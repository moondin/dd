---
source_txt: fullstack_samples/zulip-main
converted_utc: 2025-12-18T13:06:15Z
part: 1224
parts_total: 1290
---

# FULLSTACK CODE DATABASE SAMPLES zulip-main

## Verbatim Content (Part 1224 of 1290)

````text
================================================================================
FULLSTACK SAMPLES CODE DATABASE (VERBATIM) - zulip-main
================================================================================
Generated: December 18, 2025
Source: fullstack_samples/zulip-main
================================================================================

NOTES:
- This output is verbatim because the source is user-owned.
- Large/binary files may be skipped by size/binary detection limits.

================================================================================

---[FILE: lidarr_tracks_imported_upgrade_over_limit.json]---
Location: zulip-main/zerver/webhooks/lidarr/fixtures/lidarr_tracks_imported_upgrade_over_limit.json

```json
{
    "tracks": [
      {
        "id": 5257,
        "title": "Scream",
        "trackNumber": "1",
        "quality": "MP3-VBR-V0",
        "qualityVersion": 1,
        "releaseGroup": "Homely"
      },
      {
        "id": 5242,
        "title": "Billie Jean",
        "trackNumber": "1",
        "quality": "MP3-VBR-V0",
        "qualityVersion": 1,
        "releaseGroup": "Homely"
      },
      {
        "id": 5243,
        "title": "The Way You Make Me Feel",
        "trackNumber": "2",
        "quality": "MP3-VBR-V0",
        "qualityVersion": 1,
        "releaseGroup": "Homely"
      },
      {
        "id": 5258,
        "title": "They Don’t Care About Us",
        "trackNumber": "2",
        "quality": "MP3-VBR-V0",
        "qualityVersion": 1,
        "releaseGroup": "Homely"
      },
      {
        "id": 5259,
        "title": "Stranger in Moscow",
        "trackNumber": "3",
        "quality": "MP3-VBR-V0",
        "qualityVersion": 1,
        "releaseGroup": "Homely"
      },
      {
        "id": 5244,
        "title": "Black or White",
        "trackNumber": "3",
        "quality": "MP3-VBR-V0",
        "qualityVersion": 1,
        "releaseGroup": "Homely"
      },
      {
        "id": 5260,
        "title": "This Time Around",
        "trackNumber": "4",
        "quality": "MP3-VBR-V0",
        "qualityVersion": 1,
        "releaseGroup": "Homely"
      },
      {
        "id": 5245,
        "title": "Rock With You",
        "trackNumber": "4",
        "quality": "MP3-VBR-V0",
        "qualityVersion": 1,
        "releaseGroup": "Homely"
      },
      {
        "id": 5261,
        "title": "Earth Song",
        "trackNumber": "5",
        "quality": "MP3-VBR-V0",
        "qualityVersion": 1,
        "releaseGroup": "Homely"
      },
      {
        "id": 5246,
        "title": "She’s Out of My Life",
        "trackNumber": "5",
        "quality": "MP3-VBR-V0",
        "qualityVersion": 1,
        "releaseGroup": "Homely"
      },
      {
        "id": 5262,
        "title": "D.S.",
        "trackNumber": "6",
        "quality": "MP3-VBR-V0",
        "qualityVersion": 1,
        "releaseGroup": "Homely"
      },
      {
        "id": 5247,
        "title": "Bad",
        "trackNumber": "6",
        "quality": "MP3-VBR-V0",
        "qualityVersion": 1,
        "releaseGroup": "Homely"
      },
      {
        "id": 5263,
        "title": "Money",
        "trackNumber": "7",
        "quality": "MP3-VBR-V0",
        "qualityVersion": 1,
        "releaseGroup": "Homely"
      },
      {
        "id": 5248,
        "title": "I Just Can’t Stop Loving You",
        "trackNumber": "7",
        "quality": "MP3-VBR-V0",
        "qualityVersion": 1,
        "releaseGroup": "Homely"
      },
      {
        "id": 5249,
        "title": "Man in the Mirror",
        "trackNumber": "8",
        "quality": "MP3-VBR-V0",
        "qualityVersion": 1,
        "releaseGroup": "Homely"
      },
      {
        "id": 5264,
        "title": "Come Together",
        "trackNumber": "8",
        "quality": "MP3-VBR-V0",
        "qualityVersion": 1,
        "releaseGroup": "Homely"
      },
      {
        "id": 5250,
        "title": "Thriller",
        "trackNumber": "9",
        "quality": "MP3-VBR-V0",
        "qualityVersion": 1,
        "releaseGroup": "Homely"
      },
      {
        "id": 5265,
        "title": "You Are Not Alone",
        "trackNumber": "9",
        "quality": "MP3-VBR-V0",
        "qualityVersion": 1,
        "releaseGroup": "Homely"
      },
      {
        "id": 5251,
        "title": "Beat It",
        "trackNumber": "10",
        "quality": "MP3-VBR-V0",
        "qualityVersion": 1,
        "releaseGroup": "Homely"
      },
      {
        "id": 5266,
        "title": "Childhood (theme from “Free Willy 2”)",
        "trackNumber": "10",
        "quality": "MP3-VBR-V0",
        "qualityVersion": 1,
        "releaseGroup": "Homely"
      },
      {
        "id": 5267,
        "title": "Tabloid Junkie",
        "trackNumber": "11",
        "quality": "MP3-VBR-V0",
        "qualityVersion": 1,
        "releaseGroup": "Homely"
      },
      {
        "id": 5252,
        "title": "The Girl Is Mine",
        "trackNumber": "11",
        "quality": "MP3-VBR-V0",
        "qualityVersion": 1,
        "releaseGroup": "Homely"
      },
      {
        "id": 5268,
        "title": "2 Bad",
        "trackNumber": "12",
        "quality": "MP3-VBR-V0",
        "qualityVersion": 1,
        "releaseGroup": "Homely"
      },
      {
        "id": 5253,
        "title": "Remember the Time",
        "trackNumber": "12",
        "quality": "MP3-VBR-V0",
        "qualityVersion": 1,
        "releaseGroup": "Homely"
      },
      {
        "id": 5254,
        "title": "Don’t Stop ’til You Get Enough",
        "trackNumber": "13",
        "quality": "MP3-VBR-V0",
        "qualityVersion": 1,
        "releaseGroup": "Homely"
      },
      {
        "id": 5269,
        "title": "HIStory",
        "trackNumber": "13",
        "quality": "MP3-VBR-V0",
        "qualityVersion": 1,
        "releaseGroup": "Homely"
      },
      {
        "id": 5255,
        "title": "Wanna Be Startin’ Somethin’",
        "trackNumber": "14",
        "quality": "MP3-VBR-V0",
        "qualityVersion": 1,
        "releaseGroup": "Homely"
      },
      {
        "id": 5270,
        "title": "Little Susie",
        "trackNumber": "14",
        "quality": "MP3-VBR-V0",
        "qualityVersion": 1,
        "releaseGroup": "Homely"
      },
      {
        "id": 5256,
        "title": "Heal the World",
        "trackNumber": "15",
        "quality": "MP3-VBR-V0",
        "qualityVersion": 1,
        "releaseGroup": "Homely"
      },
      {
        "id": 5271,
        "title": "Smile",
        "trackNumber": "15",
        "quality": "MP3-VBR-V0",
        "qualityVersion": 1,
        "releaseGroup": "Homely"
      }
    ],
    "trackFiles": [
      {
        "id": 103,
        "path": "/home36/adbtech/media/Music/Michael Jackson/HIStory- Past, Present and Future, Book I (1995)/CD 02/Michael Jackson - HIStory- Past, Present and Future, Book I - 01 - Scream.mp3",
        "quality": "MP3-VBR-V0",
        "qualityVersion": 1,
        "releaseGroup": "Homely",
        "sceneName": "Michael_Jackson_-_History_(Past_Present_And_Future_Book_I)-2CD-1995-Homely_INT"
      },
      {
        "id": 104,
        "path": "/home36/adbtech/media/Music/Michael Jackson/HIStory- Past, Present and Future, Book I (1995)/CD 01/Michael Jackson - HIStory- Past, Present and Future, Book I - 01 - Billie Jean.mp3",
        "quality": "MP3-VBR-V0",
        "qualityVersion": 1,
        "releaseGroup": "Homely",
        "sceneName": "Michael_Jackson_-_History_(Past_Present_And_Future_Book_I)-2CD-1995-Homely_INT"
      },
      {
        "id": 105,
        "path": "/home36/adbtech/media/Music/Michael Jackson/HIStory- Past, Present and Future, Book I (1995)/CD 01/Michael Jackson - HIStory- Past, Present and Future, Book I - 02 - The Way You Make Me Feel.mp3",
        "quality": "MP3-VBR-V0",
        "qualityVersion": 1,
        "releaseGroup": "Homely",
        "sceneName": "Michael_Jackson_-_History_(Past_Present_And_Future_Book_I)-2CD-1995-Homely_INT"
      },
      {
        "id": 106,
        "path": "/home36/adbtech/media/Music/Michael Jackson/HIStory- Past, Present and Future, Book I (1995)/CD 02/Michael Jackson - HIStory- Past, Present and Future, Book I - 02 - They Don’t Care About Us.mp3",
        "quality": "MP3-VBR-V0",
        "qualityVersion": 1,
        "releaseGroup": "Homely",
        "sceneName": "Michael_Jackson_-_History_(Past_Present_And_Future_Book_I)-2CD-1995-Homely_INT"
      },
      {
        "id": 107,
        "path": "/home36/adbtech/media/Music/Michael Jackson/HIStory- Past, Present and Future, Book I (1995)/CD 02/Michael Jackson - HIStory- Past, Present and Future, Book I - 03 - Stranger in Moscow.mp3",
        "quality": "MP3-VBR-V0",
        "qualityVersion": 1,
        "releaseGroup": "Homely",
        "sceneName": "Michael_Jackson_-_History_(Past_Present_And_Future_Book_I)-2CD-1995-Homely_INT"
      },
      {
        "id": 108,
        "path": "/home36/adbtech/media/Music/Michael Jackson/HIStory- Past, Present and Future, Book I (1995)/CD 01/Michael Jackson - HIStory- Past, Present and Future, Book I - 03 - Black or White.mp3",
        "quality": "MP3-VBR-V0",
        "qualityVersion": 1,
        "releaseGroup": "Homely",
        "sceneName": "Michael_Jackson_-_History_(Past_Present_And_Future_Book_I)-2CD-1995-Homely_INT"
      },
      {
        "id": 109,
        "path": "/home36/adbtech/media/Music/Michael Jackson/HIStory- Past, Present and Future, Book I (1995)/CD 02/Michael Jackson - HIStory- Past, Present and Future, Book I - 04 - This Time Around.mp3",
        "quality": "MP3-VBR-V0",
        "qualityVersion": 1,
        "releaseGroup": "Homely",
        "sceneName": "Michael_Jackson_-_History_(Past_Present_And_Future_Book_I)-2CD-1995-Homely_INT"
      },
      {
        "id": 110,
        "path": "/home36/adbtech/media/Music/Michael Jackson/HIStory- Past, Present and Future, Book I (1995)/CD 01/Michael Jackson - HIStory- Past, Present and Future, Book I - 04 - Rock With You.mp3",
        "quality": "MP3-VBR-V0",
        "qualityVersion": 1,
        "releaseGroup": "Homely",
        "sceneName": "Michael_Jackson_-_History_(Past_Present_And_Future_Book_I)-2CD-1995-Homely_INT"
      },
      {
        "id": 111,
        "path": "/home36/adbtech/media/Music/Michael Jackson/HIStory- Past, Present and Future, Book I (1995)/CD 02/Michael Jackson - HIStory- Past, Present and Future, Book I - 05 - Earth Song.mp3",
        "quality": "MP3-VBR-V0",
        "qualityVersion": 1,
        "releaseGroup": "Homely",
        "sceneName": "Michael_Jackson_-_History_(Past_Present_And_Future_Book_I)-2CD-1995-Homely_INT"
      },
      {
        "id": 112,
        "path": "/home36/adbtech/media/Music/Michael Jackson/HIStory- Past, Present and Future, Book I (1995)/CD 01/Michael Jackson - HIStory- Past, Present and Future, Book I - 05 - She’s Out of My Life.mp3",
        "quality": "MP3-VBR-V0",
        "qualityVersion": 1,
        "releaseGroup": "Homely",
        "sceneName": "Michael_Jackson_-_History_(Past_Present_And_Future_Book_I)-2CD-1995-Homely_INT"
      },
      {
        "id": 113,
        "path": "/home36/adbtech/media/Music/Michael Jackson/HIStory- Past, Present and Future, Book I (1995)/CD 02/Michael Jackson - HIStory- Past, Present and Future, Book I - 06 - D.S.mp3",
        "quality": "MP3-VBR-V0",
        "qualityVersion": 1,
        "releaseGroup": "Homely",
        "sceneName": "Michael_Jackson_-_History_(Past_Present_And_Future_Book_I)-2CD-1995-Homely_INT"
      },
      {
        "id": 114,
        "path": "/home36/adbtech/media/Music/Michael Jackson/HIStory- Past, Present and Future, Book I (1995)/CD 01/Michael Jackson - HIStory- Past, Present and Future, Book I - 06 - Bad.mp3",
        "quality": "MP3-VBR-V0",
        "qualityVersion": 1,
        "releaseGroup": "Homely",
        "sceneName": "Michael_Jackson_-_History_(Past_Present_And_Future_Book_I)-2CD-1995-Homely_INT"
      },
      {
        "id": 115,
        "path": "/home36/adbtech/media/Music/Michael Jackson/HIStory- Past, Present and Future, Book I (1995)/CD 02/Michael Jackson - HIStory- Past, Present and Future, Book I - 07 - Money.mp3",
        "quality": "MP3-VBR-V0",
        "qualityVersion": 1,
        "releaseGroup": "Homely",
        "sceneName": "Michael_Jackson_-_History_(Past_Present_And_Future_Book_I)-2CD-1995-Homely_INT"
      },
      {
        "id": 116,
        "path": "/home36/adbtech/media/Music/Michael Jackson/HIStory- Past, Present and Future, Book I (1995)/CD 01/Michael Jackson - HIStory- Past, Present and Future, Book I - 07 - I Just Can’t Stop Loving You.mp3",
        "quality": "MP3-VBR-V0",
        "qualityVersion": 1,
        "releaseGroup": "Homely",
        "sceneName": "Michael_Jackson_-_History_(Past_Present_And_Future_Book_I)-2CD-1995-Homely_INT"
      },
      {
        "id": 117,
        "path": "/home36/adbtech/media/Music/Michael Jackson/HIStory- Past, Present and Future, Book I (1995)/CD 01/Michael Jackson - HIStory- Past, Present and Future, Book I - 08 - Man in the Mirror.mp3",
        "quality": "MP3-VBR-V0",
        "qualityVersion": 1,
        "releaseGroup": "Homely",
        "sceneName": "Michael_Jackson_-_History_(Past_Present_And_Future_Book_I)-2CD-1995-Homely_INT"
      },
      {
        "id": 118,
        "path": "/home36/adbtech/media/Music/Michael Jackson/HIStory- Past, Present and Future, Book I (1995)/CD 02/Michael Jackson - HIStory- Past, Present and Future, Book I - 08 - Come Together.mp3",
        "quality": "MP3-VBR-V0",
        "qualityVersion": 1,
        "releaseGroup": "Homely",
        "sceneName": "Michael_Jackson_-_History_(Past_Present_And_Future_Book_I)-2CD-1995-Homely_INT"
      },
      {
        "id": 119,
        "path": "/home36/adbtech/media/Music/Michael Jackson/HIStory- Past, Present and Future, Book I (1995)/CD 01/Michael Jackson - HIStory- Past, Present and Future, Book I - 09 - Thriller.mp3",
        "quality": "MP3-VBR-V0",
        "qualityVersion": 1,
        "releaseGroup": "Homely",
        "sceneName": "Michael_Jackson_-_History_(Past_Present_And_Future_Book_I)-2CD-1995-Homely_INT"
      },
      {
        "id": 120,
        "path": "/home36/adbtech/media/Music/Michael Jackson/HIStory- Past, Present and Future, Book I (1995)/CD 02/Michael Jackson - HIStory- Past, Present and Future, Book I - 09 - You Are Not Alone.mp3",
        "quality": "MP3-VBR-V0",
        "qualityVersion": 1,
        "releaseGroup": "Homely",
        "sceneName": "Michael_Jackson_-_History_(Past_Present_And_Future_Book_I)-2CD-1995-Homely_INT"
      },
      {
        "id": 121,
        "path": "/home36/adbtech/media/Music/Michael Jackson/HIStory- Past, Present and Future, Book I (1995)/CD 01/Michael Jackson - HIStory- Past, Present and Future, Book I - 10 - Beat It.mp3",
        "quality": "MP3-VBR-V0",
        "qualityVersion": 1,
        "releaseGroup": "Homely",
        "sceneName": "Michael_Jackson_-_History_(Past_Present_And_Future_Book_I)-2CD-1995-Homely_INT"
      },
      {
        "id": 122,
        "path": "/home36/adbtech/media/Music/Michael Jackson/HIStory- Past, Present and Future, Book I (1995)/CD 02/Michael Jackson - HIStory- Past, Present and Future, Book I - 10 - Childhood (theme from “Free Willy 2”).mp3",
        "quality": "MP3-VBR-V0",
        "qualityVersion": 1,
        "releaseGroup": "Homely",
        "sceneName": "Michael_Jackson_-_History_(Past_Present_And_Future_Book_I)-2CD-1995-Homely_INT"
      },
      {
        "id": 123,
        "path": "/home36/adbtech/media/Music/Michael Jackson/HIStory- Past, Present and Future, Book I (1995)/CD 02/Michael Jackson - HIStory- Past, Present and Future, Book I - 11 - Tabloid Junkie.mp3",
        "quality": "MP3-VBR-V0",
        "qualityVersion": 1,
        "releaseGroup": "Homely",
        "sceneName": "Michael_Jackson_-_History_(Past_Present_And_Future_Book_I)-2CD-1995-Homely_INT"
      },
      {
        "id": 124,
        "path": "/home36/adbtech/media/Music/Michael Jackson/HIStory- Past, Present and Future, Book I (1995)/CD 01/Michael Jackson - HIStory- Past, Present and Future, Book I - 11 - The Girl Is Mine.mp3",
        "quality": "MP3-VBR-V0",
        "qualityVersion": 1,
        "releaseGroup": "Homely",
        "sceneName": "Michael_Jackson_-_History_(Past_Present_And_Future_Book_I)-2CD-1995-Homely_INT"
      },
      {
        "id": 125,
        "path": "/home36/adbtech/media/Music/Michael Jackson/HIStory- Past, Present and Future, Book I (1995)/CD 02/Michael Jackson - HIStory- Past, Present and Future, Book I - 12 - 2 Bad.mp3",
        "quality": "MP3-VBR-V0",
        "qualityVersion": 1,
        "releaseGroup": "Homely",
        "sceneName": "Michael_Jackson_-_History_(Past_Present_And_Future_Book_I)-2CD-1995-Homely_INT"
      },
      {
        "id": 126,
        "path": "/home36/adbtech/media/Music/Michael Jackson/HIStory- Past, Present and Future, Book I (1995)/CD 01/Michael Jackson - HIStory- Past, Present and Future, Book I - 12 - Remember the Time.mp3",
        "quality": "MP3-VBR-V0",
        "qualityVersion": 1,
        "releaseGroup": "Homely",
        "sceneName": "Michael_Jackson_-_History_(Past_Present_And_Future_Book_I)-2CD-1995-Homely_INT"
      },
      {
        "id": 127,
        "path": "/home36/adbtech/media/Music/Michael Jackson/HIStory- Past, Present and Future, Book I (1995)/CD 01/Michael Jackson - HIStory- Past, Present and Future, Book I - 13 - Don’t Stop ’til You Get Enough.mp3",
        "quality": "MP3-VBR-V0",
        "qualityVersion": 1,
        "releaseGroup": "Homely",
        "sceneName": "Michael_Jackson_-_History_(Past_Present_And_Future_Book_I)-2CD-1995-Homely_INT"
      },
      {
        "id": 128,
        "path": "/home36/adbtech/media/Music/Michael Jackson/HIStory- Past, Present and Future, Book I (1995)/CD 02/Michael Jackson - HIStory- Past, Present and Future, Book I - 13 - HIStory.mp3",
        "quality": "MP3-VBR-V0",
        "qualityVersion": 1,
        "releaseGroup": "Homely",
        "sceneName": "Michael_Jackson_-_History_(Past_Present_And_Future_Book_I)-2CD-1995-Homely_INT"
      },
      {
        "id": 129,
        "path": "/home36/adbtech/media/Music/Michael Jackson/HIStory- Past, Present and Future, Book I (1995)/CD 01/Michael Jackson - HIStory- Past, Present and Future, Book I - 14 - Wanna Be Startin’ Somethin’.mp3",
        "quality": "MP3-VBR-V0",
        "qualityVersion": 1,
        "releaseGroup": "Homely",
        "sceneName": "Michael_Jackson_-_History_(Past_Present_And_Future_Book_I)-2CD-1995-Homely_INT"
      },
      {
        "id": 130,
        "path": "/home36/adbtech/media/Music/Michael Jackson/HIStory- Past, Present and Future, Book I (1995)/CD 02/Michael Jackson - HIStory- Past, Present and Future, Book I - 14 - Little Susie.mp3",
        "quality": "MP3-VBR-V0",
        "qualityVersion": 1,
        "releaseGroup": "Homely",
        "sceneName": "Michael_Jackson_-_History_(Past_Present_And_Future_Book_I)-2CD-1995-Homely_INT"
      },
      {
        "id": 131,
        "path": "/home36/adbtech/media/Music/Michael Jackson/HIStory- Past, Present and Future, Book I (1995)/CD 01/Michael Jackson - HIStory- Past, Present and Future, Book I - 15 - Heal the World.mp3",
        "quality": "MP3-VBR-V0",
        "qualityVersion": 1,
        "releaseGroup": "Homely",
        "sceneName": "Michael_Jackson_-_History_(Past_Present_And_Future_Book_I)-2CD-1995-Homely_INT"
      },
      {
        "id": 132,
        "path": "/home36/adbtech/media/Music/Michael Jackson/HIStory- Past, Present and Future, Book I (1995)/CD 02/Michael Jackson - HIStory- Past, Present and Future, Book I - 15 - Smile.mp3",
        "quality": "MP3-VBR-V0",
        "qualityVersion": 1,
        "releaseGroup": "Homely",
        "sceneName": "Michael_Jackson_-_History_(Past_Present_And_Future_Book_I)-2CD-1995-Homely_INT"
      }
    ],
    "isUpgrade": true,
    "eventType": "Download",
    "artist": {
      "id": 4,
      "name": "Michael Jackson",
      "path": "/home36/adbtech/media/Music/Michael Jackson",
      "mbId": "f27ec8db-af05-4f36-916e-3d57f91ecf5e"
    }
}
```

--------------------------------------------------------------------------------

---[FILE: lidarr_tracks_renamed.json]---
Location: zulip-main/zerver/webhooks/lidarr/fixtures/lidarr_tracks_renamed.json

```json
{
    "eventType": "Rename",
    "artist": {
      "id": 3,
      "name": "Little Mix",
      "path": "/home36/adbtech/media/Music/Little Mix",
      "mbId": "38f59974-2f4d-4bfa-b2e3-d2696de1b675"
    }
}
```

--------------------------------------------------------------------------------

---[FILE: lidarr_tracks_retagged.json]---
Location: zulip-main/zerver/webhooks/lidarr/fixtures/lidarr_tracks_retagged.json

```json
{
    "eventType": "Retag",
    "artist": {
      "id": 3,
      "name": "Little Mix",
      "path": "/home36/adbtech/media/Music/Little Mix",
      "mbId": "38f59974-2f4d-4bfa-b2e3-d2696de1b675"
    }
}
```

--------------------------------------------------------------------------------

---[FILE: doc.md]---
Location: zulip-main/zerver/webhooks/linear/doc.md

```text
# Zulip Linear integration

Get Linear notifications in Zulip!

{start_tabs}

1. {!create-an-incoming-webhook.md!}

1. {!generate-webhook-url-basic.md!}

1. Go to your team on Linear, and open **Settings**. Select **API**,
   and click on **New Webhook**.

1. Set **Webhook URL** to the URL generated above. Select the **Data
   change events** you'd like to receive notifications for, and click
   **Create Webhook**.

{end_tabs}

{!congrats.md!}

![Linear Integration](/static/images/integrations/linear/001.png)

{!event-filtering-additional-feature.md!}

### Related documentation

- [Linear webhook events documentation][linear-webhooks]

{!webhooks-url-specification.md!}

[linear-webhooks]: https://developers.linear.app/docs/graphql/webhooks
```

--------------------------------------------------------------------------------

---[FILE: tests.py]---
Location: zulip-main/zerver/webhooks/linear/tests.py

```python
from zerver.lib.test_classes import WebhookTestCase


class LinearHookTests(WebhookTestCase):
    CHANNEL_NAME = "Linear"
    URL_TEMPLATE = "/api/v1/external/linear?&api_key={api_key}&stream={stream}"
    WEBHOOK_DIR_NAME = "linear"

    def test_issue_create_simple_without_description(self) -> None:
        expected_topic_name = "Issue: Drop-down overflow in the select menu."
        expected_message = "[Issue](https://linear.app/webhooks/issue/WEB-42/drop-down-overflow-in-the-select-menu) was created in team Webhooks.\nPriority: High, Status: Todo."
        self.check_webhook(
            "issue_create_simple_without_description",
            expected_topic_name,
            expected_message,
        )

    def test_issue_create_simple_without_description_with_custom_topic_in_url(self) -> None:
        self.url = self.build_webhook_url(topic="notifications")
        expected_topic_name = "notifications"
        expected_message = "[Issue](https://linear.app/webhooks/issue/WEB-42/drop-down-overflow-in-the-select-menu) was created in team Webhooks.\nPriority: High, Status: Todo."
        self.check_webhook(
            "issue_create_simple_without_description",
            expected_topic_name,
            expected_message,
        )

    def test_issue_create_simple(self) -> None:
        expected_topic_name = "Issue: Very small font in tooltip"
        expected_message = '[Issue](https://linear.app/webhooks/issue/WEB-43/very-small-font-in-tooltip) was created in team Webhooks:\n~~~ quote\nThe tooltips at the "Select Drawing" and "Edit Drawing" buttons have a very small font and therefore are not very legible. Apart from this, the wording of the text has to be changed to fit better with the overall design pattern.\n~~~\n\nStatus: Todo.'
        self.check_webhook("issue_create_simple", expected_topic_name, expected_message)

    def test_issue_create_complex(self) -> None:
        expected_topic_name = "Issue: This is regarding the outage that we faced during ..."
        expected_message = "[Issue](https://linear.app/webhooks/issue/WEB-44/this-is-regarding-the-outage-that-we-faced-during-111222-from-2000-to) was created in team Webhooks:\n~~~ quote\nThe outage that occurred on the above-mentioned date is a cause for concern as it could have significant implications for the organization and its users. A prolonged outage can result in lost revenue, productivity, and customer confidence. Therefore, it is essential to conduct a detailed assessment and analysis to identify the root cause of the outage and take appropriate measures to prevent its recurrence.\n\nThe analysis process may involve the use of specialized tools and techniques to help pinpoint the exact cause of the outage. Once the root cause has been identified, the organization can take steps to implement effective solutions that can mitigate the risk of a similar outage happening in the future. The assessment and analysis process will help the organization to develop a more robust and reliable IT infrastructure that can provide uninterrupted services to its users.\n~~~\n\nPriority: Urgent, Assignee: Satyam Bansal, Status: In Progress."
        self.check_webhook("issue_create_complex", expected_topic_name, expected_message)

    def test_comment_create(self) -> None:
        expected_topic_name = "Issue: Thorough Impact Analysis and Cost Realization"
        expected_message = "Satyam Bansal [commented](https://linear.app/webhooks/issue/WEB-46#comment-c7cafc52) on issue **Thorough Impact Analysis and Cost Realization**:\n~~~ quote\nPerforming a thorough impact analysis and cost realization is a crucial step in responding to any system outage or incident. By examining the extent of the outage, the affected systems or services, the number of users impacted, and any error messages or logs generated during the incident, we can gain a comprehensive understanding of the scope of the incident.\n\nThis information can then be used to prioritize the resolution efforts and minimize the impact on our organization's operations. Additionally, cost realization allows us to evaluate the financial impact of the outage on our organization and make informed decisions regarding resource allocation for future incidents.\n\nOverall, conducting a thorough impact analysis and cost realization can help us effectively manage incidents and prevent similar issues from occurring in the future.\n~~~"
        self.check_webhook("comment_create", expected_topic_name, expected_message)

    def test_comment_remove(self) -> None:
        expected_topic_name = "Issue: Thorough Impact Analysis and Cost Realization"
        expected_message = "Satyam Bansal has removed a comment."
        self.check_webhook("comment_remove", expected_topic_name, expected_message)

    def test_comment_update(self) -> None:
        expected_topic_name = "Issue: Thorough Impact Analysis and Cost Realization"
        expected_message = "Satyam Bansal [updated comment](https://linear.app/webhooks/issue/WEB-46#comment-c7cafc52) on issue **Thorough Impact Analysis and Cost Realization**:\n~~~ quote\nInvalid response to any system outage or incident, it is essential to perform a comprehensive impact analysis and cost evaluation. By examining factors such as the extent of the outage, the affected systems or services, the number of users affected, and any error messages or logs generated during the incident, we can gain a detailed understanding of the incident's scope.\n\nThis information is then critical in prioritizing resolution efforts and reducing the impact on our organization's operations. Additionally, conducting cost realization allows us to assess the financial implications of the outage and make informed decisions about allocating resources for future incidents.\n\nOverall, performing a thorough impact analysis and cost realization is an effective way to manage incidents and prevent similar issues from recurring.\n~~~"
        self.check_webhook("comment_update", expected_topic_name, expected_message)

    def test_issue_remove(self) -> None:
        expected_topic_name = "Issue: This is regarding the outage that we faced on 11/1..."
        expected_message = "This issue has been removed from team Webhooks."
        self.check_webhook("issue_remove", expected_topic_name, expected_message)

    def test_issue_sub_issue_create(self) -> None:
        expected_topic_name = "Sub-Issue: Impact Analysis"
        expected_message = "[Sub-Issue](https://linear.app/webhooks/issue/WEB-46/impact-analysis) was created in team Webhooks:\n~~~ quote\nExamining the extent of the outage, the affected systems or services, the number of users impacted, and any error messages or logs generated during the incident.\n~~~\n\nStatus: Todo."
        self.check_webhook("issue_sub_issue_create", expected_topic_name, expected_message)

    def test_issue_sub_issue_remove(self) -> None:
        expected_topic_name = "Sub-Issue: Thorough Impact Analysis and Cost Realization"
        expected_message = "This issue has been removed from team Webhooks."
        self.check_webhook("issue_sub_issue_remove", expected_topic_name, expected_message)

    def test_issue_sub_issue_update(self) -> None:
        expected_topic_name = "Sub-Issue: Thorough Impact Analysis and Cost Realization"
        expected_message = "[Sub-Issue](https://linear.app/webhooks/issue/WEB-46/thorough-impact-analysis-and-cost-realization) was updated in team Webhooks:\n~~~ quote\nExamining the extent of the outage, the affected systems or services, the number of users impacted, and any error messages or logs generated during the incident.\n~~~\n\nStatus: Todo."
        self.check_webhook("issue_sub_issue_update", expected_topic_name, expected_message)

    def test_issue_update(self) -> None:
        expected_topic_name = "Issue: This is regarding the outage that we faced on 11/1..."
        expected_message = "[Issue](https://linear.app/webhooks/issue/WEB-44/this-is-regarding-the-outage-that-we-faced-on-111222-from-2000-to-2200) was updated in team Webhooks:\n~~~ quote\nThe outage that occurred on the above-mentioned date is a cause for concern as it could have significant implications for the organization and its users. A prolonged outage can result in lost revenue, productivity, and customer confidence. Therefore, it is essential to conduct a detailed assessment and analysis to identify the root cause of the outage and take appropriate measures to prevent its recurrence.\n\nThe analysis process may involve the use of specialized tools and techniques to help pinpoint the exact cause of the outage. Once the root cause has been identified, the organization can take steps to implement effective solutions that can mitigate the risk of a similar outage happening in the future. The assessment and analysis process will help the organization to develop a more robust and reliable IT infrastructure that can provide uninterrupted services to its users.\n~~~\n\nPriority: Urgent, Assignee: Satyam Bansal, Status: In Progress."
        self.check_webhook("issue_update", expected_topic_name, expected_message)

    def test_project_create(self) -> None:
        payload = self.get_body("project_create")
        result = self.client_post(
            self.url,
            payload,
            content_type="application/json",
        )
        self.assert_json_success(result)
```

--------------------------------------------------------------------------------

---[FILE: view.py]---
Location: zulip-main/zerver/webhooks/linear/view.py
Signals: Django

```python
from collections.abc import Callable

from django.http import HttpRequest, HttpResponse

from zerver.decorator import webhook_view
from zerver.lib.exceptions import UnsupportedWebhookEventTypeError
from zerver.lib.response import json_success
from zerver.lib.typed_endpoint import JsonBodyPayload, typed_endpoint
from zerver.lib.validator import WildValue, check_int, check_string
from zerver.lib.webhooks.common import OptionalUserSpecifiedTopicStr, check_send_webhook_message
from zerver.models import UserProfile

CONTENT_MESSAGE_TEMPLATE = "\n~~~ quote\n{message}\n~~~\n"

ISSUE_CREATE_OR_UPDATE_TEMPLATE = "[{type}]({url}) was {action} in team {team_name}"

ISSUE_REMOVE_TEMPLATE = "This issue has been removed from team {team_name}."
COMMENT_CREATE_OR_UPDATE_TEMPLATE = "{user} [{action}]({url}) on issue **{issue_title}**:"
COMMENT_REMOVE_TEMPLATE = "{user} has removed a comment."


def get_issue_created_or_updated_message(event: str, payload: WildValue, action: str) -> str:
    message = ISSUE_CREATE_OR_UPDATE_TEMPLATE.format(
        type="Issue" if event == "issue" else "Sub-Issue",
        number=payload["data"]["number"].tame(check_int),
        title=payload["data"]["title"].tame(check_string),
        url=payload["url"].tame(check_string),
        action=action,
        team_name=payload["data"]["team"]["name"].tame(check_string),
    )

    has_description = "description" in payload["data"]
    if has_description:
        message += f":{CONTENT_MESSAGE_TEMPLATE.format(message=payload['data']['description'].tame(check_string))}"
    else:
        message += "."

    to_add = []

    priority_label = payload["data"]["priorityLabel"].tame(check_string)
    if priority_label != "No priority":
        to_add.append(f"Priority: {priority_label}")

    has_assignee = "assignee" in payload["data"]
    if has_assignee:
        to_add.append(f"Assignee: {payload['data']['assignee']['name'].tame(check_string)}")

    status = payload["data"]["state"]["name"].tame(check_string)
    to_add.append(f"Status: {status}")

    message += f"\n{', '.join(to_add)}."

    return message


def get_issue_remove_body(payload: WildValue, event: str) -> str:
    return ISSUE_REMOVE_TEMPLATE.format(
        type="Issue" if event == "issue" else "Sub-Issue",
        number=payload["data"]["number"].tame(check_int),
        title=payload["data"]["title"].tame(check_string),
        team_name=payload["data"]["team"]["name"].tame(check_string),
    )


def get_comment_create_or_update_body(payload: WildValue, event: str, action: str) -> str:
    message = COMMENT_CREATE_OR_UPDATE_TEMPLATE.format(
        user=payload["data"]["user"]["name"].tame(check_string),
        action=action,
        url=payload["url"].tame(check_string),
        issue_title=payload["data"]["issue"]["title"].tame(check_string),
    )
    message += CONTENT_MESSAGE_TEMPLATE.format(message=payload["data"]["body"].tame(check_string))
    return message


def get_comment_remove_body(payload: WildValue, event: str) -> str:
    return COMMENT_REMOVE_TEMPLATE.format(user=payload["data"]["user"]["name"].tame(check_string))


def get_issue_or_sub_issue_message(payload: WildValue, event: str) -> str:
    action = payload["action"].tame(check_string)
    if action == "remove":
        return get_issue_remove_body(payload, event)

    return get_issue_created_or_updated_message(
        event, payload, action="created" if action == "create" else "updated"
    )


def get_comment_message(payload: WildValue, event: str) -> str:
    action = payload["action"].tame(check_string)
    if action == "remove":
        return get_comment_remove_body(payload, event)

    return get_comment_create_or_update_body(
        payload, event, "commented" if action == "create" else "updated comment"
    )


EVENT_FUNCTION_MAPPER: dict[str, Callable[[WildValue, str], str]] = {
    "issue": get_issue_or_sub_issue_message,
    "sub_issue": get_issue_or_sub_issue_message,
    "comment": get_comment_message,
}

IGNORED_EVENTS = ["IssueLabel", "Project", "ProjectUpdate", "Cycle", "Reaction"]

ALL_EVENT_TYPES = list(EVENT_FUNCTION_MAPPER.keys())


@webhook_view("Linear", notify_bot_owner_on_invalid_json=True, all_event_types=ALL_EVENT_TYPES)
@typed_endpoint
def api_linear_webhook(
    request: HttpRequest,
    user_profile: UserProfile,
    *,
    payload: JsonBodyPayload[WildValue],
    user_specified_topic: OptionalUserSpecifiedTopicStr = None,
) -> HttpResponse:
    event_type = get_event_type(payload)
    if event_type is None:
        return json_success(request)

    topic_name = get_topic(user_specified_topic, event_type, payload)

    body_function = EVENT_FUNCTION_MAPPER[event_type]
    body = body_function(payload, event_type)

    check_send_webhook_message(request, user_profile, topic_name, body)

    return json_success(request)


def get_topic(user_specified_topic: str | None, event: str, payload: WildValue) -> str:
    if user_specified_topic is not None:
        return user_specified_topic
    elif event == "comment":
        issue_title = payload["data"]["issue"]["title"].tame(check_string)
        return f"Issue: {issue_title}"
    elif event == "sub_issue":
        title = payload["data"]["title"].tame(check_string)
        return f"Sub-Issue: {title}"
    elif event == "issue":
        title = payload["data"]["title"].tame(check_string)
        return f"Issue: {title}"

    raise UnsupportedWebhookEventTypeError(event)


def get_event_type(payload: WildValue) -> str | None:
    event_type = payload["type"].tame(check_string)

    if event_type == "Issue":
        has_parent_id = "parentId" in payload["data"]
        return "issue" if not has_parent_id else "sub_issue"
    elif event_type == "Comment":
        return "comment"
    elif event_type in IGNORED_EVENTS:
        return None

    # This happens when a new event type is added to Linear and we
    # haven't updated the integration yet.
    complete_event = "{}:{}".format(
        event_type, payload.get("action", "???").tame(check_string)
    )  # nocoverage

    raise UnsupportedWebhookEventTypeError(complete_event)
```

--------------------------------------------------------------------------------

---[FILE: comment_create.json]---
Location: zulip-main/zerver/webhooks/linear/fixtures/comment_create.json

```json
{
    "action": "create",
    "createdAt": "2023-04-11T10:21:34.858Z",
    "data": {
        "id": "c7cafc52-994d-4984-a217-bff9f9aa9473",
        "createdAt": "2023-04-11T10:21:34.858Z",
        "updatedAt": "2023-04-11T10:21:34.858Z",
        "body": "Performing a thorough impact analysis and cost realization is a crucial step in responding to any system outage or incident. By examining the extent of the outage, the affected systems or services, the number of users impacted, and any error messages or logs generated during the incident, we can gain a comprehensive understanding of the scope of the incident.\n\nThis information can then be used to prioritize the resolution efforts and minimize the impact on our organization's operations. Additionally, cost realization allows us to evaluate the financial impact of the outage on our organization and make informed decisions regarding resource allocation for future incidents.\n\nOverall, conducting a thorough impact analysis and cost realization can help us effectively manage incidents and prevent similar issues from occurring in the future.",
        "issueId": "f9a37fcf-eb52-44be-a52c-0477f70e9952",
        "userId": "674c90c8-35ea-454d-8ca4-5548258fd795",
        "reactionData": [],
        "issue": {
            "id": "f9a37fcf-eb52-44be-a52c-0477f70e9952",
            "title": "Thorough Impact Analysis and Cost Realization"
        },
        "user": {
            "id": "674c90c8-35ea-454d-8ca4-5548258fd795",
            "name": "Satyam Bansal"
        }
    },
    "url": "https://linear.app/webhooks/issue/WEB-46#comment-c7cafc52",
    "type": "Comment",
    "organizationId": "7a661544-df08-4cd1-a1e3-5ec611898806",
    "webhookTimestamp": 1681208494995
}
```

--------------------------------------------------------------------------------

---[FILE: comment_remove.json]---
Location: zulip-main/zerver/webhooks/linear/fixtures/comment_remove.json

```json
{
    "action": "remove",
    "createdAt": "2023-04-11T10:22:42.436Z",
    "data": {
        "id": "c7cafc52-994d-4984-a217-bff9f9aa9473",
        "createdAt": "2023-04-11T10:21:34.858Z",
        "updatedAt": "2023-04-11T10:22:24.895Z",
        "body": "In responding to any system outage or incident, it is essential to perform a comprehensive impact analysis and cost evaluation. By examining factors such as the extent of the outage, the affected systems or services, the number of users affected, and any error messages or logs generated during the incident, we can gain a detailed understanding of the incident's scope.\n\nThis information is then critical in prioritizing resolution efforts and reducing the impact on our organization's operations. Additionally, conducting cost realization allows us to assess the financial implications of the outage and make informed decisions about allocating resources for future incidents.\n\nOverall, performing a thorough impact analysis and cost realization is an effective way to manage incidents and prevent similar issues from recurring.",
        "issueId": "f9a37fcf-eb52-44be-a52c-0477f70e9952",
        "userId": "674c90c8-35ea-454d-8ca4-5548258fd795",
        "editedAt": "2023-04-11T10:22:24.895Z",
        "reactionData": [],
        "issue": {
            "id": "f9a37fcf-eb52-44be-a52c-0477f70e9952",
            "title": "Thorough Impact Analysis and Cost Realization"
        },
        "user": {
            "id": "674c90c8-35ea-454d-8ca4-5548258fd795",
            "name": "Satyam Bansal"
        }
    },
    "type": "Comment",
    "organizationId": "7a661544-df08-4cd1-a1e3-5ec611898806",
    "webhookTimestamp": 1681208562499
}
```

--------------------------------------------------------------------------------

````
