---
source_txt: user_created_projects/vscode-main
converted_utc: 2025-12-18T18:22:26Z
part: 95
parts_total: 552
---

# FULLSTACK CODE DATABASE USER CREATED vscode-main

## Verbatim Content (Part 95 of 552)

````text
================================================================================
FULLSTACK USER CREATED CODE DATABASE (VERBATIM) - vscode-main
================================================================================
Generated: December 18, 2025
Source: user_created_projects/vscode-main
================================================================================

NOTES:
- This output is verbatim because the source is user-owned.
- Large/binary files may be skipped by size/binary detection limits.

================================================================================

---[FILE: extensions/typescript-language-features/resources/walkthroughs/install-node-js.svg]---
Location: vscode-main/extensions/typescript-language-features/resources/walkthroughs/install-node-js.svg

```text
<svg width="583" height="287" viewBox="0 0 583 287" fill="none" xmlns="http://www.w3.org/2000/svg">
  <g filter="url(#filter0_d_1720_12308)">
    <rect width="520" height="255" transform="translate(16 14)" fill="var(--vscode-quickInput-background, #252526)" />
    <g>
      <g>
        <g>
          <g>
            <path d="M40.4912 37V30.2861H42.9243V29.2495H36.8496V30.2861H39.2881V37H40.4912ZM49.3213 35.9634H45.6045V33.5518H49.1226V32.5527H45.6045V30.2861H49.3213V29.2495H44.4014V37H49.3213V35.9634ZM52.2646 34.019H53.9619L55.541 37H56.9321L55.1919 33.8311C56.1372 33.5142 56.6958 32.6655 56.6958 31.6182C56.6958 30.1733 55.6914 29.2495 54.1284 29.2495H51.0615V37H52.2646V34.019ZM52.2646 30.2593H53.9619C54.8911 30.2593 55.4604 30.7803 55.4604 31.645C55.4604 32.5312 54.9233 33.0308 53.9941 33.0308H52.2646V30.2593ZM66.251 37V29.2495H64.8438L62.373 35.3135H62.2817L59.8164 29.2495H58.4092V37H59.5264V31.3228H59.6016L61.8735 36.8604H62.7866L65.0586 31.3228H65.1338V37H66.251ZM69.3984 37V29.2495H68.1953V37H69.3984ZM72.5137 37V31.3711H72.5996L76.5796 37H77.6646V29.2495H76.4937V34.8892H76.4077L72.4277 29.2495H71.3428V37H72.5137ZM84.6309 37H85.9092L83.1108 29.2495H81.8164L79.0181 37H80.2534L80.9678 34.9053H83.9219L84.6309 37ZM82.4019 30.6191H82.4932L83.6157 33.9385H81.2739L82.4019 30.6191ZM92.0967 35.9526H88.4658V29.2495H87.2627V37H92.0967V35.9526Z" fill="var(--vscode-panelTitle-activeForeground, #FFFFFF)" />
            <rect x="36" y="48" width="57" height="1" fill="var(--vscode-panelTitle-activeForeground, #E7E7E7)" />
          </g>
        </g>
      </g>
      <g>
        <rect x="117" y="31" width="40" height="6" rx="3" fill="var(--vscode-list-deemphasizedForeground, #FFFFFF)" fill-opacity="0.16" />
      </g>
      <g>
        <rect x="181" y="31" width="50" height="6" rx="3" fill="var(--vscode-list-deemphasizedForeground, #FFFFFF)" fill-opacity="0.16" />
      </g>
      <g>
        <rect x="255" y="31" width="40" height="6" rx="3" fill="var(--vscode-list-deemphasizedForeground, #FFFFFF)" fill-opacity="0.16" />
      </g>
    </g>
    <g>
      <path d="M42.876 82.42C43.212 82.42 43.536 82.24 44.112 81.688L47.496 78.4L44.04 75.04C43.548 74.56 43.2 74.38 42.876 74.38C42.312 74.38 41.772 74.956 41.772 75.46C41.772 75.616 41.82 75.784 41.928 75.964C42.036 76.144 42.252 76.384 42.576 76.696L43.164 77.26H38.208C37.752 77.26 37.416 77.296 37.224 77.368C36.84 77.524 36.612 77.824 36.612 78.4C36.612 78.688 36.672 78.916 36.78 79.072C36.996 79.408 37.296 79.54 38.208 79.54H43.164C42.648 80.008 41.772 80.776 41.772 81.34C41.772 81.856 42.324 82.42 42.876 82.42Z" fill="#F14C4C" />
      <path d="M57.6661 77.3418V82H56.2806V75.4545H57.6552V76.3273H57.9279C58.0661 76.0218 58.237 75.7855 58.4406 75.6182C58.6443 75.4509 58.8697 75.3673 59.117 75.3673C59.3788 75.3673 59.6043 75.4509 59.7934 75.6182C59.9825 75.7782 60.1134 76.0145 60.1861 76.3273H60.4588C60.5897 76.0218 60.7679 75.7855 60.9934 75.6182C61.2188 75.4509 61.4734 75.3673 61.757 75.3673C62.0915 75.3673 62.357 75.5091 62.5534 75.7927C62.757 76.0691 62.8588 76.4473 62.8588 76.9273V82H61.4734V77.2109C61.4734 76.9636 61.4406 76.7782 61.3752 76.6545C61.3097 76.5236 61.2152 76.4582 61.0915 76.4582C60.9752 76.4582 60.8406 76.5382 60.6879 76.6982C60.5352 76.8509 60.3897 77.0655 60.2515 77.3418V82H58.8879V77.2109C58.8879 76.9636 58.8515 76.7782 58.7788 76.6545C58.7134 76.5236 58.6225 76.4582 58.5061 76.4582C58.3897 76.4582 58.2552 76.5345 58.1025 76.6873C57.957 76.8327 57.8115 77.0509 57.6661 77.3418ZM65.394 84.28C65.1831 84.28 64.9613 84.2691 64.7285 84.2473C64.5031 84.2255 64.2667 84.1964 64.0194 84.16L64.1613 82.9055C64.4158 82.9564 64.6449 82.9927 64.8485 83.0145C65.0522 83.0436 65.234 83.0582 65.394 83.0582C65.7649 83.0582 66.0631 82.9709 66.2885 82.7964C66.5213 82.6218 66.7067 82.3091 66.8449 81.8582L66.8667 81.7818H65.9722L63.9213 75.4545H65.6231L67.2049 80.6909L68.8413 75.4545H70.4776L68.274 82.0218C68.0049 82.8436 67.6449 83.4255 67.194 83.7673C66.7431 84.1091 66.1431 84.28 65.394 84.28ZM71.7364 78.8909V77.4182H77.9546V78.8909H71.7364ZM82.4643 80.8436C82.9225 80.8436 83.2571 80.7455 83.468 80.5491C83.6862 80.3527 83.7952 80.0327 83.7952 79.5891V77.8873C83.7952 77.4727 83.708 77.1673 83.5334 76.9709C83.3589 76.7745 83.1007 76.6764 82.7589 76.6764C82.4752 76.6764 82.2062 76.7455 81.9516 76.8836C81.7043 77.0218 81.4462 77.2364 81.1771 77.5273V80.4945C81.3807 80.6109 81.5807 80.6982 81.7771 80.7564C81.9734 80.8145 82.2025 80.8436 82.4643 80.8436ZM82.6716 82.0873C82.4243 82.0873 82.1698 82.0618 81.908 82.0109C81.6462 81.9673 81.4025 81.8982 81.1771 81.8036V84.1818H79.5407V75.4545H81.1771V76.6H81.5043C81.6789 76.2145 81.9407 75.9091 82.2898 75.6836C82.6389 75.4582 83.0243 75.3455 83.4462 75.3455C84.0571 75.3455 84.5407 75.5564 84.8971 75.9782C85.2534 76.3927 85.4316 76.96 85.4316 77.68V79.6109C85.4316 80.3673 85.1843 80.9709 84.6898 81.4218C84.1952 81.8655 83.5225 82.0873 82.6716 82.0873ZM87.5631 82V75.4545H89.1995V76.6H89.5268C89.6868 76.1636 89.9304 75.8473 90.2577 75.6509C90.5922 75.4473 90.9886 75.3455 91.4468 75.3455C91.9704 75.3455 92.385 75.5091 92.6904 75.8364C93.0031 76.1564 93.1595 76.6109 93.1595 77.2V78.3018H91.654V77.7018C91.654 77.3673 91.5777 77.1127 91.425 76.9382C91.2795 76.7636 91.0395 76.6764 90.705 76.6764C90.414 76.6764 90.1377 76.7491 89.8759 76.8945C89.6213 77.0327 89.3959 77.2618 89.1995 77.5818V82H87.5631ZM97.7674 82.1091C96.8365 82.1091 96.1129 81.8945 95.5965 81.4655C95.0801 81.0291 94.8219 80.4182 94.8219 79.6327V77.8655C94.8219 77.0655 95.0801 76.4473 95.5965 76.0109C96.1201 75.5673 96.8474 75.3455 97.7783 75.3455C98.7092 75.3455 99.4292 75.5709 99.9383 76.0218C100.455 76.4655 100.713 77.0873 100.713 77.8873V79.6545C100.713 80.4327 100.455 81.0364 99.9383 81.4655C99.4219 81.8945 98.6983 82.1091 97.7674 82.1091ZM97.7674 80.8545C98.2183 80.8545 98.5492 80.7527 98.7601 80.5491C98.971 80.3382 99.0765 80.0145 99.0765 79.5782V77.9091C99.0765 77.4582 98.971 77.1273 98.7601 76.9164C98.5492 76.7055 98.2183 76.6 97.7674 76.6C97.3165 76.6 96.9856 76.7055 96.7747 76.9164C96.5638 77.1273 96.4583 77.4545 96.4583 77.8982V79.5455C96.4583 79.9964 96.5638 80.3273 96.7747 80.5382C96.9856 80.7491 97.3165 80.8545 97.7674 80.8545ZM104.295 84.28C103.983 84.28 103.67 84.2618 103.357 84.2255C103.052 84.1964 102.739 84.1345 102.419 84.04L102.637 82.8291C102.921 82.9236 103.186 82.9818 103.433 83.0036C103.681 83.0327 103.917 83.0473 104.143 83.0473C104.601 83.0473 104.961 82.9564 105.223 82.7745C105.492 82.5927 105.626 82.2945 105.626 81.88V76.7091H102.746V75.4545H107.263V82.0436C107.263 82.7709 106.99 83.3236 106.444 83.7018C105.899 84.0873 105.183 84.28 104.295 84.28ZM106.379 74.3636C106.03 74.3636 105.746 74.3091 105.528 74.2C105.317 74.0909 105.212 73.9018 105.212 73.6327V73.5127C105.212 73.2364 105.317 73.0436 105.528 72.9345C105.746 72.8182 106.03 72.76 106.379 72.76C106.728 72.76 107.008 72.8182 107.219 72.9345C107.437 73.0436 107.546 73.2364 107.546 73.5127V73.6327C107.546 73.9018 107.437 74.0909 107.219 74.2C107.001 74.3091 106.721 74.3636 106.379 74.3636ZM116.081 80.5055C115.841 81.0945 115.503 81.5091 115.067 81.7491C114.638 81.9891 113.976 82.1091 113.081 82.1091C112.194 82.1091 111.474 81.9018 110.921 81.4873C110.376 81.0655 110.103 80.44 110.103 79.6109V77.8655C110.103 77.0509 110.369 76.4291 110.9 76C111.438 75.5636 112.158 75.3455 113.06 75.3455C113.969 75.3455 114.685 75.5636 115.209 76C115.732 76.4364 115.994 77.0727 115.994 77.9091V79.0545H111.74V79.6873C111.74 80.1164 111.849 80.4364 112.067 80.6473C112.285 80.8582 112.63 80.9636 113.103 80.9636C113.518 80.9636 113.841 80.9018 114.074 80.7782C114.314 80.6545 114.51 80.4327 114.663 80.1127L116.081 80.5055ZM111.74 77.7564V78.0945H114.358V77.8545C114.358 77.3527 114.256 76.9964 114.052 76.7855C113.849 76.5673 113.514 76.4582 113.049 76.4582C112.583 76.4582 112.249 76.56 112.045 76.7636C111.841 76.9673 111.74 77.2982 111.74 77.7564ZM120.82 82.1091C119.817 82.1091 119.053 81.8945 118.529 81.4655C118.006 81.0291 117.744 80.4 117.744 79.5782V77.8764C117.744 77.0545 118.006 76.4291 118.529 76C119.053 75.5636 119.813 75.3455 120.809 75.3455C121.733 75.3455 122.424 75.5491 122.882 75.9564C123.347 76.3636 123.62 76.9455 123.7 77.7018L122.118 77.8218C122.089 77.3855 121.966 77.0727 121.747 76.8836C121.537 76.6945 121.209 76.6 120.766 76.6C120.286 76.6 119.933 76.7055 119.707 76.9164C119.489 77.1273 119.38 77.4727 119.38 77.9527V79.5236C119.38 79.9891 119.493 80.3273 119.718 80.5382C119.944 80.7491 120.3 80.8545 120.787 80.8545C121.224 80.8545 121.547 80.7782 121.758 80.6255C121.969 80.4655 122.089 80.2073 122.118 79.8509L123.7 79.9709C123.649 80.6618 123.402 81.1927 122.958 81.5636C122.522 81.9273 121.809 82.1091 120.82 82.1091ZM129.475 82.1091C128.661 82.1091 128.028 81.9164 127.577 81.5309C127.134 81.1455 126.912 80.5782 126.912 79.8291V76.7091H125.221V75.4545H126.912V73.2727H128.548V75.4545H131.166V76.7091H128.548V79.6218C128.548 80.0364 128.646 80.3418 128.843 80.5382C129.039 80.7273 129.315 80.8218 129.672 80.8218C129.897 80.8218 130.126 80.8073 130.359 80.7782C130.592 80.7418 130.821 80.6836 131.046 80.6036L131.264 81.8473C131.068 81.92 130.814 81.9818 130.501 82.0327C130.195 82.0836 129.854 82.1091 129.475 82.1091Z" fill="#29B7DA" />
      <path d="M240.212 82V75.4545H241.303V76.5455H241.63C241.79 76.1745 242.041 75.8836 242.383 75.6727C242.725 75.4545 243.114 75.3455 243.55 75.3455C244.205 75.3455 244.721 75.5455 245.099 75.9455C245.477 76.3455 245.667 76.8909 245.667 77.5818V82H244.576V77.8C244.576 77.3418 244.463 76.9927 244.237 76.7527C244.019 76.5055 243.703 76.3818 243.288 76.3818C242.961 76.3818 242.627 76.48 242.285 76.6764C241.95 76.8727 241.623 77.1564 241.303 77.5273V82H240.212ZM250.58 82.1091C249.7 82.1091 249.024 81.8982 248.551 81.4764C248.085 81.0473 247.853 80.4327 247.853 79.6327V77.8655C247.853 77.0582 248.089 76.4364 248.562 76C249.034 75.5636 249.711 75.3455 250.591 75.3455C251.464 75.3455 252.133 75.5636 252.598 76C253.071 76.4364 253.307 77.0582 253.307 77.8655V79.6327C253.307 80.4327 253.071 81.0473 252.598 81.4764C252.133 81.8982 251.46 82.1091 250.58 82.1091ZM250.58 81.1273C251.133 81.1273 251.544 81.0036 251.813 80.7564C252.082 80.5091 252.216 80.1345 252.216 79.6327V77.8655C252.216 77.3418 252.082 76.9564 251.813 76.7091C251.544 76.4545 251.133 76.3273 250.58 76.3273C250.027 76.3273 249.616 76.4545 249.347 76.7091C249.078 76.9564 248.944 77.3418 248.944 77.8655V79.6327C248.944 80.1345 249.078 80.5091 249.347 80.7564C249.616 81.0036 250.027 81.1273 250.58 81.1273ZM257.893 81.0727C258.25 81.0727 258.588 80.9782 258.908 80.7891C259.228 80.6 259.544 80.3127 259.857 79.9273V76.72C259.631 76.5818 259.391 76.48 259.137 76.4145C258.882 76.3418 258.61 76.3055 258.319 76.3055C257.73 76.3055 257.293 76.4364 257.01 76.6982C256.726 76.9527 256.584 77.3418 256.584 77.8655V79.6218C256.584 80.1091 256.693 80.4727 256.911 80.7127C257.13 80.9527 257.457 81.0727 257.893 81.0727ZM259.53 80.9091C259.341 81.2873 259.079 81.5818 258.744 81.7927C258.41 82.0036 258.035 82.1091 257.621 82.1091C256.944 82.1091 256.421 81.8909 256.05 81.4545C255.679 81.0182 255.493 80.4073 255.493 79.6218V77.8436C255.493 77.0509 255.741 76.4364 256.235 76C256.73 75.5636 257.421 75.3455 258.308 75.3455C258.562 75.3455 258.824 75.3745 259.093 75.4327C259.362 75.4836 259.617 75.5564 259.857 75.6509V73.2727H260.948V82H259.857V80.9091H259.53ZM268.61 80.56C268.414 81.1055 268.116 81.5018 267.716 81.7491C267.316 81.9891 266.701 82.1091 265.872 82.1091C265.007 82.1091 264.334 81.9018 263.854 81.4873C263.374 81.0655 263.134 80.4436 263.134 79.6218V77.8655C263.134 77.0218 263.385 76.3927 263.887 75.9782C264.396 75.5564 265.058 75.3455 265.872 75.3455C266.694 75.3455 267.352 75.56 267.847 75.9891C268.341 76.4109 268.588 77.0618 268.588 77.9418V78.9455H264.225V79.6327C264.225 80.1782 264.359 80.5745 264.628 80.8218C264.905 81.0618 265.316 81.1818 265.861 81.1818C266.385 81.1818 266.767 81.1091 267.007 80.9636C267.247 80.8182 267.428 80.5818 267.552 80.2545L268.61 80.56ZM264.225 77.8655V78.1273H267.498V77.9636C267.498 77.3745 267.359 76.9455 267.083 76.6764C266.814 76.4073 266.407 76.2727 265.861 76.2727C265.316 76.2727 264.905 76.4036 264.628 76.6655C264.359 76.92 264.225 77.32 264.225 77.8655ZM278.088 78.7273V77.6364H284.197V78.7273H278.088ZM285.728 78.7273V77.6364H291.838V78.7273H285.728ZM297.1 82H295.736L293.413 75.4545H294.602L296.435 81.1164L298.267 75.4545H299.424L297.1 82ZM306.813 80.56C306.617 81.1055 306.319 81.5018 305.919 81.7491C305.519 81.9891 304.904 82.1091 304.075 82.1091C303.21 82.1091 302.537 81.9018 302.057 81.4873C301.577 81.0655 301.337 80.4436 301.337 79.6218V77.8655C301.337 77.0218 301.588 76.3927 302.09 75.9782C302.599 75.5564 303.261 75.3455 304.075 75.3455C304.897 75.3455 305.555 75.56 306.05 75.9891C306.544 76.4109 306.792 77.0618 306.792 77.9418V78.9455H302.428V79.6327C302.428 80.1782 302.562 80.5745 302.832 80.8218C303.108 81.0618 303.519 81.1818 304.064 81.1818C304.588 81.1818 304.97 81.1091 305.21 80.9636C305.45 80.8182 305.632 80.5818 305.755 80.2545L306.813 80.56ZM302.428 77.8655V78.1273H305.701V77.9636C305.701 77.3745 305.562 76.9455 305.286 76.6764C305.017 76.4073 304.61 76.2727 304.064 76.2727C303.519 76.2727 303.108 76.4036 302.832 76.6655C302.562 76.92 302.428 77.32 302.428 77.8655ZM309.523 82V75.4545H310.614V76.5455H310.941C311.094 76.1309 311.327 75.8291 311.639 75.64C311.952 75.4436 312.33 75.3455 312.774 75.3455C313.261 75.3455 313.669 75.5091 313.996 75.8364C314.323 76.1564 314.487 76.6109 314.487 77.2V78.1818H313.45V77.5927C313.45 77.1782 313.356 76.8727 313.167 76.6764C312.985 76.48 312.705 76.3818 312.327 76.3818C311.985 76.3818 311.672 76.4655 311.389 76.6327C311.112 76.8 310.854 77.0618 310.614 77.4182V82H309.523ZM319.433 82.1091C318.88 82.1091 318.346 82.0291 317.829 81.8691C317.313 81.7018 316.836 81.4473 316.4 81.1055L316.891 80.2436C317.247 80.5345 317.644 80.7564 318.08 80.9091C318.524 81.0545 318.975 81.1273 319.433 81.1273C319.811 81.1273 320.171 81.0691 320.513 80.9527C320.862 80.8364 321.036 80.5891 321.036 80.2109C321.036 79.8982 320.895 79.6764 320.611 79.5455C320.327 79.4145 319.807 79.3018 319.051 79.2073C318.251 79.1127 317.644 78.9273 317.229 78.6509C316.822 78.3673 316.618 77.9236 316.618 77.32C316.618 76.6655 316.866 76.1745 317.36 75.8473C317.855 75.5127 318.429 75.3455 319.084 75.3455C319.6 75.3455 320.095 75.4327 320.567 75.6073C321.047 75.7818 321.491 76.0291 321.898 76.3491L321.407 77.2109C321.073 76.9418 320.709 76.7273 320.316 76.5673C319.924 76.4073 319.513 76.3273 319.084 76.3273C318.735 76.3273 318.415 76.3927 318.124 76.5236C317.84 76.6545 317.698 76.8945 317.698 77.2436C317.698 77.5418 317.829 77.76 318.091 77.8982C318.36 78.0291 318.873 78.1418 319.629 78.2364C320.458 78.3309 321.08 78.5345 321.495 78.8473C321.909 79.1527 322.116 79.5818 322.116 80.1345C322.116 80.8182 321.84 81.32 321.287 81.64C320.735 81.9527 320.116 82.1091 319.433 82.1091ZM324.259 82V81.0182H326.441V76.4364H324.259V75.4545H327.532V81.0182H329.713V82H324.259ZM326.986 74.2545C326.71 74.2545 326.484 74.2109 326.31 74.1236C326.143 74.0364 326.059 73.8727 326.059 73.6327V73.5564C326.059 73.3091 326.143 73.1418 326.31 73.0545C326.484 72.96 326.71 72.9127 326.986 72.9127C327.263 72.9127 327.484 72.96 327.652 73.0545C327.826 73.1418 327.913 73.3091 327.913 73.5564V73.6327C327.913 73.8727 327.826 74.0364 327.652 74.1236C327.477 74.2109 327.255 74.2545 326.986 74.2545ZM334.627 82.1091C333.747 82.1091 333.07 81.8982 332.598 81.4764C332.132 81.0473 331.9 80.4327 331.9 79.6327V77.8655C331.9 77.0582 332.136 76.4364 332.609 76C333.081 75.5636 333.758 75.3455 334.638 75.3455C335.51 75.3455 336.18 75.5636 336.645 76C337.118 76.4364 337.354 77.0582 337.354 77.8655V79.6327C337.354 80.4327 337.118 81.0473 336.645 81.4764C336.18 81.8982 335.507 82.1091 334.627 82.1091ZM334.627 81.1273C335.18 81.1273 335.59 81.0036 335.86 80.7564C336.129 80.5091 336.263 80.1345 336.263 79.6327V77.8655C336.263 77.3418 336.129 76.9564 335.86 76.7091C335.59 76.4545 335.18 76.3273 334.627 76.3273C334.074 76.3273 333.663 76.4545 333.394 76.7091C333.125 76.9564 332.99 77.3418 332.99 77.8655V79.6327C332.99 80.1345 333.125 80.5091 333.394 80.7564C333.663 81.0036 334.074 81.1273 334.627 81.1273ZM339.54 82V75.4545H340.631V76.5455H340.958C341.118 76.1745 341.369 75.8836 341.711 75.6727C342.053 75.4545 342.442 75.3455 342.878 75.3455C343.533 75.3455 344.049 75.5455 344.427 75.9455C344.806 76.3455 344.995 76.8909 344.995 77.5818V82H343.904V77.8C343.904 77.3418 343.791 76.9927 343.566 76.7527C343.347 76.5055 343.031 76.3818 342.616 76.3818C342.289 76.3818 341.955 76.48 341.613 76.6764C341.278 76.8727 340.951 77.1564 340.631 77.5273V82H339.54ZM40.4945 118H39.1309L36.8073 111.455H37.9964L39.8291 117.116L41.6618 111.455H42.8182L40.4945 118ZM45.0588 118V117.018H47.4588V110.582H47.1424C46.8952 111.018 46.5752 111.327 46.1824 111.509C45.797 111.691 45.3497 111.738 44.8406 111.651L44.7315 110.582C45.2915 110.647 45.8043 110.571 46.2697 110.353C46.7352 110.127 47.1424 109.767 47.4915 109.273H48.5497V117.018H50.7315V118H45.0588ZM55.0994 118.109C54.074 118.109 53.3249 117.829 52.8522 117.269C52.3867 116.702 52.154 115.942 52.154 114.989V112.338C52.154 111.32 52.4085 110.538 52.9176 109.993C53.434 109.44 54.1685 109.164 55.1212 109.164C55.9867 109.164 56.6376 109.324 57.074 109.644C57.5103 109.956 57.8013 110.465 57.9467 111.171L56.7576 111.422C56.6631 110.978 56.5103 110.655 56.2994 110.451C56.0885 110.247 55.6885 110.145 55.0994 110.145C54.4303 110.145 53.954 110.316 53.6703 110.658C53.3867 110.993 53.2449 111.553 53.2449 112.338V113.385H53.4631C53.6594 113.124 53.9067 112.92 54.2049 112.775C54.5103 112.629 54.914 112.556 55.4158 112.556C56.2885 112.556 56.9431 112.796 57.3794 113.276C57.8231 113.756 58.0449 114.378 58.0449 115.142V115.382C58.0449 116.262 57.7903 116.938 57.2812 117.411C56.7722 117.876 56.0449 118.109 55.0994 118.109ZM55.0885 117.127C55.7213 117.127 56.1867 116.989 56.4849 116.713C56.7831 116.429 56.9322 115.993 56.9322 115.404V115.262C56.9322 114.673 56.7831 114.24 56.4849 113.964C56.1867 113.68 55.7213 113.538 55.0885 113.538C54.4558 113.538 53.9903 113.68 53.6922 113.964C53.394 114.24 53.2449 114.673 53.2449 115.262V115.404C53.2449 115.993 53.394 116.429 53.6922 116.713C53.9903 116.989 54.4558 117.127 55.0885 117.127ZM62.751 118.109C62.3873 118.109 62.0928 118.029 61.8673 117.869C61.6419 117.702 61.5291 117.44 61.5291 117.084V116.778C61.5291 116.422 61.6419 116.16 61.8673 115.993C62.0928 115.818 62.3873 115.731 62.751 115.731C63.1146 115.731 63.4055 115.818 63.6237 115.993C63.8491 116.16 63.9619 116.422 63.9619 116.778V117.084C63.9619 117.44 63.8491 117.702 63.6237 117.869C63.3982 118.029 63.1073 118.109 62.751 118.109ZM67.9807 118V117.018H70.3807V110.582H70.0643C69.817 111.018 69.497 111.327 69.1043 111.509C68.7189 111.691 68.2716 111.738 67.7625 111.651L67.6534 110.582C68.2134 110.647 68.7261 110.571 69.1916 110.353C69.657 110.127 70.0643 109.767 70.4134 109.273H71.4716V117.018H73.6534V118H67.9807ZM76.1668 114.727H79.1122V110.407L76.1668 114.727ZM81.5122 115.709H80.2031V118H79.1122V115.709H74.9668V114.727L78.6213 109.273H80.2031V114.727H81.5122V115.709ZM85.6728 118.109C85.3092 118.109 85.0147 118.029 84.7892 117.869C84.5638 117.702 84.451 117.44 84.451 117.084V116.778C84.451 116.422 84.5638 116.16 84.7892 115.993C85.0147 115.818 85.3092 115.731 85.6728 115.731C86.0365 115.731 86.3274 115.818 86.5456 115.993C86.771 116.16 86.8838 116.422 86.8838 116.778V117.084C86.8838 117.44 86.771 117.702 86.5456 117.869C86.3201 118.029 86.0292 118.109 85.6728 118.109ZM93.3026 118.109C92.3426 118.109 91.6116 117.789 91.1098 117.149C90.608 116.502 90.3571 115.56 90.3571 114.324V112.993C90.3571 111.742 90.608 110.793 91.1098 110.145C91.6116 109.491 92.3462 109.164 93.3135 109.164C94.2735 109.164 95.0007 109.491 95.4953 110.145C95.9971 110.793 96.248 111.742 96.248 112.993V114.324C96.248 115.56 95.9971 116.502 95.4953 117.149C94.9935 117.789 94.2626 118.109 93.3026 118.109ZM93.3026 117.127C93.9644 117.127 94.4371 116.909 94.7207 116.473C95.0116 116.036 95.1571 115.32 95.1571 114.324V112.993C95.1571 111.975 95.0116 111.247 94.7207 110.811C94.4371 110.367 93.9644 110.145 93.3026 110.145C92.6407 110.145 92.1644 110.367 91.8735 110.811C91.5898 111.247 91.448 111.975 91.448 112.993V114.324C91.448 115.32 91.5898 116.036 91.8735 116.473C92.1644 116.909 92.6407 117.127 93.3026 117.127ZM93.3026 114.487C93.0698 114.487 92.8807 114.447 92.7353 114.367C92.5898 114.287 92.5171 114.135 92.5171 113.909V113.375C92.5171 113.156 92.5898 113.007 92.7353 112.927C92.8807 112.84 93.0698 112.796 93.3026 112.796C93.5353 112.796 93.7207 112.84 93.8589 112.927C94.0044 113.007 94.0771 113.156 94.0771 113.375V113.909C94.0771 114.135 94.0044 114.287 93.8589 114.367C93.7135 114.447 93.528 114.487 93.3026 114.487ZM36 126.727H43.6364V138.727H36V126.727Z" fill="var(--vscode-terminal-foreground, #CCCCCC)" />
      <path d="M146.993 82.4036C146.993 83 146.771 83.4618 146.328 83.7891C145.884 84.1236 145.313 84.2909 144.615 84.2909H142.651C141.888 84.2909 141.291 84.1491 140.862 83.8655C140.44 83.5891 140.229 83.2109 140.229 82.7309C140.229 82.3745 140.335 82.0873 140.546 81.8691C140.757 81.6509 141.033 81.5236 141.375 81.4873V81.2691C141.113 81.2036 140.895 81.0873 140.72 80.92C140.546 80.7527 140.458 80.4945 140.458 80.1455C140.458 79.7818 140.578 79.4764 140.818 79.2291C141.066 78.9745 141.411 78.8255 141.855 78.7818V78.5745C141.484 78.4727 141.215 78.3091 141.048 78.0836C140.888 77.8509 140.808 77.6 140.808 77.3309V77.1782C140.808 76.6473 141.037 76.2291 141.495 75.9236C141.953 75.6109 142.553 75.4545 143.295 75.4545H146.862V76.5455L145.117 76.3164V76.5236C145.393 76.5964 145.611 76.7418 145.771 76.96C145.938 77.1709 146.022 77.3964 146.022 77.6364V77.8C146.022 78.3236 145.8 78.7345 145.357 79.0327C144.92 79.3309 144.306 79.48 143.513 79.48H142.378C142.16 79.48 141.989 79.5236 141.866 79.6109C141.749 79.6982 141.691 79.8473 141.691 80.0582C141.691 80.2618 141.76 80.4109 141.898 80.5055C142.037 80.6 142.237 80.6473 142.498 80.6473H144.702C145.378 80.6473 145.928 80.7891 146.349 81.0727C146.778 81.3564 146.993 81.8 146.993 82.4036ZM143.426 78.5745C143.797 78.5745 144.069 78.5018 144.244 78.3564C144.426 78.2109 144.517 78.0036 144.517 77.7345V77.2873C144.517 77.0255 144.426 76.8255 144.244 76.6873C144.062 76.5491 143.789 76.48 143.426 76.48C143.055 76.48 142.778 76.5491 142.597 76.6873C142.422 76.8255 142.335 77.0255 142.335 77.2873V77.7345C142.335 78.0036 142.422 78.2109 142.597 78.3564C142.778 78.5018 143.055 78.5745 143.426 78.5745ZM142.651 83.2545H144.669C144.953 83.2545 145.182 83.2073 145.357 83.1127C145.538 83.0182 145.629 82.8364 145.629 82.5673C145.629 82.2982 145.546 82.1164 145.378 82.0218C145.211 81.9273 144.993 81.88 144.724 81.88H141.8V82.5127C141.8 82.76 141.869 82.9455 142.008 83.0691C142.153 83.1927 142.368 83.2545 142.651 83.2545ZM148.361 82V80.7455H150.434V76.7091H148.361V75.4545H152.07V80.7455H154.143V82H148.361ZM151.317 74.3636C150.968 74.3636 150.685 74.3091 150.466 74.2C150.255 74.0909 150.15 73.9018 150.15 73.6327V73.5127C150.15 73.2364 150.255 73.0436 150.466 72.9345C150.685 72.8182 150.968 72.76 151.317 72.76C151.666 72.76 151.946 72.8182 152.157 72.9345C152.375 73.0436 152.485 73.2364 152.485 73.5127V73.6327C152.485 73.9018 152.375 74.0909 152.157 74.2C151.939 74.3091 151.659 74.3636 151.317 74.3636ZM160.038 82.1091C159.223 82.1091 158.591 81.9164 158.14 81.5309C157.696 81.1455 157.474 80.5782 157.474 79.8291V76.7091H155.783V75.4545H157.474V73.2727H159.111V75.4545H161.729V76.7091H159.111V79.6218C159.111 80.0364 159.209 80.3418 159.405 80.5382C159.601 80.7273 159.878 80.8218 160.234 80.8218C160.46 80.8218 160.689 80.8073 160.921 80.7782C161.154 80.7418 161.383 80.6836 161.609 80.6036L161.827 81.8473C161.631 81.92 161.376 81.9818 161.063 82.0327C160.758 82.0836 160.416 82.1091 160.038 82.1091ZM166.544 77.7673C166.144 77.7673 165.817 77.6836 165.562 77.5164C165.315 77.3491 165.191 77.0982 165.191 76.7636V76.1855C165.191 75.8509 165.315 75.5964 165.562 75.4218C165.817 75.2473 166.144 75.16 166.544 75.16C166.944 75.16 167.268 75.2473 167.515 75.4218C167.762 75.5964 167.886 75.8509 167.886 76.1855V76.7636C167.886 77.0982 167.758 77.3491 167.504 77.5164C167.257 77.6836 166.937 77.7673 166.544 77.7673ZM166.544 82.0764C166.144 82.0764 165.817 81.9927 165.562 81.8255C165.315 81.6582 165.191 81.4073 165.191 81.0727V80.4945C165.191 80.16 165.315 79.9055 165.562 79.7309C165.817 79.5564 166.144 79.4691 166.544 79.4691C166.944 79.4691 167.268 79.5564 167.515 79.7309C167.762 79.9055 167.886 80.16 167.886 80.4945V81.0727C167.886 81.4073 167.758 81.6582 167.504 81.8255C167.257 81.9927 166.937 82.0764 166.544 82.0764ZM176.519 84.2909C175.057 84.0218 173.981 83.3782 173.29 82.36C172.606 81.3418 172.265 80.1309 172.265 78.7273C172.265 77.3455 172.606 76.1418 173.29 75.1164C173.981 74.0836 175.057 73.4327 176.519 73.1636L176.683 74.2982C175.65 74.5673 174.926 75.0909 174.512 75.8691C174.105 76.6473 173.901 77.6 173.901 78.7273C173.901 79.8545 174.105 80.8 174.512 81.5636C174.926 82.3273 175.65 82.8436 176.683 83.1127L176.519 84.2909Z" fill="#3B8EEA" />
      <path d="M179.916 77.3418V82H178.531V75.4545H179.905V76.3273H180.178C180.316 76.0218 180.487 75.7855 180.691 75.6182C180.894 75.4509 181.12 75.3673 181.367 75.3673C181.629 75.3673 181.854 75.4509 182.043 75.6182C182.232 75.7782 182.363 76.0145 182.436 76.3273H182.709C182.84 76.0218 183.018 75.7855 183.243 75.6182C183.469 75.4509 183.723 75.3673 184.007 75.3673C184.342 75.3673 184.607 75.5091 184.803 75.7927C185.007 76.0691 185.109 76.4473 185.109 76.9273V82H183.723V77.2109C183.723 76.9636 183.691 76.7782 183.625 76.6545C183.56 76.5236 183.465 76.4582 183.342 76.4582C183.225 76.4582 183.091 76.5382 182.938 76.6982C182.785 76.8509 182.64 77.0655 182.502 77.3418V82H181.138V77.2109C181.138 76.9636 181.102 76.7782 181.029 76.6545C180.963 76.5236 180.872 76.4582 180.756 76.4582C180.64 76.4582 180.505 76.5345 180.352 76.6873C180.207 76.8327 180.062 77.0509 179.916 77.3418ZM188.702 80.9855C189.008 80.9855 189.291 80.9382 189.553 80.8436C189.815 80.7418 190.055 80.5855 190.273 80.3745V79.3164H188.637C188.368 79.3164 188.153 79.3745 187.993 79.4909C187.84 79.6073 187.764 79.8327 187.764 80.1673C187.764 80.4291 187.837 80.6327 187.982 80.7782C188.128 80.9164 188.368 80.9855 188.702 80.9855ZM188.342 82.1091C187.746 82.1091 187.244 81.9491 186.837 81.6291C186.437 81.3091 186.237 80.84 186.237 80.2218C186.237 79.6255 186.44 79.1673 186.848 78.8473C187.255 78.52 187.775 78.3564 188.408 78.3564H190.273V77.5164C190.273 77.1891 190.175 76.9491 189.979 76.7964C189.782 76.6436 189.488 76.5673 189.095 76.5673C188.695 76.5673 188.397 76.6364 188.2 76.7745C188.004 76.9055 187.855 77.1782 187.753 77.5927L186.389 77.32C186.535 76.6218 186.822 76.12 187.251 75.8145C187.68 75.5018 188.306 75.3455 189.128 75.3455C189.979 75.3455 190.644 75.5164 191.124 75.8582C191.611 76.2 191.855 76.7309 191.855 77.4509V80.0909C191.855 80.4255 191.953 80.6327 192.149 80.7127C192.346 80.7927 192.629 80.8073 193 80.7564V81.9891C192.469 82.0982 192.011 82.0836 191.626 81.9455C191.248 81.8 191.011 81.4727 190.917 80.9636H190.644C190.426 81.2764 190.113 81.5455 189.706 81.7709C189.299 81.9964 188.844 82.1091 188.342 82.1091ZM197.15 82.0873C196.583 82.0873 196.026 82.0109 195.481 81.8582C194.943 81.6982 194.463 81.4655 194.041 81.16L194.532 80.08C194.925 80.3564 195.354 80.5673 195.819 80.7127C196.292 80.8582 196.743 80.9309 197.172 80.9309C197.528 80.9309 197.823 80.88 198.056 80.7782C198.296 80.6691 198.416 80.4691 198.416 80.1782C198.416 79.9091 198.306 79.7164 198.088 79.6C197.87 79.4836 197.481 79.3891 196.921 79.3164C196.056 79.2218 195.394 79.04 194.936 78.7709C194.485 78.4945 194.259 78.0436 194.259 77.4182C194.259 76.7636 194.51 76.2545 195.012 75.8909C195.521 75.5273 196.161 75.3455 196.932 75.3455C197.412 75.3455 197.896 75.4218 198.383 75.5745C198.87 75.7273 199.314 75.9382 199.714 76.2073L199.277 77.2436C198.906 77.0036 198.525 76.8218 198.132 76.6982C197.739 76.5673 197.354 76.5018 196.976 76.5018C196.663 76.5018 196.401 76.56 196.19 76.6764C195.986 76.7855 195.885 76.9745 195.885 77.2436C195.885 77.5127 196.005 77.7018 196.245 77.8109C196.492 77.92 196.921 78.0109 197.532 78.0836C198.376 78.1855 199.005 78.3927 199.419 78.7055C199.834 79.0109 200.041 79.4473 200.041 80.0145C200.041 80.6909 199.768 81.2073 199.223 81.5636C198.685 81.9127 197.994 82.0873 197.15 82.0873ZM205.882 82.1091C205.067 82.1091 204.434 81.9164 203.983 81.5309C203.54 81.1455 203.318 80.5782 203.318 79.8291V76.7091H201.627V75.4545H203.318V73.2727H204.954V75.4545H207.573V76.7091H204.954V79.6218C204.954 80.0364 205.053 80.3418 205.249 80.5382C205.445 80.7273 205.722 80.8218 206.078 80.8218C206.303 80.8218 206.533 80.8073 206.765 80.7782C206.998 80.7418 207.227 80.6836 207.453 80.6036L207.671 81.8473C207.474 81.92 207.22 81.9818 206.907 82.0327C206.602 82.0836 206.26 82.1091 205.882 82.1091ZM215.41 80.5055C215.17 81.0945 214.831 81.5091 214.395 81.7491C213.966 81.9891 213.304 82.1091 212.41 82.1091C211.522 82.1091 210.802 81.9018 210.25 81.4873C209.704 81.0655 209.431 80.44 209.431 79.6109V77.8655C209.431 77.0509 209.697 76.4291 210.228 76C210.766 75.5636 211.486 75.3455 212.388 75.3455C213.297 75.3455 214.013 75.5636 214.537 76C215.06 76.4364 215.322 77.0727 215.322 77.9091V79.0545H211.068V79.6873C211.068 80.1164 211.177 80.4364 211.395 80.6473C211.613 80.8582 211.959 80.9636 212.431 80.9636C212.846 80.9636 213.17 80.9018 213.402 80.7782C213.642 80.6545 213.839 80.4327 213.991 80.1127L215.41 80.5055ZM211.068 77.7564V78.0945H213.686V77.8545C213.686 77.3527 213.584 76.9964 213.38 76.7855C213.177 76.5673 212.842 76.4582 212.377 76.4582C211.911 76.4582 211.577 76.56 211.373 76.7636C211.17 76.9673 211.068 77.2982 211.068 77.7564ZM217.454 82V75.4545H219.09V76.6H219.417C219.577 76.1636 219.821 75.8473 220.148 75.6509C220.483 75.4473 220.879 75.3455 221.337 75.3455C221.861 75.3455 222.276 75.5091 222.581 75.8364C222.894 76.1564 223.05 76.6109 223.05 77.2V78.3018H221.545V77.7018C221.545 77.3673 221.468 77.1127 221.316 76.9382C221.17 76.7636 220.93 76.6764 220.596 76.6764C220.305 76.6764 220.028 76.7491 219.766 76.8945C219.512 77.0327 219.286 77.2618 219.09 77.5818V82H217.454Z" fill="#EE4B4B" />
      <path d="M225.313 84.2909L225.149 83.1127C226.182 82.8436 226.902 82.32 227.309 81.5418C227.723 80.7636 227.931 79.8255 227.931 78.7273C227.931 77.6582 227.723 76.72 227.309 75.9127C226.902 75.1055 226.182 74.5673 225.149 74.2982L225.313 73.1636C226.774 73.4327 227.847 74.0836 228.531 75.1164C229.222 76.1491 229.567 77.3527 229.567 78.7273C229.567 80.1309 229.222 81.3418 228.531 82.36C227.847 83.3782 226.774 84.0218 225.313 84.2909Z" fill="#398AE4" />
    </g>
    <g>
      <rect width="1" height="216" transform="translate(432 53)" fill="var(--vscode-panel-border, #454545)" />
    </g>
    <g>
      <g>
        <rect width="103" height="22" transform="translate(433 53)" fill="var(--vscode-list-inactiveSelectionBackground, #3A3D41)" />
        <g>
          <g>
            <path d="M450.027 57.0133L449.013 57.9733V69.9733L450.027 70.9867H462.027L462.987 69.9733V57.9733L462.027 57.0133H450.027ZM450.027 69.9733V57.9733H462.027V69.9733H450.027ZM453.76 67.3067L454.453 68.0533L457.973 64.5333V63.9467L454.453 60.4267L453.76 61.12L456.853 64.2667L453.76 67.3067Z" fill="var(--vscode-editor-foreground, #CCCCCC)" />
          </g>
          <g>
            <path d="M470.832 69H476.303V67.9019H472.545V67.7939L476.265 63.0522V62.1064H470.857V63.2046H474.634V63.3062L470.832 68.105V69ZM477.966 64.0361C477.966 65.0581 478.576 65.6421 479.89 65.9468L481.096 66.2324C481.788 66.3975 482.111 66.6768 482.111 67.1084C482.111 67.6733 481.508 68.0669 480.658 68.0669C479.833 68.0669 479.325 67.7305 479.153 67.1909H477.789C477.909 68.3906 478.982 69.1333 480.626 69.1333C482.276 69.1333 483.489 68.2637 483.489 66.9814C483.489 65.9785 482.873 65.4136 481.559 65.1089L480.41 64.8423C479.661 64.6646 479.312 64.3979 479.312 63.9727C479.312 63.4141 479.89 63.0396 480.651 63.0396C481.426 63.0396 481.921 63.376 482.048 63.8901H483.355C483.222 62.6968 482.207 61.9731 480.651 61.9731C479.09 61.9731 477.966 62.8364 477.966 64.0361ZM485.196 69H486.561V64.9629C486.561 63.8838 487.183 63.1665 488.3 63.1665C489.265 63.1665 489.779 63.7314 489.779 64.8677V69H491.144V64.5439C491.144 62.9126 490.236 61.9795 488.764 61.9795C487.723 61.9795 486.993 62.4365 486.656 63.2046H486.548V59.4023H485.196V69Z" fill="var(--vscode-editor-foreground, #CCCCCC)" />
          </g>
        </g>
      </g>
    </g>
    <g>
      <g>
        <g>
          <g>
            <path d="M450.027 79.0133L449.013 79.9733V91.9733L450.027 92.9867H462.027L462.987 91.9733V79.9733L462.027 79.0133H450.027ZM450.027 91.9733V79.9733H462.027V91.9733H450.027ZM453.76 89.3067L454.453 90.0533L457.973 86.5333V85.9467L454.453 82.4267L453.76 83.12L456.853 86.2667L453.76 89.3067Z" fill="var(--vscode-editor-foreground, #CCCCCC)" />
          </g>
          <g>
            <path d="M474.653 91.1143C476.398 91.1143 477.509 89.7241 477.509 87.5532C477.509 85.3633 476.405 83.9858 474.653 83.9858C473.707 83.9858 472.895 84.4492 472.526 85.1982H472.418V81.4023H471.054V91H472.368V89.9082H472.469C472.882 90.6699 473.688 91.1143 474.653 91.1143ZM474.259 85.1538C475.415 85.1538 476.106 86.0615 476.106 87.5532C476.106 89.0449 475.415 89.9463 474.259 89.9463C473.11 89.9463 472.399 89.0322 472.393 87.5532C472.399 86.0742 473.117 85.1538 474.259 85.1538ZM481.064 91.1143C481.972 91.1143 482.727 90.7207 483.14 90.0225H483.248V91H484.562V86.2837C484.562 84.8364 483.584 83.9731 481.851 83.9731C480.283 83.9731 479.166 84.7285 479.026 85.8901H480.347C480.499 85.3887 481.026 85.103 481.788 85.103C482.721 85.103 483.203 85.5283 483.203 86.2837V86.8867L481.331 87.001C479.687 87.1025 478.76 87.8198 478.76 89.0576C478.76 90.3145 479.731 91.1143 481.064 91.1143ZM481.413 90.0161C480.67 90.0161 480.131 89.6416 480.131 89.0005C480.131 88.3721 480.562 88.0356 481.515 87.9722L483.203 87.8579V88.4546C483.203 89.3433 482.441 90.0161 481.413 90.0161ZM486.345 86.0361C486.345 87.0581 486.955 87.6421 488.269 87.9468L489.475 88.2324C490.167 88.3975 490.49 88.6768 490.49 89.1084C490.49 89.6733 489.887 90.0669 489.037 90.0669C488.211 90.0669 487.704 89.7305 487.532 89.1909H486.167C486.288 90.3906 487.361 91.1333 489.005 91.1333C490.655 91.1333 491.868 90.2637 491.868 88.9814C491.868 87.9785 491.252 87.4136 489.938 87.1089L488.789 86.8423C488.04 86.6646 487.691 86.3979 487.691 85.9727C487.691 85.4141 488.269 85.0396 489.03 85.0396C489.805 85.0396 490.3 85.376 490.427 85.8901H491.734C491.601 84.6968 490.585 83.9731 489.03 83.9731C487.469 83.9731 486.345 84.8364 486.345 86.0361ZM493.575 91H494.94V86.9629C494.94 85.8838 495.562 85.1665 496.679 85.1665C497.644 85.1665 498.158 85.7314 498.158 86.8677V91H499.523V86.5439C499.523 84.9126 498.615 83.9795 497.143 83.9795C496.102 83.9795 495.372 84.4365 495.035 85.2046H494.927V81.4023H493.575V91Z" fill="var(--vscode-editor-foreground, #CCCCCC)" />
          </g>
        </g>
      </g>
    </g>
    <g>
      <g>
        <path d="M508.093 33L503.56 37.5333L504.467 38.44L509 33.9067L513.533 38.44L514.44 37.5333L509.907 33L514.44 28.4667L513.533 27.56L509 32.0933L504.467 27.56L503.56 28.4667L508.093 33Z" fill="var(--vscode-editor-foreground, #CCCCCC)" />
      </g>
    </g>
    <g>
      <g>
        <path d="M483 30.92L478.68 35.2933L478.04 34.6533L482.733 30.0133H483.32L488.013 34.6533L487.373 35.2933L483 30.92Z" fill="var(--vscode-editor-foreground, #CCCCCC)" />
      </g>
    </g>
    <g>
      <path d="M463.027 32.9867V34H457V39.9733H455.987V34H450.013V32.9867H455.987V27.0133H457V32.9867H463.027Z" fill="var(--vscode-editor-foreground, #CCCCCC)" />
    </g>
  </g>
  <defs>
    <filter id="filter0_d_1720_12308" x="0" y="0" width="583" height="287" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
      <feFlood flood-opacity="0" result="BackgroundImageFix" />
      <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha" />
      <feOffset dy="2" />
      <feGaussianBlur stdDeviation="8" />
      <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.36 0" />
      <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_1720_12308" />
      <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_1720_12308" result="shape" />
    </filter>
  </defs>
</svg>
```

--------------------------------------------------------------------------------

---[FILE: extensions/typescript-language-features/resources/walkthroughs/learn-more.svg]---
Location: vscode-main/extensions/typescript-language-features/resources/walkthroughs/learn-more.svg

```text
<svg width="482" height="332" viewBox="0 0 482 332" fill="none" xmlns="http://www.w3.org/2000/svg">
  <g filter="url(#filter0_d_1720_12523)">
    <g clip-path="url(#clip0_1720_12523)">
      <rect x="16" y="14" width="450" height="300" rx="2" fill="var(--vscode-quickInput-background, #1E1E1E)" />
      <g>
        <rect width="450" height="35" transform="translate(16 14)" fill="var(--vscode-editorGroupHeader-tabsBackground, #292929)" />
        <g clip-path="url(#clip1_1720_12523)">
          <g>
            <rect width="103" height="35" transform="translate(16 14)" fill="var(--vscode-tab-activeBackground, #1E1E1E)" />
            <rect x="28" y="28" width="79" height="7" rx="3.5" fill="var(--vscode-tab-inactiveForeground, #FFFFFF)" fill-opacity="0.12" />
          </g>
        </g>
      </g>
      <g>
        <g>
          <g>
            <g>
              <rect x="43" y="144" width="320" height="8" rx="4" fill="var(--vscode-list-deemphasizedForeground, #FFFFFF)" fill-opacity="0.16" />
              <rect x="43" y="159" width="224.192" height="8" rx="4" fill="var(--vscode-list-deemphasizedForeground, #FFFFFF)" fill-opacity="0.16" />
              <rect x="278.688" y="159" width="61.3174" height="8" rx="4" fill="var(--vscode-textLink-foreground, #007ACC)" />
            </g>
            <g>
              <rect x="43" y="199" width="105.389" height="8" rx="4" fill="var(--vscode-list-deemphasizedForeground, #FFFFFF)" fill-opacity="0.16" />
              <rect x="43" y="214" width="318.084" height="8" rx="4" fill="var(--vscode-list-deemphasizedForeground, #FFFFFF)" fill-opacity="0.16" />
              <rect x="43" y="229" width="318.38" height="8" rx="4" fill="var(--vscode-list-deemphasizedForeground, #FFFFFF)" fill-opacity="0.16" />
              <rect x="43.8101" y="244" width="223.595" height="8" rx="4" fill="var(--vscode-list-deemphasizedForeground, #FFFFFF)" fill-opacity="0.16" />
            </g>
          </g>
          <g>
            <g filter="url(#filter1_d_1720_12523)">
              <g>
                <mask style="mask-type:alpha" maskUnits="userSpaceOnUse" x="44" y="66" width="14" height="14">
                  <path fill-rule="evenodd" clip-rule="evenodd" d="M53.9277 79.9044C54.1482 79.9903 54.3996 79.9848 54.6221 79.8777L57.5045 78.4908C57.8074 78.3451 58 78.0385 58 77.7022V68.2979C58 67.9616 57.8074 67.6551 57.5045 67.5093L54.6221 66.1224C54.3301 65.9818 53.9882 66.0162 53.7319 66.2026C53.6953 66.2292 53.6604 66.259 53.6277 66.2917L48.1097 71.3258L45.7062 69.5014C45.4825 69.3315 45.1695 69.3455 44.9617 69.5345L44.1908 70.2357C43.9366 70.4669 43.9364 70.8668 44.1902 71.0984L46.2746 73L44.1902 74.9017C43.9364 75.1333 43.9366 75.5332 44.1908 75.7644L44.9617 76.4656C45.1695 76.6546 45.4825 76.6685 45.7062 76.4987L48.1097 74.6743L53.6277 79.7084C53.7149 79.7957 53.8174 79.8615 53.9277 79.9044ZM54.5021 69.8219L50.3153 73L54.5021 76.1782V69.8219Z" fill="#FFFFFF" />
                </mask>
                <g mask="url(#mask0_1720_12523)">
                  <path d="M57.5048 67.5114L54.6202 66.1225C54.2863 65.9617 53.8872 66.0295 53.6252 66.2916L44.182 74.9016C43.928 75.1331 43.9283 75.533 44.1826 75.7642L44.954 76.4655C45.1619 76.6545 45.4751 76.6684 45.6989 76.4986L57.0707 67.8717C57.4522 67.5823 58.0002 67.8544 58.0002 68.3332V68.2998C58.0002 67.9636 57.8077 67.6572 57.5048 67.5114Z" fill="#0065A9" />
                  <g filter="url(#filter2_d_1720_12523)">
                    <path d="M57.5048 78.4886L54.6202 79.8775C54.2863 80.0383 53.8872 79.9705 53.6252 79.7084L44.182 71.0984C43.928 70.8668 43.9283 70.467 44.1826 70.2357L44.954 69.5345C45.1619 69.3455 45.4751 69.3316 45.6989 69.5014L57.0707 78.1283C57.4522 78.4177 58.0002 78.1456 58.0002 77.6667V77.7002C58.0002 78.0364 57.8077 78.3428 57.5048 78.4886Z" fill="#007ACC" />
                  </g>
                  <g filter="url(#filter3_d_1720_12523)">
                    <path d="M54.6201 79.8777C54.2861 80.0384 53.8871 79.9704 53.625 79.7084C53.9479 80.0313 54.5 79.8026 54.5 79.3459V66.6541C54.5 66.1975 53.9479 65.9688 53.625 66.2917C53.8871 66.0296 54.2861 65.9617 54.6201 66.1224L57.5042 67.5093C57.8073 67.6551 58 67.9616 58 68.2979V77.7022C58 78.0385 57.8073 78.3451 57.5042 78.4908L54.6201 79.8777Z" fill="#1F9CF0" />
                  </g>
                  <g style="mix-blend-mode:overlay" opacity="0.25">
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M53.9194 79.9044C54.1399 79.9903 54.3913 79.9848 54.6138 79.8777L57.4962 78.4908C57.7991 78.3451 57.9917 78.0385 57.9917 77.7022V68.2979C57.9917 67.9616 57.7991 67.6551 57.4962 67.5093L54.6138 66.1224C54.3218 65.9818 53.9799 66.0162 53.7236 66.2026C53.687 66.2292 53.6521 66.259 53.6194 66.2917L48.1014 71.3258L45.6979 69.5014C45.4742 69.3315 45.1612 69.3455 44.9534 69.5345L44.1825 70.2357C43.9283 70.4669 43.9281 70.8668 44.1819 71.0984L46.2663 73L44.1819 74.9017C43.9281 75.1333 43.9283 75.5332 44.1825 75.7644L44.9534 76.4656C45.1612 76.6546 45.4742 76.6685 45.6979 76.4987L48.1014 74.6742L53.6194 79.7084C53.7066 79.7957 53.8091 79.8615 53.9194 79.9044ZM54.4938 69.8219L50.307 73L54.4938 76.1782V69.8219Z" fill="url(#paint0_linear_1720_12523)" />
                  </g>
                </g>
              </g>
            </g>
          </g>
          <g>
            <rect x="73" y="69" width="41" height="7" rx="3.5" fill="var(--vscode-list-deemphasizedForeground, #FFFFFF)" fill-opacity="0.32" />
            <rect x="123" y="69" width="41" height="7" rx="3.5" fill="var(--vscode-list-deemphasizedForeground, #FFFFFF)" fill-opacity="0.16" />
            <rect x="173" y="69" width="55" height="7" rx="3.5" fill="var(--vscode-list-deemphasizedForeground, #FFFFFF)" fill-opacity="0.16" />
            <rect x="237" y="69" width="33" height="7" rx="3.5" fill="var(--vscode-list-deemphasizedForeground, #FFFFFF)" fill-opacity="0.16" />
          </g>
          <path d="M51.7803 113.517H51.9033L54.6279 123H56.4824L59.9102 110.317H57.8623L55.542 120.179H55.4189L52.7559 110.317H50.9277L48.2822 120.179H48.1592L45.8301 110.317H43.7822L47.2012 123H49.0645L51.7803 113.517ZM65.166 123.185C67.9609 123.185 69.6748 121.312 69.6748 118.228C69.6748 115.143 67.9521 113.271 65.166 113.271C62.3711 113.271 60.6484 115.151 60.6484 118.228C60.6484 121.312 62.3623 123.185 65.166 123.185ZM65.166 121.576C63.5225 121.576 62.5996 120.354 62.5996 118.228C62.5996 116.101 63.5225 114.87 65.166 114.87C66.8008 114.87 67.7324 116.101 67.7324 118.228C67.7324 120.346 66.8008 121.576 65.166 121.576ZM71.9512 123H73.8408V117.296C73.8408 115.951 74.8516 115.028 76.2842 115.028C76.6182 115.028 77.1807 115.09 77.3389 115.134V113.358C77.1367 113.314 76.7764 113.288 76.4951 113.288C75.2471 113.288 74.1836 113.965 73.9111 114.905H73.7705V113.455H71.9512V123ZM81.2852 117.48H81.1357V109.711H79.2461V123H81.1357V119.528L81.9707 118.729L85.2578 123H87.5781L83.377 117.542L87.3145 113.455H85.082L81.2852 117.48ZM90.2939 111.75C90.9531 111.75 91.4893 111.214 91.4893 110.563C91.4893 109.904 90.9531 109.368 90.2939 109.368C89.6348 109.368 89.0986 109.904 89.0986 110.563C89.0986 111.214 89.6348 111.75 90.2939 111.75ZM89.3535 123H91.2344V113.455H89.3535V123ZM94.0117 123H95.9014V117.401C95.9014 115.863 96.7891 114.914 98.1865 114.914C99.584 114.914 100.252 115.688 100.252 117.27V123H102.142V116.821C102.142 114.545 100.964 113.271 98.8281 113.271C97.3867 113.271 96.4375 113.912 95.9717 114.967H95.8311V113.455H94.0117V123ZM108.839 126.647C111.546 126.647 113.26 125.268 113.26 123.097V113.455H111.449V114.976H111.3C110.764 113.938 109.612 113.288 108.294 113.288C105.851 113.288 104.321 115.213 104.321 118.104C104.321 120.97 105.833 122.859 108.276 122.859C109.595 122.859 110.649 122.288 111.229 121.251H111.37V123.088C111.37 124.38 110.438 125.153 108.865 125.153C107.591 125.153 106.791 124.696 106.633 123.976H104.699C104.901 125.584 106.448 126.647 108.839 126.647ZM108.812 121.295C107.187 121.295 106.272 120.056 106.272 118.104C106.272 116.153 107.187 114.905 108.812 114.905C110.421 114.905 111.405 116.153 111.405 118.104C111.405 120.056 110.43 121.295 108.812 121.295ZM133.387 113.455H131.497L129.792 120.82H129.643L127.674 113.455H125.863L123.895 120.82H123.754L122.04 113.455H120.124L122.761 123H124.703L126.672 115.881H126.821L128.799 123H130.759L133.387 113.455ZM136.313 111.75C136.973 111.75 137.509 111.214 137.509 110.563C137.509 109.904 136.973 109.368 136.313 109.368C135.654 109.368 135.118 109.904 135.118 110.563C135.118 111.214 135.654 111.75 136.313 111.75ZM135.373 123H137.254V113.455H135.373V123ZM140.699 111.047V113.481H139.179V114.993H140.699V120.486C140.699 122.323 141.534 123.062 143.635 123.062C144.004 123.062 144.355 123.018 144.663 122.965V121.462C144.399 121.488 144.232 121.506 143.942 121.506C143.002 121.506 142.589 121.058 142.589 120.029V114.993H144.663V113.481H142.589V111.047H140.699ZM146.975 123H148.864V117.41C148.864 115.916 149.726 114.923 151.272 114.923C152.608 114.923 153.32 115.705 153.32 117.278V123H155.21V116.83C155.21 114.571 153.953 113.279 151.914 113.279C150.473 113.279 149.462 113.912 148.996 114.976H148.847V109.711H146.975V123ZM162.145 119.783C162.145 121.91 163.718 123.308 166.012 123.308C168.455 123.308 169.932 121.857 169.932 119.335V110.317H167.963V119.326C167.963 120.776 167.251 121.55 165.994 121.55C164.869 121.55 164.104 120.838 164.078 119.783H162.145ZM175.478 123.158C176.734 123.158 177.78 122.613 178.352 121.646H178.501V123H180.32V116.47C180.32 114.466 178.967 113.271 176.567 113.271C174.396 113.271 172.85 114.316 172.656 115.925H174.484C174.695 115.23 175.425 114.835 176.479 114.835C177.771 114.835 178.439 115.424 178.439 116.47V117.305L175.847 117.463C173.57 117.604 172.287 118.597 172.287 120.311C172.287 122.051 173.632 123.158 175.478 123.158ZM175.961 121.638C174.933 121.638 174.186 121.119 174.186 120.231C174.186 119.361 174.783 118.896 176.102 118.808L178.439 118.649V119.476C178.439 120.706 177.385 121.638 175.961 121.638ZM190.797 113.455H188.793L186.42 121.066H186.271L183.889 113.455H181.867L185.321 123H187.352L190.797 113.455ZM195.024 123.158C196.281 123.158 197.327 122.613 197.898 121.646H198.048V123H199.867V116.47C199.867 114.466 198.514 113.271 196.114 113.271C193.943 113.271 192.396 114.316 192.203 115.925H194.031C194.242 115.23 194.972 114.835 196.026 114.835C197.318 114.835 197.986 115.424 197.986 116.47V117.305L195.394 117.463C193.117 117.604 191.834 118.597 191.834 120.311C191.834 122.051 193.179 123.158 195.024 123.158ZM195.508 121.638C194.479 121.638 193.732 121.119 193.732 120.231C193.732 119.361 194.33 118.896 195.648 118.808L197.986 118.649V119.476C197.986 120.706 196.932 121.638 195.508 121.638ZM202.179 119.616C202.319 121.866 204.209 123.308 207.021 123.308C210.027 123.308 211.908 121.796 211.908 119.396C211.908 117.498 210.836 116.452 208.234 115.828L206.837 115.485C205.185 115.081 204.517 114.554 204.517 113.631C204.517 112.444 205.554 111.68 207.109 111.68C208.586 111.68 209.605 112.418 209.79 113.622H211.706C211.592 111.504 209.711 110.01 207.136 110.01C204.367 110.01 202.521 111.504 202.521 113.736C202.521 115.582 203.567 116.672 205.861 117.226L207.496 117.621C209.175 118.025 209.913 118.641 209.913 119.634C209.913 120.794 208.753 121.629 207.171 121.629C205.475 121.629 204.297 120.847 204.13 119.616H202.179ZM222.385 116.522C222.139 114.668 220.688 113.271 218.289 113.271C215.503 113.271 213.807 115.16 213.807 118.192C213.807 121.286 215.512 123.185 218.298 123.185C220.662 123.185 222.139 121.857 222.385 119.977H220.548C220.302 121.014 219.484 121.576 218.289 121.576C216.716 121.576 215.74 120.302 215.74 118.192C215.74 116.127 216.707 114.879 218.289 114.879C219.555 114.879 220.328 115.591 220.548 116.522H222.385ZM224.547 123H226.437V117.296C226.437 115.951 227.447 115.028 228.88 115.028C229.214 115.028 229.776 115.09 229.935 115.134V113.358C229.732 113.314 229.372 113.288 229.091 113.288C227.843 113.288 226.779 113.965 226.507 114.905H226.366V113.455H224.547V123ZM232.729 111.75C233.389 111.75 233.925 111.214 233.925 110.563C233.925 109.904 233.389 109.368 232.729 109.368C232.07 109.368 231.534 109.904 231.534 110.563C231.534 111.214 232.07 111.75 232.729 111.75ZM231.789 123H233.67V113.455H231.789V123ZM241.413 113.288C240.112 113.288 238.987 113.947 238.407 115.037H238.267V113.455H236.447V126.182H238.337V121.559H238.486C238.987 122.569 240.068 123.158 241.431 123.158C243.848 123.158 245.386 121.242 245.386 118.228C245.386 115.195 243.848 113.288 241.413 113.288ZM240.877 121.541C239.295 121.541 238.302 120.267 238.302 118.228C238.302 116.18 239.295 114.905 240.886 114.905C242.485 114.905 243.443 116.153 243.443 118.228C243.443 120.302 242.485 121.541 240.877 121.541ZM248.33 111.047V113.481H246.81V114.993H248.33V120.486C248.33 122.323 249.165 123.062 251.266 123.062C251.635 123.062 251.986 123.018 252.294 122.965V121.462C252.03 121.488 251.863 121.506 251.573 121.506C250.633 121.506 250.22 121.058 250.22 120.029V114.993H252.294V113.481H250.22V111.047H248.33Z" fill="var(--vscode-settings-headerForeground, #FFFFFF)" />
        </g>
      </g>
    </g>
  </g>
  <defs>
    <filter id="filter0_d_1720_12523" x="0" y="0" width="482" height="332" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
      <feFlood flood-opacity="0" result="BackgroundImageFix" />
      <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha" />
      <feOffset dy="2" />
      <feGaussianBlur stdDeviation="8" />
      <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.36 0" />
      <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_1720_12523" />
      <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_1720_12523" result="shape" />
    </filter>
    <filter id="filter1_d_1720_12523" x="42.1284" y="64.7523" width="17.7432" height="17.7432" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
      <feFlood flood-opacity="0" result="BackgroundImageFix" />
      <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha" />
      <feOffset dy="0.623874" />
      <feGaussianBlur stdDeviation="0.935811" />
      <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0" />
      <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_1720_12523" />
      <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_1720_12523" result="shape" />
    </filter>
    <filter id="filter2_d_1720_12523" x="39.6246" y="65.0157" width="22.7425" height="19.3153" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
      <feFlood flood-opacity="0" result="BackgroundImageFix" />
      <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha" />
      <feOffset />
      <feGaussianBlur stdDeviation="2.18356" />
      <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0" />
      <feBlend mode="overlay" in2="BackgroundImageFix" result="effect1_dropShadow_1720_12523" />
      <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_1720_12523" result="shape" />
    </filter>
    <filter id="filter3_d_1720_12523" x="49.2579" y="61.669" width="13.1092" height="22.662" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
      <feFlood flood-opacity="0" result="BackgroundImageFix" />
      <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha" />
      <feOffset />
      <feGaussianBlur stdDeviation="2.18356" />
      <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0" />
      <feBlend mode="overlay" in2="BackgroundImageFix" result="effect1_dropShadow_1720_12523" />
      <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_1720_12523" result="shape" />
    </filter>
    <linearGradient id="paint0_linear_1720_12523" x1="50.9917" y1="66.0361" x2="50.9917" y2="79.964" gradientUnits="userSpaceOnUse">
      <stop stop-color="white" />
      <stop offset="1" stop-color="white" stop-opacity="0" />
    </linearGradient>
    <clipPath id="clip0_1720_12523">
      <rect x="16" y="14" width="450" height="300" rx="2" fill="#FFFFFF" />
    </clipPath>
    <clipPath id="clip1_1720_12523">
      <rect width="103" height="35" fill="#FFFFFF" transform="translate(16 14)" />
    </clipPath>
  </defs>
</svg>
```

--------------------------------------------------------------------------------

---[FILE: extensions/typescript-language-features/schemas/jsconfig.schema.json]---
Location: vscode-main/extensions/typescript-language-features/schemas/jsconfig.schema.json

```json
{
	"allowTrailingCommas": true,
	"title": "JSON schema for the JavaScript configuration file",
	"type": "object",
	"default": {
		"compilerOptions": {
			"target": "es2024"
		}
	}
}
```

--------------------------------------------------------------------------------

---[FILE: extensions/typescript-language-features/schemas/package.schema.json]---
Location: vscode-main/extensions/typescript-language-features/schemas/package.schema.json

```json
{
	"$schema": "http://json-schema.org/draft-07/schema#",
	"type": "object",
	"properties": {
		"contributes": {
			"type": "object",
			"properties": {
				"typescriptServerPlugins": {
					"type": "array",
					"description": "Contributed TypeScript server plugins.",
					"items": {
						"type": "object",
						"description": "TypeScript server plugin.",
						"properties": {
							"name": {
								"type": "string",
								"description": "Name of the plugin as listed in the package.json."
							},
							"enableForWorkspaceTypeScriptVersions": {
								"type": "boolean",
								"default": false,
								"description": "Should the plugin be loaded when using workspace versions of TypeScript?"
							}
						}
					}
				}
			}
		}
	}
}
```

--------------------------------------------------------------------------------

---[FILE: extensions/typescript-language-features/schemas/tsconfig.schema.json]---
Location: vscode-main/extensions/typescript-language-features/schemas/tsconfig.schema.json

```json
{
	"allowTrailingCommas": true,
	"title": "JSON schema for the TypeScript compiler's configuration file",
	"type": "object",
	"default": {
		"compilerOptions": {
			"module": "commonjs"
		},
		"exclude": [
			"node_modules"
		]
	}
}
```

--------------------------------------------------------------------------------

---[FILE: extensions/typescript-language-features/src/api.ts]---
Location: vscode-main/extensions/typescript-language-features/src/api.ts

```typescript
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

import * as vscode from 'vscode';
import { PluginManager } from './tsServer/plugins';

class ApiV0 {
	public constructor(
		public readonly onCompletionAccepted: vscode.Event<vscode.CompletionItem & { metadata?: any }>,
		private readonly _pluginManager: PluginManager,
	) { }

	configurePlugin(pluginId: string, configuration: {}): void {
		this._pluginManager.setConfiguration(pluginId, configuration);
	}
}

export interface Api {
	getAPI(version: 0): ApiV0 | undefined;
}

export function getExtensionApi(
	onCompletionAccepted: vscode.Event<vscode.CompletionItem>,
	pluginManager: PluginManager,
): Api {
	return {
		getAPI(version) {
			if (version === 0) {
				return new ApiV0(onCompletionAccepted, pluginManager);
			}
			return undefined;
		}
	};
}
```

--------------------------------------------------------------------------------

---[FILE: extensions/typescript-language-features/src/experimentationService.ts]---
Location: vscode-main/extensions/typescript-language-features/src/experimentationService.ts

```typescript
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

import * as vscode from 'vscode';
import * as tas from 'vscode-tas-client';

import { IExperimentationTelemetryReporter } from './experimentTelemetryReporter';

interface ExperimentTypes {
	// None for now.
}

export class ExperimentationService {
	private readonly _experimentationServicePromise: Promise<tas.IExperimentationService>;
	private readonly _telemetryReporter: IExperimentationTelemetryReporter;

	constructor(telemetryReporter: IExperimentationTelemetryReporter, id: string, version: string, globalState: vscode.Memento) {
		this._telemetryReporter = telemetryReporter;
		this._experimentationServicePromise = createTasExperimentationService(this._telemetryReporter, id, version, globalState);
	}

	public async getTreatmentVariable<K extends keyof ExperimentTypes>(name: K, defaultValue: ExperimentTypes[K]): Promise<ExperimentTypes[K]> {
		const experimentationService = await this._experimentationServicePromise;
		try {
			const treatmentVariable = experimentationService.getTreatmentVariableAsync('vscode', name, /*checkCache*/ true) as Promise<ExperimentTypes[K]>;
			return treatmentVariable;
		} catch {
			return defaultValue;
		}
	}
}

export async function createTasExperimentationService(
	reporter: IExperimentationTelemetryReporter,
	id: string,
	version: string,
	globalState: vscode.Memento): Promise<tas.IExperimentationService> {
	let targetPopulation: tas.TargetPopulation;
	switch (vscode.env.uriScheme) {
		case 'vscode':
			targetPopulation = tas.TargetPopulation.Public;
			break;
		case 'vscode-insiders':
			targetPopulation = tas.TargetPopulation.Insiders;
			break;
		case 'vscode-exploration':
			targetPopulation = tas.TargetPopulation.Internal;
			break;
		case 'code-oss':
			targetPopulation = tas.TargetPopulation.Team;
			break;
		default:
			targetPopulation = tas.TargetPopulation.Public;
			break;
	}

	const experimentationService = tas.getExperimentationService(id, version, targetPopulation, reporter, globalState);
	await experimentationService.initialFetch;
	return experimentationService;
}
```

--------------------------------------------------------------------------------

---[FILE: extensions/typescript-language-features/src/experimentTelemetryReporter.ts]---
Location: vscode-main/extensions/typescript-language-features/src/experimentTelemetryReporter.ts

```typescript
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

import VsCodeTelemetryReporter from '@vscode/extension-telemetry';
import * as vscode from 'vscode';
import * as tas from 'vscode-tas-client';

export interface IExperimentationTelemetryReporter extends tas.IExperimentationTelemetry, vscode.Disposable {
	postEventObj(eventName: string, props: { [prop: string]: string }): void;
}

/**
 * This reporter *supports* experimentation telemetry,
 * but will only do so when passed to an {@link ExperimentationService}.
 */

export class ExperimentationTelemetryReporter implements IExperimentationTelemetryReporter {

	private _sharedProperties: Record<string, string> = {};
	private readonly _reporter: VsCodeTelemetryReporter;

	constructor(reporter: VsCodeTelemetryReporter) {
		this._reporter = reporter;
	}

	setSharedProperty(name: string, value: string): void {
		this._sharedProperties[name] = value;
	}

	postEvent(eventName: string, props: Map<string, string>): void {
		const propsObject = {
			...this._sharedProperties,
			...Object.fromEntries(props),
		};
		this._reporter.sendTelemetryEvent(eventName, propsObject);
	}

	postEventObj(eventName: string, props: { [prop: string]: string }) {
		this._reporter.sendTelemetryEvent(eventName, {
			...this._sharedProperties,
			...props,
		});
	}

	dispose() {
		this._reporter.dispose();
	}
}
```

--------------------------------------------------------------------------------

---[FILE: extensions/typescript-language-features/src/extension.browser.ts]---
Location: vscode-main/extensions/typescript-language-features/src/extension.browser.ts

```typescript
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

import VsCodeTelemetryReporter from '@vscode/extension-telemetry';
import * as vscode from 'vscode';
import { Api, getExtensionApi } from './api';
import { CommandManager } from './commands/commandManager';
import { registerBaseCommands } from './commands/index';
import { TypeScriptServiceConfiguration } from './configuration/configuration';
import { BrowserServiceConfigurationProvider } from './configuration/configuration.browser';
import { ExperimentationTelemetryReporter, IExperimentationTelemetryReporter } from './experimentTelemetryReporter';
import { registerAtaSupport } from './filesystems/ata';
import { createLazyClientHost, lazilyActivateClient } from './lazyClientHost';
import { Logger } from './logging/logger';
import RemoteRepositories from './remoteRepositories.browser';
import { API } from './tsServer/api';
import { noopRequestCancellerFactory } from './tsServer/cancellation';
import { noopLogDirectoryProvider } from './tsServer/logDirectoryProvider';
import { PluginManager } from './tsServer/plugins';
import { WorkerServerProcessFactory } from './tsServer/serverProcess.browser';
import { ITypeScriptVersionProvider, TypeScriptVersion, TypeScriptVersionSource } from './tsServer/versionProvider';
import { ActiveJsTsEditorTracker } from './ui/activeJsTsEditorTracker';
import { Disposable } from './utils/dispose';
import { getPackageInfo } from './utils/packageInfo';
import { isWebAndHasSharedArrayBuffers } from './utils/platform';

class StaticVersionProvider implements ITypeScriptVersionProvider {

	constructor(
		private readonly _version: TypeScriptVersion
	) { }

	updateConfiguration(_configuration: TypeScriptServiceConfiguration): void {
		// noop
	}

	get defaultVersion() { return this._version; }
	get bundledVersion() { return this._version; }

	readonly globalVersion = undefined;
	readonly localVersion = undefined;
	readonly localVersions = [];
}

export async function activate(context: vscode.ExtensionContext): Promise<Api> {
	const pluginManager = new PluginManager();
	context.subscriptions.push(pluginManager);

	const commandManager = new CommandManager();
	context.subscriptions.push(commandManager);

	const onCompletionAccepted = new vscode.EventEmitter<vscode.CompletionItem>();
	context.subscriptions.push(onCompletionAccepted);

	const activeJsTsEditorTracker = new ActiveJsTsEditorTracker();
	context.subscriptions.push(activeJsTsEditorTracker);

	const versionProvider = new StaticVersionProvider(
		new TypeScriptVersion(
			TypeScriptVersionSource.Bundled,
			vscode.Uri.joinPath(context.extensionUri, 'dist/browser/typescript/tsserver.web.js').toString(),
			API.fromSimpleString('5.9.0')));

	let experimentTelemetryReporter: IExperimentationTelemetryReporter | undefined;
	const packageInfo = getPackageInfo(context);
	if (packageInfo) {
		const { aiKey } = packageInfo;
		const vscTelemetryReporter = new VsCodeTelemetryReporter(aiKey);
		experimentTelemetryReporter = new ExperimentationTelemetryReporter(vscTelemetryReporter);
		context.subscriptions.push(experimentTelemetryReporter);
	}

	const logger = new Logger();

	const lazyClientHost = createLazyClientHost(context, false, {
		pluginManager,
		commandManager,
		logDirectoryProvider: noopLogDirectoryProvider,
		cancellerFactory: noopRequestCancellerFactory,
		versionProvider,
		processFactory: new WorkerServerProcessFactory(context.extensionUri, logger),
		activeJsTsEditorTracker,
		serviceConfigurationProvider: new BrowserServiceConfigurationProvider(),
		experimentTelemetryReporter,
		logger,
	}, item => {
		onCompletionAccepted.fire(item);
	});

	registerBaseCommands(commandManager, lazyClientHost, pluginManager, activeJsTsEditorTracker);

	// context.subscriptions.push(task.register(lazyClientHost.map(x => x.serviceClient)));

	import('./languageFeatures/tsconfig').then(module => {
		context.subscriptions.push(module.register());
	});

	context.subscriptions.push(lazilyActivateClient(lazyClientHost, pluginManager, activeJsTsEditorTracker, async () => {
		await startPreloadWorkspaceContentsIfNeeded(context, logger);
	}));

	context.subscriptions.push(registerAtaSupport(logger));

	return getExtensionApi(onCompletionAccepted.event, pluginManager);
}

async function startPreloadWorkspaceContentsIfNeeded(context: vscode.ExtensionContext, logger: Logger): Promise<void> {
	if (!isWebAndHasSharedArrayBuffers()) {
		return;
	}

	if (!vscode.workspace.workspaceFolders) {
		return;
	}

	await Promise.all(vscode.workspace.workspaceFolders.map(async folder => {
		const workspaceUri = folder.uri;
		if (workspaceUri.scheme !== 'vscode-vfs' || !workspaceUri.authority.startsWith('github')) {
			logger.info(`Skipped pre loading workspace contents for repository ${workspaceUri?.toString()}`);
			return;
		}

		const loader = new RemoteWorkspaceContentsPreloader(workspaceUri, logger);
		context.subscriptions.push(loader);
		try {
			await loader.triggerPreload();
		} catch (error) {
			console.error(error);
		}
	}));
}

class RemoteWorkspaceContentsPreloader extends Disposable {

	private _preload: Promise<void> | undefined;

	constructor(
		private readonly workspaceUri: vscode.Uri,
		private readonly logger: Logger,
	) {
		super();

		const fsWatcher = this._register(vscode.workspace.createFileSystemWatcher(new vscode.RelativePattern(workspaceUri, '*')));
		this._register(fsWatcher.onDidChange(uri => {
			if (uri.toString() === workspaceUri.toString()) {
				this._preload = undefined;
				this.triggerPreload();
			}
		}));
	}

	async triggerPreload() {
		this._preload ??= this.doPreload();
		return this._preload;
	}

	private async doPreload(): Promise<void> {
		try {
			const remoteHubApi = await RemoteRepositories.getApi();
			if (await remoteHubApi.loadWorkspaceContents?.(this.workspaceUri)) {
				this.logger.info(`Successfully loaded workspace content for repository ${this.workspaceUri.toString()}`);
			} else {
				this.logger.info(`Failed to load workspace content for repository ${this.workspaceUri.toString()}`);
			}
		} catch (error) {
			this.logger.info(`Loading workspace content for repository ${this.workspaceUri.toString()} failed: ${error instanceof Error ? error.toString() : 'Unknown reason'}`);
			console.error(error);
		}
	}
}
```

--------------------------------------------------------------------------------

---[FILE: extensions/typescript-language-features/src/extension.ts]---
Location: vscode-main/extensions/typescript-language-features/src/extension.ts

```typescript
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

import VsCodeTelemetryReporter from '@vscode/extension-telemetry';
import * as fs from 'fs';
import * as vscode from 'vscode';
import { Api, getExtensionApi } from './api';
import { CommandManager } from './commands/commandManager';
import { DisableTsgoCommand, tsNativeExtensionId } from './commands/useTsgo';
import { registerBaseCommands } from './commands/index';
import { ElectronServiceConfigurationProvider } from './configuration/configuration.electron';
import { ExperimentationTelemetryReporter, IExperimentationTelemetryReporter } from './experimentTelemetryReporter';
import { ExperimentationService } from './experimentationService';
import { createLazyClientHost, lazilyActivateClient } from './lazyClientHost';
import { Logger } from './logging/logger';
import { nodeRequestCancellerFactory } from './tsServer/cancellation.electron';
import { NodeLogDirectoryProvider } from './tsServer/logDirectoryProvider.electron';
import { PluginManager } from './tsServer/plugins';
import { ElectronServiceProcessFactory } from './tsServer/serverProcess.electron';
import { DiskTypeScriptVersionProvider } from './tsServer/versionProvider.electron';
import { ActiveJsTsEditorTracker } from './ui/activeJsTsEditorTracker';
import { onCaseInsensitiveFileSystem } from './utils/fs.electron';
import { Lazy } from './utils/lazy';
import { getPackageInfo } from './utils/packageInfo';
import * as temp from './utils/temp.electron';
import { conditionalRegistration, requireGlobalConfiguration, requireHasVsCodeExtension } from './languageFeatures/util/dependentRegistration';
import { DisposableStore } from './utils/dispose';

export function activate(
	context: vscode.ExtensionContext
): Api {
	const pluginManager = new PluginManager();
	context.subscriptions.push(pluginManager);

	const onCompletionAccepted = new vscode.EventEmitter<vscode.CompletionItem>();
	context.subscriptions.push(onCompletionAccepted);

	const logDirectoryProvider = new NodeLogDirectoryProvider(context);
	const versionProvider = new DiskTypeScriptVersionProvider();

	let experimentTelemetryReporter: IExperimentationTelemetryReporter | undefined;
	const packageInfo = getPackageInfo(context);
	if (packageInfo) {
		const { name: id, version, aiKey } = packageInfo;
		const vscTelemetryReporter = new VsCodeTelemetryReporter(aiKey);
		experimentTelemetryReporter = new ExperimentationTelemetryReporter(vscTelemetryReporter);
		context.subscriptions.push(experimentTelemetryReporter);

		// Currently we have no experiments, but creating the service adds the appropriate
		// shared properties to the ExperimentationTelemetryReporter we just created.
		new ExperimentationService(experimentTelemetryReporter, id, version, context.globalState);
	}

	// Register features that work in both TSGO and non-TSGO modes
	import('./languageFeatures/tsconfig').then(module => {
		context.subscriptions.push(module.register());
	});

	// Conditionally register features based on whether TSGO is enabled
	context.subscriptions.push(conditionalRegistration([
		requireGlobalConfiguration('typescript', 'experimental.useTsgo'),
		requireHasVsCodeExtension(tsNativeExtensionId),
	], () => {
		// TSGO. Only register a small set of features that don't use TS Server
		const disposables = new DisposableStore();

		const commandManager = disposables.add(new CommandManager());
		commandManager.register(new DisableTsgoCommand());

		return disposables;
	}, () => {
		// Normal registration path
		const disposables = new DisposableStore();

		const commandManager = disposables.add(new CommandManager());
		const activeJsTsEditorTracker = disposables.add(new ActiveJsTsEditorTracker());

		const lazyClientHost = createLazyClientHost(context, onCaseInsensitiveFileSystem(), {
			pluginManager,
			commandManager,
			logDirectoryProvider,
			cancellerFactory: nodeRequestCancellerFactory,
			versionProvider,
			processFactory: new ElectronServiceProcessFactory(),
			activeJsTsEditorTracker,
			serviceConfigurationProvider: new ElectronServiceConfigurationProvider(),
			experimentTelemetryReporter,
			logger: new Logger(),
		}, item => {
			onCompletionAccepted.fire(item);
		}).map(clientHost => {
			return disposables.add(clientHost);
		});

		// Register features
		registerBaseCommands(commandManager, lazyClientHost, pluginManager, activeJsTsEditorTracker);

		import('./task/taskProvider').then(module => {
			disposables.add(module.register(new Lazy(() => lazyClientHost.value.serviceClient)));
		});

		disposables.add(lazilyActivateClient(lazyClientHost, pluginManager, activeJsTsEditorTracker));

		return disposables;
	},));

	return getExtensionApi(onCompletionAccepted.event, pluginManager);
}

export function deactivate() {
	fs.rmSync(temp.instanceTempDir.value, { recursive: true, force: true });
}
```

--------------------------------------------------------------------------------

---[FILE: extensions/typescript-language-features/src/languageProvider.ts]---
Location: vscode-main/extensions/typescript-language-features/src/languageProvider.ts

```typescript
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

import { basename, extname } from 'path';
import * as vscode from 'vscode';
import { CommandManager } from './commands/commandManager';
import { DocumentSelector } from './configuration/documentSelector';
import * as fileSchemes from './configuration/fileSchemes';
import { LanguageDescription } from './configuration/languageDescription';
import { Schemes } from './configuration/schemes';
import { DiagnosticKind } from './languageFeatures/diagnostics';
import FileConfigurationManager from './languageFeatures/fileConfigurationManager';
import { TelemetryReporter } from './logging/telemetry';
import { CachedResponse } from './tsServer/cachedResponse';
import { ClientCapability } from './typescriptService';
import TypeScriptServiceClient from './typescriptServiceClient';
import TypingsStatus from './ui/typingsStatus';
import { Disposable } from './utils/dispose';
import { isWeb, isWebAndHasSharedArrayBuffers, supportsReadableByteStreams } from './utils/platform';


const validateSetting = 'validate.enable';
const suggestionSetting = 'suggestionActions.enabled';

export default class LanguageProvider extends Disposable {

	constructor(
		private readonly client: TypeScriptServiceClient,
		private readonly description: LanguageDescription,
		private readonly commandManager: CommandManager,
		private readonly telemetryReporter: TelemetryReporter,
		private readonly typingsStatus: TypingsStatus,
		private readonly fileConfigurationManager: FileConfigurationManager,
		private readonly onCompletionAccepted: (item: vscode.CompletionItem) => void,
	) {
		super();
		vscode.workspace.onDidChangeConfiguration(this.configurationChanged, this, this._disposables);
		this.configurationChanged();

		client.onReady(() => this.registerProviders());
	}

	private get documentSelector(): DocumentSelector {
		const semantic: vscode.DocumentFilter[] = [];
		const syntax: vscode.DocumentFilter[] = [];
		for (const language of this.description.languageIds) {
			syntax.push({ language });
			for (const scheme of fileSchemes.getSemanticSupportedSchemes()) {
				semantic.push({ language, scheme });
			}
		}

		return { semantic, syntax };
	}

	private async registerProviders(): Promise<void> {
		const selector = this.documentSelector;

		const cachedNavTreeResponse = new CachedResponse();

		await Promise.all([
			import('./languageFeatures/callHierarchy').then(provider => this._register(provider.register(selector, this.client))),
			import('./languageFeatures/codeLens/implementationsCodeLens').then(provider => this._register(provider.register(selector, this.description, this.client, cachedNavTreeResponse))),
			import('./languageFeatures/codeLens/referencesCodeLens').then(provider => this._register(provider.register(selector, this.description, this.client, cachedNavTreeResponse))),
			import('./languageFeatures/completions').then(provider => this._register(provider.register(selector, this.description, this.client, this.typingsStatus, this.fileConfigurationManager, this.commandManager, this.telemetryReporter, this.onCompletionAccepted))),
			import('./languageFeatures/copyPaste').then(provider => this._register(provider.register(selector, this.description, this.client, this.fileConfigurationManager))),
			import('./languageFeatures/definitions').then(provider => this._register(provider.register(selector, this.client))),
			import('./languageFeatures/directiveCommentCompletions').then(provider => this._register(provider.register(selector, this.client))),
			import('./languageFeatures/documentHighlight').then(provider => this._register(provider.register(selector, this.client))),
			import('./languageFeatures/documentSymbol').then(provider => this._register(provider.register(selector, this.client, cachedNavTreeResponse))),
			import('./languageFeatures/fileReferences').then(provider => this._register(provider.register(this.client, this.commandManager))),
			import('./languageFeatures/fixAll').then(provider => this._register(provider.register(selector, this.client, this.fileConfigurationManager, this.client.diagnosticsManager))),
			import('./languageFeatures/folding').then(provider => this._register(provider.register(selector, this.client))),
			import('./languageFeatures/formatting').then(provider => this._register(provider.register(selector, this.description, this.client, this.fileConfigurationManager))),
			import('./languageFeatures/hover').then(provider => this._register(provider.register(selector, this.client, this.fileConfigurationManager))),
			import('./languageFeatures/implementations').then(provider => this._register(provider.register(selector, this.client))),
			import('./languageFeatures/inlayHints').then(provider => this._register(provider.register(selector, this.description, this.client, this.fileConfigurationManager, this.telemetryReporter))),
			import('./languageFeatures/jsDocCompletions').then(provider => this._register(provider.register(selector, this.description, this.client, this.fileConfigurationManager))),
			import('./languageFeatures/linkedEditing').then(provider => this._register(provider.register(selector, this.client))),
			import('./languageFeatures/organizeImports').then(provider => this._register(provider.register(selector, this.client, this.commandManager, this.fileConfigurationManager, this.telemetryReporter))),
			import('./languageFeatures/quickFix').then(provider => this._register(provider.register(selector, this.client, this.fileConfigurationManager, this.commandManager, this.client.diagnosticsManager, this.telemetryReporter))),
			import('./languageFeatures/refactor').then(provider => this._register(provider.register(selector, this.client, cachedNavTreeResponse, this.fileConfigurationManager, this.commandManager, this.telemetryReporter))),
			import('./languageFeatures/references').then(provider => this._register(provider.register(selector, this.client))),
			import('./languageFeatures/rename').then(provider => this._register(provider.register(selector, this.description, this.client, this.fileConfigurationManager))),
			import('./languageFeatures/semanticTokens').then(provider => this._register(provider.register(selector, this.client))),
			import('./languageFeatures/signatureHelp').then(provider => this._register(provider.register(selector, this.client))),
			import('./languageFeatures/smartSelect').then(provider => this._register(provider.register(selector, this.client))),
			import('./languageFeatures/sourceDefinition').then(provider => this._register(provider.register(this.client, this.commandManager))),
			import('./languageFeatures/tagClosing').then(provider => this._register(provider.register(selector, this.description, this.client))),
			import('./languageFeatures/typeDefinitions').then(provider => this._register(provider.register(selector, this.client))),
		]);
	}

	private configurationChanged(): void {
		const config = vscode.workspace.getConfiguration(this.id, null);
		this.updateValidate(config.get(validateSetting, true));
		this.updateSuggestionDiagnostics(config.get(suggestionSetting, true));
	}

	public handlesUri(resource: vscode.Uri): boolean {
		const ext = extname(resource.path).slice(1).toLowerCase();
		return this.description.standardFileExtensions.includes(ext) || this.handlesConfigFile(resource);
	}

	public handlesDocument(doc: vscode.TextDocument): boolean {
		return this.description.languageIds.includes(doc.languageId) || this.handlesConfigFile(doc.uri);
	}

	private handlesConfigFile(resource: vscode.Uri) {
		const base = basename(resource.fsPath);
		return !!base && (!!this.description.configFilePattern && this.description.configFilePattern.test(base));
	}

	private get id(): string {
		return this.description.id;
	}

	public get diagnosticSource(): string {
		return this.description.diagnosticSource;
	}

	private updateValidate(value: boolean) {
		this.client.diagnosticsManager.setValidate(this._diagnosticLanguage, value);
	}

	private updateSuggestionDiagnostics(value: boolean) {
		this.client.diagnosticsManager.setEnableSuggestions(this._diagnosticLanguage, value);
	}

	public reInitialize(): void {
		this.client.diagnosticsManager.reInitialize();
	}

	public triggerAllDiagnostics(): void {
		this.client.bufferSyncSupport.requestAllDiagnostics();
	}

	public diagnosticsReceived(
		diagnosticsKind: DiagnosticKind,
		file: vscode.Uri,
		diagnostics: (vscode.Diagnostic & { reportUnnecessary: any; reportDeprecated: any })[],
		ranges: vscode.Range[] | undefined): void {
		if (diagnosticsKind !== DiagnosticKind.Syntax && !this.client.hasCapabilityForResource(file, ClientCapability.Semantic)) {
			return;
		}

		if (diagnosticsKind === DiagnosticKind.Semantic && isWeb()) {
			if (
				!isWebAndHasSharedArrayBuffers()
				|| !supportsReadableByteStreams() // No ata. Will result in lots of false positives
				|| this.client.configuration.webProjectWideIntellisenseSuppressSemanticErrors
				|| !this.client.configuration.webProjectWideIntellisenseEnabled
			) {
				return;
			}
		}

		// Disable semantic errors in notebooks until we have better notebook support
		if (diagnosticsKind === DiagnosticKind.Semantic && file.scheme === Schemes.notebookCell) {
			return;
		}

		const config = vscode.workspace.getConfiguration(this.id, file);
		const reportUnnecessary = config.get<boolean>('showUnused', true);
		const reportDeprecated = config.get<boolean>('showDeprecated', true);
		this.client.diagnosticsManager.updateDiagnostics(file, this._diagnosticLanguage, diagnosticsKind, diagnostics.filter(diag => {
			// Don't bother reporting diagnostics we know will not be rendered
			if (!reportUnnecessary) {
				if (diag.reportUnnecessary && diag.severity === vscode.DiagnosticSeverity.Hint) {
					return false;
				}
			}
			if (!reportDeprecated) {
				if (diag.reportDeprecated && diag.severity === vscode.DiagnosticSeverity.Hint) {
					return false;
				}
			}
			return true;
		}), ranges);
	}

	public configFileDiagnosticsReceived(file: vscode.Uri, diagnostics: vscode.Diagnostic[]): void {
		this.client.diagnosticsManager.configFileDiagnosticsReceived(file, diagnostics);
	}

	private get _diagnosticLanguage() {
		return this.description.diagnosticLanguage;
	}
}
```

--------------------------------------------------------------------------------

---[FILE: extensions/typescript-language-features/src/lazyClientHost.ts]---
Location: vscode-main/extensions/typescript-language-features/src/lazyClientHost.ts

```typescript
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

import * as vscode from 'vscode';
import { CommandManager } from './commands/commandManager';
import { IExperimentationTelemetryReporter } from './experimentTelemetryReporter';
import { OngoingRequestCancellerFactory } from './tsServer/cancellation';
import { ILogDirectoryProvider } from './tsServer/logDirectoryProvider';
import { TsServerProcessFactory } from './tsServer/server';
import { ITypeScriptVersionProvider } from './tsServer/versionProvider';
import TypeScriptServiceClientHost from './typeScriptServiceClientHost';
import { ActiveJsTsEditorTracker } from './ui/activeJsTsEditorTracker';
import ManagedFileContextManager from './ui/managedFileContext';
import { ServiceConfigurationProvider } from './configuration/configuration';
import * as fileSchemes from './configuration/fileSchemes';
import { standardLanguageDescriptions, isJsConfigOrTsConfigFileName } from './configuration/languageDescription';
import { Lazy } from './utils/lazy';
import { Logger } from './logging/logger';
import { PluginManager } from './tsServer/plugins';

export function createLazyClientHost(
	context: vscode.ExtensionContext,
	onCaseInsensitiveFileSystem: boolean,
	services: {
		pluginManager: PluginManager;
		commandManager: CommandManager;
		logDirectoryProvider: ILogDirectoryProvider;
		cancellerFactory: OngoingRequestCancellerFactory;
		versionProvider: ITypeScriptVersionProvider;
		processFactory: TsServerProcessFactory;
		activeJsTsEditorTracker: ActiveJsTsEditorTracker;
		serviceConfigurationProvider: ServiceConfigurationProvider;
		experimentTelemetryReporter: IExperimentationTelemetryReporter | undefined;
		logger: Logger;
	},
	onCompletionAccepted: (item: vscode.CompletionItem) => void,
): Lazy<TypeScriptServiceClientHost> {
	return new Lazy(() => {
		return new TypeScriptServiceClientHost(
			standardLanguageDescriptions,
			context,
			onCaseInsensitiveFileSystem,
			services,
			onCompletionAccepted);
	});
}

export function lazilyActivateClient(
	lazyClientHost: Lazy<TypeScriptServiceClientHost>,
	pluginManager: PluginManager,
	activeJsTsEditorTracker: ActiveJsTsEditorTracker,
	onActivate: () => Promise<void> = () => Promise.resolve(),
): vscode.Disposable {
	const disposables: vscode.Disposable[] = [];

	const supportedLanguage = [
		...standardLanguageDescriptions.map(x => x.languageIds),
		...pluginManager.plugins.map(x => x.languages)
	].flat();

	let hasActivated = false;
	const maybeActivate = (textDocument: vscode.TextDocument): boolean => {
		if (!hasActivated && isSupportedDocument(supportedLanguage, textDocument)) {
			hasActivated = true;

			onActivate().then(() => {
				// Force activation
				void lazyClientHost.value;

				disposables.push(new ManagedFileContextManager(activeJsTsEditorTracker));
			});

			return true;
		}
		return false;
	};

	const didActivate = vscode.workspace.textDocuments.some(maybeActivate);
	if (!didActivate) {
		const openListener = vscode.workspace.onDidOpenTextDocument(doc => {
			if (maybeActivate(doc)) {
				openListener.dispose();
			}
		}, undefined, disposables);
	}

	return new vscode.Disposable(() => {
		disposables.forEach(d => d.dispose());
	});
}

function isSupportedDocument(
	supportedLanguage: readonly string[],
	document: vscode.TextDocument
): boolean {
	return (supportedLanguage.indexOf(document.languageId) >= 0 || isJsConfigOrTsConfigFileName(document.fileName))
		&& !fileSchemes.disabledSchemes.has(document.uri.scheme);
}
```

--------------------------------------------------------------------------------

---[FILE: extensions/typescript-language-features/src/remoteRepositories.browser.ts]---
Location: vscode-main/extensions/typescript-language-features/src/remoteRepositories.browser.ts

```typescript
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

import { Extension, extensions, Uri } from 'vscode';

export interface RemoteHubApi {
	getProviderUri(uri: Uri): Uri;
	getProviderRootUri(uri: Uri): Uri;

	getVirtualUri(uri: Uri): Uri;
	getVirtualWorkspaceUri(uri: Uri): Uri | undefined;

	loadWorkspaceContents?(workspaceUri: Uri): Promise<boolean>;
}

namespace RemoteRepositories {

	let remoteHub: Extension<RemoteHubApi> | undefined;

	function getRemoteExtension(): Extension<RemoteHubApi> {
		if (remoteHub !== undefined) {
			return remoteHub;
		}

		remoteHub = extensions.getExtension<RemoteHubApi>('ms-vscode.remote-repositories')
			?? extensions.getExtension<RemoteHubApi>('GitHub.remoteHub')
			?? extensions.getExtension<RemoteHubApi>('GitHub.remoteHub-insiders');

		if (remoteHub === undefined) {
			throw new Error(`No Remote repository extension found.`);
		}
		return remoteHub;
	}

	export function getApi(): Thenable<RemoteHubApi> {
		return getRemoteExtension().activate();
	}
}

export default RemoteRepositories;
```

--------------------------------------------------------------------------------

---[FILE: extensions/typescript-language-features/src/test-all.ts]---
Location: vscode-main/extensions/typescript-language-features/src/test-all.ts

```typescript
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

//
// PLEASE DO NOT MODIFY / DELETE UNLESS YOU KNOW WHAT YOU ARE DOING
//
// This file is providing the test runner to use when running extension tests.
// By default the test runner in use is Mocha based.
//
// You can provide your own test runner if you want to override it by exporting
// a function run(testRoot: string, clb: (error:Error) => void) that the extension
// host can call to run the tests. The test runner is expected to use console.log
// to report the results back to the caller. When the tests are finished, return
// a possible error to the callback or null if none.

const testRunner = require('../../../test/integration/electron/testrunner');

// You can directly control Mocha options by uncommenting the following lines
// See https://github.com/mochajs/mocha/wiki/Using-mocha-programmatically#set-options for more info
testRunner.configure({
	ui: 'tdd', 		// the TDD UI is being used in extension.test.ts (suite, test, etc.)
	color: true,
	timeout: 60000,
});

export = testRunner;
```

--------------------------------------------------------------------------------

---[FILE: extensions/typescript-language-features/src/tsconfig.ts]---
Location: vscode-main/extensions/typescript-language-features/src/tsconfig.ts

```typescript
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

import * as vscode from 'vscode';
import { TypeScriptServiceConfiguration } from './configuration/configuration';
import { API } from './tsServer/api';
import type * as Proto from './tsServer/protocol/protocol';
import { ITypeScriptServiceClient, ServerResponse } from './typescriptService';
import { nulToken } from './utils/cancellation';


export const enum ProjectType {
	TypeScript,
	JavaScript,
}

export function isImplicitProjectConfigFile(configFileName: string) {
	return configFileName.startsWith('/dev/null/');
}

export function inferredProjectCompilerOptions(
	version: API,
	projectType: ProjectType,
	serviceConfig: TypeScriptServiceConfiguration,
): Proto.ExternalProjectCompilerOptions {
	const projectConfig: Proto.ExternalProjectCompilerOptions = {
		module: (version.gte(API.v540) ? 'Preserve' : 'ESNext') as Proto.ModuleKind,
		moduleResolution: (version.gte(API.v540) ? 'Bundler' : 'Node') as Proto.ModuleResolutionKind,
		target: 'ES2022' as Proto.ScriptTarget,
		jsx: 'react-jsx' as Proto.JsxEmit,
	};

	if (version.gte(API.v500)) {
		projectConfig.allowImportingTsExtensions = true;
	}

	if (serviceConfig.implicitProjectConfiguration.checkJs) {
		projectConfig.checkJs = true;
		if (projectType === ProjectType.TypeScript) {
			projectConfig.allowJs = true;
		}
	}

	if (serviceConfig.implicitProjectConfiguration.experimentalDecorators) {
		projectConfig.experimentalDecorators = true;
	}

	if (serviceConfig.implicitProjectConfiguration.strictNullChecks) {
		projectConfig.strictNullChecks = true;
	}

	if (serviceConfig.implicitProjectConfiguration.strictFunctionTypes) {
		projectConfig.strictFunctionTypes = true;
	}

	if (serviceConfig.implicitProjectConfiguration.strict) {
		projectConfig.strict = true;
	}

	if (serviceConfig.implicitProjectConfiguration.module) {
		projectConfig.module = serviceConfig.implicitProjectConfiguration.module as Proto.ModuleKind;
	}

	if (serviceConfig.implicitProjectConfiguration.target) {
		projectConfig.target = serviceConfig.implicitProjectConfiguration.target as Proto.ScriptTarget;
	}

	if (projectType === ProjectType.TypeScript) {
		projectConfig.sourceMap = true;
	}

	return projectConfig;
}

function inferredProjectConfigSnippet(
	version: API,
	projectType: ProjectType,
	config: TypeScriptServiceConfiguration
) {
	const baseConfig = inferredProjectCompilerOptions(version, projectType, config);
	if (projectType === ProjectType.TypeScript) {
		delete baseConfig.allowImportingTsExtensions;
	}

	const compilerOptions = Object.keys(baseConfig).map(key => `"${key}": ${JSON.stringify(baseConfig[key])}`);
	return new vscode.SnippetString(`{
	"compilerOptions": {
		${compilerOptions.join(',\n\t\t')}$0
	},
	"exclude": [
		"node_modules",
		"**/node_modules/*"
	]
}`);
}

export async function openOrCreateConfig(
	version: API,
	projectType: ProjectType,
	rootPath: vscode.Uri,
	configuration: TypeScriptServiceConfiguration,
): Promise<vscode.TextEditor | null> {
	const configFile = vscode.Uri.joinPath(rootPath, projectType === ProjectType.TypeScript ? 'tsconfig.json' : 'jsconfig.json');
	const col = vscode.window.activeTextEditor?.viewColumn;
	try {
		const doc = await vscode.workspace.openTextDocument(configFile);
		return vscode.window.showTextDocument(doc, col);
	} catch {
		const doc = await vscode.workspace.openTextDocument(configFile.with({ scheme: 'untitled' }));
		const editor = await vscode.window.showTextDocument(doc, col);
		if (editor.document.getText().length === 0) {
			await editor.insertSnippet(inferredProjectConfigSnippet(version, projectType, configuration));
		}
		return editor;
	}
}

export async function openProjectConfigOrPromptToCreate(
	projectType: ProjectType,
	client: ITypeScriptServiceClient,
	rootPath: vscode.Uri,
	configFilePath: string,
): Promise<void> {
	if (!isImplicitProjectConfigFile(configFilePath)) {
		const doc = await vscode.workspace.openTextDocument(client.toResource(configFilePath));
		vscode.window.showTextDocument(doc, vscode.window.activeTextEditor?.viewColumn);
		return;
	}

	const CreateConfigItem: vscode.MessageItem = {
		title: projectType === ProjectType.TypeScript
			? vscode.l10n.t("Configure tsconfig.json")
			: vscode.l10n.t("Configure jsconfig.json"),
	};

	const selected = await vscode.window.showInformationMessage(
		(projectType === ProjectType.TypeScript
			? vscode.l10n.t("File is not part of a TypeScript project. View the [tsconfig.json documentation]({0}) to learn more.", 'https://go.microsoft.com/fwlink/?linkid=841896')
			: vscode.l10n.t("File is not part of a JavaScript project. View the [jsconfig.json documentation]({0}) to learn more.", 'https://go.microsoft.com/fwlink/?linkid=759670')
		),
		CreateConfigItem);

	switch (selected) {
		case CreateConfigItem:
			openOrCreateConfig(client.apiVersion, projectType, rootPath, client.configuration);
			return;
	}
}

export async function openProjectConfigForFile(
	projectType: ProjectType,
	client: ITypeScriptServiceClient,
	resource: vscode.Uri,
): Promise<void> {
	const rootPath = client.getWorkspaceRootForResource(resource);
	if (!rootPath) {
		vscode.window.showInformationMessage(
			vscode.l10n.t("Please open a folder in VS Code to use a TypeScript or JavaScript project"));
		return;
	}

	const file = client.toTsFilePath(resource);
	// TSServer errors when 'projectInfo' is invoked on a non js/ts file
	if (!file || !client.toTsFilePath(resource)) {
		vscode.window.showWarningMessage(
			vscode.l10n.t("Could not determine TypeScript or JavaScript project. Unsupported file type"));
		return;
	}

	let res: ServerResponse.Response<Proto.ProjectInfoResponse> | undefined;
	try {
		res = await client.execute('projectInfo', { file, needFileNameList: false }, nulToken);
	} catch {
		// noop
	}

	if (res?.type !== 'response' || !res.body) {
		vscode.window.showWarningMessage(vscode.l10n.t("Could not determine TypeScript or JavaScript project"));
		return;
	}
	return openProjectConfigOrPromptToCreate(projectType, client, rootPath, res.body.configFileName);
}
```

--------------------------------------------------------------------------------

---[FILE: extensions/typescript-language-features/src/typeConverters.ts]---
Location: vscode-main/extensions/typescript-language-features/src/typeConverters.ts

```typescript
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

/**
 * Helpers for converting FROM vscode types TO ts types
 */

import * as vscode from 'vscode';
import type * as Proto from './tsServer/protocol/protocol';
import * as PConst from './tsServer/protocol/protocol.const';
import { ITypeScriptServiceClient } from './typescriptService';

export namespace Range {
	export const fromTextSpan = (span: Proto.TextSpan): vscode.Range =>
		fromLocations(span.start, span.end);

	export const toTextSpan = (range: vscode.Range): Proto.TextSpan => ({
		start: Position.toLocation(range.start),
		end: Position.toLocation(range.end)
	});

	export const fromLocations = (start: Proto.Location, end: Proto.Location): vscode.Range =>
		new vscode.Range(
			Math.max(0, start.line - 1), Math.max(start.offset - 1, 0),
			Math.max(0, end.line - 1), Math.max(0, end.offset - 1));

	export const toFileRange = (range: vscode.Range): Proto.FileRange => ({
		startLine: range.start.line + 1,
		startOffset: range.start.character + 1,
		endLine: range.end.line + 1,
		endOffset: range.end.character + 1
	});

	export const toFileRangeRequestArgs = (file: string, range: vscode.Range): Proto.FileRangeRequestArgs => ({
		file,
		...toFileRange(range)
	});

	export const toFileRangesRequestArgs = (file: string, ranges: vscode.Range[]): Proto.FileRangesRequestArgs => ({
		file,
		ranges: ranges.map(toFileRange)
	});

	export const toFormattingRequestArgs = (file: string, range: vscode.Range): Proto.FormatRequestArgs => ({
		file,
		line: range.start.line + 1,
		offset: range.start.character + 1,
		endLine: range.end.line + 1,
		endOffset: range.end.character + 1
	});
}

export namespace Position {
	export const fromLocation = (tslocation: Proto.Location): vscode.Position =>
		new vscode.Position(tslocation.line - 1, tslocation.offset - 1);

	export const toLocation = (vsPosition: vscode.Position): Proto.Location => ({
		line: vsPosition.line + 1,
		offset: vsPosition.character + 1,
	});

	export const toFileLocationRequestArgs = (file: string, position: vscode.Position): Proto.FileLocationRequestArgs => ({
		file,
		line: position.line + 1,
		offset: position.character + 1,
	});
}

export namespace Location {
	export const fromTextSpan = (resource: vscode.Uri, tsTextSpan: Proto.TextSpan): vscode.Location =>
		new vscode.Location(resource, Range.fromTextSpan(tsTextSpan));
}

export namespace TextEdit {
	export const fromCodeEdit = (edit: Proto.CodeEdit): vscode.TextEdit =>
		new vscode.TextEdit(
			Range.fromTextSpan(edit),
			edit.newText);
}

export namespace WorkspaceEdit {
	export function fromFileCodeEdits(
		client: ITypeScriptServiceClient,
		edits: Iterable<Proto.FileCodeEdits>
	): vscode.WorkspaceEdit {
		return withFileCodeEdits(new vscode.WorkspaceEdit(), client, edits);
	}

	export function withFileCodeEdits(
		workspaceEdit: vscode.WorkspaceEdit,
		client: ITypeScriptServiceClient,
		edits: Iterable<Proto.FileCodeEdits>
	): vscode.WorkspaceEdit {
		for (const edit of edits) {
			const resource = client.toResource(edit.fileName);
			for (const textChange of edit.textChanges) {
				workspaceEdit.replace(resource,
					Range.fromTextSpan(textChange),
					textChange.newText);
			}
		}

		return workspaceEdit;
	}
}

export namespace SymbolKind {
	export function fromProtocolScriptElementKind(kind: Proto.ScriptElementKind) {
		switch (kind) {
			case PConst.Kind.module: return vscode.SymbolKind.Module;
			case PConst.Kind.class: return vscode.SymbolKind.Class;
			case PConst.Kind.enum: return vscode.SymbolKind.Enum;
			case PConst.Kind.enumMember: return vscode.SymbolKind.EnumMember;
			case PConst.Kind.interface: return vscode.SymbolKind.Interface;
			case PConst.Kind.indexSignature: return vscode.SymbolKind.Method;
			case PConst.Kind.callSignature: return vscode.SymbolKind.Method;
			case PConst.Kind.method: return vscode.SymbolKind.Method;
			case PConst.Kind.memberVariable: return vscode.SymbolKind.Property;
			case PConst.Kind.memberGetAccessor: return vscode.SymbolKind.Property;
			case PConst.Kind.memberSetAccessor: return vscode.SymbolKind.Property;
			case PConst.Kind.variable: return vscode.SymbolKind.Variable;
			case PConst.Kind.let: return vscode.SymbolKind.Variable;
			case PConst.Kind.const: return vscode.SymbolKind.Variable;
			case PConst.Kind.localVariable: return vscode.SymbolKind.Variable;
			case PConst.Kind.alias: return vscode.SymbolKind.Variable;
			case PConst.Kind.function: return vscode.SymbolKind.Function;
			case PConst.Kind.localFunction: return vscode.SymbolKind.Function;
			case PConst.Kind.constructSignature: return vscode.SymbolKind.Constructor;
			case PConst.Kind.constructorImplementation: return vscode.SymbolKind.Constructor;
			case PConst.Kind.typeParameter: return vscode.SymbolKind.TypeParameter;
			case PConst.Kind.string: return vscode.SymbolKind.String;
			default: return vscode.SymbolKind.Variable;
		}
	}
}

export namespace CompletionTriggerKind {
	export function toProtocolCompletionTriggerKind(kind: vscode.CompletionTriggerKind): Proto.CompletionTriggerKind {
		switch (kind) {
			case vscode.CompletionTriggerKind.Invoke: return 1;
			case vscode.CompletionTriggerKind.TriggerCharacter: return 2;
			case vscode.CompletionTriggerKind.TriggerForIncompleteCompletions: return 3;
		}
	}
}

export namespace OrganizeImportsMode {
	export function toProtocolOrganizeImportsMode(mode: PConst.OrganizeImportsMode): Proto.OrganizeImportsMode {
		switch (mode) {
			case PConst.OrganizeImportsMode.All: return 'All' as Proto.OrganizeImportsMode.All;
			case PConst.OrganizeImportsMode.SortAndCombine: return 'SortAndCombine' as Proto.OrganizeImportsMode.SortAndCombine;
			case PConst.OrganizeImportsMode.RemoveUnused: return 'RemoveUnused' as Proto.OrganizeImportsMode.RemoveUnused;
		}
	}
}
```

--------------------------------------------------------------------------------

---[FILE: extensions/typescript-language-features/src/typescriptService.ts]---
Location: vscode-main/extensions/typescript-language-features/src/typescriptService.ts

```typescript
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

import * as vscode from 'vscode';
import * as Proto from './tsServer/protocol/protocol';
import BufferSyncSupport from './tsServer/bufferSyncSupport';
import { ExecutionTarget } from './tsServer/server';
import { TypeScriptVersion } from './tsServer/versionProvider';
import { API } from './tsServer/api';
import { TypeScriptServiceConfiguration } from './configuration/configuration';
import { PluginManager } from './tsServer/plugins';
import { TelemetryReporter } from './logging/telemetry';

export enum ServerType {
	Syntax = 'syntax',
	Semantic = 'semantic',
}

export namespace ServerResponse {

	export class Cancelled {
		public readonly type = 'cancelled';

		constructor(
			public readonly reason: string
		) { }
	}

	export const NoContent = { type: 'noContent' } as const;

	export const NoServer = { type: 'noServer' } as const;

	export type Response<T extends Proto.Response> = T | Cancelled | typeof NoContent | typeof NoServer;
}

interface StandardTsServerRequests {
	'applyCodeActionCommand': [Proto.ApplyCodeActionCommandRequestArgs, Proto.ApplyCodeActionCommandResponse];
	'completionEntryDetails': [Proto.CompletionDetailsRequestArgs, Proto.CompletionDetailsResponse];
	'completionInfo': [Proto.CompletionsRequestArgs, Proto.CompletionInfoResponse];
	'completions': [Proto.CompletionsRequestArgs, Proto.CompletionsResponse];
	'configure': [Proto.ConfigureRequestArguments, Proto.ConfigureResponse];
	'definition': [Proto.FileLocationRequestArgs, Proto.DefinitionResponse];
	'definitionAndBoundSpan': [Proto.FileLocationRequestArgs, Proto.DefinitionInfoAndBoundSpanResponse];
	'docCommentTemplate': [Proto.FileLocationRequestArgs, Proto.DocCommandTemplateResponse];
	'documentHighlights': [Proto.DocumentHighlightsRequestArgs, Proto.DocumentHighlightsResponse];
	'format': [Proto.FormatRequestArgs, Proto.FormatResponse];
	'formatonkey': [Proto.FormatOnKeyRequestArgs, Proto.FormatResponse];
	'getApplicableRefactors': [Proto.GetApplicableRefactorsRequestArgs, Proto.GetApplicableRefactorsResponse];
	'getCodeFixes': [Proto.CodeFixRequestArgs, Proto.CodeFixResponse];
	'getCombinedCodeFix': [Proto.GetCombinedCodeFixRequestArgs, Proto.GetCombinedCodeFixResponse];
	'getEditsForFileRename': [Proto.GetEditsForFileRenameRequestArgs, Proto.GetEditsForFileRenameResponse];
	'getEditsForRefactor': [Proto.GetEditsForRefactorRequestArgs, Proto.GetEditsForRefactorResponse];
	'getOutliningSpans': [Proto.FileRequestArgs, Proto.OutliningSpansResponse];
	'getSupportedCodeFixes': [null, Proto.GetSupportedCodeFixesResponse];
	'implementation': [Proto.FileLocationRequestArgs, Proto.ImplementationResponse];
	'jsxClosingTag': [Proto.JsxClosingTagRequestArgs, Proto.JsxClosingTagResponse];
	'navto': [Proto.NavtoRequestArgs, Proto.NavtoResponse];
	'navtree': [Proto.FileRequestArgs, Proto.NavTreeResponse];
	'organizeImports': [Proto.OrganizeImportsRequestArgs, Proto.OrganizeImportsResponse];
	'projectInfo': [Proto.ProjectInfoRequestArgs, Proto.ProjectInfoResponse];
	'quickinfo': [Proto.FileLocationRequestArgs, Proto.QuickInfoResponse];
	'references': [Proto.FileLocationRequestArgs, Proto.ReferencesResponse];
	'rename': [Proto.RenameRequestArgs, Proto.RenameResponse];
	'selectionRange': [Proto.SelectionRangeRequestArgs, Proto.SelectionRangeResponse];
	'signatureHelp': [Proto.SignatureHelpRequestArgs, Proto.SignatureHelpResponse];
	'typeDefinition': [Proto.FileLocationRequestArgs, Proto.TypeDefinitionResponse];
	'updateOpen': [Proto.UpdateOpenRequestArgs, Proto.Response];
	'prepareCallHierarchy': [Proto.FileLocationRequestArgs, Proto.PrepareCallHierarchyResponse];
	'provideCallHierarchyIncomingCalls': [Proto.FileLocationRequestArgs, Proto.ProvideCallHierarchyIncomingCallsResponse];
	'provideCallHierarchyOutgoingCalls': [Proto.FileLocationRequestArgs, Proto.ProvideCallHierarchyOutgoingCallsResponse];
	'fileReferences': [Proto.FileRequestArgs, Proto.FileReferencesResponse];
	'provideInlayHints': [Proto.InlayHintsRequestArgs, Proto.InlayHintsResponse];
	'encodedSemanticClassifications-full': [Proto.EncodedSemanticClassificationsRequestArgs, Proto.EncodedSemanticClassificationsResponse];
	'findSourceDefinition': [Proto.FileLocationRequestArgs, Proto.DefinitionResponse];
	'getMoveToRefactoringFileSuggestions': [Proto.GetMoveToRefactoringFileSuggestionsRequestArgs, Proto.GetMoveToRefactoringFileSuggestions];
	'linkedEditingRange': [Proto.FileLocationRequestArgs, Proto.LinkedEditingRangeResponse];
	'mapCode': [Proto.MapCodeRequestArgs, Proto.MapCodeResponse];
	'getPasteEdits': [Proto.GetPasteEditsRequestArgs, Proto.GetPasteEditsResponse];
	'preparePasteEdits': [Proto.PreparePasteEditsRequestArgs, Proto.PreparePasteEditsResponse];
}

interface NoResponseTsServerRequests {
	'open': [Proto.OpenRequestArgs, null];
	'close': [Proto.FileRequestArgs, null];
	'change': [Proto.ChangeRequestArgs, null];
	'compilerOptionsForInferredProjects': [Proto.SetCompilerOptionsForInferredProjectsArgs, null];
	'reloadProjects': [null, null];
	'configurePlugin': [Proto.ConfigurePluginRequest, Proto.ConfigurePluginResponse];
	'watchChange': [Proto.Request, null];
}

interface AsyncTsServerRequests {
	'geterr': [Proto.GeterrRequestArgs, Proto.Response];
	'geterrForProject': [Proto.GeterrForProjectRequestArgs, Proto.Response];
}

export type TypeScriptRequests = StandardTsServerRequests & NoResponseTsServerRequests & AsyncTsServerRequests;

export type ExecConfig = {
	readonly lowPriority?: boolean;
	readonly nonRecoverable?: boolean;
	readonly cancelOnResourceChange?: vscode.Uri;
	readonly executionTarget?: ExecutionTarget;
};

export enum ClientCapability {
	/**
	 * Basic syntax server. All clients should support this.
	 */
	Syntax,

	/**
	 * Advanced syntax server that can provide single file IntelliSense.
	 */
	EnhancedSyntax,

	/**
	 * Complete, multi-file semantic server
	 */
	Semantic,
}

export class ClientCapabilities {
	private readonly capabilities: ReadonlySet<ClientCapability>;

	constructor(...capabilities: ClientCapability[]) {
		this.capabilities = new Set(capabilities);
	}

	public has(capability: ClientCapability): boolean {
		return this.capabilities.has(capability);
	}
}

export interface ITypeScriptServiceClient {

	/**
	 * Convert a (VS Code) resource to a path that TypeScript server understands.
	 */
	toTsFilePath(resource: vscode.Uri): string | undefined;

	/**
	 * Convert a path to a resource.
	 */
	toResource(filepath: string): vscode.Uri;

	/**
	 * Tries to ensure that a vscode document is open on the TS server.
	 *
	 * @return The normalized path or `undefined` if the document is not open on the server.
	 */
	toOpenTsFilePath(document: vscode.TextDocument | vscode.Uri, options?: {
		suppressAlertOnFailure?: boolean;
	}): string | undefined;

	/**
	 * Checks if `resource` has a given capability.
	 */
	hasCapabilityForResource(resource: vscode.Uri, capability: ClientCapability): boolean;

	getWorkspaceRootForResource(resource: vscode.Uri): vscode.Uri | undefined;

	readonly onTsServerStarted: vscode.Event<{ version: TypeScriptVersion; usedApiVersion: API }>;
	readonly onProjectLanguageServiceStateChanged: vscode.Event<Proto.ProjectLanguageServiceStateEventBody>;
	readonly onDidBeginInstallTypings: vscode.Event<Proto.BeginInstallTypesEventBody>;
	readonly onDidEndInstallTypings: vscode.Event<Proto.EndInstallTypesEventBody>;
	readonly onTypesInstallerInitializationFailed: vscode.Event<Proto.TypesInstallerInitializationFailedEventBody>;

	readonly capabilities: ClientCapabilities;
	readonly onDidChangeCapabilities: vscode.Event<void>;

	onReady(f: () => void): Promise<void>;

	showVersionPicker(): void;

	readonly apiVersion: API;

	readonly pluginManager: PluginManager;
	readonly configuration: TypeScriptServiceConfiguration;
	readonly bufferSyncSupport: BufferSyncSupport;
	readonly telemetryReporter: TelemetryReporter;

	execute<K extends keyof StandardTsServerRequests>(
		command: K,
		args: StandardTsServerRequests[K][0],
		token: vscode.CancellationToken,
		config?: ExecConfig
	): Promise<ServerResponse.Response<StandardTsServerRequests[K][1]>>;

	executeWithoutWaitingForResponse<K extends keyof NoResponseTsServerRequests>(
		command: K,
		args: NoResponseTsServerRequests[K][0]
	): void;

	executeAsync<K extends keyof AsyncTsServerRequests>(
		command: K,
		args: AsyncTsServerRequests[K][0],
		token: vscode.CancellationToken
	): Promise<ServerResponse.Response<Proto.Response>>;

	/**
	 * Cancel on going geterr requests and re-queue them after `f` has been evaluated.
	 */
	interruptGetErr<R>(f: () => R): R;
}
```

--------------------------------------------------------------------------------

---[FILE: extensions/typescript-language-features/src/typescriptServiceClient.ts]---
Location: vscode-main/extensions/typescript-language-features/src/typescriptServiceClient.ts

```typescript
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

import { homedir } from 'os';
import * as path from 'path';
import * as vscode from 'vscode';
import { ServiceConfigurationProvider, SyntaxServerConfiguration, TsServerLogLevel, TypeScriptServiceConfiguration, areServiceConfigurationsEqual } from './configuration/configuration';
import * as fileSchemes from './configuration/fileSchemes';
import { Schemes } from './configuration/schemes';
import { IExperimentationTelemetryReporter } from './experimentTelemetryReporter';
import { DiagnosticKind, DiagnosticsManager } from './languageFeatures/diagnostics';
import { Logger } from './logging/logger';
import { TelemetryReporter, VSCodeTelemetryReporter } from './logging/telemetry';
import Tracer from './logging/tracer';
import { ProjectType, inferredProjectCompilerOptions } from './tsconfig';
import { API } from './tsServer/api';
import BufferSyncSupport from './tsServer/bufferSyncSupport';
import { OngoingRequestCancellerFactory } from './tsServer/cancellation';
import { ILogDirectoryProvider } from './tsServer/logDirectoryProvider';
import { NodeVersionManager } from './tsServer/nodeManager';
import { TypeScriptPluginPathsProvider } from './tsServer/pluginPathsProvider';
import { PluginManager } from './tsServer/plugins';
import * as Proto from './tsServer/protocol/protocol';
import { EventName } from './tsServer/protocol/protocol.const';
import { ITypeScriptServer, TsServerLog, TsServerProcessFactory, TypeScriptServerExitEvent } from './tsServer/server';
import { TypeScriptServerError } from './tsServer/serverError';
import { TypeScriptServerSpawner } from './tsServer/spawner';
import { TypeScriptVersionManager } from './tsServer/versionManager';
import { ITypeScriptVersionProvider, TypeScriptVersion } from './tsServer/versionProvider';
import { ClientCapabilities, ClientCapability, ExecConfig, ITypeScriptServiceClient, ServerResponse, TypeScriptRequests } from './typescriptService';
import { Disposable, DisposableStore, disposeAll } from './utils/dispose';
import { hash } from './utils/hash';
import { isWeb, isWebAndHasSharedArrayBuffers } from './utils/platform';


export interface TsDiagnostics {
	readonly kind: DiagnosticKind;
	readonly resource: vscode.Uri;
	readonly diagnostics: Proto.Diagnostic[];
	readonly spans?: Proto.TextSpan[];
}

interface ToCancelOnResourceChanged {
	readonly resource: vscode.Uri;
	cancel(): void;
}

namespace ServerState {
	export const enum Type {
		None,
		Running,
		Errored
	}

	export const None = { type: Type.None } as const;

	export class Running {
		readonly type = Type.Running;

		constructor(
			public readonly server: ITypeScriptServer,

			/**
			 * API version obtained from the version picker after checking the corresponding path exists.
			 */
			public readonly apiVersion: API,

			/**
			 * Version reported by currently-running tsserver.
			 */
			public tsserverVersion: string | undefined,
			public languageServiceEnabled: boolean,
		) { }

		public readonly toCancelOnResourceChange = new Set<ToCancelOnResourceChanged>();

		updateTsserverVersion(tsserverVersion: string) {
			this.tsserverVersion = tsserverVersion;
		}

		updateLanguageServiceEnabled(enabled: boolean) {
			this.languageServiceEnabled = enabled;
		}
	}

	export class Errored {
		readonly type = Type.Errored;
		constructor(
			public readonly error: Error,
			public readonly tsServerLog: TsServerLog | undefined,
		) { }
	}

	export type State = typeof None | Running | Errored;
}

export const emptyAuthority = 'ts-nul-authority';

export const inMemoryResourcePrefix = '^';

interface WatchEvent {
	updated?: Set<string>;
	created?: Set<string>;
	deleted?: Set<string>;
}

export default class TypeScriptServiceClient extends Disposable implements ITypeScriptServiceClient {

	private readonly _onReady?: { promise: Promise<void>; resolve: () => void; reject: () => void };
	private _configuration: TypeScriptServiceConfiguration;
	private readonly pluginPathsProvider: TypeScriptPluginPathsProvider;
	private readonly _versionManager: TypeScriptVersionManager;
	private readonly _nodeVersionManager: NodeVersionManager;

	private readonly logger: Logger;
	private readonly tracer: Tracer;

	private readonly typescriptServerSpawner: TypeScriptServerSpawner;
	private serverState: ServerState.State = ServerState.None;
	private lastStart: number;
	private numberRestarts: number;
	private _isPromptingAfterCrash = false;
	private isRestarting: boolean = false;
	private hasServerFatallyCrashedTooManyTimes = false;
	private readonly loadingIndicator: ServerInitializingIndicator;

	public readonly telemetryReporter: TelemetryReporter;
	public readonly bufferSyncSupport: BufferSyncSupport;
	public readonly diagnosticsManager: DiagnosticsManager;
	public readonly pluginManager: PluginManager;

	private readonly logDirectoryProvider: ILogDirectoryProvider;
	private readonly cancellerFactory: OngoingRequestCancellerFactory;
	private readonly versionProvider: ITypeScriptVersionProvider;
	private readonly processFactory: TsServerProcessFactory;

	private readonly watches = new Map<number, Disposable>();
	private readonly watchEvents = new Map<number, WatchEvent>();
	private watchChangeTimeout: NodeJS.Timeout | undefined;

	constructor(
		private readonly context: vscode.ExtensionContext,
		onCaseInsensitiveFileSystem: boolean,
		services: {
			pluginManager: PluginManager;
			logDirectoryProvider: ILogDirectoryProvider;
			cancellerFactory: OngoingRequestCancellerFactory;
			versionProvider: ITypeScriptVersionProvider;
			processFactory: TsServerProcessFactory;
			serviceConfigurationProvider: ServiceConfigurationProvider;
			experimentTelemetryReporter: IExperimentationTelemetryReporter | undefined;
			logger: Logger;
		},
		allModeIds: readonly string[]
	) {
		super();

		this.loadingIndicator = this._register(new ServerInitializingIndicator(this));

		this.logger = services.logger;
		this.tracer = new Tracer(this.logger);

		this.pluginManager = services.pluginManager;
		this.logDirectoryProvider = services.logDirectoryProvider;
		this.cancellerFactory = services.cancellerFactory;
		this.versionProvider = services.versionProvider;
		this.processFactory = services.processFactory;

		this.lastStart = Date.now();

		let resolve: () => void;
		let reject: () => void;
		const p = new Promise<void>((res, rej) => {
			resolve = res;
			reject = rej;
		});
		this._onReady = { promise: p, resolve: resolve!, reject: reject! };

		this.numberRestarts = 0;

		this._configuration = services.serviceConfigurationProvider.loadFromWorkspace();
		this.versionProvider.updateConfiguration(this._configuration);

		this.pluginPathsProvider = new TypeScriptPluginPathsProvider(this._configuration);
		this._versionManager = this._register(new TypeScriptVersionManager(this._configuration, this.versionProvider, context.workspaceState));
		this._register(this._versionManager.onDidPickNewVersion(() => {
			this.restartTsServer();
		}));

		this._nodeVersionManager = this._register(new NodeVersionManager(this._configuration, context.workspaceState));
		this._register(this._nodeVersionManager.onDidPickNewVersion(() => {
			this.restartTsServer();
		}));

		this.bufferSyncSupport = new BufferSyncSupport(this, allModeIds, onCaseInsensitiveFileSystem);
		this.onReady(() => { this.bufferSyncSupport.listen(); });

		this.bufferSyncSupport.onDelete(resource => {
			this.cancelInflightRequestsForResource(resource);
			this.diagnosticsManager.deleteAllDiagnosticsInFile(resource);
		}, null, this._disposables);

		this.bufferSyncSupport.onWillChange(resource => {
			this.cancelInflightRequestsForResource(resource);
		});

		vscode.workspace.onDidChangeConfiguration(() => {
			const oldConfiguration = this._configuration;
			this._configuration = services.serviceConfigurationProvider.loadFromWorkspace();

			this.versionProvider.updateConfiguration(this._configuration);
			this._versionManager.updateConfiguration(this._configuration);
			this.pluginPathsProvider.updateConfiguration(this._configuration);
			this._nodeVersionManager.updateConfiguration(this._configuration);

			if (this.serverState.type === ServerState.Type.Running) {
				if (!this._configuration.implicitProjectConfiguration.isEqualTo(oldConfiguration.implicitProjectConfiguration)) {
					this.setCompilerOptionsForInferredProjects(this._configuration);
				}

				if (!areServiceConfigurationsEqual(this._configuration, oldConfiguration)) {
					this.restartTsServer();
				}
			}
		}, this, this._disposables);

		this.telemetryReporter = new VSCodeTelemetryReporter(services.experimentTelemetryReporter, () => {
			if (this.serverState.type === ServerState.Type.Running) {
				if (this.serverState.tsserverVersion) {
					return this.serverState.tsserverVersion;
				}
			}
			return this.apiVersion.fullVersionString;
		});

		this.diagnosticsManager = this._register(new DiagnosticsManager('typescript', this._configuration, this.telemetryReporter, onCaseInsensitiveFileSystem));
		this.typescriptServerSpawner = new TypeScriptServerSpawner(this.versionProvider, this._versionManager, this._nodeVersionManager, this.logDirectoryProvider, this.pluginPathsProvider, this.logger, this.telemetryReporter, this.tracer, this.processFactory);

		this._register(this.pluginManager.onDidUpdateConfig(update => {
			this.configurePlugin(update.pluginId, update.config);
		}));

		this._register(this.pluginManager.onDidChangePlugins(() => {
			this.restartTsServer();
		}));
	}

	public get capabilities() {
		if (this._configuration.useSyntaxServer === SyntaxServerConfiguration.Always) {
			return new ClientCapabilities(
				ClientCapability.Syntax,
				ClientCapability.EnhancedSyntax);
		}

		if (isWeb()) {
			if (this.isProjectWideIntellisenseOnWebEnabled()) {
				return new ClientCapabilities(
					ClientCapability.Syntax,
					ClientCapability.EnhancedSyntax,
					ClientCapability.Semantic);
			} else {
				return new ClientCapabilities(
					ClientCapability.Syntax,
					ClientCapability.EnhancedSyntax);
			}
		}

		if (this.apiVersion.gte(API.v400)) {
			return new ClientCapabilities(
				ClientCapability.Syntax,
				ClientCapability.EnhancedSyntax,
				ClientCapability.Semantic);
		}

		return new ClientCapabilities(
			ClientCapability.Syntax,
			ClientCapability.Semantic);
	}

	private readonly _onDidChangeCapabilities = this._register(new vscode.EventEmitter<void>());
	readonly onDidChangeCapabilities = this._onDidChangeCapabilities.event;

	private isProjectWideIntellisenseOnWebEnabled(): boolean {
		return isWebAndHasSharedArrayBuffers() && this._configuration.webProjectWideIntellisenseEnabled;
	}

	private cancelInflightRequestsForResource(resource: vscode.Uri): void {
		if (this.serverState.type !== ServerState.Type.Running) {
			return;
		}

		for (const request of this.serverState.toCancelOnResourceChange) {
			if (request.resource.toString() === resource.toString()) {
				request.cancel();
			}
		}
	}

	public get configuration() {
		return this._configuration;
	}

	public override dispose() {
		super.dispose();

		this.bufferSyncSupport.dispose();

		if (this.serverState.type === ServerState.Type.Running) {
			this.serverState.server.kill();
		}

		this.loadingIndicator.reset();

		this.resetWatchers();
	}

	public restartTsServer(fromUserAction = false): void {
		if (this.serverState.type === ServerState.Type.Running) {
			this.logger.info('Killing TS Server');
			this.isRestarting = true;
			this.serverState.server.kill();
		}

		if (fromUserAction) {
			// Reset crash trackers
			this.hasServerFatallyCrashedTooManyTimes = false;
			this.numberRestarts = 0;
			this.lastStart = Date.now();
		}

		this.serverState = this.startService(true);
	}

	private readonly _onTsServerStarted = this._register(new vscode.EventEmitter<{ version: TypeScriptVersion; usedApiVersion: API }>());
	public readonly onTsServerStarted = this._onTsServerStarted.event;

	private readonly _onDiagnosticsReceived = this._register(new vscode.EventEmitter<TsDiagnostics>());
	public readonly onDiagnosticsReceived = this._onDiagnosticsReceived.event;

	private readonly _onConfigDiagnosticsReceived = this._register(new vscode.EventEmitter<Proto.ConfigFileDiagnosticEvent>());
	public readonly onConfigDiagnosticsReceived = this._onConfigDiagnosticsReceived.event;

	private readonly _onResendModelsRequested = this._register(new vscode.EventEmitter<void>());
	public readonly onResendModelsRequested = this._onResendModelsRequested.event;

	private readonly _onProjectLanguageServiceStateChanged = this._register(new vscode.EventEmitter<Proto.ProjectLanguageServiceStateEventBody>());
	public readonly onProjectLanguageServiceStateChanged = this._onProjectLanguageServiceStateChanged.event;

	private readonly _onDidBeginInstallTypings = this._register(new vscode.EventEmitter<Proto.BeginInstallTypesEventBody>());
	public readonly onDidBeginInstallTypings = this._onDidBeginInstallTypings.event;

	private readonly _onDidEndInstallTypings = this._register(new vscode.EventEmitter<Proto.EndInstallTypesEventBody>());
	public readonly onDidEndInstallTypings = this._onDidEndInstallTypings.event;

	private readonly _onTypesInstallerInitializationFailed = this._register(new vscode.EventEmitter<Proto.TypesInstallerInitializationFailedEventBody>());
	public readonly onTypesInstallerInitializationFailed = this._onTypesInstallerInitializationFailed.event;

	private readonly _onSurveyReady = this._register(new vscode.EventEmitter<Proto.SurveyReadyEventBody>());
	public readonly onSurveyReady = this._onSurveyReady.event;

	public get apiVersion(): API {
		if (this.serverState.type === ServerState.Type.Running) {
			return this.serverState.apiVersion;
		}
		return API.defaultVersion;
	}

	public onReady(f: () => void): Promise<void> {
		return this._onReady!.promise.then(f);
	}

	public ensureServiceStarted() {
		if (this.serverState.type !== ServerState.Type.Running) {
			this.startService();
		}
	}

	private token: number = 0;
	private startService(resendModels: boolean = false): ServerState.State {
		this.logger.info(`Starting TS Server`);

		if (this.isDisposed) {
			this.logger.info(`Not starting server: disposed`);
			return ServerState.None;
		}

		if (this.hasServerFatallyCrashedTooManyTimes) {
			this.logger.info(`Not starting server: too many crashes`);
			return ServerState.None;
		}

		let version = this._versionManager.currentVersion;
		if (!version.isValid) {
			vscode.window.showWarningMessage(vscode.l10n.t("The path {0} doesn't point to a valid tsserver install. Falling back to bundled TypeScript version.", version.path));

			this._versionManager.reset();
			version = this._versionManager.currentVersion;
		}

		this.logger.info(`Using tsserver from: ${version.path}`);
		const nodePath = this._nodeVersionManager.currentVersion;
		if (nodePath) {
			this.logger.info(`Using Node installation from ${nodePath} to run TS Server`);
		}

		this.resetWatchers();

		const apiVersion = version.apiVersion || API.defaultVersion;
		const mytoken = ++this.token;
		const handle = this.typescriptServerSpawner.spawn(version, this.capabilities, this.configuration, this.pluginManager, this.cancellerFactory, {
			onFatalError: (command, err) => this.fatalError(command, err),
		});
		this.serverState = new ServerState.Running(handle, apiVersion, undefined, true);
		this.lastStart = Date.now();


		/* __GDPR__FRAGMENT__
			"TypeScriptServerEnvCommonProperties" : {
				"hasGlobalPlugins": { "classification": "SystemMetaData", "purpose": "FeatureInsight" },
				"globalPluginNameHashes": { "classification": "SystemMetaData", "purpose": "FeatureInsight" }
			}
		*/
		const typeScriptServerEnvCommonProperties = {
			hasGlobalPlugins: this.pluginManager.plugins.length > 0,
			globalPluginNameHashes: JSON.stringify(this.pluginManager.plugins.map(plugin => hash(plugin.name))),
		};

		/* __GDPR__
			"tsserver.spawned" : {
				"owner": "mjbvz",
				"${include}": [
					"${TypeScriptCommonProperties}",
					"${TypeScriptServerEnvCommonProperties}"
				],
				"localTypeScriptVersion": { "classification": "SystemMetaData", "purpose": "FeatureInsight" },
				"typeScriptVersionSource": { "classification": "SystemMetaData", "purpose": "FeatureInsight" }
			}
		*/
		this.telemetryReporter.logTelemetry('tsserver.spawned', {
			...typeScriptServerEnvCommonProperties,
			localTypeScriptVersion: this.versionProvider.localVersion ? this.versionProvider.localVersion.displayName : '',
			typeScriptVersionSource: version.source,
		});

		handle.onError((err: unknown) => {
			if (this.token !== mytoken) {
				// this is coming from an old process
				return;
			}

			if (!(err instanceof Error)) {
				this.logger.error('TSServer got unknown error type:', err);
				return;
			}

			if (err) {
				vscode.window.showErrorMessage(vscode.l10n.t("TypeScript language server exited with error. Error message is: {0}", err.message || err.name));
			}

			this.serverState = new ServerState.Errored(err, handle.tsServerLog);
			this.logger.error('TSServer errored with error.', err);
			if (handle.tsServerLog?.type === 'file') {
				this.logger.error(`TSServer log file: ${handle.tsServerLog.uri.fsPath}`);
			}

			/* __GDPR__
				"tsserver.error" : {
					"owner": "mjbvz",
					"${include}": [
						"${TypeScriptCommonProperties}",
						"${TypeScriptServerEnvCommonProperties}"
					]
				}
			*/
			this.telemetryReporter.logTelemetry('tsserver.error', {
				...typeScriptServerEnvCommonProperties
			});
			this.serviceExited(false, apiVersion);
		});

		handle.onExit((data: TypeScriptServerExitEvent) => {
			const { code, signal } = data;
			this.logger.error(`TSServer exited. Code: ${code}. Signal: ${signal}`);

			// In practice, the exit code is an integer with no ties to any identity,
			// so it can be classified as SystemMetaData, rather than CallstackOrException.
			/* __GDPR__
				"tsserver.exitWithCode" : {
					"owner": "mjbvz",
					"${include}": [
						"${TypeScriptCommonProperties}",
						"${TypeScriptServerEnvCommonProperties}"
					],
					"code" : { "classification": "SystemMetaData", "purpose": "PerformanceAndHealth" },
					"signal" : { "classification": "SystemMetaData", "purpose": "PerformanceAndHealth" }
				}
			*/
			this.telemetryReporter.logTelemetry('tsserver.exitWithCode', {
				...typeScriptServerEnvCommonProperties,
				code: code ?? undefined,
				signal: signal ?? undefined,
			});

			if (this.token !== mytoken) {
				// this is coming from an old process
				return;
			}

			if (handle.tsServerLog?.type === 'file') {
				this.logger.info(`TSServer log file: ${handle.tsServerLog.uri.fsPath}`);
			}
			this.serviceExited(!this.isRestarting, apiVersion);
			this.isRestarting = false;
		});

		handle.onEvent(event => this.dispatchEvent(event));

		this.serviceStarted(resendModels);

		this._onReady!.resolve();
		this._onTsServerStarted.fire({ version: version, usedApiVersion: apiVersion });
		this._onDidChangeCapabilities.fire();
		return this.serverState;
	}

	private resetWatchers() {
		clearTimeout(this.watchChangeTimeout);
		disposeAll(Array.from(this.watches.values()));
	}

	public async showVersionPicker(): Promise<void> {
		this._versionManager.promptUserForVersion();
	}

	public async openTsServerLogFile(): Promise<boolean> {
		if (this._configuration.tsServerLogLevel === TsServerLogLevel.Off) {
			vscode.window.showErrorMessage<vscode.MessageItem>(
				vscode.l10n.t("TS Server logging is off. Please set 'typescript.tsserver.log' and restart the TS server to enable logging"),
				{
					title: vscode.l10n.t("Enable logging and restart TS server"),
				})
				.then(selection => {
					if (selection) {
						return vscode.workspace.getConfiguration().update('typescript.tsserver.log', 'verbose', true).then(() => {
							this.restartTsServer();
						});
					}
					return undefined;
				});
			return false;
		}

		if (this.serverState.type !== ServerState.Type.Running || !this.serverState.server.tsServerLog) {
			vscode.window.showWarningMessage(vscode.l10n.t("TS Server has not started logging."));
			return false;
		}

		switch (this.serverState.server.tsServerLog.type) {
			case 'output': {
				this.serverState.server.tsServerLog.output.show();
				return true;
			}
			case 'file': {
				try {
					const doc = await vscode.workspace.openTextDocument(this.serverState.server.tsServerLog.uri);
					await vscode.window.showTextDocument(doc);
					return true;
				} catch {
					// noop
				}

				try {
					await vscode.commands.executeCommand('revealFileInOS', this.serverState.server.tsServerLog.uri);
					return true;
				} catch {
					vscode.window.showWarningMessage(vscode.l10n.t("Could not open TS Server log file"));
					return false;
				}
			}
		}
	}

	private serviceStarted(resendModels: boolean): void {
		this.bufferSyncSupport.reset();

		const watchOptions = this.apiVersion.gte(API.v380)
			? this.configuration.watchOptions
			: undefined;

		const configureOptions: Proto.ConfigureRequestArguments = {
			hostInfo: 'vscode',
			preferences: {
				providePrefixAndSuffixTextForRename: true,
				allowRenameOfImportPath: true,
				includePackageJsonAutoImports: this._configuration.includePackageJsonAutoImports,
				excludeLibrarySymbolsInNavTo: this._configuration.workspaceSymbolsExcludeLibrarySymbols,
			},
			watchOptions
		};
		this.executeWithoutWaitingForResponse('configure', configureOptions);
		this.setCompilerOptionsForInferredProjects(this._configuration);
		if (resendModels) {
			this._onResendModelsRequested.fire();
			this.bufferSyncSupport.reinitialize();
			this.bufferSyncSupport.requestAllDiagnostics();
		}

		// Reconfigure any plugins
		for (const [pluginName, config] of this.pluginManager.configurations()) {
			this.configurePlugin(pluginName, config);
		}
	}

	private setCompilerOptionsForInferredProjects(configuration: TypeScriptServiceConfiguration): void {
		const args: Proto.SetCompilerOptionsForInferredProjectsArgs = {
			options: this.getCompilerOptionsForInferredProjects(configuration)
		};
		this.executeWithoutWaitingForResponse('compilerOptionsForInferredProjects', args);
	}

	private getCompilerOptionsForInferredProjects(configuration: TypeScriptServiceConfiguration): Proto.ExternalProjectCompilerOptions {
		return {
			...inferredProjectCompilerOptions(this.apiVersion, ProjectType.TypeScript, configuration),
			allowJs: true,
			allowSyntheticDefaultImports: true,
			allowNonTsExtensions: true,
			resolveJsonModule: true,
		};
	}

	private serviceExited(restart: boolean, tsVersion: API): void {
		this.resetWatchers();
		this.loadingIndicator.reset();

		this.serverState = ServerState.None;

		if (this.isDisposed) {
			return;
		}

		if (restart) {
			const diff = Date.now() - this.lastStart;
			this.numberRestarts++;
			let startService = true;

			const pluginExtensionList = this.pluginManager.plugins.map(plugin => plugin.extension.id).join(', ');
			const reportIssueItem: vscode.MessageItem = {
				title: vscode.l10n.t("Report Issue"),
			};
			let prompt: Thenable<undefined | vscode.MessageItem> | undefined = undefined;

			if (this.numberRestarts > 5) {
				this.numberRestarts = 0;
				if (diff < 10 * 1000 /* 10 seconds */) {
					this.lastStart = Date.now();
					startService = false;
					this.hasServerFatallyCrashedTooManyTimes = true;
					if (this.pluginManager.plugins.length) {
						prompt = vscode.window.showErrorMessage<vscode.MessageItem>(
							vscode.l10n.t("The JS/TS language service immediately crashed 5 times. The service will not be restarted.\nThis may be caused by a plugin contributed by one of these extensions: {0}.\nPlease try disabling these extensions before filing an issue against VS Code.", pluginExtensionList));
					} else {
						prompt = vscode.window.showErrorMessage(
							vscode.l10n.t("The JS/TS language service immediately crashed 5 times. The service will not be restarted."),
							reportIssueItem);
					}

					/* __GDPR__
						"serviceExited" : {
							"owner": "mjbvz",
							"${include}": [
								"${TypeScriptCommonProperties}"
							]
						}
					*/
					this.telemetryReporter.logTelemetry('serviceExited');
				} else if (diff < 60 * 1000 * 5 /* 5 Minutes */) {
					this.lastStart = Date.now();
					if (!this._isPromptingAfterCrash) {
						if (this.pluginManager.plugins.length) {
							prompt = vscode.window.showWarningMessage<vscode.MessageItem>(
								vscode.l10n.t("The JS/TS language service crashed 5 times in the last 5 Minutes.\nThis may be caused by a plugin contributed by one of these extensions: {0}\nPlease try disabling these extensions before filing an issue against VS Code.", pluginExtensionList));
						} else {
							prompt = vscode.window.showWarningMessage(
								vscode.l10n.t("The JS/TS language service crashed 5 times in the last 5 Minutes."),
								reportIssueItem);
						}
					}
				}
			} else if (['vscode-insiders', 'code-oss'].includes(vscode.env.uriScheme)) {
				// Prompt after a single restart
				this.numberRestarts = 0;
				if (!this._isPromptingAfterCrash) {
					if (this.pluginManager.plugins.length) {
						prompt = vscode.window.showWarningMessage<vscode.MessageItem>(
							vscode.l10n.t("The JS/TS language service crashed.\nThis may be caused by a plugin contributed by one of these extensions: {0}.\nPlease try disabling these extensions before filing an issue against VS Code.", pluginExtensionList));
					} else {
						prompt = vscode.window.showWarningMessage(
							vscode.l10n.t("The JS/TS language service crashed."),
							reportIssueItem);
					}
				}
			}

			if (prompt) {
				this._isPromptingAfterCrash = true;
			}

			prompt?.then(async item => {
				this._isPromptingAfterCrash = false;

				if (item === reportIssueItem) {

					const minModernTsVersion = this.versionProvider.bundledVersion.apiVersion;

					// Don't allow reporting issues using the PnP patched version of TS Server
					if (tsVersion.isYarnPnp()) {
						const reportIssue: vscode.MessageItem = {
							title: vscode.l10n.t("Report issue against Yarn PnP"),
						};
						const response = await vscode.window.showWarningMessage(
							vscode.l10n.t("Please report an issue against Yarn PnP"),
							{
								modal: true,
								detail: vscode.l10n.t("The workspace is using a version of the TypeScript Server that has been patched by Yarn PnP. This patching is a common source of bugs."),
							},
							reportIssue);

						if (response === reportIssue) {
							vscode.env.openExternal(vscode.Uri.parse('https://github.com/yarnpkg/berry/issues'));
						}
					}
					// Don't allow reporting issues with old TS versions
					else if (
						minModernTsVersion &&
						tsVersion.lt(minModernTsVersion)
					) {
						vscode.window.showWarningMessage(
							vscode.l10n.t("Please update your TypeScript version"),
							{
								modal: true,
								detail: vscode.l10n.t(
									"The workspace is using an old version of TypeScript ({0}).\n\nBefore reporting an issue, please update the workspace to use TypeScript {1} or newer to make sure the bug has not already been fixed.",
									tsVersion.displayName,
									minModernTsVersion.displayName),
							});
					} else {
						vscode.env.openExternal(vscode.Uri.parse('https://github.com/microsoft/vscode/wiki/TypeScript-Issues'));
					}
				}
			});

			if (startService) {
				this.startService(true);
			}
		}
	}

	public toTsFilePath(resource: vscode.Uri): string | undefined {
		if (fileSchemes.disabledSchemes.has(resource.scheme)) {
			return undefined;
		}

		if (resource.scheme === fileSchemes.file && !isWeb()) {
			return resource.fsPath;
		}

		return (this.isProjectWideIntellisenseOnWebEnabled() ? '' : inMemoryResourcePrefix)
			+ '/' + resource.scheme
			+ '/' + (resource.authority || emptyAuthority)
			+ (resource.path.startsWith('/') ? resource.path : '/' + resource.path)
			+ (resource.fragment ? '#' + resource.fragment : '');
	}


	public toOpenTsFilePath(document: vscode.TextDocument | vscode.Uri, options: { suppressAlertOnFailure?: boolean } = {}): string | undefined {
		const uri = document instanceof vscode.Uri ? document : document.uri;
		if (!this.bufferSyncSupport.ensureHasBuffer(uri)) {
			if (!options.suppressAlertOnFailure && !fileSchemes.disabledSchemes.has(uri.scheme)) {
				console.error(`Unexpected resource ${uri}`);
			}
			return undefined;
		}
		return this.toTsFilePath(uri);
	}

	public hasCapabilityForResource(resource: vscode.Uri, capability: ClientCapability): boolean {
		if (!this.capabilities.has(capability)) {
			return false;
		}

		switch (capability) {
			case ClientCapability.Semantic: {
				return fileSchemes.getSemanticSupportedSchemes().includes(resource.scheme);
			}
			case ClientCapability.Syntax:
			case ClientCapability.EnhancedSyntax: {
				return true;
			}
		}
	}

	public toResource(filepath: string): vscode.Uri {
		if (isWeb()) {
			// On web, the stdlib paths that TS return look like: '/lib.es2015.collection.d.ts'
			// TODO: Find out what extensionUri is when testing (should be http://localhost:8080/static/sources/extensions/typescript-language-features/)
			// TODO:  make sure that this code path is getting hit
			if (filepath.startsWith('/lib.') && filepath.endsWith('.d.ts')) {
				return vscode.Uri.joinPath(this.context.extensionUri, 'dist', 'browser', 'typescript', filepath.slice(1));
			}
			const parts = filepath.match(/^\/([^\/]+)\/([^\/]*)\/(.+)$/);
			if (parts) {
				const resource = vscode.Uri.parse(parts[1] + '://' + (parts[2] === emptyAuthority ? '' : parts[2]) + '/' + parts[3]);
				return this.bufferSyncSupport.toVsCodeResource(resource);
			}
		}

		if (filepath.startsWith(inMemoryResourcePrefix)) {
			const parts = filepath.match(/^\^\/([^\/]+)\/([^\/]*)\/(.+)$/);
			if (parts) {
				const resource = vscode.Uri.parse(parts[1] + '://' + (parts[2] === emptyAuthority ? '' : parts[2]) + '/' + parts[3]);
				return this.bufferSyncSupport.toVsCodeResource(resource);
			}
		}
		return this.bufferSyncSupport.toResource(filepath);
	}

	public getWorkspaceRootForResource(resource: vscode.Uri): vscode.Uri | undefined {
		const roots = vscode.workspace.workspaceFolders ? Array.from(vscode.workspace.workspaceFolders) : undefined;
		if (!roots?.length) {
			return undefined;
		}

		// For notebook cells, we need to use the notebook document to look up the workspace
		if (resource.scheme === Schemes.notebookCell) {
			for (const notebook of vscode.workspace.notebookDocuments) {
				for (const cell of notebook.getCells()) {
					if (cell.document.uri.toString() === resource.toString()) {
						resource = notebook.uri;
						break;
					}
				}
			}
		}

		// Find the highest level workspace folder that contains the file
		for (const root of roots.sort((a, b) => a.uri.path.length - b.uri.path.length)) {
			if (root.uri.scheme === resource.scheme && root.uri.authority === resource.authority) {
				if (resource.path.startsWith(root.uri.path + '/')) {
					return root.uri;
				}
			}
		}

		return vscode.workspace.getWorkspaceFolder(resource)?.uri;
	}

	public execute(command: keyof TypeScriptRequests, args: unknown, token: vscode.CancellationToken, config?: ExecConfig): Promise<ServerResponse.Response<Proto.Response>> {
		let executions: Array<Promise<ServerResponse.Response<Proto.Response>> | undefined> | undefined;

		if (config?.cancelOnResourceChange) {
			const runningServerState = this.serverState;
			if (runningServerState.type === ServerState.Type.Running) {
				const source = new vscode.CancellationTokenSource();
				token.onCancellationRequested(() => source.cancel());

				const inFlight: ToCancelOnResourceChanged = {
					resource: config.cancelOnResourceChange,
					cancel: () => source.cancel(),
				};
				runningServerState.toCancelOnResourceChange.add(inFlight);

				executions = this.executeImpl(command, args, {
					isAsync: false,
					token: source.token,
					expectsResult: true,
					...config,
				});
				executions[0]!.finally(() => {
					runningServerState.toCancelOnResourceChange.delete(inFlight);
					source.dispose();
				});
			}
		}

		if (!executions) {
			executions = this.executeImpl(command, args, {
				isAsync: false,
				token,
				expectsResult: true,
				...config,
			});
		}

		if (config?.nonRecoverable) {
			executions[0]!.catch(err => this.fatalError(command, err));
		}

		if (command === 'updateOpen') {
			// If update open has completed, consider that the project has loaded
			const updateOpenTask = Promise.all(executions).then(() => {
				this.loadingIndicator.reset();
			});

			const updateOpenArgs = (args as Proto.UpdateOpenRequestArgs);
			if (updateOpenArgs.openFiles?.length === 1) {
				this.loadingIndicator.startedLoadingFile(updateOpenArgs.openFiles[0].file, updateOpenTask);
			}
		}

		return executions[0]!;
	}

	public executeWithoutWaitingForResponse(command: keyof TypeScriptRequests, args: unknown): void {
		this.executeImpl(command, args, {
			isAsync: false,
			token: undefined,
			expectsResult: false
		});
	}

	public executeAsync(command: keyof TypeScriptRequests, args: Proto.GeterrRequestArgs, token: vscode.CancellationToken): Promise<ServerResponse.Response<Proto.Response>> {
		return this.executeImpl(command, args, {
			isAsync: true,
			token,
			expectsResult: true
		})[0]!;
	}

	private executeImpl(command: keyof TypeScriptRequests, args: unknown, executeInfo: { isAsync: boolean; token?: vscode.CancellationToken; expectsResult: boolean; lowPriority?: boolean; requireSemantic?: boolean }): Array<Promise<ServerResponse.Response<Proto.Response>> | undefined> {
		const serverState = this.serverState;
		if (serverState.type === ServerState.Type.Running) {
			this.bufferSyncSupport.beforeCommand(command);
			return serverState.server.executeImpl(command, args, executeInfo);
		} else {
			return [Promise.resolve(ServerResponse.NoServer)];
		}
	}

	public interruptGetErr<R>(f: () => R): R {
		return this.bufferSyncSupport.interruptGetErr(f);
	}

	private fatalError(command: string, error: unknown): void {
		/* __GDPR__
			"fatalError" : {
				"owner": "mjbvz",
				"${include}": [
					"${TypeScriptCommonProperties}",
					"${TypeScriptRequestErrorProperties}"
				],
				"command" : { "classification": "SystemMetaData", "purpose": "FeatureInsight" }
			}
		*/
		this.telemetryReporter.logTelemetry('fatalError', { ...(error instanceof TypeScriptServerError ? error.telemetry : { command }) });
		console.error(`A non-recoverable error occurred while executing tsserver command: ${command}`);
		if (error instanceof TypeScriptServerError && error.serverErrorText) {
			console.error(error.serverErrorText);
		}

		if (this.serverState.type === ServerState.Type.Running) {
			this.logger.info('Killing TS Server');
			const logfile = this.serverState.server.tsServerLog;
			this.serverState.server.kill();
			if (error instanceof TypeScriptServerError) {
				this.serverState = new ServerState.Errored(error, logfile);
			}
		}
	}

	private dispatchEvent(event: Proto.Event) {
		switch (event.event) {
			case EventName.syntaxDiag:
			case EventName.semanticDiag:
			case EventName.suggestionDiag:
			case EventName.regionSemanticDiag: {
				// This event also roughly signals that projects have been loaded successfully (since the TS server is synchronous)
				this.loadingIndicator.reset();

				const diagnosticEvent = event as Proto.DiagnosticEvent;
				if (diagnosticEvent.body?.diagnostics) {
					this._onDiagnosticsReceived.fire({
						kind: getDiagnosticsKind(event),
						resource: this.toResource(diagnosticEvent.body.file),
						diagnostics: diagnosticEvent.body.diagnostics,
						spans: diagnosticEvent.body.spans,
					});
				}
				return;
			}
			case EventName.configFileDiag:
				this._onConfigDiagnosticsReceived.fire(event as Proto.ConfigFileDiagnosticEvent);
				return;

			case EventName.telemetry: {
				const body = (event as Proto.TelemetryEvent).body;
				this.dispatchTelemetryEvent(body);
				return;
			}
			case EventName.projectLanguageServiceState: {
				const body = (event as Proto.ProjectLanguageServiceStateEvent).body!;
				if (this.serverState.type === ServerState.Type.Running) {
					this.serverState.updateLanguageServiceEnabled(body.languageServiceEnabled);
				}
				this._onProjectLanguageServiceStateChanged.fire(body);
				return;
			}
			case EventName.projectsUpdatedInBackground: {
				this.loadingIndicator.reset();

				const body = (event as Proto.ProjectsUpdatedInBackgroundEvent).body;
				const resources = body.openFiles.map(file => this.toResource(file));
				this.bufferSyncSupport.getErr(resources);
				return;
			}
			case EventName.beginInstallTypes:
				this._onDidBeginInstallTypings.fire((event as Proto.BeginInstallTypesEvent).body);
				return;

			case EventName.endInstallTypes:
				this._onDidEndInstallTypings.fire((event as Proto.EndInstallTypesEvent).body);
				return;

			case EventName.typesInstallerInitializationFailed:
				this._onTypesInstallerInitializationFailed.fire((event as Proto.TypesInstallerInitializationFailedEvent).body);
				return;

			case EventName.surveyReady:
				this._onSurveyReady.fire((event as Proto.SurveyReadyEvent).body);
				return;

			case EventName.projectLoadingStart:
				this.loadingIndicator.startedLoadingProject((event as Proto.ProjectLoadingStartEvent).body.projectName);
				return;

			case EventName.projectLoadingFinish:
				this.loadingIndicator.finishedLoadingProject((event as Proto.ProjectLoadingFinishEvent).body.projectName);
				return;

			case EventName.createDirectoryWatcher: {
				const fpath = (event.body as Proto.CreateDirectoryWatcherEventBody).path;
				if (fpath.startsWith(inMemoryResourcePrefix)) {
					return;
				}
				if (process.platform === 'darwin' && fpath === path.join(homedir(), 'Library')) {
					// ignore directory watch requests on ~/Library
					// until microsoft/TypeScript#59831 is resolved
					return;
				}

				this.createFileSystemWatcher(
					(event.body as Proto.CreateDirectoryWatcherEventBody).id,
					new vscode.RelativePattern(
						vscode.Uri.file(fpath),
						(event.body as Proto.CreateDirectoryWatcherEventBody).recursive ? '**' : '*'
					),
					(event.body as Proto.CreateDirectoryWatcherEventBody).ignoreUpdate
				);
				return;
			}
			case EventName.createFileWatcher: {
				const path = (event.body as Proto.CreateFileWatcherEventBody).path;
				if (path.startsWith(inMemoryResourcePrefix)) {
					return;
				}

				this.createFileSystemWatcher(
					(event.body as Proto.CreateFileWatcherEventBody).id,
					new vscode.RelativePattern(
						vscode.Uri.file(path),
						'*'
					)
				);
				return;
			}
			case EventName.closeFileWatcher:
				this.closeFileSystemWatcher(event.body.id);
				return;

			case EventName.requestCompleted: {
				const diagnosticsDuration = (event.body as Proto.RequestCompletedEventBody).performanceData?.diagnosticsDuration;
				if (diagnosticsDuration) {
					this.diagnosticsManager.logDiagnosticsPerformanceTelemetry(
						diagnosticsDuration.map(fileData => {
							const resource = this.toResource(fileData.file);
							return {
								...fileData,
								fileLineCount: this.bufferSyncSupport.lineCount(resource),
							};
						})
					);
				}
				return;
			}
		}
	}

	private scheduleExecuteWatchChangeRequest() {
		if (!this.watchChangeTimeout) {
			this.watchChangeTimeout = setTimeout(() => {
				this.watchChangeTimeout = undefined;
				const allEvents = Array.from(this.watchEvents, ([id, event]) => ({
					id,
					updated: event.updated && Array.from(event.updated),
					created: event.created && Array.from(event.created),
					deleted: event.deleted && Array.from(event.deleted)
				}));
				this.watchEvents.clear();
				this.executeWithoutWaitingForResponse('watchChange', allEvents);
			}, 100); /* aggregate events over 100ms to reduce client<->server IPC overhead */
		}
	}

	private addWatchEvent(id: number, eventType: keyof WatchEvent, path: string) {
		let event = this.watchEvents.get(id);
		const removeEvent = (typeOfEventToRemove: keyof WatchEvent) => {
			if (event?.[typeOfEventToRemove]?.delete(path) && event[typeOfEventToRemove].size === 0) {
				event[typeOfEventToRemove] = undefined;
			}
		};
		const aggregateEvent = () => {
			if (!event) {
				this.watchEvents.set(id, event = {});
			}
			(event[eventType] ??= new Set()).add(path);
		};
		switch (eventType) {
			case 'created':
				removeEvent('deleted');
				removeEvent('updated');
				aggregateEvent();
				break;
			case 'deleted':
				removeEvent('created');
				removeEvent('updated');
				aggregateEvent();
				break;
			case 'updated':
				if (event?.created?.has(path)) {
					return;
				}
				removeEvent('deleted');
				aggregateEvent();
				break;
		}
		this.scheduleExecuteWatchChangeRequest();
	}

	private createFileSystemWatcher(
		id: number,
		pattern: vscode.RelativePattern,
		ignoreChangeEvents?: boolean,
	) {
		const disposable = new DisposableStore();
		const watcher = disposable.add(vscode.workspace.createFileSystemWatcher(pattern, undefined, ignoreChangeEvents));
		disposable.add(watcher.onDidChange(changeFile =>
			this.addWatchEvent(id, 'updated', changeFile.fsPath)
		));
		disposable.add(watcher.onDidCreate(createFile =>
			this.addWatchEvent(id, 'created', createFile.fsPath)
		));
		disposable.add(watcher.onDidDelete(deletedFile =>
			this.addWatchEvent(id, 'deleted', deletedFile.fsPath)
		));
		disposable.add({
			dispose: () => {
				this.watchEvents.delete(id);
				this.watches.delete(id);
			}
		});

		if (this.watches.has(id)) {
			this.closeFileSystemWatcher(id);
		}
		this.watches.set(id, disposable);
	}

	private closeFileSystemWatcher(id: number) {
		const existing = this.watches.get(id);
		existing?.dispose();
	}

	private dispatchTelemetryEvent(telemetryData: Proto.TelemetryEventBody): void {
		const properties: { [key: string]: string } = Object.create(null);
		switch (telemetryData.telemetryEventName) {
			case 'typingsInstalled': {
				const typingsInstalledPayload: Proto.TypingsInstalledTelemetryEventPayload = (telemetryData.payload as Proto.TypingsInstalledTelemetryEventPayload);
				properties['installedPackages'] = typingsInstalledPayload.installedPackages;

				if (typeof typingsInstalledPayload.installSuccess === 'boolean') {
					properties['installSuccess'] = typingsInstalledPayload.installSuccess.toString();
				}
				if (typeof typingsInstalledPayload.typingsInstallerVersion === 'string') {
					properties['typingsInstallerVersion'] = typingsInstalledPayload.typingsInstallerVersion;
				}
				break;
			}
			default: {
				const payload = telemetryData.payload;
				if (payload) {
					Object.keys(payload).forEach((key) => {
						try {
							if (payload.hasOwnProperty(key)) {
								properties[key] = typeof payload[key] === 'string' ? payload[key] : JSON.stringify(payload[key]);
							}
						} catch (e) {
							// noop
						}
					});
				}
				break;
			}
		}

		// Add plugin data here
		if (telemetryData.telemetryEventName === 'projectInfo') {
			if (this.serverState.type === ServerState.Type.Running) {
				this.serverState.updateTsserverVersion(properties['version']);
			}
		}

		/* __GDPR__
			"typingsInstalled" : {
				"owner": "mjbvz",
				"installedPackages" : { "classification": "PublicNonPersonalData", "purpose": "FeatureInsight" },
				"installSuccess": { "classification": "SystemMetaData", "purpose": "PerformanceAndHealth" },
				"typingsInstallerVersion": { "classification": "SystemMetaData", "purpose": "PerformanceAndHealth" },
				"${include}": [
					"${TypeScriptCommonProperties}"
				]
			}
		*/
		// __GDPR__COMMENT__: Other events are defined by TypeScript.
		this.telemetryReporter.logTelemetry(telemetryData.telemetryEventName, properties);
	}

	private configurePlugin(pluginName: string, configuration: unknown): void {
		this.executeWithoutWaitingForResponse('configurePlugin', { pluginName, configuration });
	}
}

function getDiagnosticsKind(event: Proto.Event) {
	switch (event.event) {
		case 'syntaxDiag': return DiagnosticKind.Syntax;
		case 'semanticDiag': return DiagnosticKind.Semantic;
		case 'suggestionDiag': return DiagnosticKind.Suggestion;
		case 'regionSemanticDiag': return DiagnosticKind.RegionSemantic;
	}
	throw new Error('Unknown dignostics kind');
}

class ServerInitializingIndicator extends Disposable {

	private _task?: { project: string; resolve: () => void };

	constructor(
		private readonly client: ITypeScriptServiceClient,
	) {
		super();
	}

	public reset(): void {
		if (this._task) {
			this._task.resolve();
			this._task = undefined;
		}
	}

	/**
	 * Signal that a project has started loading.
	 */
	public startedLoadingProject(projectName: string): void {
		// TS projects are loaded sequentially. Cancel existing task because it should always be resolved before
		// the incoming project loading task is.
		this.reset();

		const projectDisplayName = this.getProjectDisplayName(projectName);

		vscode.window.withProgress({
			location: vscode.ProgressLocation.Window,
			title: vscode.l10n.t("Initializing '{0}'", projectDisplayName),
		}, () => new Promise<void>(resolve => {
			this._task = { project: projectName, resolve };
		}));
	}

	private getProjectDisplayName(projectName: string): string {
		const projectUri = this.client.toResource(projectName);
		const relPath = vscode.workspace.asRelativePath(projectUri);

		const maxDisplayLength = 60;
		if (relPath.length > maxDisplayLength) {
			return '...' + relPath.slice(-maxDisplayLength);
		}

		return relPath;
	}

	public startedLoadingFile(fileName: string, task: Promise<unknown>): void {
		if (!this._task) {
			vscode.window.withProgress({
				location: vscode.ProgressLocation.Window,
				title: vscode.l10n.t("Analyzing '{0}' and its dependencies", path.basename(fileName)),
			}, () => task);
		}
	}

	public finishedLoadingProject(projectName: string): void {
		if (this._task && this._task.project === projectName) {
			this._task.resolve();
			this._task = undefined;
		}
	}
}
```

--------------------------------------------------------------------------------

---[FILE: extensions/typescript-language-features/src/typeScriptServiceClientHost.ts]---
Location: vscode-main/extensions/typescript-language-features/src/typeScriptServiceClientHost.ts

```typescript
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

/* --------------------------------------------------------------------------------------------
 * Includes code from typescript-sublime-plugin project, obtained from
 * https://github.com/microsoft/TypeScript-Sublime-Plugin/blob/master/TypeScript%20Indent.tmPreferences
 * ------------------------------------------------------------------------------------------ */

import * as vscode from 'vscode';
import { CommandManager } from './commands/commandManager';
import { ServiceConfigurationProvider } from './configuration/configuration';
import { DiagnosticLanguage, LanguageDescription } from './configuration/languageDescription';
import { IExperimentationTelemetryReporter } from './experimentTelemetryReporter';
import { DiagnosticKind } from './languageFeatures/diagnostics';
import FileConfigurationManager from './languageFeatures/fileConfigurationManager';
import LanguageProvider from './languageProvider';
import { LogLevelMonitor } from './logging/logLevelMonitor';
import { Logger } from './logging/logger';
import { OngoingRequestCancellerFactory } from './tsServer/cancellation';
import { ILogDirectoryProvider } from './tsServer/logDirectoryProvider';
import { PluginManager } from './tsServer/plugins';
import * as errorCodes from './tsServer/protocol/errorCodes';
import * as Proto from './tsServer/protocol/protocol';
import * as PConst from './tsServer/protocol/protocol.const';
import { TsServerProcessFactory } from './tsServer/server';
import { ITypeScriptVersionProvider } from './tsServer/versionProvider';
import * as typeConverters from './typeConverters';
import TypeScriptServiceClient from './typescriptServiceClient';
import { ActiveJsTsEditorTracker } from './ui/activeJsTsEditorTracker';
import { IntellisenseStatus } from './ui/intellisenseStatus';
import * as LargeProjectStatus from './ui/largeProjectStatus';
import TypingsStatus, { AtaProgressReporter } from './ui/typingsStatus';
import { VersionStatus } from './ui/versionStatus';
import { coalesce } from './utils/arrays';
import { Disposable } from './utils/dispose';

// Style check diagnostics that can be reported as warnings
const styleCheckDiagnostics = new Set([
	...errorCodes.variableDeclaredButNeverUsed,
	...errorCodes.propertyDeclaretedButNeverUsed,
	...errorCodes.allImportsAreUnused,
	...errorCodes.unreachableCode,
	...errorCodes.unusedLabel,
	...errorCodes.fallThroughCaseInSwitch,
	...errorCodes.notAllCodePathsReturnAValue,
]);

export default class TypeScriptServiceClientHost extends Disposable {

	private readonly client: TypeScriptServiceClient;
	private readonly languages: LanguageProvider[] = [];
	private readonly languagePerId = new Map<string, LanguageProvider>();

	private readonly typingsStatus: TypingsStatus;

	private readonly fileConfigurationManager: FileConfigurationManager;

	private reportStyleCheckAsWarnings: boolean = true;

	private readonly commandManager: CommandManager;

	constructor(
		descriptions: LanguageDescription[],
		context: vscode.ExtensionContext,
		onCaseInsensitiveFileSystem: boolean,
		services: {
			pluginManager: PluginManager;
			commandManager: CommandManager;
			logDirectoryProvider: ILogDirectoryProvider;
			cancellerFactory: OngoingRequestCancellerFactory;
			versionProvider: ITypeScriptVersionProvider;
			processFactory: TsServerProcessFactory;
			activeJsTsEditorTracker: ActiveJsTsEditorTracker;
			serviceConfigurationProvider: ServiceConfigurationProvider;
			experimentTelemetryReporter: IExperimentationTelemetryReporter | undefined;
			logger: Logger;
		},
		onCompletionAccepted: (item: vscode.CompletionItem) => void,
	) {
		super();

		this.commandManager = services.commandManager;

		const allModeIds = this.getAllModeIds(descriptions, services.pluginManager);
		this.client = this._register(new TypeScriptServiceClient(
			context,
			onCaseInsensitiveFileSystem,
			services,
			allModeIds));

		this.client.onDiagnosticsReceived(({ kind, resource, diagnostics, spans }) => {
			this.diagnosticsReceived(kind, resource, diagnostics, spans);
		}, null, this._disposables);

		this.client.onConfigDiagnosticsReceived(diag => this.configFileDiagnosticsReceived(diag), null, this._disposables);
		this.client.onResendModelsRequested(() => this.populateService(), null, this._disposables);

		this._register(new VersionStatus(this.client));
		this._register(new IntellisenseStatus(this.client, services.commandManager, services.activeJsTsEditorTracker));
		this._register(new AtaProgressReporter(this.client));
		this.typingsStatus = this._register(new TypingsStatus(this.client));
		this._register(LargeProjectStatus.create(this.client));

		this.fileConfigurationManager = this._register(new FileConfigurationManager(this.client, onCaseInsensitiveFileSystem));

		for (const description of descriptions) {
			const manager = new LanguageProvider(this.client, description, this.commandManager, this.client.telemetryReporter, this.typingsStatus, this.fileConfigurationManager, onCompletionAccepted);
			this.languages.push(manager);
			this._register(manager);
			this.languagePerId.set(description.id, manager);
		}

		import('./languageFeatures/updatePathsOnRename').then(module =>
			this._register(module.register(this.client, this.fileConfigurationManager, uri => this.handles(uri))));

		import('./languageFeatures/workspaceSymbols').then(module =>
			this._register(module.register(this.client, allModeIds)));

		this.client.ensureServiceStarted();
		this.client.onReady(() => {
			const languages = new Set<string>();
			for (const plugin of services.pluginManager.plugins) {
				if (plugin.configNamespace && plugin.languages.length) {
					this.registerExtensionLanguageProvider({
						id: plugin.configNamespace,
						languageIds: Array.from(plugin.languages),
						diagnosticSource: 'ts-plugin',
						diagnosticLanguage: DiagnosticLanguage.TypeScript,
						diagnosticOwner: 'typescript',
						isExternal: true,
						standardFileExtensions: [],
					}, onCompletionAccepted);
				} else {
					for (const language of plugin.languages) {
						languages.add(language);
					}
				}
			}

			if (languages.size) {
				this.registerExtensionLanguageProvider({
					id: 'typescript-plugins',
					languageIds: Array.from(languages.values()),
					diagnosticSource: 'ts-plugin',
					diagnosticLanguage: DiagnosticLanguage.TypeScript,
					diagnosticOwner: 'typescript',
					isExternal: true,
					standardFileExtensions: [],
				}, onCompletionAccepted);
			}
		});

		this.client.onTsServerStarted(() => {
			this.triggerAllDiagnostics();
		});

		vscode.workspace.onDidChangeConfiguration(this.configurationChanged, this, this._disposables);
		this.configurationChanged();
		this._register(new LogLevelMonitor(context));
	}

	private registerExtensionLanguageProvider(description: LanguageDescription, onCompletionAccepted: (item: vscode.CompletionItem) => void) {
		const manager = new LanguageProvider(this.client, description, this.commandManager, this.client.telemetryReporter, this.typingsStatus, this.fileConfigurationManager, onCompletionAccepted);
		this.languages.push(manager);
		this._register(manager);
		this.languagePerId.set(description.id, manager);
	}

	private getAllModeIds(descriptions: LanguageDescription[], pluginManager: PluginManager) {
		return [
			...descriptions.map(x => x.languageIds),
			...pluginManager.plugins.map(x => x.languages)
		].flat();
	}

	public get serviceClient(): TypeScriptServiceClient {
		return this.client;
	}

	public reloadProjects(): void {
		this.client.executeWithoutWaitingForResponse('reloadProjects', null);
		this.triggerAllDiagnostics();
	}

	public async handles(resource: vscode.Uri): Promise<boolean> {
		const provider = await this.findLanguage(resource);
		if (provider) {
			return true;
		}
		return this.client.bufferSyncSupport.handles(resource);
	}

	private configurationChanged(): void {
		const typescriptConfig = vscode.workspace.getConfiguration('typescript');

		this.reportStyleCheckAsWarnings = typescriptConfig.get('reportStyleChecksAsWarnings', true);
	}

	private async findLanguage(resource: vscode.Uri): Promise<LanguageProvider | undefined> {
		try {
			// First try finding language just based on the resource.
			// This is not strictly correct but should be in the vast majority of cases
			// (except when someone goes and maps `.js` to `typescript` or something...)
			for (const language of this.languages) {
				if (language.handlesUri(resource)) {
					return language;
				}
			}

			// If that doesn't work, fallback to using a text document language mode.
			// This is not ideal since we have to open the document but should always
			// be correct
			const doc = await vscode.workspace.openTextDocument(resource);
			return this.languages.find(language => language.handlesDocument(doc));
		} catch {
			return undefined;
		}
	}

	private triggerAllDiagnostics() {
		for (const language of this.languagePerId.values()) {
			language.triggerAllDiagnostics();
		}
	}

	private populateService(): void {
		this.fileConfigurationManager.reset();

		for (const language of this.languagePerId.values()) {
			language.reInitialize();
		}
	}

	private async diagnosticsReceived(
		kind: DiagnosticKind,
		resource: vscode.Uri,
		diagnostics: Proto.Diagnostic[],
		spans: Proto.TextSpan[] | undefined,
	): Promise<void> {
		const language = await this.findLanguage(resource);
		if (language) {
			language.diagnosticsReceived(
				kind,
				resource,
				this.createMarkerDatas(diagnostics, language.diagnosticSource),
				spans?.map(span => typeConverters.Range.fromTextSpan(span)));
		}
	}

	private configFileDiagnosticsReceived(event: Proto.ConfigFileDiagnosticEvent): void {
		// See https://github.com/microsoft/TypeScript/issues/10384
		const body = event.body;
		if (!body?.diagnostics || !body.configFile) {
			return;
		}

		this.findLanguage(this.client.toResource(body.configFile)).then(language => {
			language?.configFileDiagnosticsReceived(this.client.toResource(body.configFile), body.diagnostics.map(tsDiag => {
				const range = tsDiag.start && tsDiag.end ? typeConverters.Range.fromTextSpan(tsDiag) : new vscode.Range(0, 0, 0, 1);
				const diagnostic = new vscode.Diagnostic(range, tsDiag.text, this.getDiagnosticSeverity(tsDiag));
				diagnostic.source = language.diagnosticSource;
				return diagnostic;
			}));
		});
	}

	private createMarkerDatas(
		diagnostics: Proto.Diagnostic[],
		source: string
	): (vscode.Diagnostic & { reportUnnecessary: any; reportDeprecated: any })[] {
		return diagnostics.map(tsDiag => this.tsDiagnosticToVsDiagnostic(tsDiag, source));
	}

	private tsDiagnosticToVsDiagnostic(diagnostic: Proto.Diagnostic, source: string): vscode.Diagnostic & { reportUnnecessary: any; reportDeprecated: any } {
		const { start, end, text } = diagnostic;
		const range = new vscode.Range(typeConverters.Position.fromLocation(start), typeConverters.Position.fromLocation(end));
		const converted = new vscode.Diagnostic(range, text, this.getDiagnosticSeverity(diagnostic));
		converted.source = diagnostic.source || source;
		if (diagnostic.code) {
			converted.code = diagnostic.code;
		}
		const relatedInformation = diagnostic.relatedInformation;
		if (relatedInformation) {
			converted.relatedInformation = coalesce(relatedInformation.map((info: any) => {
				const span = info.span;
				if (!span) {
					return undefined;
				}
				return new vscode.DiagnosticRelatedInformation(typeConverters.Location.fromTextSpan(this.client.toResource(span.file), span), info.message);
			}));
		}
		const tags: vscode.DiagnosticTag[] = [];
		if (diagnostic.reportsUnnecessary) {
			tags.push(vscode.DiagnosticTag.Unnecessary);
		}
		if (diagnostic.reportsDeprecated) {
			tags.push(vscode.DiagnosticTag.Deprecated);
		}
		converted.tags = tags.length ? tags : undefined;

		const resultConverted = converted as vscode.Diagnostic & { reportUnnecessary: any; reportDeprecated: any };
		resultConverted.reportUnnecessary = diagnostic.reportsUnnecessary;
		resultConverted.reportDeprecated = diagnostic.reportsDeprecated;
		return resultConverted;
	}

	private getDiagnosticSeverity(diagnostic: Proto.Diagnostic): vscode.DiagnosticSeverity {
		if (this.reportStyleCheckAsWarnings
			&& this.isStyleCheckDiagnostic(diagnostic.code)
			&& diagnostic.category === PConst.DiagnosticCategory.error
		) {
			return vscode.DiagnosticSeverity.Warning;
		}

		switch (diagnostic.category) {
			case PConst.DiagnosticCategory.error:
				return vscode.DiagnosticSeverity.Error;

			case PConst.DiagnosticCategory.warning:
				return vscode.DiagnosticSeverity.Warning;

			case PConst.DiagnosticCategory.suggestion:
				return vscode.DiagnosticSeverity.Hint;

			default:
				return vscode.DiagnosticSeverity.Error;
		}
	}

	private isStyleCheckDiagnostic(code: number | undefined): boolean {
		return typeof code === 'number' && styleCheckDiagnostics.has(code);
	}
}
```

--------------------------------------------------------------------------------

---[FILE: extensions/typescript-language-features/src/commands/commandManager.ts]---
Location: vscode-main/extensions/typescript-language-features/src/commands/commandManager.ts

```typescript
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

import * as vscode from 'vscode';

export interface Command {
	readonly id: string;

	execute(...args: unknown[]): void | unknown;
}

export class CommandManager {
	private readonly commands = new Map<string, { refCount: number; readonly registration: vscode.Disposable }>();

	public dispose() {
		for (const registration of this.commands.values()) {
			registration.registration.dispose();
		}
		this.commands.clear();
	}

	public register<T extends Command>(command: T): vscode.Disposable {
		let entry = this.commands.get(command.id);
		if (!entry) {
			entry = { refCount: 1, registration: vscode.commands.registerCommand(command.id, command.execute, command) };
			this.commands.set(command.id, entry);
		} else {
			entry.refCount += 1;
		}

		return new vscode.Disposable(() => {
			entry.refCount -= 1;
			if (entry.refCount <= 0) {
				entry.registration.dispose();
				this.commands.delete(command.id);
			}
		});
	}
}
```

--------------------------------------------------------------------------------

---[FILE: extensions/typescript-language-features/src/commands/configurePlugin.ts]---
Location: vscode-main/extensions/typescript-language-features/src/commands/configurePlugin.ts

```typescript
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

import { PluginManager } from '../tsServer/plugins';
import { Command } from './commandManager';

export class ConfigurePluginCommand implements Command {
	public readonly id = '_typescript.configurePlugin';

	public constructor(
		private readonly pluginManager: PluginManager,
	) { }

	public execute(pluginId: string, configuration: unknown) {
		this.pluginManager.setConfiguration(pluginId, configuration);
	}
}
```

--------------------------------------------------------------------------------

---[FILE: extensions/typescript-language-features/src/commands/goToProjectConfiguration.ts]---
Location: vscode-main/extensions/typescript-language-features/src/commands/goToProjectConfiguration.ts

```typescript
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

import TypeScriptServiceClientHost from '../typeScriptServiceClientHost';
import { ActiveJsTsEditorTracker } from '../ui/activeJsTsEditorTracker';
import { Lazy } from '../utils/lazy';
import { openProjectConfigForFile, ProjectType } from '../tsconfig';
import { Command } from './commandManager';

export class TypeScriptGoToProjectConfigCommand implements Command {
	public readonly id = 'typescript.goToProjectConfig';

	public constructor(
		private readonly activeJsTsEditorTracker: ActiveJsTsEditorTracker,
		private readonly lazyClientHost: Lazy<TypeScriptServiceClientHost>,
	) { }

	public execute() {
		const editor = this.activeJsTsEditorTracker.activeJsTsEditor;
		if (editor) {
			openProjectConfigForFile(ProjectType.TypeScript, this.lazyClientHost.value.serviceClient, editor.document.uri);
		}
	}
}

export class JavaScriptGoToProjectConfigCommand implements Command {
	public readonly id = 'javascript.goToProjectConfig';

	public constructor(
		private readonly activeJsTsEditorTracker: ActiveJsTsEditorTracker,
		private readonly lazyClientHost: Lazy<TypeScriptServiceClientHost>,
	) { }

	public execute() {
		const editor = this.activeJsTsEditorTracker.activeJsTsEditor;
		if (editor) {
			openProjectConfigForFile(ProjectType.JavaScript, this.lazyClientHost.value.serviceClient, editor.document.uri);
		}
	}
}
```

--------------------------------------------------------------------------------

---[FILE: extensions/typescript-language-features/src/commands/index.ts]---
Location: vscode-main/extensions/typescript-language-features/src/commands/index.ts

```typescript
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

import { PluginManager } from '../tsServer/plugins';
import TypeScriptServiceClientHost from '../typeScriptServiceClientHost';
import { ActiveJsTsEditorTracker } from '../ui/activeJsTsEditorTracker';
import { Lazy } from '../utils/lazy';
import { CommandManager } from './commandManager';
import { ConfigurePluginCommand } from './configurePlugin';
import { EnableTsgoCommand, DisableTsgoCommand } from './useTsgo';
import { JavaScriptGoToProjectConfigCommand, TypeScriptGoToProjectConfigCommand } from './goToProjectConfiguration';
import { LearnMoreAboutRefactoringsCommand } from './learnMoreAboutRefactorings';
import { OpenJsDocLinkCommand } from './openJsDocLink';
import { OpenTsServerLogCommand } from './openTsServerLog';
import { ReloadJavaScriptProjectsCommand, ReloadTypeScriptProjectsCommand } from './reloadProject';
import { RestartTsServerCommand } from './restartTsServer';
import { SelectTypeScriptVersionCommand } from './selectTypeScriptVersion';
import { TSServerRequestCommand } from './tsserverRequests';

export function registerBaseCommands(
	commandManager: CommandManager,
	lazyClientHost: Lazy<TypeScriptServiceClientHost>,
	pluginManager: PluginManager,
	activeJsTsEditorTracker: ActiveJsTsEditorTracker,
): void {
	commandManager.register(new ReloadTypeScriptProjectsCommand(lazyClientHost));
	commandManager.register(new ReloadJavaScriptProjectsCommand(lazyClientHost));
	commandManager.register(new SelectTypeScriptVersionCommand(lazyClientHost));
	commandManager.register(new OpenTsServerLogCommand(lazyClientHost));
	commandManager.register(new RestartTsServerCommand(lazyClientHost));
	commandManager.register(new TypeScriptGoToProjectConfigCommand(activeJsTsEditorTracker, lazyClientHost));
	commandManager.register(new JavaScriptGoToProjectConfigCommand(activeJsTsEditorTracker, lazyClientHost));
	commandManager.register(new ConfigurePluginCommand(pluginManager));
	commandManager.register(new LearnMoreAboutRefactoringsCommand());
	commandManager.register(new TSServerRequestCommand(lazyClientHost));
	commandManager.register(new OpenJsDocLinkCommand());
	commandManager.register(new EnableTsgoCommand());
	commandManager.register(new DisableTsgoCommand());
}
```

--------------------------------------------------------------------------------

---[FILE: extensions/typescript-language-features/src/commands/learnMoreAboutRefactorings.ts]---
Location: vscode-main/extensions/typescript-language-features/src/commands/learnMoreAboutRefactorings.ts

```typescript
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

import * as vscode from 'vscode';
import { isTypeScriptDocument } from '../configuration/languageIds';
import { Command } from './commandManager';

export class LearnMoreAboutRefactoringsCommand implements Command {
	public static readonly id = '_typescript.learnMoreAboutRefactorings';
	public readonly id = LearnMoreAboutRefactoringsCommand.id;

	public execute() {
		const docUrl = vscode.window.activeTextEditor && isTypeScriptDocument(vscode.window.activeTextEditor.document)
			? 'https://go.microsoft.com/fwlink/?linkid=2114477'
			: 'https://go.microsoft.com/fwlink/?linkid=2116761';

		vscode.env.openExternal(vscode.Uri.parse(docUrl));
	}
}
```

--------------------------------------------------------------------------------

---[FILE: extensions/typescript-language-features/src/commands/openJsDocLink.ts]---
Location: vscode-main/extensions/typescript-language-features/src/commands/openJsDocLink.ts

```typescript
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

import * as vscode from 'vscode';
import { Command } from './commandManager';

export interface OpenJsDocLinkCommand_Args {
	readonly file: {
		readonly scheme: string;
		readonly authority?: string;
		readonly path?: string;
		readonly query?: string;
		readonly fragment?: string;
	};
	readonly position: {
		readonly line: number;
		readonly character: number;
	};
}

/**
 * Proxy command for opening links in jsdoc comments.
 *
 * This is needed to avoid incorrectly rewriting uris.
 */
export class OpenJsDocLinkCommand implements Command {
	public static readonly id = '_typescript.openJsDocLink';
	public readonly id = OpenJsDocLinkCommand.id;

	public async execute(args: OpenJsDocLinkCommand_Args): Promise<void> {
		const { line, character } = args.position;
		const position = new vscode.Position(line, character);
		await vscode.commands.executeCommand('vscode.open', vscode.Uri.from(args.file), {
			selection: new vscode.Range(position, position),
		} satisfies vscode.TextDocumentShowOptions);
	}
}
```

--------------------------------------------------------------------------------

---[FILE: extensions/typescript-language-features/src/commands/openTsServerLog.ts]---
Location: vscode-main/extensions/typescript-language-features/src/commands/openTsServerLog.ts

```typescript
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

import TypeScriptServiceClientHost from '../typeScriptServiceClientHost';
import { Lazy } from '../utils/lazy';
import { Command } from './commandManager';

export class OpenTsServerLogCommand implements Command {
	public readonly id = 'typescript.openTsServerLog';

	public constructor(
		private readonly lazyClientHost: Lazy<TypeScriptServiceClientHost>
	) { }

	public execute() {
		this.lazyClientHost.value.serviceClient.openTsServerLogFile();
	}
}
```

--------------------------------------------------------------------------------

---[FILE: extensions/typescript-language-features/src/commands/reloadProject.ts]---
Location: vscode-main/extensions/typescript-language-features/src/commands/reloadProject.ts

```typescript
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

import TypeScriptServiceClientHost from '../typeScriptServiceClientHost';
import { Lazy } from '../utils/lazy';
import { Command } from './commandManager';

export class ReloadTypeScriptProjectsCommand implements Command {
	public readonly id = 'typescript.reloadProjects';

	public constructor(
		private readonly lazyClientHost: Lazy<TypeScriptServiceClientHost>
	) { }

	public execute() {
		this.lazyClientHost.value.reloadProjects();
	}
}

export class ReloadJavaScriptProjectsCommand implements Command {
	public readonly id = 'javascript.reloadProjects';

	public constructor(
		private readonly lazyClientHost: Lazy<TypeScriptServiceClientHost>
	) { }

	public execute() {
		this.lazyClientHost.value.reloadProjects();
	}
}
```

--------------------------------------------------------------------------------

---[FILE: extensions/typescript-language-features/src/commands/restartTsServer.ts]---
Location: vscode-main/extensions/typescript-language-features/src/commands/restartTsServer.ts

```typescript
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

import TypeScriptServiceClientHost from '../typeScriptServiceClientHost';
import { Lazy } from '../utils/lazy';
import { Command } from './commandManager';

export class RestartTsServerCommand implements Command {
	public readonly id = 'typescript.restartTsServer';

	public constructor(
		private readonly lazyClientHost: Lazy<TypeScriptServiceClientHost>
	) { }

	public execute() {
		this.lazyClientHost.value.serviceClient.restartTsServer(true);
	}
}
```

--------------------------------------------------------------------------------

---[FILE: extensions/typescript-language-features/src/commands/selectTypeScriptVersion.ts]---
Location: vscode-main/extensions/typescript-language-features/src/commands/selectTypeScriptVersion.ts

```typescript
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

import TypeScriptServiceClientHost from '../typeScriptServiceClientHost';
import { Lazy } from '../utils/lazy';
import { Command } from './commandManager';

export class SelectTypeScriptVersionCommand implements Command {
	public static readonly id = 'typescript.selectTypeScriptVersion';
	public readonly id = SelectTypeScriptVersionCommand.id;

	public constructor(
		private readonly lazyClientHost: Lazy<TypeScriptServiceClientHost>
	) { }

	public execute() {
		this.lazyClientHost.value.serviceClient.showVersionPicker();
	}
}
```

--------------------------------------------------------------------------------

---[FILE: extensions/typescript-language-features/src/commands/tsserverRequests.ts]---
Location: vscode-main/extensions/typescript-language-features/src/commands/tsserverRequests.ts

```typescript
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
import * as vscode from 'vscode';

import { ExecConfig, TypeScriptRequests } from '../typescriptService';
import TypeScriptServiceClientHost from '../typeScriptServiceClientHost';
import { nulToken } from '../utils/cancellation';
import { Lazy } from '../utils/lazy';
import { Command } from './commandManager';

function isCancellationToken(value: any): value is vscode.CancellationToken {
	return value && typeof value.isCancellationRequested === 'boolean' && typeof value.onCancellationRequested === 'function';
}

export interface RequestArgs {
	readonly file?: unknown;
	readonly $traceId?: unknown;
}

export class TSServerRequestCommand implements Command {
	public readonly id = 'typescript.tsserverRequest';

	public constructor(
		private readonly lazyClientHost: Lazy<TypeScriptServiceClientHost>
	) { }

	public async execute(command: keyof TypeScriptRequests, args?: unknown, config?: ExecConfig, token?: vscode.CancellationToken): Promise<unknown> {
		if (!isCancellationToken(token)) {
			token = nulToken;
		}
		if (args && typeof args === 'object' && !Array.isArray(args)) {
			const requestArgs = args as RequestArgs;
			const hasFile = requestArgs.file instanceof vscode.Uri;
			const hasTraceId = typeof requestArgs.$traceId === 'string';
			if (hasFile || hasTraceId) {
				const newArgs = { file: undefined as string | undefined, ...args };
				if (hasFile) {
					const client = this.lazyClientHost.value.serviceClient;
					newArgs.file = client.toOpenTsFilePath(requestArgs.file);
				}
				if (hasTraceId) {
					const telemetryReporter = this.lazyClientHost.value.serviceClient.telemetryReporter;
					telemetryReporter.logTraceEvent('TSServerRequestCommand.execute', requestArgs.$traceId, JSON.stringify({ command }));
				}
				args = newArgs;
			}
		}

		// The list can be found in the TypeScript compiler as `const enum CommandTypes`,
		// to avoid extensions making calls which could affect the internal tsserver state
		// these are only read-y sorts of commands
		const allowList = [
			// Seeing the JS/DTS output for a file
			'emit-output',
			// Grabbing a file's diagnostics
			'semanticDiagnosticsSync',
			'syntacticDiagnosticsSync',
			'suggestionDiagnosticsSync',
			// Introspecting code at a position
			'quickinfo',
			'quickinfo-full',
			'completionInfo'
		];

		if (allowList.includes(command) || command.startsWith('_')) {
			return this.lazyClientHost.value.serviceClient.execute(command, args, token, config);
		}
		return undefined;
	}
}
```

--------------------------------------------------------------------------------

---[FILE: extensions/typescript-language-features/src/commands/useTsgo.ts]---
Location: vscode-main/extensions/typescript-language-features/src/commands/useTsgo.ts

```typescript
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

import * as vscode from 'vscode';
import { Command } from './commandManager';

export const tsNativeExtensionId = 'typescriptteam.native-preview';

export class EnableTsgoCommand implements Command {
	public readonly id = 'typescript.experimental.enableTsgo';

	public async execute(): Promise<void> {
		await updateTsgoSetting(true);
	}
}

export class DisableTsgoCommand implements Command {
	public readonly id = 'typescript.experimental.disableTsgo';

	public async execute(): Promise<void> {
		await updateTsgoSetting(false);
	}
}

/**
 * Updates the TypeScript Go setting and reloads extension host.
 * @param enable Whether to enable or disable TypeScript Go
 */
async function updateTsgoSetting(enable: boolean): Promise<void> {
	const tsgoExtension = vscode.extensions.getExtension(tsNativeExtensionId);
	// Error if the TypeScript Go extension is not installed with a button to open the GitHub repo
	if (!tsgoExtension) {
		const selection = await vscode.window.showErrorMessage(
			vscode.l10n.t('The TypeScript Go extension is not installed.'),
			{
				title: vscode.l10n.t('Open on GitHub'),
				isCloseAffordance: true,
			}
		);

		if (selection) {
			await vscode.env.openExternal(vscode.Uri.parse('https://github.com/microsoft/typescript-go'));
		}
	}

	const tsConfig = vscode.workspace.getConfiguration('typescript');
	const currentValue = tsConfig.get<boolean>('experimental.useTsgo', false);
	if (currentValue === enable) {
		return;
	}

	// Determine the target scope for the configuration update
	let target = vscode.ConfigurationTarget.Global;
	const inspect = tsConfig.inspect<boolean>('experimental.useTsgo');
	if (inspect?.workspaceValue !== undefined) {
		target = vscode.ConfigurationTarget.Workspace;
	} else if (inspect?.workspaceFolderValue !== undefined) {
		target = vscode.ConfigurationTarget.WorkspaceFolder;
	} else {
		// If setting is not defined yet, use the same scope as typescript-go.executablePath
		const tsgoConfig = vscode.workspace.getConfiguration('typescript-go');
		const tsgoInspect = tsgoConfig.inspect<string>('executablePath');

		if (tsgoInspect?.workspaceValue !== undefined) {
			target = vscode.ConfigurationTarget.Workspace;
		} else if (tsgoInspect?.workspaceFolderValue !== undefined) {
			target = vscode.ConfigurationTarget.WorkspaceFolder;
		}
	}

	await tsConfig.update('experimental.useTsgo', enable, target);
}
```

--------------------------------------------------------------------------------

````
