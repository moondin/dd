---
source_txt: fullstack_samples/zulip-main
converted_utc: 2025-12-18T13:06:15Z
part: 1282
parts_total: 1290
---

# FULLSTACK CODE DATABASE SAMPLES zulip-main

## Verbatim Content (Part 1282 of 1290)

````text
================================================================================
FULLSTACK SAMPLES CODE DATABASE (VERBATIM) - zulip-main
================================================================================
Generated: December 18, 2025
Source: fullstack_samples/zulip-main
================================================================================

NOTES:
- This output is verbatim because the source is user-owned.
- Large/binary files may be skipped by size/binary detection limits.

================================================================================

---[FILE: 0044_remoterealmbillinguser.py]---
Location: zulip-main/zilencer/migrations/0044_remoterealmbillinguser.py
Signals: Django

```python
# Generated by Django 4.2.7 on 2023-12-05 01:15

import django.db.models.deletion
from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zilencer", "0043_remotepushdevicetoken_remote_realm"),
    ]

    operations = [
        migrations.CreateModel(
            name="RemoteRealmBillingUser",
            fields=[
                (
                    "id",
                    models.AutoField(
                        auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
                    ),
                ),
                ("user_uuid", models.UUIDField()),
                ("full_name", models.TextField(default="")),
                ("email", models.EmailField(max_length=254)),
                ("tos_version", models.TextField(default="-1")),
                (
                    "remote_realm",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE, to="zilencer.remoterealm"
                    ),
                ),
            ],
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0045_remoterealmauditlog_zilencer_remoterealmauditlog_server_realm_and_more.py]---
Location: zulip-main/zilencer/migrations/0045_remoterealmauditlog_zilencer_remoterealmauditlog_server_realm_and_more.py
Signals: Django

```python
# Generated by Django 4.2.7 on 2023-12-05 19:33

from django.contrib.postgres.operations import AddIndexConcurrently
from django.db import migrations, models


class Migration(migrations.Migration):
    atomic = False

    dependencies = [
        ("zilencer", "0044_remoterealmbillinguser"),
    ]

    operations = [
        AddIndexConcurrently(
            model_name="remoterealmauditlog",
            index=models.Index(
                condition=models.Q(("remote_realm__isnull", True)),
                fields=["server", "realm_id"],
                name="zilencer_remoterealmauditlog_server_realm",
            ),
        ),
        AddIndexConcurrently(
            model_name="remoterealmauditlog",
            index=models.Index(
                condition=models.Q(("remote_realm__isnull", True)),
                fields=["server"],
                name="zilencer_remoterealmauditlog_server",
            ),
        ),
        AddIndexConcurrently(
            model_name="remoterealmcount",
            index=models.Index(
                condition=models.Q(("remote_realm__isnull", True)),
                fields=["server", "realm_id"],
                name="zilencer_remoterealmcount_server_realm",
            ),
        ),
        AddIndexConcurrently(
            model_name="remoterealmcount",
            index=models.Index(
                condition=models.Q(("remote_realm__isnull", True)),
                fields=["server"],
                name="zilencer_remoterealmcount_server",
            ),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0046_remotezulipserver_last_audit_log_update.py]---
Location: zulip-main/zilencer/migrations/0046_remotezulipserver_last_audit_log_update.py
Signals: Django

```python
# Generated by Django 4.2.7 on 2023-12-06 18:23

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zilencer", "0045_remoterealmauditlog_zilencer_remoterealmauditlog_server_realm_and_more"),
    ]

    operations = [
        migrations.AddField(
            model_name="remotezulipserver",
            name="last_audit_log_update",
            field=models.DateTimeField(null=True),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0047_preregistrationremoteserverbillinguser_and_more.py]---
Location: zulip-main/zilencer/migrations/0047_preregistrationremoteserverbillinguser_and_more.py
Signals: Django

```python
# Generated by Django 4.2.8 on 2023-12-08 19:13

import django.db.models.deletion
from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zilencer", "0046_remotezulipserver_last_audit_log_update"),
    ]

    operations = [
        migrations.CreateModel(
            name="PreregistrationRemoteServerBillingUser",
            fields=[
                (
                    "id",
                    models.AutoField(
                        auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
                    ),
                ),
                ("email", models.EmailField(max_length=254)),
                ("status", models.IntegerField(default=0)),
                ("next_page", models.TextField(null=True)),
                (
                    "remote_server",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE, to="zilencer.remotezulipserver"
                    ),
                ),
            ],
            options={
                "abstract": False,
            },
        ),
        migrations.CreateModel(
            name="RemoteServerBillingUser",
            fields=[
                (
                    "id",
                    models.AutoField(
                        auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
                    ),
                ),
                ("email", models.EmailField(max_length=254)),
                ("full_name", models.TextField(default="")),
                (
                    "remote_server",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE, to="zilencer.remotezulipserver"
                    ),
                ),
            ],
            options={
                "unique_together": {("remote_server", "email")},
            },
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0048_remotezulipserver_last_api_feature_level.py]---
Location: zulip-main/zilencer/migrations/0048_remotezulipserver_last_api_feature_level.py
Signals: Django

```python
# Generated by Django 4.2.8 on 2023-12-09 18:08

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zilencer", "0047_preregistrationremoteserverbillinguser_and_more"),
    ]

    operations = [
        migrations.AddField(
            model_name="remotezulipserver",
            name="last_api_feature_level",
            field=models.PositiveIntegerField(null=True),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0049_alter_remoterealmbillinguser_unique_together_and_more.py]---
Location: zulip-main/zilencer/migrations/0049_alter_remoterealmbillinguser_unique_together_and_more.py
Signals: Django

```python
# Generated by Django 4.2.8 on 2023-12-10 01:01

import django.db.models.deletion
from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zilencer", "0048_remotezulipserver_last_api_feature_level"),
    ]

    operations = [
        migrations.AlterUniqueTogether(
            name="remoterealmbillinguser",
            unique_together={("remote_realm", "user_uuid")},
        ),
        migrations.CreateModel(
            name="PreregistrationRemoteRealmBillingUser",
            fields=[
                (
                    "id",
                    models.AutoField(
                        auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
                    ),
                ),
                ("user_uuid", models.UUIDField()),
                ("email", models.EmailField(max_length=254)),
                ("status", models.IntegerField(default=0)),
                ("next_page", models.TextField(null=True)),
                ("uri_scheme", models.TextField()),
                (
                    "remote_realm",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE, to="zilencer.remoterealm"
                    ),
                ),
            ],
            options={
                "abstract": False,
            },
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0050_preregistrationremoterealmbillinguser_created_user_and_more.py]---
Location: zulip-main/zilencer/migrations/0050_preregistrationremoterealmbillinguser_created_user_and_more.py
Signals: Django

```python
# Generated by Django 4.2.8 on 2023-12-11 12:55

import django.db.models.deletion
import django.utils.timezone
from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zilencer", "0049_alter_remoterealmbillinguser_unique_together_and_more"),
    ]

    operations = [
        migrations.AddField(
            model_name="preregistrationremoterealmbillinguser",
            name="created_user",
            field=models.ForeignKey(
                null=True,
                on_delete=django.db.models.deletion.SET_NULL,
                to="zilencer.remoterealmbillinguser",
            ),
        ),
        migrations.AddField(
            model_name="preregistrationremoterealmbillinguser",
            name="date_joined",
            field=models.DateTimeField(default=django.utils.timezone.now),
        ),
        migrations.AddField(
            model_name="preregistrationremoteserverbillinguser",
            name="created_user",
            field=models.ForeignKey(
                null=True,
                on_delete=django.db.models.deletion.SET_NULL,
                to="zilencer.remoteserverbillinguser",
            ),
        ),
        migrations.AddField(
            model_name="preregistrationremoteserverbillinguser",
            name="date_joined",
            field=models.DateTimeField(default=django.utils.timezone.now),
        ),
        migrations.AddField(
            model_name="remoterealmbillinguser",
            name="date_joined",
            field=models.DateTimeField(default=django.utils.timezone.now),
        ),
        migrations.AddField(
            model_name="remoterealmbillinguser",
            name="is_active",
            field=models.BooleanField(default=True),
        ),
        migrations.AddField(
            model_name="remoterealmbillinguser",
            name="last_login",
            field=models.DateTimeField(null=True),
        ),
        migrations.AddField(
            model_name="remoteserverbillinguser",
            name="date_joined",
            field=models.DateTimeField(default=django.utils.timezone.now),
        ),
        migrations.AddField(
            model_name="remoteserverbillinguser",
            name="is_active",
            field=models.BooleanField(default=True),
        ),
        migrations.AddField(
            model_name="remoteserverbillinguser",
            name="last_login",
            field=models.DateTimeField(null=True),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0051_remoterealm_is_system_bot_realm.py]---
Location: zulip-main/zilencer/migrations/0051_remoterealm_is_system_bot_realm.py
Signals: Django

```python
# Generated by Django 4.2.8 on 2023-12-11 20:38

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zilencer", "0050_preregistrationremoterealmbillinguser_created_user_and_more"),
    ]

    operations = [
        migrations.AddField(
            model_name="remoterealm",
            name="is_system_bot_realm",
            field=models.BooleanField(default=False),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0052_alter_remoterealm_plan_type_and_more.py]---
Location: zulip-main/zilencer/migrations/0052_alter_remoterealm_plan_type_and_more.py
Signals: Django

```python
# Generated by Django 4.2.8 on 2023-12-13 23:20

from django.db import migrations, models
from django.db.backends.base.schema import BaseDatabaseSchemaEditor
from django.db.migrations.state import StateApps

PLAN_TYPE_SELF_HOSTED = 1
PLAN_TYPE_SELF_MANAGED = 100


def renumber_plan_types(apps: StateApps, schema_editor: BaseDatabaseSchemaEditor) -> None:
    RemoteZulipServer = apps.get_model("zilencer", "RemoteZulipServer")
    RemoteRealm = apps.get_model("zilencer", "RemoteRealm")
    RemoteRealm.objects.filter(plan_type=PLAN_TYPE_SELF_HOSTED).update(
        plan_type=PLAN_TYPE_SELF_MANAGED
    )
    RemoteZulipServer.objects.filter(plan_type=PLAN_TYPE_SELF_HOSTED).update(
        plan_type=PLAN_TYPE_SELF_MANAGED
    )


class Migration(migrations.Migration):
    dependencies = [
        ("zilencer", "0051_remoterealm_is_system_bot_realm"),
    ]

    operations = [
        migrations.AlterField(
            model_name="remoterealm",
            name="plan_type",
            field=models.PositiveSmallIntegerField(db_index=True, default=PLAN_TYPE_SELF_MANAGED),
        ),
        migrations.AlterField(
            model_name="remotezulipserver",
            name="plan_type",
            field=models.PositiveSmallIntegerField(default=PLAN_TYPE_SELF_MANAGED),
        ),
        migrations.RunPython(
            renumber_plan_types, reverse_code=migrations.RunPython.noop, elidable=True
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0053_remoterealmauditlog_acting_remote_user_and_more.py]---
Location: zulip-main/zilencer/migrations/0053_remoterealmauditlog_acting_remote_user_and_more.py
Signals: Django

```python
# Generated by Django 4.2.8 on 2023-12-14 14:18

import django.db.models.deletion
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
        ("zilencer", "0052_alter_remoterealm_plan_type_and_more"),
    ]

    operations = [
        migrations.AddField(
            model_name="remoterealmauditlog",
            name="acting_remote_user",
            field=models.ForeignKey(
                null=True,
                on_delete=django.db.models.deletion.SET_NULL,
                to="zilencer.remoterealmbillinguser",
            ),
        ),
        migrations.AddField(
            model_name="remoterealmauditlog",
            name="acting_support_user",
            field=models.ForeignKey(
                null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL
            ),
        ),
        migrations.AddField(
            model_name="remotezulipserverauditlog",
            name="acting_remote_user",
            field=models.ForeignKey(
                null=True,
                on_delete=django.db.models.deletion.SET_NULL,
                to="zilencer.remoteserverbillinguser",
            ),
        ),
        migrations.AddField(
            model_name="remotezulipserverauditlog",
            name="acting_support_user",
            field=models.ForeignKey(
                null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL
            ),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0054_remoterealmbillinguser_enable_maintenance_release_emails_and_more.py]---
Location: zulip-main/zilencer/migrations/0054_remoterealmbillinguser_enable_maintenance_release_emails_and_more.py
Signals: Django

```python
# Generated by Django 4.2.8 on 2023-12-14 17:16

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zilencer", "0053_remoterealmauditlog_acting_remote_user_and_more"),
    ]

    operations = [
        migrations.AddField(
            model_name="remoterealmbillinguser",
            name="enable_maintenance_release_emails",
            field=models.BooleanField(default=True),
        ),
        migrations.AddField(
            model_name="remoterealmbillinguser",
            name="enable_major_release_emails",
            field=models.BooleanField(default=True),
        ),
        migrations.AddField(
            model_name="remoteserverbillinguser",
            name="enable_maintenance_release_emails",
            field=models.BooleanField(default=True),
        ),
        migrations.AddField(
            model_name="remoteserverbillinguser",
            name="enable_major_release_emails",
            field=models.BooleanField(default=True),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0055_remoteserverbillinguser_tos_version.py]---
Location: zulip-main/zilencer/migrations/0055_remoteserverbillinguser_tos_version.py
Signals: Django

```python
# Generated by Django 4.2.8 on 2023-12-14 17:27

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zilencer", "0054_remoterealmbillinguser_enable_maintenance_release_emails_and_more"),
    ]

    operations = [
        migrations.AddField(
            model_name="remoteserverbillinguser",
            name="tos_version",
            field=models.TextField(default="-1"),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0056_remoterealm_realm_locally_deleted.py]---
Location: zulip-main/zilencer/migrations/0056_remoterealm_realm_locally_deleted.py
Signals: Django

```python
# Generated by Django 4.2.8 on 2023-12-15 13:52

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zilencer", "0055_remoteserverbillinguser_tos_version"),
    ]

    operations = [
        migrations.AddField(
            model_name="remoterealm",
            name="realm_locally_deleted",
            field=models.BooleanField(default=False),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0057_remoterealm_last_request_timestamp_and_more.py]---
Location: zulip-main/zilencer/migrations/0057_remoterealm_last_request_timestamp_and_more.py
Signals: Django

```python
# Generated by Django 4.2.8 on 2023-12-25 00:54

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zilencer", "0056_remoterealm_realm_locally_deleted"),
    ]

    operations = [
        migrations.AddField(
            model_name="remoterealm",
            name="last_request_datetime",
            field=models.DateTimeField(null=True),
        ),
        migrations.AddField(
            model_name="remotezulipserver",
            name="last_request_datetime",
            field=models.DateTimeField(null=True),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0058_remoteinstallationcount_add_mobile_pushes_forwarded_index.py]---
Location: zulip-main/zilencer/migrations/0058_remoteinstallationcount_add_mobile_pushes_forwarded_index.py
Signals: Django

```python
# Generated by Django 4.2.9 on 2024-02-01 13:58

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zilencer", "0057_remoterealm_last_request_timestamp_and_more"),
    ]

    operations = [
        migrations.AddIndex(
            model_name="remoteinstallationcount",
            index=models.Index(
                condition=models.Q(("property", "mobile_pushes_forwarded::day")),
                fields=["server_id", "end_time"],
                name="zilencer_remoteinstallationcount_server_end_time_mobile_pushes_forwarded",
            ),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0059_remoterealmauditlog_add_synced_billing_event_type_index.py]---
Location: zulip-main/zilencer/migrations/0059_remoterealmauditlog_add_synced_billing_event_type_index.py
Signals: Django

```python
# Generated by Django 4.2.9 on 2024-02-20 12:04

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zilencer", "0058_remoteinstallationcount_add_mobile_pushes_forwarded_index"),
    ]

    operations = [
        migrations.AddIndex(
            model_name="remoterealmauditlog",
            index=models.Index(
                condition=models.Q(("event_type__in", [101, 102, 103, 104, 105, 201, 202, 229])),
                fields=["remote_realm_id", "id"],
                name="zilencer_remoterealmauditlog_synced_billing_events",
            ),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0060_remove_remoterealmcount_unique_remote_realm_installation_count_and_more.py]---
Location: zulip-main/zilencer/migrations/0060_remove_remoterealmcount_unique_remote_realm_installation_count_and_more.py
Signals: Django

```python
# Generated by Django 5.0.5 on 2024-05-06 15:17

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zilencer", "0059_remoterealmauditlog_add_synced_billing_event_type_index"),
    ]

    operations = [
        migrations.SeparateDatabaseAndState(
            # Django does not provide a RenameConstraint operation.
            # "Constraints" are created as indexes in PostgreSQL, so
            # we rename the underlying indexes.
            database_operations=[
                migrations.RunSQL(
                    sql=(
                        "ALTER INDEX unique_remote_realm_installation_count "
                        "RENAME TO unique_server_realm_installation_count"
                    ),
                    reverse_sql=(
                        "ALTER INDEX unique_server_realm_installation_count "
                        "RENAME TO unique_remote_realm_installation_count"
                    ),
                ),
                migrations.RunSQL(
                    sql=(
                        "ALTER INDEX unique_remote_realm_installation_count_null_subgroup "
                        "RENAME TO unique_server_realm_installation_count_null_subgroup"
                    ),
                    reverse_sql=(
                        "ALTER INDEX unique_server_realm_installation_count_null_subgroup "
                        "RENAME TO unique_remote_realm_installation_count_null_subgroup"
                    ),
                ),
            ],
            state_operations=[
                migrations.RemoveConstraint(
                    model_name="remoterealmcount",
                    name="unique_remote_realm_installation_count",
                ),
                migrations.RemoveConstraint(
                    model_name="remoterealmcount",
                    name="unique_remote_realm_installation_count_null_subgroup",
                ),
                migrations.AddConstraint(
                    model_name="remoterealmcount",
                    constraint=models.UniqueConstraint(
                        condition=models.Q(("subgroup__isnull", False)),
                        fields=("server", "realm_id", "property", "subgroup", "end_time"),
                        name="unique_server_realm_installation_count",
                    ),
                ),
                migrations.AddConstraint(
                    model_name="remoterealmcount",
                    constraint=models.UniqueConstraint(
                        condition=models.Q(("subgroup__isnull", True)),
                        fields=("server", "realm_id", "property", "end_time"),
                        name="unique_server_realm_installation_count_null_subgroup",
                    ),
                ),
            ],
        ),
        migrations.AddConstraint(
            model_name="remoterealmcount",
            constraint=models.UniqueConstraint(
                condition=models.Q(("subgroup__isnull", False)),
                fields=("remote_realm_id", "property", "subgroup", "end_time"),
                name="unique_remote_realm_installation_count",
            ),
        ),
        migrations.AddConstraint(
            model_name="remoterealmcount",
            constraint=models.UniqueConstraint(
                condition=models.Q(("subgroup__isnull", True)),
                fields=("remote_realm_id", "property", "end_time"),
                name="unique_remote_realm_installation_count_null_subgroup",
            ),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0061_clean_count_tables.py]---
Location: zulip-main/zilencer/migrations/0061_clean_count_tables.py
Signals: Django

```python
from django.db import migrations

# This matches analytics.lib.counts.LOGGING_COUNT_STAT_PROPERTIES_NOT_SENT_TO_BOUNCER
IGNORED = (
    "invites_sent::day",
    "mobile_pushes_sent::day",
    "active_users_log:is_bot:day",
    "active_users:is_bot:day",
)


class Migration(migrations.Migration):
    elidable = True

    dependencies = [
        (
            "zilencer",
            "0060_remove_remoterealmcount_unique_remote_realm_installation_count_and_more",
        ),
    ]

    operations = [
        migrations.RunSQL(
            [
                ("DELETE FROM zilencer_remoterealmcount WHERE property IN %s", (IGNORED,)),
                ("DELETE FROM zilencer_remoteinstallationcount WHERE property IN %s", (IGNORED,)),
            ],
            elidable=True,
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0062_alter_remoteinstallationcount_id_and_more.py]---
Location: zulip-main/zilencer/migrations/0062_alter_remoteinstallationcount_id_and_more.py
Signals: Django

```python
from django.db import migrations, models


class Migration(migrations.Migration):
    atomic = False

    dependencies = [
        ("zilencer", "0061_clean_count_tables"),
    ]

    operations = [
        migrations.AlterField(
            model_name="remoteinstallationcount",
            name="id",
            field=models.BigAutoField(
                auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
            ),
        ),
        migrations.AlterField(
            model_name="remoterealmcount",
            name="id",
            field=models.BigAutoField(
                auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
            ),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0063_convert_ids_to_bigints.py]---
Location: zulip-main/zilencer/migrations/0063_convert_ids_to_bigints.py
Signals: Django

```python
from django.db import migrations, models


class Migration(migrations.Migration):
    atomic = False

    dependencies = [
        ("zilencer", "0062_alter_remoteinstallationcount_id_and_more"),
    ]

    operations = [
        migrations.AlterField(
            model_name="preregistrationremoterealmbillinguser",
            name="id",
            field=models.BigAutoField(
                auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
            ),
        ),
        migrations.AlterField(
            model_name="preregistrationremoteserverbillinguser",
            name="id",
            field=models.BigAutoField(
                auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
            ),
        ),
        migrations.AlterField(
            model_name="remotepushdevicetoken",
            name="id",
            field=models.BigAutoField(
                auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
            ),
        ),
        migrations.AlterField(
            model_name="remoterealm",
            name="id",
            field=models.BigAutoField(
                auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
            ),
        ),
        migrations.AlterField(
            model_name="remoterealmauditlog",
            name="id",
            field=models.BigAutoField(
                auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
            ),
        ),
        migrations.AlterField(
            model_name="remoterealmbillinguser",
            name="id",
            field=models.BigAutoField(
                auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
            ),
        ),
        migrations.AlterField(
            model_name="remoteserverbillinguser",
            name="id",
            field=models.BigAutoField(
                auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
            ),
        ),
        migrations.AlterField(
            model_name="remotezulipserver",
            name="id",
            field=models.BigAutoField(
                auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
            ),
        ),
        migrations.AlterField(
            model_name="remotezulipserverauditlog",
            name="id",
            field=models.BigAutoField(
                auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
            ),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0064_remotezulipserver_last_merge_base.py]---
Location: zulip-main/zilencer/migrations/0064_remotezulipserver_last_merge_base.py
Signals: Django

```python
# Generated by Django 5.0.6 on 2024-06-23 00:29

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zilencer", "0063_convert_ids_to_bigints"),
    ]

    operations = [
        migrations.AddField(
            model_name="remotezulipserver",
            name="last_merge_base",
            field=models.CharField(max_length=128, null=True),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0065_remotepushdevice.py]---
Location: zulip-main/zilencer/migrations/0065_remotepushdevice.py
Signals: Django

```python
# Generated by Django 5.2.3 on 2025-06-24 07:49

import django.db.models.deletion
from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0725_realmuserdefault_web_left_sidebar_unreads_count_summary_and_more"),
        ("zilencer", "0001_squashed_0064_remotezulipserver_last_merge_base"),
    ]

    operations = [
        migrations.CreateModel(
            name="RemotePushDevice",
            fields=[
                ("device_id", models.BigAutoField(primary_key=True, serialize=False)),
                ("token", models.CharField(max_length=4096)),
                ("token_kind", models.PositiveSmallIntegerField(choices=[(1, "APNs"), (2, "FCM")])),
                ("push_account_id", models.BigIntegerField()),
                ("expired_time", models.DateTimeField(null=True)),
                ("ios_app_id", models.TextField(null=True)),
                (
                    "realm",
                    models.ForeignKey(
                        null=True, on_delete=django.db.models.deletion.CASCADE, to="zerver.realm"
                    ),
                ),
                (
                    "remote_realm",
                    models.ForeignKey(
                        null=True,
                        on_delete=django.db.models.deletion.CASCADE,
                        to="zilencer.remoterealm",
                    ),
                ),
            ],
            options={
                "constraints": [
                    models.UniqueConstraint(
                        fields=("push_account_id", "token"),
                        name="unique_remote_push_device_push_account_id_token",
                    )
                ],
            },
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0066_alter_remotepushdevice_token_kind.py]---
Location: zulip-main/zilencer/migrations/0066_alter_remotepushdevice_token_kind.py
Signals: Django

```python
# Generated by Django 5.2.3 on 2025-07-09 13:11

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zilencer", "0065_remotepushdevice"),
    ]

    operations = [
        migrations.AlterField(
            model_name="remotepushdevice",
            name="token_kind",
            field=models.CharField(choices=[("apns", "APNs"), ("fcm", "FCM")], max_length=4),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0067_remotepushdevicetoken_apns_case_insensitive.py]---
Location: zulip-main/zilencer/migrations/0067_remotepushdevicetoken_apns_case_insensitive.py
Signals: Django

```python
import django.db.models.functions.text
from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zilencer", "0066_alter_remotepushdevice_token_kind"),
    ]

    operations = [
        # This parallels zerver/migrations/0740 but must account for
        # the user_id / user_uuid split.
        migrations.RunSQL(
            """
            WITH dups AS (
              SELECT server_id, user_id, kind, LOWER(token) AS token, MAX(last_updated) AS max_last_updated
                FROM zilencer_remotepushdevicetoken
               WHERE kind = 1
                 AND user_uuid IS NULL
               GROUP BY server_id, user_id, kind, LOWER(token)
              HAVING COUNT(*) > 1
            )
            UPDATE zilencer_remotepushdevicetoken
               SET last_updated = dups.max_last_updated
              FROM dups
             WHERE zilencer_remotepushdevicetoken.server_id = dups.server_id
               AND zilencer_remotepushdevicetoken.user_id = dups.user_id
               AND zilencer_remotepushdevicetoken.user_uuid IS NULL
               AND zilencer_remotepushdevicetoken.kind = dups.kind
               AND LOWER(zilencer_remotepushdevicetoken.token) = dups.token
            """
        ),
        migrations.RunSQL(
            """
            WITH dups AS (
              SELECT server_id, user_id, kind, LOWER(token) AS token, MIN(id) AS min_id
                FROM zilencer_remotepushdevicetoken
               WHERE kind = 1
                 AND user_uuid IS NULL
               GROUP BY server_id, user_id, kind, LOWER(token)
              HAVING COUNT(*) > 1
            )
            DELETE FROM zilencer_remotepushdevicetoken
             USING dups
             WHERE zilencer_remotepushdevicetoken.server_id = dups.server_id
               AND zilencer_remotepushdevicetoken.user_id = dups.user_id
               AND zilencer_remotepushdevicetoken.user_uuid IS NULL
               AND zilencer_remotepushdevicetoken.kind = dups.kind
               AND LOWER(zilencer_remotepushdevicetoken.token) = dups.token
               AND zilencer_remotepushdevicetoken.id != dups.min_id
            """
        ),
        migrations.AddConstraint(
            model_name="remotepushdevicetoken",
            constraint=models.UniqueConstraint(
                models.F("server_id"),
                models.F("user_id"),
                models.F("kind"),
                django.db.models.functions.text.Lower(models.F("token")),
                condition=models.Q(("kind", 1)),
                name="zilencer_remotepushdevicetoken_apns_server_user_id_kind_token",
            ),
        ),
        migrations.AddConstraint(
            model_name="remotepushdevicetoken",
            constraint=models.UniqueConstraint(
                models.F("server_id"),
                models.F("user_id"),
                models.F("kind"),
                models.F("token"),
                condition=models.Q(("kind", 2)),
                name="zilencer_remotepushdevicetoken_fcm_server_user_id_kind_token",
            ),
        ),
        migrations.RunSQL(
            """
            WITH dups AS (
              SELECT server_id, user_uuid, kind, LOWER(token) AS token, MAX(last_updated) AS max_last_updated
                FROM zilencer_remotepushdevicetoken
               WHERE kind = 1
                 AND user_id IS NULL
               GROUP BY server_id, user_uuid, kind, LOWER(token)
              HAVING COUNT(*) > 1
            )
            UPDATE zilencer_remotepushdevicetoken
               SET last_updated = dups.max_last_updated
              FROM dups
             WHERE zilencer_remotepushdevicetoken.server_id = dups.server_id
               AND zilencer_remotepushdevicetoken.user_uuid = dups.user_uuid
               AND zilencer_remotepushdevicetoken.user_id IS NULL
               AND zilencer_remotepushdevicetoken.kind = dups.kind
               AND LOWER(zilencer_remotepushdevicetoken.token) = dups.token
            """
        ),
        migrations.RunSQL(
            """
            WITH dups AS (
              SELECT server_id, user_uuid, kind, LOWER(token) AS token, MIN(id) AS min_id
                FROM zilencer_remotepushdevicetoken
               WHERE kind = 1
                 AND user_id IS NULL
               GROUP BY server_id, user_uuid, kind, LOWER(token)
              HAVING COUNT(*) > 1
            )
            DELETE FROM zilencer_remotepushdevicetoken
             USING dups
             WHERE zilencer_remotepushdevicetoken.server_id = dups.server_id
               AND zilencer_remotepushdevicetoken.user_uuid = dups.user_uuid
               AND zilencer_remotepushdevicetoken.user_id IS NULL
               AND zilencer_remotepushdevicetoken.kind = dups.kind
               AND LOWER(zilencer_remotepushdevicetoken.token) = dups.token
               AND zilencer_remotepushdevicetoken.id != dups.min_id
            """
        ),
        migrations.AddConstraint(
            model_name="remotepushdevicetoken",
            constraint=models.UniqueConstraint(
                models.F("server_id"),
                models.F("user_uuid"),
                models.F("kind"),
                django.db.models.functions.text.Lower(models.F("token")),
                condition=models.Q(("kind", 1)),
                name="zilencer_remotepushdevicetoken_apns_server_uuid_kind_token",
            ),
        ),
        migrations.AddConstraint(
            model_name="remotepushdevicetoken",
            constraint=models.UniqueConstraint(
                models.F("server_id"),
                models.F("user_uuid"),
                models.F("kind"),
                models.F("token"),
                condition=models.Q(("kind", 2)),
                name="zilencer_remotepushdevicetoken_fcm_server_uuid_kind_token",
            ),
        ),
        migrations.AlterUniqueTogether(
            name="remotepushdevicetoken",
            unique_together=set(),
        ),
    ]
```

--------------------------------------------------------------------------------

````
