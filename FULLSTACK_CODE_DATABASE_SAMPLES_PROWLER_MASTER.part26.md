---
source_txt: fullstack_samples/prowler-master
converted_utc: 2025-12-18T11:26:14Z
part: 26
parts_total: 867
---

# FULLSTACK CODE DATABASE SAMPLES prowler-master

## Verbatim Content (Part 26 of 867)

````text
================================================================================
FULLSTACK SAMPLES CODE DATABASE (VERBATIM) - prowler-master
================================================================================
Generated: December 18, 2025
Source: fullstack_samples/prowler-master
================================================================================

NOTES:
- This output is verbatim because the source is user-owned.
- Large/binary files may be skipped by size/binary detection limits.

================================================================================

---[FILE: 0002_token_migrations.py]---
Location: prowler-master/api/src/backend/api/migrations/0002_token_migrations.py
Signals: Django

```python
from django.conf import settings
from django.db import migrations

from api.db_utils import DB_PROWLER_USER

DB_NAME = settings.DATABASES["default"]["NAME"]


class Migration(migrations.Migration):
    dependencies = [
        ("api", "0001_initial"),
        ("token_blacklist", "0012_alter_outstandingtoken_user"),
    ]

    operations = [
        migrations.RunSQL(
            f"""
            GRANT SELECT, INSERT, UPDATE, DELETE ON token_blacklist_blacklistedtoken TO {DB_PROWLER_USER};
            GRANT SELECT, INSERT, UPDATE, DELETE ON token_blacklist_outstandingtoken TO {DB_PROWLER_USER};
            GRANT SELECT, DELETE ON django_admin_log TO {DB_PROWLER_USER};
            """
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0003_update_provider_unique_constraint_with_is_deleted.py]---
Location: prowler-master/api/src/backend/api/migrations/0003_update_provider_unique_constraint_with_is_deleted.py
Signals: Django

```python
# Generated by Django 5.1.1 on 2024-12-20 13:16

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("api", "0002_token_migrations"),
    ]

    operations = [
        migrations.RemoveConstraint(
            model_name="provider",
            name="unique_provider_uids",
        ),
        migrations.AddConstraint(
            model_name="provider",
            constraint=models.UniqueConstraint(
                fields=("tenant_id", "provider", "uid", "is_deleted"),
                name="unique_provider_uids",
            ),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0004_rbac.py]---
Location: prowler-master/api/src/backend/api/migrations/0004_rbac.py
Signals: Django

```python
# Generated by Django 5.1.1 on 2024-12-05 12:29

import uuid

import django.db.models.deletion
from django.conf import settings
from django.db import migrations, models

import api.rls


class Migration(migrations.Migration):
    dependencies = [
        ("api", "0003_update_provider_unique_constraint_with_is_deleted"),
    ]

    operations = [
        migrations.CreateModel(
            name="Role",
            fields=[
                (
                    "id",
                    models.UUIDField(
                        default=uuid.uuid4,
                        editable=False,
                        primary_key=True,
                        serialize=False,
                    ),
                ),
                ("name", models.CharField(max_length=255)),
                ("manage_users", models.BooleanField(default=False)),
                ("manage_account", models.BooleanField(default=False)),
                ("manage_billing", models.BooleanField(default=False)),
                ("manage_providers", models.BooleanField(default=False)),
                ("manage_integrations", models.BooleanField(default=False)),
                ("manage_scans", models.BooleanField(default=False)),
                ("unlimited_visibility", models.BooleanField(default=False)),
                ("inserted_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                (
                    "tenant",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE, to="api.tenant"
                    ),
                ),
            ],
            options={
                "db_table": "roles",
            },
        ),
        migrations.CreateModel(
            name="RoleProviderGroupRelationship",
            fields=[
                (
                    "id",
                    models.UUIDField(
                        default=uuid.uuid4,
                        editable=False,
                        primary_key=True,
                        serialize=False,
                    ),
                ),
                ("inserted_at", models.DateTimeField(auto_now_add=True)),
                (
                    "tenant",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE, to="api.tenant"
                    ),
                ),
            ],
            options={
                "db_table": "role_provider_group_relationship",
            },
        ),
        migrations.CreateModel(
            name="UserRoleRelationship",
            fields=[
                (
                    "id",
                    models.UUIDField(
                        default=uuid.uuid4,
                        editable=False,
                        primary_key=True,
                        serialize=False,
                    ),
                ),
                ("inserted_at", models.DateTimeField(auto_now_add=True)),
                (
                    "tenant",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE, to="api.tenant"
                    ),
                ),
            ],
            options={
                "db_table": "role_user_relationship",
            },
        ),
        migrations.AddField(
            model_name="roleprovidergrouprelationship",
            name="provider_group",
            field=models.ForeignKey(
                on_delete=django.db.models.deletion.CASCADE, to="api.providergroup"
            ),
        ),
        migrations.AddField(
            model_name="roleprovidergrouprelationship",
            name="role",
            field=models.ForeignKey(
                on_delete=django.db.models.deletion.CASCADE, to="api.role"
            ),
        ),
        migrations.AddField(
            model_name="role",
            name="provider_groups",
            field=models.ManyToManyField(
                related_name="roles",
                through="api.RoleProviderGroupRelationship",
                to="api.providergroup",
            ),
        ),
        migrations.AddField(
            model_name="userrolerelationship",
            name="role",
            field=models.ForeignKey(
                on_delete=django.db.models.deletion.CASCADE, to="api.role"
            ),
        ),
        migrations.AddField(
            model_name="userrolerelationship",
            name="user",
            field=models.ForeignKey(
                on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL
            ),
        ),
        migrations.AddField(
            model_name="role",
            name="users",
            field=models.ManyToManyField(
                related_name="roles",
                through="api.UserRoleRelationship",
                to=settings.AUTH_USER_MODEL,
            ),
        ),
        migrations.AddConstraint(
            model_name="roleprovidergrouprelationship",
            constraint=models.UniqueConstraint(
                fields=("role_id", "provider_group_id"),
                name="unique_role_provider_group_relationship",
            ),
        ),
        migrations.AddConstraint(
            model_name="roleprovidergrouprelationship",
            constraint=api.rls.RowLevelSecurityConstraint(
                "tenant_id",
                name="rls_on_roleprovidergrouprelationship",
                statements=["SELECT", "INSERT", "UPDATE", "DELETE"],
            ),
        ),
        migrations.AddConstraint(
            model_name="userrolerelationship",
            constraint=models.UniqueConstraint(
                fields=("role_id", "user_id"), name="unique_role_user_relationship"
            ),
        ),
        migrations.AddConstraint(
            model_name="userrolerelationship",
            constraint=api.rls.RowLevelSecurityConstraint(
                "tenant_id",
                name="rls_on_userrolerelationship",
                statements=["SELECT", "INSERT", "UPDATE", "DELETE"],
            ),
        ),
        migrations.AddConstraint(
            model_name="role",
            constraint=models.UniqueConstraint(
                fields=("tenant_id", "name"), name="unique_role_per_tenant"
            ),
        ),
        migrations.AddConstraint(
            model_name="role",
            constraint=api.rls.RowLevelSecurityConstraint(
                "tenant_id",
                name="rls_on_role",
                statements=["SELECT", "INSERT", "UPDATE", "DELETE"],
            ),
        ),
        migrations.CreateModel(
            name="InvitationRoleRelationship",
            fields=[
                (
                    "id",
                    models.UUIDField(
                        default=uuid.uuid4,
                        editable=False,
                        primary_key=True,
                        serialize=False,
                    ),
                ),
                ("inserted_at", models.DateTimeField(auto_now_add=True)),
                (
                    "invitation",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE, to="api.invitation"
                    ),
                ),
                (
                    "role",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE, to="api.role"
                    ),
                ),
                (
                    "tenant",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE, to="api.tenant"
                    ),
                ),
            ],
            options={
                "db_table": "role_invitation_relationship",
            },
        ),
        migrations.AddConstraint(
            model_name="invitationrolerelationship",
            constraint=models.UniqueConstraint(
                fields=("role_id", "invitation_id"),
                name="unique_role_invitation_relationship",
            ),
        ),
        migrations.AddConstraint(
            model_name="invitationrolerelationship",
            constraint=api.rls.RowLevelSecurityConstraint(
                "tenant_id",
                name="rls_on_invitationrolerelationship",
                statements=["SELECT", "INSERT", "UPDATE", "DELETE"],
            ),
        ),
        migrations.AddField(
            model_name="role",
            name="invitations",
            field=models.ManyToManyField(
                related_name="roles",
                through="api.InvitationRoleRelationship",
                to="api.invitation",
            ),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0005_rbac_missing_admin_roles.py]---
Location: prowler-master/api/src/backend/api/migrations/0005_rbac_missing_admin_roles.py
Signals: Django

```python
from django.db import migrations

from api.db_router import MainRouter


def create_admin_role(apps, schema_editor):
    Tenant = apps.get_model("api", "Tenant")
    Role = apps.get_model("api", "Role")
    User = apps.get_model("api", "User")
    UserRoleRelationship = apps.get_model("api", "UserRoleRelationship")

    for tenant in Tenant.objects.using(MainRouter.admin_db).all():
        admin_role, _ = Role.objects.using(MainRouter.admin_db).get_or_create(
            name="admin",
            tenant=tenant,
            defaults={
                "manage_users": True,
                "manage_account": True,
                "manage_billing": True,
                "manage_providers": True,
                "manage_integrations": True,
                "manage_scans": True,
                "unlimited_visibility": True,
            },
        )
        users = User.objects.using(MainRouter.admin_db).filter(
            membership__tenant=tenant
        )
        for user in users:
            UserRoleRelationship.objects.using(MainRouter.admin_db).get_or_create(
                user=user,
                role=admin_role,
                tenant=tenant,
            )


class Migration(migrations.Migration):
    dependencies = [
        ("api", "0004_rbac"),
    ]

    operations = [
        migrations.RunPython(create_admin_role),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0006_findings_first_seen.py]---
Location: prowler-master/api/src/backend/api/migrations/0006_findings_first_seen.py
Signals: Django

```python
from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("api", "0005_rbac_missing_admin_roles"),
    ]

    operations = [
        migrations.AddField(
            model_name="finding",
            name="first_seen_at",
            field=models.DateTimeField(editable=False, null=True),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0007_scan_and_scan_summaries_indexes.py]---
Location: prowler-master/api/src/backend/api/migrations/0007_scan_and_scan_summaries_indexes.py
Signals: Django

```python
# Generated by Django 5.1.5 on 2025-01-28 15:03

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("api", "0006_findings_first_seen"),
    ]

    operations = [
        migrations.AddIndex(
            model_name="scan",
            index=models.Index(
                fields=["tenant_id", "provider_id", "state", "inserted_at"],
                name="scans_prov_state_insert_idx",
            ),
        ),
        migrations.AddIndex(
            model_name="scansummary",
            index=models.Index(
                fields=["tenant_id", "scan_id"], name="scan_summaries_tenant_scan_idx"
            ),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0008_daily_scheduled_tasks_update.py]---
Location: prowler-master/api/src/backend/api/migrations/0008_daily_scheduled_tasks_update.py
Signals: Django

```python
import json
from datetime import datetime, timedelta, timezone

import django.db.models.deletion
from django.db import migrations, models
from django_celery_beat.models import PeriodicTask

from api.db_utils import rls_transaction
from api.models import Scan, StateChoices


def migrate_daily_scheduled_scan_tasks(apps, schema_editor):
    for daily_scheduled_scan_task in PeriodicTask.objects.filter(
        task="scan-perform-scheduled"
    ):
        task_kwargs = json.loads(daily_scheduled_scan_task.kwargs)
        tenant_id = task_kwargs["tenant_id"]
        provider_id = task_kwargs["provider_id"]

        current_time = datetime.now(timezone.utc)
        scheduled_time_today = datetime.combine(
            current_time.date(),
            daily_scheduled_scan_task.start_time.time(),
            tzinfo=timezone.utc,
        )

        if current_time < scheduled_time_today:
            next_scan_date = scheduled_time_today
        else:
            next_scan_date = scheduled_time_today + timedelta(days=1)

        with rls_transaction(tenant_id):
            Scan.objects.create(
                tenant_id=tenant_id,
                name="Daily scheduled scan",
                provider_id=provider_id,
                trigger=Scan.TriggerChoices.SCHEDULED,
                state=StateChoices.SCHEDULED,
                scheduled_at=next_scan_date,
                scheduler_task_id=daily_scheduled_scan_task.id,
            )


class Migration(migrations.Migration):
    atomic = False

    dependencies = [
        ("api", "0007_scan_and_scan_summaries_indexes"),
        ("django_celery_beat", "0019_alter_periodictasks_options"),
    ]

    operations = [
        migrations.AddField(
            model_name="scan",
            name="scheduler_task",
            field=models.ForeignKey(
                blank=True,
                null=True,
                on_delete=django.db.models.deletion.CASCADE,
                to="django_celery_beat.periodictask",
            ),
        ),
        migrations.RunPython(migrate_daily_scheduled_scan_tasks),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0009_increase_provider_uid_maximum_length.py]---
Location: prowler-master/api/src/backend/api/migrations/0009_increase_provider_uid_maximum_length.py
Signals: Django

```python
# Generated by Django 5.1.5 on 2025-02-07 09:42

import django.core.validators
from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("api", "0008_daily_scheduled_tasks_update"),
    ]

    operations = [
        migrations.AlterField(
            model_name="provider",
            name="uid",
            field=models.CharField(
                max_length=250,
                validators=[django.core.validators.MinLengthValidator(3)],
                verbose_name="Unique identifier for the provider, set by the provider",
            ),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0010_findings_performance_indexes_partitions.py]---
Location: prowler-master/api/src/backend/api/migrations/0010_findings_performance_indexes_partitions.py
Signals: Django

```python
from functools import partial

from django.db import connection, migrations


def create_index_on_partitions(
    apps, schema_editor, parent_table: str, index_name: str, index_details: str
):
    with connection.cursor() as cursor:
        cursor.execute(
            """
            SELECT inhrelid::regclass::text
            FROM pg_inherits
            WHERE inhparent = %s::regclass;
        """,
            [parent_table],
        )
        partitions = [row[0] for row in cursor.fetchall()]
    # Iterate over partitions and create index concurrently.
    # Note: PostgreSQL does not allow CONCURRENTLY inside a transaction,
    # so we need atomic = False for this migration.
    for partition in partitions:
        sql = (
            f"CREATE INDEX CONCURRENTLY IF NOT EXISTS {partition.replace('.', '_')}_{index_name} ON {partition} "
            f"{index_details};"
        )
        schema_editor.execute(sql)


def drop_index_on_partitions(apps, schema_editor, parent_table: str, index_name: str):
    with schema_editor.connection.cursor() as cursor:
        cursor.execute(
            """
            SELECT inhrelid::regclass::text
            FROM pg_inherits
            WHERE inhparent = %s::regclass;
        """,
            [parent_table],
        )
        partitions = [row[0] for row in cursor.fetchall()]

    # Iterate over partitions and drop index concurrently.
    for partition in partitions:
        partition_index = f"{partition.replace('.', '_')}_{index_name}"
        sql = f"DROP INDEX CONCURRENTLY IF EXISTS {partition_index};"
        schema_editor.execute(sql)


class Migration(migrations.Migration):
    atomic = False

    dependencies = [
        ("api", "0009_increase_provider_uid_maximum_length"),
    ]

    operations = [
        migrations.RunPython(
            partial(
                create_index_on_partitions,
                parent_table="findings",
                index_name="findings_tenant_and_id_idx",
                index_details="(tenant_id, id)",
            ),
            reverse_code=partial(
                drop_index_on_partitions,
                parent_table="findings",
                index_name="findings_tenant_and_id_idx",
            ),
        ),
        migrations.RunPython(
            partial(
                create_index_on_partitions,
                parent_table="findings",
                index_name="find_tenant_scan_idx",
                index_details="(tenant_id, scan_id)",
            ),
            reverse_code=partial(
                drop_index_on_partitions,
                parent_table="findings",
                index_name="find_tenant_scan_idx",
            ),
        ),
        migrations.RunPython(
            partial(
                create_index_on_partitions,
                parent_table="findings",
                index_name="find_tenant_scan_id_idx",
                index_details="(tenant_id, scan_id, id)",
            ),
            reverse_code=partial(
                drop_index_on_partitions,
                parent_table="findings",
                index_name="find_tenant_scan_id_idx",
            ),
        ),
        migrations.RunPython(
            partial(
                create_index_on_partitions,
                parent_table="findings",
                index_name="find_delta_new_idx",
                index_details="(tenant_id, id) where delta = 'new'",
            ),
            reverse_code=partial(
                drop_index_on_partitions,
                parent_table="findings",
                index_name="find_delta_new_idx",
            ),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0011_findings_performance_indexes_parent.py]---
Location: prowler-master/api/src/backend/api/migrations/0011_findings_performance_indexes_parent.py
Signals: Django

```python
from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("api", "0010_findings_performance_indexes_partitions"),
    ]

    operations = [
        migrations.AddIndex(
            model_name="finding",
            index=models.Index(
                fields=["tenant_id", "id"], name="findings_tenant_and_id_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="finding",
            index=models.Index(
                fields=["tenant_id", "scan_id"], name="find_tenant_scan_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="finding",
            index=models.Index(
                fields=["tenant_id", "scan_id", "id"], name="find_tenant_scan_id_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="finding",
            index=models.Index(
                condition=models.Q(("delta", "new")),
                fields=["tenant_id", "id"],
                name="find_delta_new_idx",
            ),
        ),
        migrations.AddIndex(
            model_name="resourcetagmapping",
            index=models.Index(
                fields=["tenant_id", "resource_id"], name="resource_tag_tenant_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="resource",
            index=models.Index(
                fields=["tenant_id", "service", "region", "type"],
                name="resource_tenant_metadata_idx",
            ),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0012_scan_report_output.py]---
Location: prowler-master/api/src/backend/api/migrations/0012_scan_report_output.py
Signals: Django

```python
from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("api", "0011_findings_performance_indexes_parent"),
    ]

    operations = [
        migrations.AddField(
            model_name="scan",
            name="output_location",
            field=models.CharField(blank=True, max_length=200, null=True),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0013_integrations_enum.py]---
Location: prowler-master/api/src/backend/api/migrations/0013_integrations_enum.py
Signals: Django

```python
# Generated by Django 5.1.5 on 2025-03-03 15:46

from functools import partial

from django.db import migrations

from api.db_utils import IntegrationTypeEnum, PostgresEnumMigration, register_enum
from api.models import Integration

IntegrationTypeEnumMigration = PostgresEnumMigration(
    enum_name="integration_type",
    enum_values=tuple(
        integration_type[0]
        for integration_type in Integration.IntegrationChoices.choices
    ),
)


class Migration(migrations.Migration):
    atomic = False

    dependencies = [
        ("api", "0012_scan_report_output"),
    ]

    operations = [
        migrations.RunPython(
            IntegrationTypeEnumMigration.create_enum_type,
            reverse_code=IntegrationTypeEnumMigration.drop_enum_type,
        ),
        migrations.RunPython(
            partial(register_enum, enum_class=IntegrationTypeEnum),
            reverse_code=migrations.RunPython.noop,
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0014_integrations.py]---
Location: prowler-master/api/src/backend/api/migrations/0014_integrations.py
Signals: Django

```python
# Generated by Django 5.1.5 on 2025-03-03 15:46

import uuid

import django.db.models.deletion
from django.db import migrations, models

import api.db_utils
import api.rls
from api.rls import RowLevelSecurityConstraint


class Migration(migrations.Migration):
    dependencies = [
        ("api", "0013_integrations_enum"),
    ]

    operations = [
        migrations.CreateModel(
            name="Integration",
            fields=[
                (
                    "id",
                    models.UUIDField(
                        default=uuid.uuid4,
                        editable=False,
                        primary_key=True,
                        serialize=False,
                    ),
                ),
                ("inserted_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                ("enabled", models.BooleanField(default=False)),
                ("connected", models.BooleanField(blank=True, null=True)),
                (
                    "connection_last_checked_at",
                    models.DateTimeField(blank=True, null=True),
                ),
                (
                    "integration_type",
                    api.db_utils.IntegrationTypeEnumField(
                        choices=[
                            ("amazon_s3", "Amazon S3"),
                            ("saml", "SAML"),
                            ("aws_security_hub", "AWS Security Hub"),
                            ("jira", "JIRA"),
                            ("slack", "Slack"),
                        ]
                    ),
                ),
                ("configuration", models.JSONField(default=dict)),
                ("_credentials", models.BinaryField(db_column="credentials")),
                (
                    "tenant",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE, to="api.tenant"
                    ),
                ),
            ],
            options={"db_table": "integrations", "abstract": False},
        ),
        migrations.AddConstraint(
            model_name="integration",
            constraint=RowLevelSecurityConstraint(
                "tenant_id",
                name="rls_on_integration",
                statements=["SELECT", "INSERT", "UPDATE", "DELETE"],
            ),
        ),
        migrations.CreateModel(
            name="IntegrationProviderRelationship",
            fields=[
                (
                    "id",
                    models.UUIDField(
                        default=uuid.uuid4,
                        editable=False,
                        primary_key=True,
                        serialize=False,
                    ),
                ),
                ("inserted_at", models.DateTimeField(auto_now_add=True)),
                (
                    "integration",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        to="api.integration",
                    ),
                ),
                (
                    "provider",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE, to="api.provider"
                    ),
                ),
                (
                    "tenant",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE, to="api.tenant"
                    ),
                ),
            ],
            options={
                "db_table": "integration_provider_mappings",
                "constraints": [
                    models.UniqueConstraint(
                        fields=("integration_id", "provider_id"),
                        name="unique_integration_provider_rel",
                    ),
                ],
            },
        ),
        migrations.AddConstraint(
            model_name="IntegrationProviderRelationship",
            constraint=RowLevelSecurityConstraint(
                "tenant_id",
                name="rls_on_integrationproviderrelationship",
                statements=["SELECT", "INSERT", "UPDATE", "DELETE"],
            ),
        ),
        migrations.AddField(
            model_name="integration",
            name="providers",
            field=models.ManyToManyField(
                blank=True,
                related_name="integrations",
                through="api.IntegrationProviderRelationship",
                to="api.provider",
            ),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0015_finding_muted.py]---
Location: prowler-master/api/src/backend/api/migrations/0015_finding_muted.py
Signals: Django

```python
# Generated by Django 5.1.5 on 2025-03-25 11:29

from django.db import migrations, models

import api.db_utils


class Migration(migrations.Migration):
    dependencies = [
        ("api", "0014_integrations"),
    ]

    operations = [
        migrations.AddField(
            model_name="finding",
            name="muted",
            field=models.BooleanField(default=False),
        ),
        migrations.AlterField(
            model_name="finding",
            name="status",
            field=api.db_utils.StatusEnumField(
                choices=[("FAIL", "Fail"), ("PASS", "Pass"), ("MANUAL", "Manual")]
            ),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0016_finding_compliance_resource_details_and_more.py]---
Location: prowler-master/api/src/backend/api/migrations/0016_finding_compliance_resource_details_and_more.py
Signals: Django

```python
# Generated by Django 5.1.5 on 2025-03-31 10:46

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("api", "0015_finding_muted"),
    ]

    operations = [
        migrations.AddField(
            model_name="finding",
            name="compliance",
            field=models.JSONField(blank=True, default=dict, null=True),
        ),
        migrations.AddField(
            model_name="resource",
            name="details",
            field=models.TextField(blank=True, null=True),
        ),
        migrations.AddField(
            model_name="resource",
            name="metadata",
            field=models.TextField(blank=True, null=True),
        ),
        migrations.AddField(
            model_name="resource",
            name="partition",
            field=models.TextField(blank=True, null=True),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0017_m365_provider.py]---
Location: prowler-master/api/src/backend/api/migrations/0017_m365_provider.py
Signals: Django

```python
# Generated by Django 5.1.7 on 2025-04-16 08:47

from django.db import migrations

import api.db_utils


class Migration(migrations.Migration):
    dependencies = [
        ("api", "0016_finding_compliance_resource_details_and_more"),
    ]

    operations = [
        migrations.AlterField(
            model_name="provider",
            name="provider",
            field=api.db_utils.ProviderEnumField(
                choices=[
                    ("aws", "AWS"),
                    ("azure", "Azure"),
                    ("gcp", "GCP"),
                    ("kubernetes", "Kubernetes"),
                    ("m365", "M365"),
                ],
                default="aws",
            ),
        ),
        migrations.RunSQL(
            "ALTER TYPE provider ADD VALUE IF NOT EXISTS 'm365';",
            reverse_sql=migrations.RunSQL.noop,
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0018_resource_scan_summaries.py]---
Location: prowler-master/api/src/backend/api/migrations/0018_resource_scan_summaries.py
Signals: Django

```python
# Generated by Django 5.1.7 on 2025-05-05 10:01

import uuid

import django.db.models.deletion
import uuid6
from django.db import migrations, models

import api.rls


class Migration(migrations.Migration):
    dependencies = [
        ("api", "0017_m365_provider"),
    ]

    operations = [
        migrations.CreateModel(
            name="ResourceScanSummary",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                ("scan_id", models.UUIDField(db_index=True, default=uuid6.uuid7)),
                ("resource_id", models.UUIDField(db_index=True, default=uuid.uuid4)),
                ("service", models.CharField(max_length=100)),
                ("region", models.CharField(max_length=100)),
                ("resource_type", models.CharField(max_length=100)),
                (
                    "tenant",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE, to="api.tenant"
                    ),
                ),
            ],
            options={
                "db_table": "resource_scan_summaries",
                "indexes": [
                    models.Index(
                        fields=["tenant_id", "scan_id", "service"],
                        name="rss_tenant_scan_svc_idx",
                    ),
                    models.Index(
                        fields=["tenant_id", "scan_id", "region"],
                        name="rss_tenant_scan_reg_idx",
                    ),
                    models.Index(
                        fields=["tenant_id", "scan_id", "resource_type"],
                        name="rss_tenant_scan_type_idx",
                    ),
                    models.Index(
                        fields=["tenant_id", "scan_id", "region", "service"],
                        name="rss_tenant_scan_reg_svc_idx",
                    ),
                    models.Index(
                        fields=["tenant_id", "scan_id", "service", "resource_type"],
                        name="rss_tenant_scan_svc_type_idx",
                    ),
                    models.Index(
                        fields=["tenant_id", "scan_id", "region", "resource_type"],
                        name="rss_tenant_scan_reg_type_idx",
                    ),
                ],
                "unique_together": {("tenant_id", "scan_id", "resource_id")},
            },
        ),
        migrations.AddConstraint(
            model_name="resourcescansummary",
            constraint=api.rls.RowLevelSecurityConstraint(
                "tenant_id",
                name="rls_on_resourcescansummary",
                statements=["SELECT", "INSERT", "UPDATE", "DELETE"],
            ),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0019_finding_denormalize_resource_fields.py]---
Location: prowler-master/api/src/backend/api/migrations/0019_finding_denormalize_resource_fields.py
Signals: Django

```python
import django.contrib.postgres.fields
import django.contrib.postgres.indexes
from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("api", "0018_resource_scan_summaries"),
    ]

    operations = [
        migrations.AddField(
            model_name="finding",
            name="resource_regions",
            field=django.contrib.postgres.fields.ArrayField(
                base_field=models.CharField(max_length=100),
                blank=True,
                null=True,
                size=None,
            ),
        ),
        migrations.AddField(
            model_name="finding",
            name="resource_services",
            field=django.contrib.postgres.fields.ArrayField(
                base_field=models.CharField(max_length=100),
                blank=True,
                null=True,
                size=None,
            ),
        ),
        migrations.AddField(
            model_name="finding",
            name="resource_types",
            field=django.contrib.postgres.fields.ArrayField(
                base_field=models.CharField(max_length=100),
                blank=True,
                null=True,
                size=None,
            ),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0020_findings_new_performance_indexes_partitions.py]---
Location: prowler-master/api/src/backend/api/migrations/0020_findings_new_performance_indexes_partitions.py
Signals: Django

```python
from functools import partial

from django.db import migrations

from api.db_utils import create_index_on_partitions, drop_index_on_partitions


class Migration(migrations.Migration):
    atomic = False

    dependencies = [
        ("api", "0019_finding_denormalize_resource_fields"),
    ]

    operations = [
        migrations.RunPython(
            partial(
                create_index_on_partitions,
                parent_table="findings",
                index_name="gin_find_service_idx",
                columns="resource_services",
                method="GIN",
            ),
            reverse_code=partial(
                drop_index_on_partitions,
                parent_table="findings",
                index_name="gin_find_service_idx",
            ),
        ),
        migrations.RunPython(
            partial(
                create_index_on_partitions,
                parent_table="findings",
                index_name="gin_find_region_idx",
                columns="resource_regions",
                method="GIN",
            ),
            reverse_code=partial(
                drop_index_on_partitions,
                parent_table="findings",
                index_name="gin_find_region_idx",
            ),
        ),
        migrations.RunPython(
            partial(
                create_index_on_partitions,
                parent_table="findings",
                index_name="gin_find_rtype_idx",
                columns="resource_types",
                method="GIN",
            ),
            reverse_code=partial(
                drop_index_on_partitions,
                parent_table="findings",
                index_name="gin_find_rtype_idx",
            ),
        ),
        migrations.RunPython(
            partial(
                drop_index_on_partitions,
                parent_table="findings",
                index_name="findings_uid_idx",
            ),
            reverse_code=partial(
                create_index_on_partitions,
                parent_table="findings",
                index_name="findings_uid_idx",
                columns="uid",
                method="BTREE",
            ),
        ),
        migrations.RunPython(
            partial(
                drop_index_on_partitions,
                parent_table="findings",
                index_name="findings_filter_idx",
            ),
            reverse_code=partial(
                create_index_on_partitions,
                parent_table="findings",
                index_name="findings_filter_idx",
                columns="scan_id, impact, severity, status, check_id, delta",
                method="BTREE",
            ),
        ),
    ]
```

--------------------------------------------------------------------------------

````
