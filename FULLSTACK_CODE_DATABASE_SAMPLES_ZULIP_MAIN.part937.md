---
source_txt: fullstack_samples/zulip-main
converted_utc: 2025-12-18T13:06:14Z
part: 937
parts_total: 1290
---

# FULLSTACK CODE DATABASE SAMPLES zulip-main

## Verbatim Content (Part 937 of 1290)

````text
================================================================================
FULLSTACK SAMPLES CODE DATABASE (VERBATIM) - zulip-main
================================================================================
Generated: December 18, 2025
Source: fullstack_samples/zulip-main
================================================================================

NOTES:
- This output is verbatim because the source is user-owned.
- Large/binary files may be skipped by size/binary detection limits.

================================================================================

---[FILE: 0136_remove_userprofile_quota.py]---
Location: zulip-main/zerver/migrations/0136_remove_userprofile_quota.py
Signals: Django

```python
# Generated by Django 1.11.6 on 2018-01-24 20:24

from django.db import migrations


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0135_scheduledmessage_delivery_type"),
    ]

    operations = [
        migrations.RemoveField(
            model_name="userprofile",
            name="quota",
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0137_realm_upload_quota_gb.py]---
Location: zulip-main/zerver/migrations/0137_realm_upload_quota_gb.py
Signals: Django

```python
# Generated by Django 1.11.6 on 2018-01-24 20:24

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0136_remove_userprofile_quota"),
    ]

    operations = [
        migrations.AddField(
            model_name="realm",
            name="upload_quota_gb",
            field=models.IntegerField(null=True),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0138_userprofile_realm_name_in_notifications.py]---
Location: zulip-main/zerver/migrations/0138_userprofile_realm_name_in_notifications.py
Signals: Django

```python
# Generated by Django 1.11.6 on 2018-01-21 08:47

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0137_realm_upload_quota_gb"),
    ]

    operations = [
        migrations.AddField(
            model_name="userprofile",
            name="realm_name_in_notifications",
            field=models.BooleanField(default=False),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0139_fill_last_message_id_in_subscription_logs.py]---
Location: zulip-main/zerver/migrations/0139_fill_last_message_id_in_subscription_logs.py
Signals: Django

```python
from django.db import migrations
from django.db.backends.base.schema import BaseDatabaseSchemaEditor
from django.db.migrations.state import StateApps


def backfill_last_message_id(apps: StateApps, schema_editor: BaseDatabaseSchemaEditor) -> None:
    event_type = ["subscription_created", "subscription_deactivated", "subscription_activated"]
    RealmAuditLog = apps.get_model("zerver", "RealmAuditLog")
    subscription_logs = RealmAuditLog.objects.filter(
        event_last_message_id__isnull=True, event_type__in=event_type
    )
    subscription_logs.update(event_last_message_id=-1)


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0138_userprofile_realm_name_in_notifications"),
    ]

    operations = [
        migrations.RunPython(
            backfill_last_message_id, reverse_code=migrations.RunPython.noop, elidable=True
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0140_realm_send_welcome_emails.py]---
Location: zulip-main/zerver/migrations/0140_realm_send_welcome_emails.py
Signals: Django

```python
# Generated by Django 1.11.6 on 2018-02-18 07:02

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0139_fill_last_message_id_in_subscription_logs"),
    ]

    operations = [
        migrations.AddField(
            model_name="realm",
            name="send_welcome_emails",
            field=models.BooleanField(default=True),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0141_change_usergroup_description_to_textfield.py]---
Location: zulip-main/zerver/migrations/0141_change_usergroup_description_to_textfield.py
Signals: Django

```python
# Generated by Django 1.11.6 on 2018-02-28 17:38

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0140_realm_send_welcome_emails"),
    ]

    operations = [
        migrations.AlterField(
            model_name="usergroup",
            name="description",
            field=models.TextField(default=""),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0142_userprofile_translate_emoticons.py]---
Location: zulip-main/zerver/migrations/0142_userprofile_translate_emoticons.py
Signals: Django

```python
# Generated by Django 1.11.6 on 2018-02-19 22:27

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0141_change_usergroup_description_to_textfield"),
    ]

    operations = [
        migrations.AddField(
            model_name="userprofile",
            name="translate_emoticons",
            field=models.BooleanField(default=False),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0143_realm_bot_creation_policy.py]---
Location: zulip-main/zerver/migrations/0143_realm_bot_creation_policy.py
Signals: Django

```python
# Generated by Django 1.11.6 on 2018-03-09 18:00
from django.db import migrations, models
from django.db.backends.base.schema import BaseDatabaseSchemaEditor
from django.db.migrations.state import StateApps

BOT_CREATION_EVERYONE = 1


def set_initial_value_for_bot_creation_policy(
    apps: StateApps, schema_editor: BaseDatabaseSchemaEditor
) -> None:
    Realm = apps.get_model("zerver", "Realm")
    Realm.BOT_CREATION_EVERYONE = 1
    Realm.BOT_CREATION_LIMIT_GENERIC_BOTS = 2
    for realm in Realm.objects.all().iterator():
        if realm.create_generic_bot_by_admins_only:
            realm.bot_creation_policy = Realm.BOT_CREATION_LIMIT_GENERIC_BOTS
        else:
            realm.bot_creation_policy = Realm.BOT_CREATION_EVERYONE
        realm.save(update_fields=["bot_creation_policy"])


def reverse_code(apps: StateApps, schema_editor: BaseDatabaseSchemaEditor) -> None:
    Realm = apps.get_model("zerver", "Realm")
    Realm.BOT_CREATION_EVERYONE = 1
    for realm in Realm.objects.all().iterator():
        if realm.bot_creation_policy == Realm.BOT_CREATION_EVERYONE:
            realm.create_generic_bot_by_admins_only = False
        else:
            realm.create_generic_bot_by_admins_only = True
        realm.save(update_fields=["create_generic_bot_by_admins_only"])


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0142_userprofile_translate_emoticons"),
    ]

    operations = [
        migrations.AddField(
            model_name="realm",
            name="bot_creation_policy",
            field=models.PositiveSmallIntegerField(default=BOT_CREATION_EVERYONE),
        ),
        migrations.RunPython(
            set_initial_value_for_bot_creation_policy, reverse_code=reverse_code, elidable=True
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0144_remove_realm_create_generic_bot_by_admins_only.py]---
Location: zulip-main/zerver/migrations/0144_remove_realm_create_generic_bot_by_admins_only.py
Signals: Django

```python
# Generated by Django 1.11.6 on 2018-03-09 21:21

from django.db import migrations


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0143_realm_bot_creation_policy"),
    ]

    operations = [
        migrations.RemoveField(
            model_name="realm",
            name="create_generic_bot_by_admins_only",
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0145_reactions_realm_emoji_name_to_id.py]---
Location: zulip-main/zerver/migrations/0145_reactions_realm_emoji_name_to_id.py
Signals: Django

```python
from collections import defaultdict
from typing import Any

from django.db import migrations
from django.db.backends.base.schema import BaseDatabaseSchemaEditor
from django.db.migrations.state import StateApps


def realm_emoji_name_to_id(apps: StateApps, schema_editor: BaseDatabaseSchemaEditor) -> None:
    Reaction = apps.get_model("zerver", "Reaction")
    RealmEmoji = apps.get_model("zerver", "RealmEmoji")
    realm_emoji_by_realm_id: dict[int, dict[str, Any]] = defaultdict(dict)
    for realm_emoji in RealmEmoji.objects.all().iterator():
        realm_emoji_by_realm_id[realm_emoji.realm_id][realm_emoji.name] = {
            "id": str(realm_emoji.id),
            "name": realm_emoji.name,
            "deactivated": realm_emoji.deactivated,
        }
    for reaction in Reaction.objects.filter(reaction_type="realm_emoji"):
        realm_id = reaction.user_profile.realm_id
        emoji_name = reaction.emoji_name
        realm_emoji = realm_emoji_by_realm_id.get(realm_id, {}).get(emoji_name)
        if realm_emoji is None:
            # Realm emoji used in this reaction has been deleted so this
            # reaction should also be deleted. We don't need to reverse
            # this step in migration reversal code.
            print(
                f"Reaction for ({emoji_name}, {reaction.message_id}) refers to deleted custom emoji {reaction.user_profile_id}; deleting"
            )
            reaction.delete()
        else:
            reaction.emoji_code = realm_emoji["id"]
            reaction.save()


def reversal(apps: StateApps, schema_editor: BaseDatabaseSchemaEditor) -> None:
    Reaction = apps.get_model("zerver", "Reaction")
    for reaction in Reaction.objects.filter(reaction_type="realm_emoji"):
        reaction.emoji_code = reaction.emoji_name
        reaction.save()


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0144_remove_realm_create_generic_bot_by_admins_only"),
    ]

    operations = [
        migrations.RunPython(realm_emoji_name_to_id, reverse_code=reversal, elidable=True),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0146_userprofile_message_content_in_email_notifications.py]---
Location: zulip-main/zerver/migrations/0146_userprofile_message_content_in_email_notifications.py
Signals: Django

```python
# Generated by Django 1.11.6 on 2017-11-29 12:33

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0145_reactions_realm_emoji_name_to_id"),
    ]

    operations = [
        migrations.AddField(
            model_name="userprofile",
            name="message_content_in_email_notifications",
            field=models.BooleanField(default=True),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0147_realm_disallow_disposable_email_addresses.py]---
Location: zulip-main/zerver/migrations/0147_realm_disallow_disposable_email_addresses.py
Signals: Django

```python
# Generated by Django 1.11.6 on 2018-03-05 19:20

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0146_userprofile_message_content_in_email_notifications"),
    ]

    operations = [
        migrations.AddField(
            model_name="realm",
            name="disallow_disposable_email_addresses",
            field=models.BooleanField(default=True),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0148_max_invites_forget_default.py]---
Location: zulip-main/zerver/migrations/0148_max_invites_forget_default.py
Signals: Django

```python
# Generated by Django 1.11.6 on 2018-02-10 02:59

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0147_realm_disallow_disposable_email_addresses"),
    ]

    operations = [
        migrations.AlterField(
            model_name="realm",
            name="max_invites",
            field=models.IntegerField(null=True, db_column="max_invites"),
        ),
        migrations.RenameField(
            model_name="realm",
            old_name="max_invites",
            new_name="_max_invites",
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0149_realm_emoji_drop_unique_constraint.py]---
Location: zulip-main/zerver/migrations/0149_realm_emoji_drop_unique_constraint.py
Signals: Django

```python
import os
import shutil

import boto3.session
from django.conf import settings
from django.db import migrations, models
from django.db.backends.base.schema import BaseDatabaseSchemaEditor
from django.db.migrations.state import StateApps
from mypy_boto3_s3.type_defs import CopySourceTypeDef
from typing_extensions import override


class Uploader:
    def __init__(self) -> None:
        self.old_orig_image_path_template = "{realm_id}/emoji/{emoji_file_name}.original"
        self.old_path_template = "{realm_id}/emoji/{emoji_file_name}"
        self.new_orig_image_path_template = "{realm_id}/emoji/images/{emoji_file_name}.original"
        self.new_path_template = "{realm_id}/emoji/images/{emoji_file_name}"

    def copy_files(self, src_path: str, dst_path: str) -> None:
        raise NotImplementedError

    def ensure_emoji_images(self, realm_id: int, old_filename: str, new_filename: str) -> None:
        # Copy original image file.
        old_file_path = self.old_orig_image_path_template.format(
            realm_id=realm_id, emoji_file_name=old_filename
        )
        new_file_path = self.new_orig_image_path_template.format(
            realm_id=realm_id, emoji_file_name=new_filename
        )
        self.copy_files(old_file_path, new_file_path)

        # Copy resized image file.
        old_file_path = self.old_path_template.format(
            realm_id=realm_id, emoji_file_name=old_filename
        )
        new_file_path = self.new_path_template.format(
            realm_id=realm_id, emoji_file_name=new_filename
        )
        self.copy_files(old_file_path, new_file_path)


class LocalUploader(Uploader):
    def __init__(self) -> None:
        super().__init__()

    @staticmethod
    def mkdirs(path: str) -> None:
        dirname = os.path.dirname(path)
        if not os.path.isdir(dirname):
            os.makedirs(dirname)

    @override
    def copy_files(self, src_path: str, dst_path: str) -> None:
        assert settings.LOCAL_UPLOADS_DIR is not None
        assert settings.LOCAL_AVATARS_DIR is not None
        assert settings.LOCAL_FILES_DIR is not None
        src_path = os.path.join(settings.LOCAL_AVATARS_DIR, src_path)
        self.mkdirs(src_path)
        dst_path = os.path.join(settings.LOCAL_AVATARS_DIR, dst_path)
        self.mkdirs(dst_path)
        shutil.copyfile(src_path, dst_path)


class S3Uploader(Uploader):
    def __init__(self) -> None:
        super().__init__()
        session = boto3.session.Session(settings.S3_KEY, settings.S3_SECRET_KEY)
        self.bucket_name = settings.S3_AVATAR_BUCKET
        self.bucket = session.resource(
            "s3", region_name=settings.S3_REGION, endpoint_url=settings.S3_ENDPOINT_URL
        ).Bucket(self.bucket_name)

    @override
    def copy_files(self, src_key: str, dst_key: str) -> None:
        source = CopySourceTypeDef(Bucket=self.bucket_name, Key=src_key)
        self.bucket.copy(CopySource=source, Key=dst_key)


def get_uploader() -> Uploader:
    if settings.LOCAL_UPLOADS_DIR is None:
        return S3Uploader()
    return LocalUploader()


def get_emoji_file_name(emoji_file_name: str, new_name: str) -> str:
    _, image_ext = os.path.splitext(emoji_file_name)
    return f"{new_name}{image_ext}"


def migrate_realm_emoji_image_files(
    apps: StateApps, schema_editor: BaseDatabaseSchemaEditor
) -> None:
    RealmEmoji = apps.get_model("zerver", "RealmEmoji")
    uploader = get_uploader()
    for realm_emoji in RealmEmoji.objects.all().iterator():
        old_file_name = realm_emoji.file_name
        new_file_name = get_emoji_file_name(old_file_name, str(realm_emoji.id))
        uploader.ensure_emoji_images(realm_emoji.realm_id, old_file_name, new_file_name)
        realm_emoji.file_name = new_file_name
        realm_emoji.save(update_fields=["file_name"])


def reversal(apps: StateApps, schema_editor: BaseDatabaseSchemaEditor) -> None:
    # Ensures that migration can be re-run in case of a failure.
    RealmEmoji = apps.get_model("zerver", "RealmEmoji")
    for realm_emoji in RealmEmoji.objects.all().iterator():
        corrupt_file_name = realm_emoji.file_name
        correct_file_name = get_emoji_file_name(corrupt_file_name, realm_emoji.name)
        realm_emoji.file_name = correct_file_name
        realm_emoji.save(update_fields=["file_name"])


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0148_max_invites_forget_default"),
    ]

    operations = [
        migrations.AlterUniqueTogether(
            name="realmemoji",
            unique_together=set(),
        ),
        migrations.AlterField(
            model_name="realmemoji",
            name="file_name",
            field=models.TextField(db_index=True, null=True, blank=True),
        ),
        migrations.RunPython(migrate_realm_emoji_image_files, reverse_code=reversal, elidable=True),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0150_realm_allow_community_topic_editing.py]---
Location: zulip-main/zerver/migrations/0150_realm_allow_community_topic_editing.py
Signals: Django

```python
# Generated by Django 1.11.4 on 2017-09-28 22:56

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0149_realm_emoji_drop_unique_constraint"),
    ]

    operations = [
        migrations.AddField(
            model_name="realm",
            name="allow_community_topic_editing",
            field=models.BooleanField(default=False),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0151_last_reminder_default_none.py]---
Location: zulip-main/zerver/migrations/0151_last_reminder_default_none.py
Signals: Django

```python
# Generated by Django 1.11.6 on 2018-03-29 18:47

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0150_realm_allow_community_topic_editing"),
    ]

    operations = [
        migrations.AlterField(
            model_name="userprofile",
            name="last_reminder",
            field=models.DateTimeField(default=None, null=True),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0152_realm_default_twenty_four_hour_time.py]---
Location: zulip-main/zerver/migrations/0152_realm_default_twenty_four_hour_time.py
Signals: Django

```python
# Generated by Django 1.11.6 on 2018-03-30 17:18

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0151_last_reminder_default_none"),
    ]

    operations = [
        migrations.AddField(
            model_name="realm",
            name="default_twenty_four_hour_time",
            field=models.BooleanField(default=False),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0153_remove_int_float_custom_fields.py]---
Location: zulip-main/zerver/migrations/0153_remove_int_float_custom_fields.py
Signals: Django

```python
# Generated by Django 1.11.6 on 2018-04-02 12:42

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0152_realm_default_twenty_four_hour_time"),
    ]

    operations = [
        migrations.AlterField(
            model_name="customprofilefield",
            name="field_type",
            field=models.PositiveSmallIntegerField(
                choices=[(1, "Short text"), (2, "Long text")], default=1
            ),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0154_fix_invalid_bot_owner.py]---
Location: zulip-main/zerver/migrations/0154_fix_invalid_bot_owner.py
Signals: Django

```python
# Generated by Django 1.11.6 on 2018-04-03 01:52

from django.db import migrations
from django.db.backends.base.schema import BaseDatabaseSchemaEditor
from django.db.migrations.state import StateApps


def migrate_fix_invalid_bot_owner_values(
    apps: StateApps, schema_editor: BaseDatabaseSchemaEditor
) -> None:
    """Fixes UserProfile objects that incorrectly had a bot_owner set"""
    UserProfile = apps.get_model("zerver", "UserProfile")
    UserProfile.objects.filter(is_bot=False).exclude(bot_owner=None).update(bot_owner=None)


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0153_remove_int_float_custom_fields"),
    ]

    operations = [
        migrations.RunPython(
            migrate_fix_invalid_bot_owner_values,
            reverse_code=migrations.RunPython.noop,
            elidable=True,
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0155_change_default_realm_description.py]---
Location: zulip-main/zerver/migrations/0155_change_default_realm_description.py
Signals: Django

```python
# Generated by Django 1.11.11 on 2018-04-06 19:17

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0154_fix_invalid_bot_owner"),
    ]

    operations = [
        migrations.AlterField(
            model_name="realm",
            name="description",
            field=models.TextField(default=""),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0156_add_hint_to_profile_field.py]---
Location: zulip-main/zerver/migrations/0156_add_hint_to_profile_field.py
Signals: Django

```python
# Generated by Django 1.11.11 on 2018-04-06 04:10

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0155_change_default_realm_description"),
    ]

    operations = [
        migrations.AddField(
            model_name="customprofilefield",
            name="hint",
            field=models.CharField(default="", max_length=80, null=True),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0157_userprofile_is_guest.py]---
Location: zulip-main/zerver/migrations/0157_userprofile_is_guest.py
Signals: Django

```python
# Generated by Django 1.11.11 on 2018-04-20 19:29

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0156_add_hint_to_profile_field"),
    ]

    operations = [
        migrations.AddField(
            model_name="userprofile",
            name="is_guest",
            field=models.BooleanField(db_index=True, default=False),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0158_realm_video_chat_provider.py]---
Location: zulip-main/zerver/migrations/0158_realm_video_chat_provider.py
Signals: Django

```python
# Generated by Django 1.11.11 on 2018-04-10 14:57

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0157_userprofile_is_guest"),
    ]

    operations = [
        migrations.AddField(
            model_name="realm",
            name="video_chat_provider",
            field=models.CharField(default="Jitsi", max_length=40),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0159_realm_google_hangouts_domain.py]---
Location: zulip-main/zerver/migrations/0159_realm_google_hangouts_domain.py
Signals: Django

```python
# Generated by Django 1.11.11 on 2018-04-23 16:37

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0158_realm_video_chat_provider"),
    ]

    operations = [
        migrations.AddField(
            model_name="realm",
            name="google_hangouts_domain",
            field=models.TextField(default=""),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0160_add_choice_field.py]---
Location: zulip-main/zerver/migrations/0160_add_choice_field.py
Signals: Django

```python
# Generated by Django 1.11.11 on 2018-04-10 04:57

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0159_realm_google_hangouts_domain"),
    ]

    operations = [
        migrations.AddField(
            model_name="customprofilefield",
            name="field_data",
            field=models.TextField(default="", null=True),
        ),
        migrations.AlterField(
            model_name="customprofilefield",
            name="field_type",
            field=models.PositiveSmallIntegerField(
                choices=[(1, "Short text"), (2, "Long text"), (3, "Choice")], default=1
            ),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0161_realm_message_content_delete_limit_seconds.py]---
Location: zulip-main/zerver/migrations/0161_realm_message_content_delete_limit_seconds.py
Signals: Django

```python
# Generated by Django 1.11.11 on 2018-04-24 22:12

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0160_add_choice_field"),
    ]

    operations = [
        migrations.AddField(
            model_name="realm",
            name="message_content_delete_limit_seconds",
            field=models.IntegerField(default=600),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0162_change_default_community_topic_editing.py]---
Location: zulip-main/zerver/migrations/0162_change_default_community_topic_editing.py
Signals: Django

```python
# Generated by Django 1.11.11 on 2018-04-24 09:10

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0161_realm_message_content_delete_limit_seconds"),
    ]

    operations = [
        migrations.AlterField(
            model_name="realm",
            name="allow_community_topic_editing",
            field=models.BooleanField(default=True),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0163_remove_userprofile_default_desktop_notifications.py]---
Location: zulip-main/zerver/migrations/0163_remove_userprofile_default_desktop_notifications.py
Signals: Django

```python
# Generated by Django 1.11.11 on 2018-04-28 20:34

from django.db import migrations


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0162_change_default_community_topic_editing"),
    ]

    operations = [
        migrations.RemoveField(
            model_name="userprofile",
            name="default_desktop_notifications",
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0164_stream_history_public_to_subscribers.py]---
Location: zulip-main/zerver/migrations/0164_stream_history_public_to_subscribers.py
Signals: Django

```python
# Generated by Django 1.11.11 on 2018-04-28 22:31

from django.conf import settings
from django.db import migrations, models
from django.db.backends.base.schema import BaseDatabaseSchemaEditor
from django.db.migrations.state import StateApps


def set_initial_value_for_history_public_to_subscribers(
    apps: StateApps, schema_editor: BaseDatabaseSchemaEditor
) -> None:
    stream_model = apps.get_model("zerver", "Stream")
    streams = stream_model.objects.all()

    for stream in streams:
        if stream.invite_only:
            stream.history_public_to_subscribers = getattr(
                settings, "PRIVATE_STREAM_HISTORY_FOR_SUBSCRIBERS", False
            )
        else:
            stream.history_public_to_subscribers = True

        if stream.is_in_zephyr_realm:
            stream.history_public_to_subscribers = False

        stream.save(update_fields=["history_public_to_subscribers"])


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0163_remove_userprofile_default_desktop_notifications"),
    ]

    operations = [
        migrations.AddField(
            model_name="stream",
            name="history_public_to_subscribers",
            field=models.BooleanField(default=False),
        ),
        migrations.RunPython(
            set_initial_value_for_history_public_to_subscribers,
            reverse_code=migrations.RunPython.noop,
            elidable=True,
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0165_add_date_to_profile_field.py]---
Location: zulip-main/zerver/migrations/0165_add_date_to_profile_field.py
Signals: Django

```python
# Generated by Django 1.11.11 on 2018-04-29 17:24

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0164_stream_history_public_to_subscribers"),
    ]

    operations = [
        migrations.AlterField(
            model_name="customprofilefield",
            name="field_type",
            field=models.PositiveSmallIntegerField(
                choices=[(1, "Short text"), (2, "Long text"), (4, "Date"), (3, "Choice")], default=1
            ),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0166_add_url_to_profile_field.py]---
Location: zulip-main/zerver/migrations/0166_add_url_to_profile_field.py
Signals: Django

```python
# Generated by Django 1.11.11 on 2018-04-29 17:25

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0165_add_date_to_profile_field"),
    ]

    operations = [
        migrations.AlterField(
            model_name="customprofilefield",
            name="field_type",
            field=models.PositiveSmallIntegerField(
                choices=[
                    (1, "Short text"),
                    (2, "Long text"),
                    (4, "Date"),
                    (5, "URL"),
                    (3, "Choice"),
                ],
                default=1,
            ),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0167_custom_profile_fields_sort_order.py]---
Location: zulip-main/zerver/migrations/0167_custom_profile_fields_sort_order.py
Signals: Django

```python
# Generated by Django 1.11.11 on 2018-04-08 15:49

from django.db import migrations, models
from django.db.backends.base.schema import BaseDatabaseSchemaEditor
from django.db.migrations.state import StateApps
from django.db.models import F


def migrate_set_order_value(apps: StateApps, schema_editor: BaseDatabaseSchemaEditor) -> None:
    CustomProfileField = apps.get_model("zerver", "CustomProfileField")
    CustomProfileField.objects.all().update(order=F("id"))


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0166_add_url_to_profile_field"),
    ]

    operations = [
        migrations.AddField(
            model_name="customprofilefield",
            name="order",
            field=models.IntegerField(default=0),
        ),
        migrations.RunPython(
            migrate_set_order_value, reverse_code=migrations.RunPython.noop, elidable=True
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0168_stream_is_web_public.py]---
Location: zulip-main/zerver/migrations/0168_stream_is_web_public.py
Signals: Django

```python
# Generated by Django 1.11.11 on 2018-04-27 08:03

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0167_custom_profile_fields_sort_order"),
    ]

    operations = [
        migrations.AddField(
            model_name="stream",
            name="is_web_public",
            field=models.BooleanField(default=False),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0169_stream_is_announcement_only.py]---
Location: zulip-main/zerver/migrations/0169_stream_is_announcement_only.py
Signals: Django

```python
# Generated by Django 1.11.6 on 2018-05-12 04:57

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0168_stream_is_web_public"),
    ]

    operations = [
        migrations.AddField(
            model_name="stream",
            name="is_announcement_only",
            field=models.BooleanField(default=False),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0170_submessage.py]---
Location: zulip-main/zerver/migrations/0170_submessage.py
Signals: Django

```python
# Generated by Django 1.11.6 on 2018-01-26 21:54

import django.db.models.deletion
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0169_stream_is_announcement_only"),
    ]

    operations = [
        migrations.CreateModel(
            name="SubMessage",
            fields=[
                (
                    "id",
                    models.AutoField(
                        auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
                    ),
                ),
                ("msg_type", models.TextField()),
                ("content", models.TextField()),
                (
                    "message",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE, to="zerver.Message"
                    ),
                ),
                (
                    "sender",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL
                    ),
                ),
            ],
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0171_userprofile_dense_mode.py]---
Location: zulip-main/zerver/migrations/0171_userprofile_dense_mode.py
Signals: Django

```python
# Generated by Django 1.11.11 on 2018-05-24 18:45

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0170_submessage"),
    ]

    operations = [
        migrations.AddField(
            model_name="userprofile",
            name="dense_mode",
            field=models.BooleanField(default=True),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0172_add_user_type_of_custom_profile_field.py]---
Location: zulip-main/zerver/migrations/0172_add_user_type_of_custom_profile_field.py
Signals: Django

```python
# Generated by Django 1.11.11 on 2018-05-08 17:24

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0171_userprofile_dense_mode"),
    ]

    operations = [
        migrations.AlterField(
            model_name="customprofilefield",
            name="field_type",
            field=models.PositiveSmallIntegerField(
                choices=[
                    (1, "Short text"),
                    (2, "Long text"),
                    (4, "Date"),
                    (5, "URL"),
                    (3, "Choice"),
                    (6, "User"),
                ],
                default=1,
            ),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0173_support_seat_based_plans.py]---
Location: zulip-main/zerver/migrations/0173_support_seat_based_plans.py
Signals: Django

```python
# Generated by Django 1.11.13 on 2018-06-28 01:09

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0172_add_user_type_of_custom_profile_field"),
    ]

    operations = [
        migrations.AddField(
            model_name="realm",
            name="has_seat_based_plan",
            field=models.BooleanField(default=False),
        ),
        migrations.AddField(
            model_name="realmauditlog",
            name="requires_billing_update",
            field=models.BooleanField(default=False),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0174_userprofile_delivery_email.py]---
Location: zulip-main/zerver/migrations/0174_userprofile_delivery_email.py
Signals: Django

```python
# Generated by Django 1.11.13 on 2018-07-05 17:57

from django.db import migrations, models
from django.db.backends.base.schema import BaseDatabaseSchemaEditor
from django.db.migrations.state import StateApps
from django.db.models import F


def copy_email_field(apps: StateApps, schema_editor: BaseDatabaseSchemaEditor) -> None:
    UserProfile = apps.get_model("zerver", "UserProfile")
    UserProfile.objects.all().update(delivery_email=F("email"))


class Migration(migrations.Migration):
    atomic = False

    dependencies = [
        ("zerver", "0173_support_seat_based_plans"),
    ]

    operations = [
        migrations.AddField(
            model_name="userprofile",
            name="delivery_email",
            field=models.EmailField(db_index=True, default="", max_length=254),
            preserve_default=False,
        ),
        migrations.RunPython(
            copy_email_field, reverse_code=migrations.RunPython.noop, elidable=True
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0175_change_realm_audit_log_event_type_tense.py]---
Location: zulip-main/zerver/migrations/0175_change_realm_audit_log_event_type_tense.py
Signals: Django

```python
from django.db import migrations
from django.db.backends.base.schema import BaseDatabaseSchemaEditor
from django.db.migrations.state import StateApps


def change_realm_audit_log_event_type_tense(
    apps: StateApps, schema_editor: BaseDatabaseSchemaEditor
) -> None:
    RealmAuditLog = apps.get_model("zerver", "RealmAuditLog")
    RealmAuditLog.objects.filter(event_type="user_change_password").update(
        event_type="user_password_changed"
    )
    RealmAuditLog.objects.filter(event_type="user_change_avatar_source").update(
        event_type="user_avatar_source_changed"
    )
    RealmAuditLog.objects.filter(event_type="bot_owner_changed").update(
        event_type="user_bot_owner_changed"
    )


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0174_userprofile_delivery_email"),
    ]

    operations = [
        migrations.RunPython(
            change_realm_audit_log_event_type_tense,
            reverse_code=migrations.RunPython.noop,
            elidable=True,
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0176_remove_subscription_notifications.py]---
Location: zulip-main/zerver/migrations/0176_remove_subscription_notifications.py
Signals: Django

```python
# Generated by Django 1.11.13 on 2018-07-26 18:38

from django.db import migrations


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0175_change_realm_audit_log_event_type_tense"),
    ]

    operations = [
        migrations.RemoveField(
            model_name="subscription",
            name="notifications",
        ),
    ]
```

--------------------------------------------------------------------------------

````
