---
source_txt: fullstack_samples/payload-main
converted_utc: 2025-12-18T13:05:13Z
part: 358
parts_total: 695
---

# FULLSTACK CODE DATABASE SAMPLES payload-main

## Verbatim Content (Part 358 of 695)

````text
================================================================================
FULLSTACK SAMPLES CODE DATABASE (VERBATIM) - payload-main
================================================================================
Generated: December 18, 2025
Source: fullstack_samples/payload-main
================================================================================

NOTES:
- This output is verbatim because the source is user-owned.
- Large/binary files may be skipped by size/binary detection limits.

================================================================================

---[FILE: payload-logo-dark.svg]---
Location: payload-main/packages/ui/src/assets/payload-logo-dark.svg

```text
<svg id="b" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 193.38 43.5"><g id="c"><path d="M18.01,35.63l-12.36-7.13c-.15-.09-.25-.25-.25-.43v-11.02c0-.19.21-.31.37-.22l14.35,8.28c.2.12.45-.03.45-.26v-5.37c0-.21-.11-.41-.3-.52L3.01,9c-.15-.09-.35-.09-.5,0l-2.26,1.31c-.15.09-.25.25-.25.43v20.47c0,.18.1.34.25.43l17.73,10.24c.15.09.35.09.5,0l14.89-8.6c.2-.12.2-.4,0-.52l-4.64-2.68c-.19-.11-.41-.11-.6,0l-9.61,5.55c-.15.09-.35.09-.5,0Z"/><path d="M36.21,10.3L18.48.07c-.15-.09-.35-.09-.5,0l-9.37,5.41c-.2.12-.2.4,0,.52l4.6,2.66c.19.11.41.11.6,0l4.2-2.42c.15-.09.35-.09.5,0l12.36,7.13c.15.09.25.25.25.43v11.07c0,.21.11.41.3.52l4.6,2.65c.2.12.45-.03.45-.26V10.74c0-.18-.1-.34-.25-.43Z"/><g id="d"><path d="M193.38,9.47c0,1.94-1.48,3.32-3.3,3.32s-3.31-1.39-3.31-3.32,1.49-3.31,3.31-3.31,3.3,1.39,3.3,3.31ZM192.92,9.47c0-1.68-1.26-2.88-2.84-2.88s-2.84,1.2-2.84,2.88,1.26,2.89,2.84,2.89,2.84-1.2,2.84-2.89ZM188.69,11.17v-3.51h1.61c.85,0,1.35.39,1.35,1.15,0,.53-.3.86-.67,1.02l.79,1.35h-.89l-.72-1.22h-.64v1.22h-.82ZM190.18,9.31c.46,0,.64-.16.64-.5s-.19-.49-.64-.49h-.67v.99h.67Z"/><path d="M54.72,24.84v10.93h-5.4V6.1h12.26c7.02,0,11.1,3.2,11.1,9.39s-4.07,9.35-11.06,9.35h-6.9,0ZM61.12,20.52c4.07,0,6.11-1.66,6.11-5.03s-2.04-5.03-6.11-5.03h-6.4v10.06h6.4Z"/><path d="M85.94,32.45c-1,2.41-3.66,3.78-7.02,3.78-4.11,0-7.11-2.29-7.11-6.11,0-4.24,3.32-5.98,7.61-6.48l6.32-.71v-1c0-2.58-1.58-3.82-3.99-3.82s-3.74,1.29-3.91,3.24h-5.11c.46-4.53,3.99-7.19,9.18-7.19,5.74,0,9.02,2.7,9.02,8.19v8.15c0,1.95.08,3.58.42,5.28h-5.11c-.21-1.16-.29-2.29-.29-3.32h0ZM85.73,27.58v-1.29l-4.7.54c-2.24.29-3.95.79-3.95,2.99,0,1.66,1.16,2.7,3.28,2.7,2.74,0,5.36-1.62,5.36-4.95h0Z"/><path d="M90.39,14.66h5.4l5.86,15.92h.08l5.57-15.92h5.28l-8.23,21.49c-2,5.28-4.45,7.32-8.89,7.36-.71,0-1.7-.08-2.45-.21v-4.03c.62.13.96.13,1.41.13,2.16,0,3.07-.75,4.2-3.66l-8.23-21.07h0Z"/><path d="M113.46,35.77V6.1h5.32v29.67h-5.32Z"/><path d="M130.79,36.27c-6.23,0-10.68-4.2-10.68-11.05s4.45-11.05,10.68-11.05,10.68,4.24,10.68,11.05-4.45,11.05-10.68,11.05ZM130.79,32.32c3.41,0,5.36-2.66,5.36-7.11s-1.95-7.11-5.36-7.11-5.36,2.7-5.36,7.11,1.91,7.11,5.36,7.11Z"/><path d="M156.19,32.45c-1,2.41-3.66,3.78-7.02,3.78-4.11,0-7.11-2.29-7.11-6.11,0-4.24,3.32-5.98,7.61-6.48l6.32-.71v-1c0-2.58-1.58-3.82-3.99-3.82s-3.74,1.29-3.91,3.24h-5.11c.46-4.53,3.99-7.19,9.19-7.19,5.74,0,9.02,2.7,9.02,8.19v8.15c0,1.95.08,3.58.42,5.28h-5.11c-.21-1.16-.29-2.29-.29-3.32h0ZM155.98,27.58v-1.29l-4.7.54c-2.24.29-3.95.79-3.95,2.99,0,1.66,1.16,2.7,3.28,2.7,2.74,0,5.36-1.62,5.36-4.95h0Z"/><path d="M178.5,32.41c-1.04,2.12-3.58,3.87-6.78,3.87-5.53,0-9.31-4.49-9.31-11.05s3.78-11.05,9.31-11.05c3.28,0,5.69,1.83,6.69,3.95V6.1h5.32v29.67h-5.24v-3.37h0ZM178.55,24.84c0-4.11-1.95-6.78-5.32-6.78s-5.45,2.83-5.45,7.15,2,7.15,5.45,7.15,5.32-2.66,5.32-6.78v-.75h0Z"/></g></g></svg>
```

--------------------------------------------------------------------------------

---[FILE: payload-logo-light.svg]---
Location: payload-main/packages/ui/src/assets/payload-logo-light.svg

```text
<svg id="b" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 193.38 43.5"><g id="c"><path d="M18.01,35.63l-12.36-7.13c-.15-.09-.25-.25-.25-.43v-11.02c0-.19.21-.31.37-.22l14.35,8.28c.2.12.45-.03.45-.26v-5.37c0-.21-.11-.41-.3-.52L3.01,9c-.15-.09-.35-.09-.5,0l-2.26,1.31c-.15.09-.25.25-.25.43v20.47c0,.18.1.34.25.43l17.73,10.24c.15.09.35.09.5,0l14.89-8.6c.2-.12.2-.4,0-.52l-4.64-2.68c-.19-.11-.41-.11-.6,0l-9.61,5.55c-.15.09-.35.09-.5,0Z" fill="#fff"/><path d="M36.21,10.3L18.48.07c-.15-.09-.35-.09-.5,0l-9.37,5.41c-.2.12-.2.4,0,.52l4.6,2.66c.19.11.41.11.6,0l4.2-2.42c.15-.09.35-.09.5,0l12.36,7.13c.15.09.25.25.25.43v11.07c0,.21.11.41.3.52l4.6,2.65c.2.12.45-.03.45-.26V10.74c0-.18-.1-.34-.25-.43Z" fill="#fff"/><g id="d"><path d="M193.38,9.47c0,1.94-1.48,3.32-3.3,3.32s-3.31-1.39-3.31-3.32,1.49-3.31,3.31-3.31,3.3,1.39,3.3,3.31ZM192.92,9.47c0-1.68-1.26-2.88-2.84-2.88s-2.84,1.2-2.84,2.88,1.26,2.89,2.84,2.89,2.84-1.2,2.84-2.89ZM188.69,11.17v-3.51h1.61c.85,0,1.35.39,1.35,1.15,0,.53-.3.86-.67,1.02l.79,1.35h-.89l-.72-1.22h-.64v1.22h-.82ZM190.18,9.31c.46,0,.64-.16.64-.5s-.19-.49-.64-.49h-.67v.99h.67Z" fill="#fff"/><path d="M54.72,24.84v10.93h-5.4V6.1h12.26c7.02,0,11.1,3.2,11.1,9.39s-4.07,9.35-11.06,9.35h-6.9,0ZM61.12,20.52c4.07,0,6.11-1.66,6.11-5.03s-2.04-5.03-6.11-5.03h-6.4v10.06h6.4Z" fill="#fff"/><path d="M85.94,32.45c-1,2.41-3.66,3.78-7.02,3.78-4.11,0-7.11-2.29-7.11-6.11,0-4.24,3.32-5.98,7.61-6.48l6.32-.71v-1c0-2.58-1.58-3.82-3.99-3.82s-3.74,1.29-3.91,3.24h-5.11c.46-4.53,3.99-7.19,9.18-7.19,5.74,0,9.02,2.7,9.02,8.19v8.15c0,1.95.08,3.58.42,5.28h-5.11c-.21-1.16-.29-2.29-.29-3.32h0ZM85.73,27.58v-1.29l-4.7.54c-2.24.29-3.95.79-3.95,2.99,0,1.66,1.16,2.7,3.28,2.7,2.74,0,5.36-1.62,5.36-4.95h0Z" fill="#fff"/><path d="M90.39,14.66h5.4l5.86,15.92h.08l5.57-15.92h5.28l-8.23,21.49c-2,5.28-4.45,7.32-8.89,7.36-.71,0-1.7-.08-2.45-.21v-4.03c.62.13.96.13,1.41.13,2.16,0,3.07-.75,4.2-3.66l-8.23-21.07h0Z" fill="#fff"/><path d="M113.46,35.77V6.1h5.32v29.67h-5.32Z" fill="#fff"/><path d="M130.79,36.27c-6.23,0-10.68-4.2-10.68-11.05s4.45-11.05,10.68-11.05,10.68,4.24,10.68,11.05-4.45,11.05-10.68,11.05ZM130.79,32.32c3.41,0,5.36-2.66,5.36-7.11s-1.95-7.11-5.36-7.11-5.36,2.7-5.36,7.11,1.91,7.11,5.36,7.11Z" fill="#fff"/><path d="M156.19,32.45c-1,2.41-3.66,3.78-7.02,3.78-4.11,0-7.11-2.29-7.11-6.11,0-4.24,3.32-5.98,7.61-6.48l6.32-.71v-1c0-2.58-1.58-3.82-3.99-3.82s-3.74,1.29-3.91,3.24h-5.11c.46-4.53,3.99-7.19,9.19-7.19,5.74,0,9.02,2.7,9.02,8.19v8.15c0,1.95.08,3.58.42,5.28h-5.11c-.21-1.16-.29-2.29-.29-3.32h0ZM155.98,27.58v-1.29l-4.7.54c-2.24.29-3.95.79-3.95,2.99,0,1.66,1.16,2.7,3.28,2.7,2.74,0,5.36-1.62,5.36-4.95h0Z" fill="#fff"/><path d="M178.5,32.41c-1.04,2.12-3.58,3.87-6.78,3.87-5.53,0-9.31-4.49-9.31-11.05s3.78-11.05,9.31-11.05c3.28,0,5.69,1.83,6.69,3.95V6.1h5.32v29.67h-5.24v-3.37h0ZM178.55,24.84c0-4.11-1.95-6.78-5.32-6.78s-5.45,2.83-5.45,7.15,2,7.15,5.45,7.15,5.32-2.66,5.32-6.78v-.75h0Z" fill="#fff"/></g></g></svg>
```

--------------------------------------------------------------------------------

---[FILE: index.scss]---
Location: payload-main/packages/ui/src/elements/AddNewRelation/index.scss

```text
@import '../../scss/styles.scss';

@layer payload-default {
  .relationship-add-new {
    display: flex;
    align-items: stretch;

    .popup__trigger-wrap {
      display: flex;
      align-items: stretch;
      height: 100%;
    }

    &__add-button:not(.relationship-add-new__add-button--unstyled),
    &__add-button:not(.relationship-add-new__add-button--unstyled).doc-drawer__toggler {
      @include formInput;
      margin: 0;
      border-top-left-radius: 0;
      border-bottom-left-radius: 0;
      position: relative;
      height: 100%;
      margin-left: -1px;
      display: flex;
      padding: 0 base(0.5);
      align-items: center;
      display: flex;
      cursor: pointer;
    }

    &__add-button {
      margin: 0;
      border-top-left-radius: 0;
      border-bottom-left-radius: 0;
      position: relative;
      height: 100%;
      margin-left: -1px;
      display: flex;
      padding: 0 base(0.5);
      align-items: center;
      display: flex;
      cursor: pointer;
    }
  }
}
```

--------------------------------------------------------------------------------

---[FILE: index.tsx]---
Location: payload-main/packages/ui/src/elements/AddNewRelation/index.tsx
Signals: React

```typescript
'use client'
import type { ClientCollectionConfig } from 'payload'

import { getTranslation } from '@payloadcms/translations'
import { hasAutosaveEnabled } from 'payload/shared'
import React, { Fragment, useCallback, useEffect, useState } from 'react'

import type { DocumentDrawerContextType } from '../DocumentDrawer/Provider.js'
import type { Props } from './types.js'

import { useRelatedCollections } from '../../hooks/useRelatedCollections.js'
import { PlusIcon } from '../../icons/Plus/index.js'
import { useAuth } from '../../providers/Auth/index.js'
import { useTranslation } from '../../providers/Translation/index.js'
import { Button } from '../Button/index.js'
import { useDocumentDrawer } from '../DocumentDrawer/index.js'
import { Popup } from '../Popup/index.js'
import * as PopupList from '../Popup/PopupButtonList/index.js'
import './index.scss'
import { Tooltip } from '../Tooltip/index.js'

const baseClass = 'relationship-add-new'

export const AddNewRelation: React.FC<Props> = ({
  Button: ButtonFromProps,
  hasMany,
  onChange,
  path,
  relationTo,
  unstyled,
  value,
}) => {
  const relatedCollections = useRelatedCollections(relationTo)
  const { permissions } = useAuth()
  const [show, setShow] = useState(false)
  const [selectedCollection, setSelectedCollection] = useState<string>()

  const relatedToMany = relatedCollections.length > 1

  const [collectionConfig, setCollectionConfig] = useState<ClientCollectionConfig>(() =>
    !relatedToMany ? relatedCollections[0] : undefined,
  )

  const [popupOpen, setPopupOpen] = useState(false)
  const { i18n, t } = useTranslation()
  const [showTooltip, setShowTooltip] = useState(false)

  const [DocumentDrawer, DocumentDrawerToggler, { isDrawerOpen, toggleDrawer }] = useDocumentDrawer(
    {
      collectionSlug: collectionConfig?.slug,
    },
  )

  const onSave: DocumentDrawerContextType['onSave'] = useCallback(
    ({ doc, operation }) => {
      // if autosave is enabled, the operation will be 'update'
      if (
        operation === 'create' ||
        (operation === 'update' && hasAutosaveEnabled(collectionConfig))
      ) {
        // ensure the value is not already in the array
        let isNewValue = false
        if (!value) {
          isNewValue = true
        } else {
          isNewValue = Array.isArray(value)
            ? !value.some((v) => v && v.value === doc.id)
            : value.value !== doc.id
        }

        if (isNewValue) {
          if (hasMany === true) {
            onChange([
              ...(Array.isArray(value) ? value : []),
              {
                relationTo: collectionConfig?.slug,
                value: doc.id,
              },
            ])
          } else {
            onChange({
              relationTo: collectionConfig?.slug,
              value: doc.id,
            })
          }
        }

        setSelectedCollection(undefined)
      }
    },
    [collectionConfig, hasMany, onChange, value],
  )

  const onPopupToggle = useCallback((state) => {
    setPopupOpen(state)
  }, [])

  useEffect(() => {
    if (permissions) {
      if (relatedCollections.length === 1) {
        setShow(permissions.collections[relatedCollections[0]?.slug]?.create)
      } else {
        setShow(
          relatedCollections.some(
            (collection) => permissions.collections[collection?.slug]?.create,
          ),
        )
      }
    }
  }, [permissions, relatedCollections])

  useEffect(() => {
    if (relatedToMany && selectedCollection) {
      setCollectionConfig(
        relatedCollections.find((collection) => collection?.slug === selectedCollection),
      )
    }
  }, [selectedCollection, relatedToMany, relatedCollections])

  useEffect(() => {
    if (relatedToMany && collectionConfig) {
      // the drawer must be rendered on the page before before opening it
      // this is why 'selectedCollection' is different from 'collectionConfig'
      toggleDrawer()
      setSelectedCollection(undefined)
    }
  }, [toggleDrawer, relatedToMany, collectionConfig])

  useEffect(() => {
    if (relatedToMany && !isDrawerOpen) {
      setCollectionConfig(undefined)
    }
  }, [isDrawerOpen, relatedToMany])

  const label = t('fields:addNewLabel', {
    label: getTranslation(relatedCollections[0]?.labels.singular, i18n),
  })

  if (!show) {
    return null
  }

  return (
    <div className={baseClass} id={`${path}-add-new`}>
      {relatedCollections.length === 1 && (
        <Fragment>
          <DocumentDrawerToggler
            className={[
              `${baseClass}__add-button`,
              unstyled && `${baseClass}__add-button--unstyled`,
            ]
              .filter(Boolean)
              .join(' ')}
            onClick={() => {
              setShowTooltip(false)
            }}
            onMouseEnter={() => setShowTooltip(true)}
            onMouseLeave={() => setShowTooltip(false)}
          >
            {ButtonFromProps ? (
              ButtonFromProps
            ) : (
              <Fragment>
                <Tooltip className={`${baseClass}__tooltip`} show={showTooltip}>
                  {label}
                </Tooltip>
                <PlusIcon />
              </Fragment>
            )}
          </DocumentDrawerToggler>
          <DocumentDrawer onSave={onSave} />
        </Fragment>
      )}
      {relatedCollections.length > 1 && (
        <Fragment>
          <Popup
            button={
              ButtonFromProps ? (
                ButtonFromProps
              ) : (
                <Button
                  buttonStyle="none"
                  className={`${baseClass}__add-button`}
                  tooltip={popupOpen ? undefined : t('fields:addNew')}
                >
                  <PlusIcon />
                </Button>
              )
            }
            buttonType="custom"
            horizontalAlign="center"
            onToggleOpen={onPopupToggle}
            render={({ close: closePopup }) => (
              <PopupList.ButtonGroup>
                {relatedCollections.map((relatedCollection) => {
                  if (permissions.collections[relatedCollection?.slug]?.create) {
                    return (
                      <PopupList.Button
                        className={`${baseClass}__relation-button--${relatedCollection?.slug}`}
                        key={relatedCollection?.slug}
                        onClick={() => {
                          closePopup()
                          setSelectedCollection(relatedCollection?.slug)
                        }}
                      >
                        {getTranslation(relatedCollection?.labels?.singular, i18n)}
                      </PopupList.Button>
                    )
                  }

                  return null
                })}
              </PopupList.ButtonGroup>
            )}
            size="medium"
          />
          {collectionConfig && permissions.collections[collectionConfig?.slug]?.create && (
            <DocumentDrawer onSave={onSave} />
          )}
        </Fragment>
      )}
    </div>
  )
}
```

--------------------------------------------------------------------------------

---[FILE: types.ts]---
Location: payload-main/packages/ui/src/elements/AddNewRelation/types.ts

```typescript
import type { ValueWithRelation } from 'payload'

export type Props = {
  readonly Button?: React.ReactNode
  readonly path: string
  readonly relationTo: string | string[]
  readonly unstyled?: boolean
} & SharedRelationshipInputProps

type SharedRelationshipInputProps =
  | {
      readonly hasMany: false
      readonly onChange: (value: ValueWithRelation, modifyForm?: boolean) => void
      readonly value?: null | ValueWithRelation
    }
  | {
      readonly hasMany: true
      readonly onChange: (value: ValueWithRelation[]) => void
      readonly value?: null | ValueWithRelation[]
    }
```

--------------------------------------------------------------------------------

---[FILE: index.scss]---
Location: payload-main/packages/ui/src/elements/AnimateHeight/index.scss

```text
@layer payload-default {
  .rah-static {
    interpolate-size: allow-keywords;
    height: 0;

    &--height-auto {
      height: auto;
    }
  }
}
```

--------------------------------------------------------------------------------

---[FILE: index.tsx]---
Location: payload-main/packages/ui/src/elements/AnimateHeight/index.tsx
Signals: React

```typescript
'use client'
import React, { useEffect, useRef } from 'react'

import { usePatchAnimateHeight } from './usePatchAnimateHeight.js'
import './index.scss'

export const AnimateHeight: React.FC<{
  children: React.ReactNode
  className?: string
  duration?: number
  height?: 'auto' | number
  id?: string
}> = ({ id, children, className, duration = 300, height }) => {
  const [open, setOpen] = React.useState(() => Boolean(height))

  const prevIsOpen = useRef(open)

  const [childrenDisplay, setChildrenDisplay] = React.useState<CSSStyleDeclaration['display']>(
    () => (open ? '' : 'none'),
  )

  const [parentOverflow, setParentOverflow] = React.useState<CSSStyleDeclaration['overflow']>(() =>
    open ? '' : 'hidden',
  )

  const [isAnimating, setIsAnimating] = React.useState(false)

  const containerRef = useRef<HTMLDivElement>(null)
  const contentRef = useRef<HTMLDivElement>(null)

  useEffect(() => {
    let displayTimer: number
    let overflowTimer: number

    const newIsOpen = Boolean(height)
    const hasChanged = prevIsOpen.current !== newIsOpen
    prevIsOpen.current = newIsOpen

    if (hasChanged) {
      setIsAnimating(true)
      setParentOverflow('hidden')

      if (newIsOpen) {
        setChildrenDisplay('')
      } else {
        // `display: none` once closed
        displayTimer = window.setTimeout(() => {
          setChildrenDisplay('none')
        }, duration)
      }

      setOpen(newIsOpen)

      // reset overflow once open
      overflowTimer = window.setTimeout(() => {
        setParentOverflow('')
        setIsAnimating(false)
      }, duration)
    }

    return () => {
      if (displayTimer) {
        clearTimeout(displayTimer)
      }

      if (overflowTimer) {
        clearTimeout(overflowTimer)
      }
    }
  }, [height, duration])

  usePatchAnimateHeight({
    containerRef,
    contentRef,
    duration,
    open,
  })

  return (
    <div
      aria-hidden={!open}
      className={[
        className,
        'rah-static',
        open && height === 'auto' && 'rah-static--height-auto',
        isAnimating && `rah-animating--${open ? 'down' : 'up'}`,
        isAnimating && height === 'auto' && `rah-animating--to-height-auto`,
      ]
        .filter(Boolean)
        .join(' ')}
      id={id}
      ref={containerRef}
      style={{
        overflow: parentOverflow,
        transition: `height ${duration}ms ease`,
      }}
    >
      <div ref={contentRef} {...(childrenDisplay ? { style: { display: childrenDisplay } } : {})}>
        {children}
      </div>
    </div>
  )
}
```

--------------------------------------------------------------------------------

---[FILE: usePatchAnimateHeight.ts]---
Location: payload-main/packages/ui/src/elements/AnimateHeight/usePatchAnimateHeight.ts
Signals: React

```typescript
import { useEffect, useMemo, useRef, useState } from 'react'

export const usePatchAnimateHeight = ({
  containerRef,
  contentRef,
  duration,
  open,
}: {
  containerRef: React.RefObject<HTMLDivElement>
  contentRef: React.RefObject<HTMLDivElement>
  duration: number
  open: boolean
}): { browserSupportsKeywordAnimation: boolean } => {
  const browserSupportsKeywordAnimation = useMemo(
    () =>
      typeof CSS !== 'undefined' && CSS && CSS.supports
        ? CSS.supports('interpolate-size', 'allow-keywords')
        : false,
    [],
  )

  const hasInitialized = useRef(false)
  const previousOpenState = useRef(open)
  const [isAnimating, setIsAnimating] = useState(false)
  const resizeObserverRef = useRef<null | ResizeObserver>(null)

  useEffect(() => {
    const container = containerRef.current
    const content = contentRef.current

    if (!container || !content || browserSupportsKeywordAnimation) {
      return
    }

    const setContainerHeight = (height: string) => {
      container.style.height = height
    }

    const handleTransitionEnd = () => {
      if (container) {
        container.style.transition = ''
        container.style.height = open ? 'auto' : '0px'
        setIsAnimating(false)
      }
    }

    const animate = () => {
      if (!hasInitialized.current && open) {
        // Skip animation on first render
        setContainerHeight('auto')
        setIsAnimating(false)
        return
      }

      hasInitialized.current = true

      if (previousOpenState.current !== open) {
        setContainerHeight(open ? '0px' : `${content.scrollHeight}px`)
      }

      // Trigger reflow
      container.offsetHeight // eslint-disable-line @typescript-eslint/no-unused-expressions

      setIsAnimating(true)
      container.style.transition = `height ${duration}ms ease`
      setContainerHeight(open ? `${content.scrollHeight}px` : '0px')

      const onTransitionEnd = () => {
        handleTransitionEnd()
        container.removeEventListener('transitionend', onTransitionEnd)
      }

      container.addEventListener('transitionend', onTransitionEnd)
    }

    animate()
    previousOpenState.current = open

    // Setup ResizeObserver
    resizeObserverRef.current = new ResizeObserver(() => {
      if (isAnimating) {
        container.style.height = open ? `${content.scrollHeight}px` : '0px'
      }
    })
    resizeObserverRef.current.observe(content)

    return () => {
      if (container) {
        container.style.transition = ''
        container.style.height = ''
      }
      resizeObserverRef.current?.disconnect()
    }
  }, [open, duration, containerRef, contentRef, browserSupportsKeywordAnimation])

  return { browserSupportsKeywordAnimation }
}
```

--------------------------------------------------------------------------------

---[FILE: index.scss]---
Location: payload-main/packages/ui/src/elements/AppHeader/index.scss

```text
@import '../../scss/styles.scss';

@layer payload-default {
  .app-header {
    position: relative;
    width: 100%;
    height: var(--app-header-height);
    z-index: var(--z-modal);

    &__mobile-nav-toggler {
      display: none;
    }

    &__localizer.localizer {
      position: absolute;
      top: 50%;
      right: base(4.5);
      transform: translate3d(0, -50%, 0);
    }

    // place the localizer outside the `overflow: hidden` container so that the popup is visible
    // this means we need to use a placeholder div so that the space is retained in the DOM
    [dir='rtl'] &__localizer {
      right: unset;
      left: base(4.5);
    }

    &__localizer-spacing {
      visibility: hidden;
    }

    &__bg {
      opacity: 0;
      position: absolute;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
    }

    &--show-bg {
      opacity: 1;
    }

    &__content {
      display: flex;
      align-items: center;
      height: 100%;
      padding: 0 var(--gutter-h);
      position: relative;
      flex-grow: 1;
    }

    &__wrapper {
      display: flex;
      gap: calc(var(--base) / 2);
      align-items: center;
      height: 100%;
      flex-grow: 1;
      justify-content: space-between;
      width: 100%;
    }

    &__account {
      position: relative;
      flex-shrink: 0;

      &:focus:not(:focus-visible) {
        opacity: 1;
      }

      // Use a pseudo element for the accessability so that it doesn't take up DOM space
      // Also because the parent element has `overflow: hidden` which would clip an outline
      &:focus-visible {
        outline: none;

        &::after {
          content: '';
          border: var(--accessibility-outline);
          position: absolute;
          top: 0;
          right: 0;
          bottom: 0;
          left: 0;
          pointer-events: none;
        }
      }
    }

    &__controls-wrapper {
      display: flex;
      align-items: center;
      flex: 1;
      min-width: 0;
    }

    &__step-nav-wrapper {
      flex-grow: 0;
      overflow: auto;
      display: flex;
      width: 100%;

      &::-webkit-scrollbar {
        display: none;
      }
    }

    &__actions-wrapper {
      position: relative;
      display: flex;
      align-items: center;
      gap: calc(var(--base) / 2);
      margin-right: var(--base);
    }

    &__gradient-placeholder {
      position: absolute;
      top: 0;
      right: 0;
      width: var(--base);
      height: var(--base);
      background: linear-gradient(to right, transparent, var(--theme-bg));
    }

    &__actions {
      display: flex;
      align-items: center;
      gap: calc(var(--base) / 2);
      flex-shrink: 0;
      max-width: 600px;
      white-space: nowrap;

      &::-webkit-scrollbar {
        display: none;
      }
    }

    &__last-action {
      margin-right: var(--base);
    }

    @include large-break {
      &__actions {
        max-width: 500px;
      }
    }

    @include mid-break {
      &__gradient-placeholder {
        right: var(--base);
      }

      &__actions {
        max-width: 300px;
        margin-right: var(--base);
      }
    }

    @include small-break {
      &__localizer.localizer {
        right: base(2);
      }

      &--nav-open {
        .app-header__localizer {
          display: none;
        }
      }

      &__mobile-nav-toggler {
        display: flex;
        align-items: center;

        &.nav-toggler--is-open {
          opacity: 0.5;
        }
      }

      &__step-header {
        // TODO: overflow the step header instead of hide it
        display: none;
      }

      &__gradient-placeholder {
        right: 0;
      }

      &__actions {
        max-width: 150px;
        margin-right: 0;
      }
    }
  }
}
```

--------------------------------------------------------------------------------

---[FILE: index.tsx]---
Location: payload-main/packages/ui/src/elements/AppHeader/index.tsx
Signals: React

```typescript
'use client'
import { formatAdminURL } from 'payload/shared'
import React, { useEffect, useRef, useState } from 'react'

import { Account } from '../../graphics/Account/index.js'
import { useActions } from '../../providers/Actions/index.js'
import { useConfig } from '../../providers/Config/index.js'
import { useTranslation } from '../../providers/Translation/index.js'
import { Hamburger } from '../Hamburger/index.js'
import { Link } from '../Link/index.js'
import { Localizer } from '../Localizer/index.js'
import { LocalizerLabel } from '../Localizer/LocalizerLabel/index.js'
import { useNav } from '../Nav/context.js'
import { NavToggler } from '../Nav/NavToggler/index.js'
import { RenderCustomComponent } from '../RenderCustomComponent/index.js'
import { StepNav } from '../StepNav/index.js'
import './index.scss'

const baseClass = 'app-header'

type Props = {
  CustomAvatar?: React.ReactNode
  CustomIcon?: React.ReactNode
}
export function AppHeader({ CustomAvatar, CustomIcon }: Props) {
  const { t } = useTranslation()

  const { Actions } = useActions()

  const {
    config: {
      admin: {
        routes: { account: accountRoute },
      },
      localization,
      routes: { admin: adminRoute },
      serverURL,
    },
  } = useConfig()

  const { navOpen } = useNav()

  const customControlsRef = useRef<HTMLDivElement>(null)
  const [isScrollable, setIsScrollable] = useState(false)

  useEffect(() => {
    const checkIsScrollable = () => {
      const el = customControlsRef.current
      if (el) {
        const scrollable = el.scrollWidth > el.clientWidth
        setIsScrollable(scrollable)
      }
    }

    checkIsScrollable()
    window.addEventListener('resize', checkIsScrollable)

    return () => {
      window.removeEventListener('resize', checkIsScrollable)
    }
  }, [Actions])

  const ActionComponents = Actions ? Object.values(Actions) : []

  return (
    <header className={[baseClass, navOpen && `${baseClass}--nav-open`].filter(Boolean).join(' ')}>
      <div className={`${baseClass}__bg`} />
      <div className={`${baseClass}__content`}>
        <div className={`${baseClass}__wrapper`}>
          <NavToggler className={`${baseClass}__mobile-nav-toggler`} tabIndex={-1}>
            <Hamburger />
          </NavToggler>
          <div className={`${baseClass}__controls-wrapper`}>
            <div className={`${baseClass}__step-nav-wrapper`}>
              <StepNav className={`${baseClass}__step-nav`} CustomIcon={CustomIcon} />
            </div>
            <div className={`${baseClass}__actions-wrapper`}>
              <div className={`${baseClass}__actions`} ref={customControlsRef}>
                {ActionComponents.map((Action, i) => (
                  <div
                    className={
                      isScrollable && i === ActionComponents.length - 1
                        ? `${baseClass}__last-action`
                        : ''
                    }
                    key={i}
                  >
                    {Action}
                  </div>
                ))}
              </div>
              {isScrollable && <div className={`${baseClass}__gradient-placeholder`} />}
            </div>
            {localization && (
              <LocalizerLabel ariaLabel="invisible" className={`${baseClass}__localizer-spacing`} />
            )}
            <Link
              aria-label={t('authentication:account')}
              className={`${baseClass}__account`}
              href={formatAdminURL({ adminRoute, path: accountRoute, serverURL })}
              prefetch={false}
              tabIndex={0}
            >
              <RenderCustomComponent CustomComponent={CustomAvatar} Fallback={<Account />} />
            </Link>
          </div>
        </div>
      </div>
      <Localizer className={`${baseClass}__localizer`} />
    </header>
  )
}
```

--------------------------------------------------------------------------------

---[FILE: index.scss]---
Location: payload-main/packages/ui/src/elements/ArrayAction/index.scss

```text
@import '../../scss/styles.scss';

@layer payload-default {
  .array-actions {
    &__button {
      @extend %btn-reset;
      cursor: pointer;
      border-radius: 100px;

      &:hover {
        background: var(--theme-elevation-0);
      }
    }

    &__actions {
      list-style: none;
      margin: 0;
      padding: 0;
    }

    &__action {
      display: flex;
      gap: calc(var(--base) / 2);
      align-items: center;

      svg {
        position: relative;

        .stroke {
          stroke-width: 1px;
        }
      }
    }
  }
}
```

--------------------------------------------------------------------------------

---[FILE: index.tsx]---
Location: payload-main/packages/ui/src/elements/ArrayAction/index.tsx
Signals: React

```typescript
'use client'
import React from 'react'

import { ChevronIcon } from '../../icons/Chevron/index.js'
import { CopyIcon } from '../../icons/Copy/index.js'
import { MoreIcon } from '../../icons/More/index.js'
import { PlusIcon } from '../../icons/Plus/index.js'
import { XIcon } from '../../icons/X/index.js'
import { useTranslation } from '../../providers/Translation/index.js'
import { ClipboardActionLabel } from '../ClipboardAction/ClipboardActionLabel.js'
import './index.scss'
import { Popup, PopupList } from '../Popup/index.js'

const baseClass = 'array-actions'

export type Props = {
  addRow: (current: number, blockType?: string) => Promise<void> | void
  copyRow: (index: number) => void
  duplicateRow: (current: number) => void
  hasMaxRows: boolean
  index: number
  isSortable?: boolean
  moveRow: (from: number, to: number) => void
  pasteRow: (index: number) => void
  removeRow: (index: number) => void
  rowCount: number
}

export const ArrayAction: React.FC<Props> = ({
  addRow,
  copyRow,
  duplicateRow,
  hasMaxRows,
  index,
  isSortable,
  moveRow,
  pasteRow,
  removeRow,
  rowCount,
}) => {
  const { t } = useTranslation()

  return (
    <Popup
      button={<MoreIcon />}
      buttonClassName={`${baseClass}__button`}
      className={baseClass}
      horizontalAlign="center"
      render={({ close }) => {
        return (
          <PopupList.ButtonGroup buttonSize="small">
            {isSortable && index !== 0 && (
              <PopupList.Button
                className={`${baseClass}__action ${baseClass}__move-up`}
                onClick={() => {
                  moveRow(index, index - 1)
                  close()
                }}
              >
                <div className={`${baseClass}__action-chevron`}>
                  <ChevronIcon direction="up" />
                </div>
                {t('general:moveUp')}
              </PopupList.Button>
            )}
            {isSortable && index < rowCount - 1 && (
              <PopupList.Button
                className={`${baseClass}__action`}
                onClick={() => {
                  moveRow(index, index + 1)
                  close()
                }}
              >
                <div className={`${baseClass}__action-chevron`}>
                  <ChevronIcon />
                </div>
                {t('general:moveDown')}
              </PopupList.Button>
            )}
            {!hasMaxRows && (
              <React.Fragment>
                <PopupList.Button
                  className={`${baseClass}__action ${baseClass}__add`}
                  onClick={() => {
                    void addRow(index + 1)
                    close()
                  }}
                >
                  <PlusIcon />
                  {t('general:addBelow')}
                </PopupList.Button>
                <PopupList.Button
                  className={`${baseClass}__action ${baseClass}__duplicate`}
                  onClick={() => {
                    duplicateRow(index)
                    close()
                  }}
                >
                  <CopyIcon />
                  {t('general:duplicate')}
                </PopupList.Button>
              </React.Fragment>
            )}
            <PopupList.Button
              className={`${baseClass}__action ${baseClass}__copy`}
              onClick={() => {
                copyRow(index)
                close()
              }}
            >
              <ClipboardActionLabel isRow />
            </PopupList.Button>
            <PopupList.Button
              className={`${baseClass}__action ${baseClass}__paste`}
              onClick={() => {
                pasteRow(index)
                close()
              }}
            >
              <ClipboardActionLabel isPaste isRow />
            </PopupList.Button>
            <PopupList.Button
              className={`${baseClass}__action ${baseClass}__remove`}
              onClick={() => {
                removeRow(index)
                close()
              }}
            >
              <XIcon />
              {t('general:remove')}
            </PopupList.Button>
          </PopupList.ButtonGroup>
        )
      }}
      size="medium"
    />
  )
}
```

--------------------------------------------------------------------------------

---[FILE: index.scss]---
Location: payload-main/packages/ui/src/elements/Autosave/index.scss

```text
@import '../../scss/styles.scss';

@layer payload-default {
  .autosave {
    white-space: nowrap;
  }
}
```

--------------------------------------------------------------------------------

````
