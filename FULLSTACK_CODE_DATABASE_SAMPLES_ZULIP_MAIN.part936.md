---
source_txt: fullstack_samples/zulip-main
converted_utc: 2025-12-18T13:06:14Z
part: 936
parts_total: 1290
---

# FULLSTACK CODE DATABASE SAMPLES zulip-main

## Verbatim Content (Part 936 of 1290)

````text
================================================================================
FULLSTACK SAMPLES CODE DATABASE (VERBATIM) - zulip-main
================================================================================
Generated: December 18, 2025
Source: fullstack_samples/zulip-main
================================================================================

NOTES:
- This output is verbatim because the source is user-owned.
- Large/binary files may be skipped by size/binary detection limits.

================================================================================

---[FILE: 0100_usermessage_remove_is_me_message.py]---
Location: zulip-main/zerver/migrations/0100_usermessage_remove_is_me_message.py
Signals: Django

```python
# Generated by Django 1.11.4 on 2017-08-27 17:08
import bitfield.models
from django.db import migrations


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0099_index_wildcard_mentioned_user_messages"),
    ]

    operations = [
        migrations.AlterField(
            model_name="archivedusermessage",
            name="flags",
            field=bitfield.models.BitField(
                [
                    "read",
                    "starred",
                    "collapsed",
                    "mentioned",
                    "wildcard_mentioned",
                    "summarize_in_home",
                    "summarize_in_stream",
                    "force_expand",
                    "force_collapse",
                    "has_alert_word",
                    "historical",
                ],
                default=0,
            ),
        ),
        migrations.AlterField(
            model_name="usermessage",
            name="flags",
            field=bitfield.models.BitField(
                [
                    "read",
                    "starred",
                    "collapsed",
                    "mentioned",
                    "wildcard_mentioned",
                    "summarize_in_home",
                    "summarize_in_stream",
                    "force_expand",
                    "force_collapse",
                    "has_alert_word",
                    "historical",
                ],
                default=0,
            ),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0101_muted_topic.py]---
Location: zulip-main/zerver/migrations/0101_muted_topic.py
Signals: Django

```python
# Generated by Django 1.11.4 on 2017-08-30 00:26
import django.db.models.deletion
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0100_usermessage_remove_is_me_message"),
    ]

    operations = [
        migrations.CreateModel(
            name="MutedTopic",
            fields=[
                (
                    "id",
                    models.AutoField(
                        auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
                    ),
                ),
                ("topic_name", models.CharField(max_length=60)),
                (
                    "recipient",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE, to="zerver.Recipient"
                    ),
                ),
                (
                    "stream",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE, to="zerver.Stream"
                    ),
                ),
                (
                    "user_profile",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL
                    ),
                ),
            ],
            bases=(models.Model,),
        ),
        migrations.AlterUniqueTogether(
            name="mutedtopic",
            unique_together={("user_profile", "stream", "topic_name")},
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0102_convert_muted_topic.py]---
Location: zulip-main/zerver/migrations/0102_convert_muted_topic.py
Signals: Django

```python
# Generated by Django 1.11.4 on 2017-08-30 00:26
import orjson
from django.db import connection, migrations
from django.db.backends.base.schema import BaseDatabaseSchemaEditor
from django.db.migrations.state import StateApps
from psycopg2.sql import SQL


def convert_muted_topics(apps: StateApps, schema_editor: BaseDatabaseSchemaEditor) -> None:
    stream_query = SQL(
        """
        SELECT
            zerver_stream.name,
            zerver_stream.realm_id,
            zerver_stream.id,
            zerver_recipient.id
        FROM
            zerver_stream
        INNER JOIN zerver_recipient ON (
            zerver_recipient.type_id = zerver_stream.id AND
            zerver_recipient.type = 2
        )
    """
    )

    stream_dict = {}

    with connection.cursor() as cursor:
        cursor.execute(stream_query)
        rows = cursor.fetchall()
        for stream_name, realm_id, stream_id, recipient_id in rows:
            stream_name = stream_name.lower()
            stream_dict[(stream_name, realm_id)] = (stream_id, recipient_id)

    UserProfile = apps.get_model("zerver", "UserProfile")
    MutedTopic = apps.get_model("zerver", "MutedTopic")

    new_objs = []

    user_query = UserProfile.objects.values(
        "id",
        "realm_id",
        "muted_topics",
    )

    for row in user_query:
        user_profile_id = row["id"]
        realm_id = row["realm_id"]
        muted_topics = row["muted_topics"]

        tups = orjson.loads(muted_topics)
        for stream_name, topic_name in tups:
            stream_name = stream_name.lower()
            val = stream_dict.get((stream_name, realm_id))
            if val is not None:
                stream_id, recipient_id = val
                muted_topic = MutedTopic(
                    user_profile_id=user_profile_id,
                    stream_id=stream_id,
                    recipient_id=recipient_id,
                    topic_name=topic_name,
                )
                new_objs.append(muted_topic)

    with connection.cursor() as cursor:
        cursor.execute("DELETE from zerver_mutedtopic")

    MutedTopic.objects.bulk_create(new_objs)


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0101_muted_topic"),
    ]

    operations = [
        migrations.RunPython(convert_muted_topics, elidable=True),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0103_remove_userprofile_muted_topics.py]---
Location: zulip-main/zerver/migrations/0103_remove_userprofile_muted_topics.py
Signals: Django

```python
# Generated by Django 1.11.4 on 2017-08-31 00:13
from django.db import migrations


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0102_convert_muted_topic"),
    ]

    operations = [
        migrations.RemoveField(
            model_name="userprofile",
            name="muted_topics",
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0104_fix_unreads.py]---
Location: zulip-main/zerver/migrations/0104_fix_unreads.py
Signals: Django

```python
# Generated by Django 1.11.4 on 2017-08-30 00:26
from django.db import migrations
from django.db.backends.base.schema import BaseDatabaseSchemaEditor
from django.db.migrations.state import StateApps

from zerver.lib.fix_unreads import fix


def fix_unreads(apps: StateApps, schema_editor: BaseDatabaseSchemaEditor) -> None:
    UserProfile = apps.get_model("zerver", "UserProfile")
    user_profiles = list(UserProfile.objects.filter(is_bot=False))
    for user_profile in user_profiles:
        fix(user_profile)


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0103_remove_userprofile_muted_topics"),
    ]

    operations = [
        migrations.RunPython(fix_unreads, elidable=True),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0105_userprofile_enable_stream_push_notifications.py]---
Location: zulip-main/zerver/migrations/0105_userprofile_enable_stream_push_notifications.py
Signals: Django

```python
# Generated by Django 1.11.4 on 2017-09-08 17:52
from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0104_fix_unreads"),
    ]

    operations = [
        migrations.AddField(
            model_name="userprofile",
            name="enable_stream_push_notifications",
            field=models.BooleanField(default=False),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0106_subscription_push_notifications.py]---
Location: zulip-main/zerver/migrations/0106_subscription_push_notifications.py
Signals: Django

```python
# Generated by Django 1.11.4 on 2017-09-08 17:52
from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0105_userprofile_enable_stream_push_notifications"),
    ]

    operations = [
        migrations.AddField(
            model_name="subscription",
            name="push_notifications",
            field=models.BooleanField(default=False),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0107_multiuseinvite.py]---
Location: zulip-main/zerver/migrations/0107_multiuseinvite.py
Signals: Django

```python
# Generated by Django 1.11.4 on 2017-09-04 22:48
import django.db.models.deletion
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0106_subscription_push_notifications"),
    ]

    operations = [
        migrations.CreateModel(
            name="MultiuseInvite",
            fields=[
                (
                    "id",
                    models.AutoField(
                        auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
                    ),
                ),
                (
                    "realm",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE, to="zerver.Realm"
                    ),
                ),
                (
                    "referred_by",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL
                    ),
                ),
                ("streams", models.ManyToManyField(to="zerver.Stream")),
            ],
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0108_fix_default_string_id.py]---
Location: zulip-main/zerver/migrations/0108_fix_default_string_id.py
Signals: Django

```python
# Generated by Django 1.11.4 on 2017-08-24 02:39
from django.db import migrations
from django.db.backends.base.schema import BaseDatabaseSchemaEditor
from django.db.migrations.state import StateApps


def fix_realm_string_ids(apps: StateApps, schema_editor: BaseDatabaseSchemaEditor) -> None:
    Realm = apps.get_model("zerver", "Realm")
    if Realm.objects.filter(deactivated=False).count() != 2:
        return

    zulip_realm = Realm.objects.get(string_id="zulip")
    try:
        user_realm = Realm.objects.filter(deactivated=False).exclude(id=zulip_realm.id)[0]
    except Realm.DoesNotExist:
        return

    user_realm.string_id = ""
    user_realm.save()


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0107_multiuseinvite"),
    ]

    operations = [
        migrations.RunPython(
            fix_realm_string_ids, reverse_code=migrations.RunPython.noop, elidable=True
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0109_mark_tutorial_status_finished.py]---
Location: zulip-main/zerver/migrations/0109_mark_tutorial_status_finished.py
Signals: Django

```python
from django.db import migrations
from django.db.backends.base.schema import BaseDatabaseSchemaEditor
from django.db.migrations.state import StateApps


def set_tutorial_status_to_finished(
    apps: StateApps, schema_editor: BaseDatabaseSchemaEditor
) -> None:
    UserProfile = apps.get_model("zerver", "UserProfile")
    UserProfile.objects.update(tutorial_status="F")


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0108_fix_default_string_id"),
    ]

    operations = [
        migrations.RunPython(set_tutorial_status_to_finished, elidable=True),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0110_stream_is_in_zephyr_realm.py]---
Location: zulip-main/zerver/migrations/0110_stream_is_in_zephyr_realm.py
Signals: Django

```python
# Generated by Django 1.11.5 on 2017-10-08 18:37
from django.db import migrations, models
from django.db.backends.base.schema import BaseDatabaseSchemaEditor
from django.db.migrations.state import StateApps


def populate_is_zephyr(apps: StateApps, schema_editor: BaseDatabaseSchemaEditor) -> None:
    Realm = apps.get_model("zerver", "Realm")
    Stream = apps.get_model("zerver", "Stream")

    realms = Realm.objects.filter(
        string_id="zephyr",
    )

    for realm in realms:
        Stream.objects.filter(realm_id=realm.id).update(
            is_in_zephyr_realm=True,
        )


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0109_mark_tutorial_status_finished"),
    ]

    operations = [
        migrations.AddField(
            model_name="stream",
            name="is_in_zephyr_realm",
            field=models.BooleanField(default=False),
        ),
        migrations.RunPython(
            populate_is_zephyr, reverse_code=migrations.RunPython.noop, elidable=True
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0111_botuserstatedata.py]---
Location: zulip-main/zerver/migrations/0111_botuserstatedata.py
Signals: Django

```python
# Generated by Django 1.11.5 on 2017-10-18 16:15

import django.db.models.deletion
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0110_stream_is_in_zephyr_realm"),
    ]

    operations = [
        migrations.CreateModel(
            name="BotUserStateData",
            fields=[
                (
                    "id",
                    models.AutoField(
                        auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
                    ),
                ),
                ("key", models.TextField(db_index=True)),
                ("value", models.TextField()),
                (
                    "bot_profile",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL
                    ),
                ),
            ],
        ),
        migrations.AlterUniqueTogether(
            name="botuserstatedata",
            unique_together={("bot_profile", "key")},
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0112_index_muted_topics.py]---
Location: zulip-main/zerver/migrations/0112_index_muted_topics.py
Signals: Django

```python
from django.db import migrations, models
from django.db.models.functions import Upper


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0111_botuserstatedata"),
    ]

    operations = [
        migrations.AddIndex(
            model_name="mutedtopic",
            index=models.Index(
                "stream", Upper("topic_name"), name="zerver_mutedtopic_stream_topic"
            ),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0113_default_stream_group.py]---
Location: zulip-main/zerver/migrations/0113_default_stream_group.py
Signals: Django

```python
# Generated by Django 1.11.5 on 2017-10-14 15:12

import django.db.models.deletion
from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0112_index_muted_topics"),
    ]

    operations = [
        migrations.CreateModel(
            name="DefaultStreamGroup",
            fields=[
                (
                    "id",
                    models.AutoField(
                        auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
                    ),
                ),
                ("name", models.CharField(db_index=True, max_length=60)),
                (
                    "realm",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE, to="zerver.Realm"
                    ),
                ),
                ("streams", models.ManyToManyField(to="zerver.Stream")),
            ],
        ),
        migrations.AlterUniqueTogether(
            name="defaultstreamgroup",
            unique_together={("realm", "name")},
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0114_preregistrationuser_invited_as_admin.py]---
Location: zulip-main/zerver/migrations/0114_preregistrationuser_invited_as_admin.py
Signals: Django

```python
# Generated by Django 1.11.5 on 2017-10-19 21:42

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0113_default_stream_group"),
    ]

    operations = [
        migrations.AddField(
            model_name="preregistrationuser",
            name="invited_as_admin",
            field=models.BooleanField(default=False),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0115_user_groups.py]---
Location: zulip-main/zerver/migrations/0115_user_groups.py
Signals: Django

```python
# Generated by Django 1.11.6 on 2017-10-30 05:05

import django.db.models.deletion
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0114_preregistrationuser_invited_as_admin"),
    ]

    operations = [
        migrations.CreateModel(
            name="UserGroup",
            fields=[
                (
                    "id",
                    models.AutoField(
                        auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
                    ),
                ),
                ("name", models.CharField(max_length=100)),
            ],
        ),
        migrations.CreateModel(
            name="UserGroupMembership",
            fields=[
                (
                    "id",
                    models.AutoField(
                        auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
                    ),
                ),
                (
                    "user_group",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE, to="zerver.UserGroup"
                    ),
                ),
                (
                    "user_profile",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL
                    ),
                ),
            ],
        ),
        migrations.AddField(
            model_name="usergroup",
            name="members",
            field=models.ManyToManyField(
                through="zerver.UserGroupMembership", to=settings.AUTH_USER_MODEL
            ),
        ),
        migrations.AddField(
            model_name="usergroup",
            name="realm",
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to="zerver.Realm"),
        ),
        migrations.AlterUniqueTogether(
            name="usergroupmembership",
            unique_together={("user_group", "user_profile")},
        ),
        migrations.AlterUniqueTogether(
            name="usergroup",
            unique_together={("realm", "name")},
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0116_realm_allow_message_deleting.py]---
Location: zulip-main/zerver/migrations/0116_realm_allow_message_deleting.py
Signals: Django

```python
# Generated by Django 1.11.5 on 2017-10-28 11:13

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0115_user_groups"),
    ]

    operations = [
        migrations.AddField(
            model_name="realm",
            name="allow_message_deleting",
            field=models.BooleanField(default=False),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0117_add_desc_to_user_group.py]---
Location: zulip-main/zerver/migrations/0117_add_desc_to_user_group.py
Signals: Django

```python
# Generated by Django 1.11.6 on 2017-11-01 08:01

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0116_realm_allow_message_deleting"),
    ]

    operations = [
        migrations.AddField(
            model_name="usergroup",
            name="description",
            field=models.CharField(default="", max_length=1024),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0118_defaultstreamgroup_description.py]---
Location: zulip-main/zerver/migrations/0118_defaultstreamgroup_description.py
Signals: Django

```python
# Generated by Django 1.11.6 on 2017-11-14 19:52

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0117_add_desc_to_user_group"),
    ]

    operations = [
        migrations.AddField(
            model_name="defaultstreamgroup",
            name="description",
            field=models.CharField(default="", max_length=1024),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0119_userprofile_night_mode.py]---
Location: zulip-main/zerver/migrations/0119_userprofile_night_mode.py
Signals: Django

```python
# Generated by Django 1.11.6 on 2017-11-14 19:28

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0118_defaultstreamgroup_description"),
    ]

    operations = [
        migrations.AddField(
            model_name="userprofile",
            name="night_mode",
            field=models.BooleanField(default=False),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0120_botuserconfigdata.py]---
Location: zulip-main/zerver/migrations/0120_botuserconfigdata.py
Signals: Django

```python
# Generated by Django 1.11.6 on 2017-11-01 19:12

import django.db.models.deletion
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0119_userprofile_night_mode"),
    ]

    operations = [
        migrations.CreateModel(
            name="BotUserConfigData",
            fields=[
                (
                    "id",
                    models.AutoField(
                        auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
                    ),
                ),
                ("key", models.TextField(db_index=True)),
                ("value", models.TextField()),
                (
                    "bot_profile",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL
                    ),
                ),
            ],
        ),
        migrations.AlterUniqueTogether(
            name="botuserconfigdata",
            unique_together={("bot_profile", "key")},
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0121_realm_signup_notifications_stream.py]---
Location: zulip-main/zerver/migrations/0121_realm_signup_notifications_stream.py
Signals: Django

```python
# Generated by Django 1.11.5 on 2017-10-19 22:01

import django.db.models.deletion
from django.db import migrations, models
from django.db.backends.base.schema import BaseDatabaseSchemaEditor
from django.db.migrations.state import StateApps


def set_initial_value_for_signup_notifications_stream(
    apps: StateApps, schema_editor: BaseDatabaseSchemaEditor
) -> None:
    realm_model = apps.get_model("zerver", "Realm")
    realms = realm_model.objects.exclude(notifications_stream__isnull=True)
    for realm in realms:
        realm.signup_notifications_stream = realm.notifications_stream
        realm.save(update_fields=["signup_notifications_stream"])


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0120_botuserconfigdata"),
    ]

    operations = [
        migrations.AddField(
            model_name="realm",
            name="signup_notifications_stream",
            field=models.ForeignKey(
                blank=True,
                null=True,
                on_delete=django.db.models.deletion.CASCADE,
                related_name="+",
                to="zerver.Stream",
            ),
        ),
        migrations.RunPython(
            set_initial_value_for_signup_notifications_stream,
            reverse_code=migrations.RunPython.noop,
            elidable=True,
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0122_rename_botuserstatedata_botstoragedata.py]---
Location: zulip-main/zerver/migrations/0122_rename_botuserstatedata_botstoragedata.py
Signals: Django

```python
# Generated by Django 1.11.6 on 2017-11-24 09:10

from django.db import migrations


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0121_realm_signup_notifications_stream"),
    ]

    operations = [
        migrations.RenameModel(
            old_name="BotUserStateData",
            new_name="BotStorageData",
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0123_userprofile_make_realm_email_pair_unique.py]---
Location: zulip-main/zerver/migrations/0123_userprofile_make_realm_email_pair_unique.py
Signals: Django

```python
# Generated by Django 1.11.6 on 2017-11-22 20:45

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0122_rename_botuserstatedata_botstoragedata"),
    ]

    operations = [
        migrations.AlterField(
            model_name="userprofile",
            name="email",
            field=models.EmailField(db_index=True, max_length=254),
        ),
        migrations.AlterUniqueTogether(
            name="userprofile",
            unique_together={("realm", "email")},
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0124_stream_enable_notifications.py]---
Location: zulip-main/zerver/migrations/0124_stream_enable_notifications.py
Signals: Django

```python
# Generated by Django 1.11.6 on 2017-11-29 01:38

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0123_userprofile_make_realm_email_pair_unique"),
    ]

    operations = [
        migrations.AddField(
            model_name="subscription",
            name="email_notifications",
            field=models.BooleanField(default=False),
        ),
        migrations.AddField(
            model_name="userprofile",
            name="enable_stream_email_notifications",
            field=models.BooleanField(default=False),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0125_realm_max_invites.py]---
Location: zulip-main/zerver/migrations/0125_realm_max_invites.py
Signals: Django

```python
# Generated by Django 1.11.6 on 2017-11-30 04:58

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0124_stream_enable_notifications"),
    ]

    operations = [
        migrations.AddField(
            model_name="realm",
            name="max_invites",
            field=models.IntegerField(default=100),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0126_prereg_remove_users_without_realm.py]---
Location: zulip-main/zerver/migrations/0126_prereg_remove_users_without_realm.py
Signals: Django

```python
# Generated by Django 1.11.6 on 2017-11-30 04:58

from django.db import migrations
from django.db.backends.base.schema import BaseDatabaseSchemaEditor
from django.db.migrations.state import StateApps


def remove_prereg_users_without_realm(
    apps: StateApps, schema_editor: BaseDatabaseSchemaEditor
) -> None:
    prereg_model = apps.get_model("zerver", "PreregistrationUser")
    prereg_model.objects.filter(realm=None, realm_creation=False).delete()


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0125_realm_max_invites"),
    ]

    operations = [
        migrations.RunPython(
            remove_prereg_users_without_realm, reverse_code=migrations.RunPython.noop, elidable=True
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0127_disallow_chars_in_stream_and_user_name.py]---
Location: zulip-main/zerver/migrations/0127_disallow_chars_in_stream_and_user_name.py
Signals: Django

```python
from django.db import migrations


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0126_prereg_remove_users_without_realm"),
    ]

    operations = [
        # There was a migration here, which wasn't ready for wide deployment
        # and was backed out.  This placeholder is left behind to avoid
        # confusing the migration engine on any installs that applied the
        # migration.  (Fortunately no reverse migration is needed.)
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0128_scheduledemail_realm.py]---
Location: zulip-main/zerver/migrations/0128_scheduledemail_realm.py
Signals: Django

```python
# Generated by Django 1.11.6 on 2017-12-05 01:08

import django.db.models.deletion
from django.db import migrations, models
from django.db.backends.base.schema import BaseDatabaseSchemaEditor
from django.db.migrations.state import StateApps


def set_realm_for_existing_scheduledemails(
    apps: StateApps, schema_editor: BaseDatabaseSchemaEditor
) -> None:
    scheduledemail_model = apps.get_model("zerver", "ScheduledEmail")
    preregistrationuser_model = apps.get_model("zerver", "PreregistrationUser")
    for scheduledemail in scheduledemail_model.objects.all().iterator():
        if scheduledemail.type == 3:  # ScheduledEmail.INVITATION_REMINDER
            # Don't think this can be None, but just be safe
            prereg = preregistrationuser_model.objects.filter(email=scheduledemail.address).first()
            if prereg is not None:
                scheduledemail.realm = prereg.realm
        else:
            scheduledemail.realm = scheduledemail.user.realm
        scheduledemail.save(update_fields=["realm"])

    # Shouldn't be needed, but just in case
    scheduledemail_model.objects.filter(realm=None).delete()


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0127_disallow_chars_in_stream_and_user_name"),
    ]

    operations = [
        # Start with ScheduledEmail.realm being non-null
        migrations.AddField(
            model_name="scheduledemail",
            name="realm",
            field=models.ForeignKey(
                null=True, on_delete=django.db.models.deletion.CASCADE, to="zerver.Realm"
            ),
        ),
        # Sets realm for existing ScheduledEmails
        migrations.RunPython(
            set_realm_for_existing_scheduledemails,
            reverse_code=migrations.RunPython.noop,
            elidable=True,
        ),
        # Require ScheduledEmail.realm to be non-null
        migrations.AlterField(
            model_name="scheduledemail",
            name="realm",
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to="zerver.Realm"),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0129_remove_userprofile_autoscroll_forever.py]---
Location: zulip-main/zerver/migrations/0129_remove_userprofile_autoscroll_forever.py
Signals: Django

```python
# Generated by Django 1.11.6 on 2017-12-27 17:55

from django.db import migrations


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0128_scheduledemail_realm"),
    ]

    operations = [
        migrations.RemoveField(
            model_name="userprofile",
            name="autoscroll_forever",
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0130_text_choice_in_emojiset.py]---
Location: zulip-main/zerver/migrations/0130_text_choice_in_emojiset.py
Signals: Django

```python
from django.db import migrations, models
from django.db.backends.base.schema import BaseDatabaseSchemaEditor
from django.db.migrations.state import StateApps


# change emoji set to text if emoji_alt_code is true.
def change_emojiset(apps: StateApps, schema_editor: BaseDatabaseSchemaEditor) -> None:
    UserProfile = apps.get_model("zerver", "UserProfile")
    for user in UserProfile.objects.filter(emoji_alt_code=True):
        user.emojiset = "text"
        user.save(update_fields=["emojiset"])


def reverse_change_emojiset(apps: StateApps, schema_editor: BaseDatabaseSchemaEditor) -> None:
    UserProfile = apps.get_model("zerver", "UserProfile")
    for user in UserProfile.objects.filter(emojiset="text"):
        # Resetting `emojiset` to "google" (the default) doesn't make an
        # exact round trip, but it's nearly indistinguishable -- the setting
        # shouldn't really matter while `emoji_alt_code` is true.
        user.emoji_alt_code = True
        user.emojiset = "google"
        user.save(update_fields=["emoji_alt_code", "emojiset"])


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0129_remove_userprofile_autoscroll_forever"),
    ]

    operations = [
        migrations.AlterField(
            model_name="userprofile",
            name="emojiset",
            field=models.CharField(
                choices=[
                    ("google", "Google"),
                    ("apple", "Apple"),
                    ("twitter", "Twitter"),
                    ("emojione", "EmojiOne"),
                    ("text", "Plain text"),
                ],
                default="google",
                max_length=20,
            ),
        ),
        migrations.RunPython(change_emojiset, reverse_change_emojiset, elidable=True),
        migrations.RemoveField(
            model_name="userprofile",
            name="emoji_alt_code",
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0131_realm_create_generic_bot_by_admins_only.py]---
Location: zulip-main/zerver/migrations/0131_realm_create_generic_bot_by_admins_only.py
Signals: Django

```python
# Generated by Django 1.11.6 on 2017-11-30 20:05

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0130_text_choice_in_emojiset"),
    ]

    operations = [
        migrations.AddField(
            model_name="realm",
            name="create_generic_bot_by_admins_only",
            field=models.BooleanField(default=False),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0132_realm_message_visibility_limit.py]---
Location: zulip-main/zerver/migrations/0132_realm_message_visibility_limit.py
Signals: Django

```python
# Generated by Django 1.11.6 on 2018-01-03 18:14

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0131_realm_create_generic_bot_by_admins_only"),
    ]

    operations = [
        migrations.AddField(
            model_name="realm",
            name="message_visibility_limit",
            field=models.IntegerField(null=True),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0133_rename_botuserconfigdata_botconfigdata.py]---
Location: zulip-main/zerver/migrations/0133_rename_botuserconfigdata_botconfigdata.py
Signals: Django

```python
# Generated by Django 1.11.6 on 2018-01-06 09:56

from django.db import migrations


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0132_realm_message_visibility_limit"),
    ]

    operations = [
        migrations.RenameModel(
            old_name="BotUserConfigData",
            new_name="BotConfigData",
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0134_scheduledmessage.py]---
Location: zulip-main/zerver/migrations/0134_scheduledmessage.py
Signals: Django

```python
# Generated by Django 1.11.6 on 2018-01-10 01:11

import django.db.models.deletion
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0133_rename_botuserconfigdata_botconfigdata"),
    ]

    operations = [
        migrations.CreateModel(
            name="ScheduledMessage",
            fields=[
                (
                    "id",
                    models.AutoField(
                        auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
                    ),
                ),
                ("subject", models.CharField(max_length=60)),
                ("content", models.TextField()),
                ("scheduled_timestamp", models.DateTimeField(db_index=True)),
                ("delivered", models.BooleanField(default=False)),
                (
                    "realm",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE, to="zerver.Realm"
                    ),
                ),
                (
                    "recipient",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE, to="zerver.Recipient"
                    ),
                ),
                (
                    "sender",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL
                    ),
                ),
                (
                    "sending_client",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE, to="zerver.Client"
                    ),
                ),
                (
                    "stream",
                    models.ForeignKey(
                        null=True, on_delete=django.db.models.deletion.CASCADE, to="zerver.Stream"
                    ),
                ),
            ],
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0135_scheduledmessage_delivery_type.py]---
Location: zulip-main/zerver/migrations/0135_scheduledmessage_delivery_type.py
Signals: Django

```python
# Generated by Django 1.11.6 on 2018-01-12 10:37

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0134_scheduledmessage"),
    ]

    operations = [
        migrations.AddField(
            model_name="scheduledmessage",
            name="delivery_type",
            field=models.PositiveSmallIntegerField(
                choices=[(1, "send_later"), (2, "remind")], default=1
            ),
        ),
    ]
```

--------------------------------------------------------------------------------

````
