---
source_txt: fullstack_samples/zulip-main
converted_utc: 2025-12-18T13:06:14Z
part: 943
parts_total: 1290
---

# FULLSTACK CODE DATABASE SAMPLES zulip-main

## Verbatim Content (Part 943 of 1290)

````text
================================================================================
FULLSTACK SAMPLES CODE DATABASE (VERBATIM) - zulip-main
================================================================================
Generated: December 18, 2025
Source: fullstack_samples/zulip-main
================================================================================

NOTES:
- This output is verbatim because the source is user-owned.
- Large/binary files may be skipped by size/binary detection limits.

================================================================================

---[FILE: 0321_userprofile_enable_marketing_emails.py]---
Location: zulip-main/zerver/migrations/0321_userprofile_enable_marketing_emails.py
Signals: Django

```python
# Generated by Django 3.1.8 on 2021-04-27 22:00

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0320_realm_move_messages_between_streams_policy"),
    ]

    operations = [
        migrations.AddField(
            model_name="userprofile",
            name="enable_marketing_emails",
            field=models.BooleanField(default=True),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0322_realm_create_audit_log_backfill.py]---
Location: zulip-main/zerver/migrations/0322_realm_create_audit_log_backfill.py
Signals: Django

```python
# Generated by Django 3.1.8 on 2021-04-20 10:09

from django.db import migrations
from django.db.backends.base.schema import BaseDatabaseSchemaEditor
from django.db.migrations.state import StateApps


def backfill_realm_creation_log_events(
    apps: StateApps, schema_editor: BaseDatabaseSchemaEditor
) -> None:
    RealmAuditLog = apps.get_model("zerver", "RealmAuditLog")
    RealmAuditLog.REALM_CREATED = 215

    Realm = apps.get_model("zerver", "Realm")

    objects_to_create = []
    for realm in Realm.objects.all().iterator():
        entry = RealmAuditLog(
            realm=realm,
            event_type=RealmAuditLog.REALM_CREATED,
            event_time=realm.date_created,
            backfilled=True,
        )
        objects_to_create.append(entry)
    RealmAuditLog.objects.bulk_create(objects_to_create)


def reverse_code(apps: StateApps, schema_editor: BaseDatabaseSchemaEditor) -> None:
    RealmAuditLog = apps.get_model("zerver", "RealmAuditLog")
    RealmAuditLog.REALM_CREATED = 215
    RealmAuditLog.objects.filter(event_type=RealmAuditLog.REALM_CREATED, backfilled=True).delete()


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0321_userprofile_enable_marketing_emails"),
    ]

    operations = [
        migrations.RunPython(
            backfill_realm_creation_log_events, reverse_code=reverse_code, elidable=True
        )
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0323_show_starred_message_counts.py]---
Location: zulip-main/zerver/migrations/0323_show_starred_message_counts.py
Signals: Django

```python
# Generated by Django 3.1.8 on 2021-05-01 12:34

from django.db import migrations, models
from django.db.backends.base.schema import BaseDatabaseSchemaEditor
from django.db.migrations.state import StateApps


# Set starred_message_count for already existing users to True.
def set_starred_message_count_to_true(
    apps: StateApps, schema_editor: BaseDatabaseSchemaEditor
) -> None:
    UserProfile = apps.get_model("zerver", "UserProfile")
    UserProfile.objects.filter(starred_message_counts=False).update(starred_message_counts=True)


class Migration(migrations.Migration):
    atomic = False

    dependencies = [
        ("zerver", "0322_realm_create_audit_log_backfill"),
    ]

    operations = [
        migrations.AlterField(
            model_name="userprofile",
            name="starred_message_counts",
            field=models.BooleanField(default=True),
        ),
        migrations.RunPython(
            set_starred_message_count_to_true,
            reverse_code=migrations.RunPython.noop,
            elidable=True,
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0324_fix_deletion_cascade_behavior.py]---
Location: zulip-main/zerver/migrations/0324_fix_deletion_cascade_behavior.py
Signals: Django

```python
# Generated by Django 3.2 on 2021-05-07 01:00

import django.db.models.deletion
from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0323_show_starred_message_counts"),
    ]

    operations = [
        migrations.AlterField(
            model_name="realm",
            name="notifications_stream",
            field=models.ForeignKey(
                blank=True,
                null=True,
                on_delete=django.db.models.deletion.SET_NULL,
                related_name="+",
                to="zerver.stream",
            ),
        ),
        migrations.AlterField(
            model_name="realm",
            name="signup_notifications_stream",
            field=models.ForeignKey(
                blank=True,
                null=True,
                on_delete=django.db.models.deletion.SET_NULL,
                related_name="+",
                to="zerver.stream",
            ),
        ),
        migrations.AlterField(
            model_name="userprofile",
            name="default_events_register_stream",
            field=models.ForeignKey(
                null=True,
                on_delete=django.db.models.deletion.SET_NULL,
                related_name="+",
                to="zerver.stream",
            ),
        ),
        migrations.AlterField(
            model_name="userprofile",
            name="default_sending_stream",
            field=models.ForeignKey(
                null=True,
                on_delete=django.db.models.deletion.SET_NULL,
                related_name="+",
                to="zerver.stream",
            ),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0325_alter_realmplayground_unique_together.py]---
Location: zulip-main/zerver/migrations/0325_alter_realmplayground_unique_together.py
Signals: Django

```python
# Generated by Django 3.2.2 on 2021-05-13 00:16

from django.db import migrations


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0324_fix_deletion_cascade_behavior"),
    ]

    operations = [
        migrations.AlterUniqueTogether(
            name="realmplayground",
            unique_together={("realm", "pygments_language", "name")},
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0326_alter_realm_authentication_methods.py]---
Location: zulip-main/zerver/migrations/0326_alter_realm_authentication_methods.py
Signals: Django

```python
# Generated by Django 3.2.2 on 2021-05-19 11:53

import bitfield.models
from django.db import migrations


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0325_alter_realmplayground_unique_together"),
    ]

    operations = [
        migrations.AlterField(
            model_name="realm",
            name="authentication_methods",
            field=bitfield.models.BitField(
                [
                    "Google",
                    "Email",
                    "GitHub",
                    "LDAP",
                    "Dev",
                    "RemoteUser",
                    "AzureAD",
                    "SAML",
                    "GitLab",
                    "Apple",
                    "OpenID Connect",
                ],
                default=2147483647,
            ),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0327_realm_edit_topic_policy.py]---
Location: zulip-main/zerver/migrations/0327_realm_edit_topic_policy.py
Signals: Django

```python
# Generated by Django 3.2.2 on 2021-05-26 09:39

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0326_alter_realm_authentication_methods"),
    ]

    operations = [
        migrations.AddField(
            model_name="realm",
            name="edit_topic_policy",
            field=models.PositiveSmallIntegerField(default=5),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0328_migrate_to_edit_topic_policy.py]---
Location: zulip-main/zerver/migrations/0328_migrate_to_edit_topic_policy.py
Signals: Django

```python
# Generated by Django 3.2.2 on 2021-05-26 09:43

from django.db import migrations
from django.db.backends.base.schema import BaseDatabaseSchemaEditor
from django.db.migrations.state import StateApps


def migrate_to_edit_topic_policy(apps: StateApps, schema_editor: BaseDatabaseSchemaEditor) -> None:
    Realm = apps.get_model("zerver", "Realm")
    Realm.POLICY_EVERYONE = 5
    Realm.POLICY_ADMINS_ONLY = 2
    Realm.objects.filter(allow_community_topic_editing=False).update(
        edit_topic_policy=Realm.POLICY_ADMINS_ONLY
    )
    Realm.objects.filter(allow_community_topic_editing=True).update(
        edit_topic_policy=Realm.POLICY_EVERYONE
    )


def reverse_migrate_to_edit_topic_policy(
    apps: StateApps, schema_editor: BaseDatabaseSchemaEditor
) -> None:
    Realm = apps.get_model("zerver", "Realm")
    Realm.POLICY_EVERYONE = 5
    Realm.POLICY_ADMINS_ONLY = 2
    Realm.objects.filter(edit_topic_policy=Realm.POLICY_ADMINS_ONLY).update(
        allow_community_topic_editing=False
    )
    Realm.objects.filter(edit_topic_policy=Realm.POLICY_EVERYONE).update(
        allow_community_topic_editing=True
    )


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0327_realm_edit_topic_policy"),
    ]

    operations = [
        migrations.RunPython(
            migrate_to_edit_topic_policy,
            reverse_code=reverse_migrate_to_edit_topic_policy,
            elidable=True,
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0329_remove_realm_allow_community_topic_editing.py]---
Location: zulip-main/zerver/migrations/0329_remove_realm_allow_community_topic_editing.py
Signals: Django

```python
# Generated by Django 3.2.2 on 2021-05-26 09:48

from django.db import migrations


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0328_migrate_to_edit_topic_policy"),
    ]

    operations = [
        migrations.RemoveField(
            model_name="realm",
            name="allow_community_topic_editing",
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0330_linkifier_pattern_validator.py]---
Location: zulip-main/zerver/migrations/0330_linkifier_pattern_validator.py
Signals: Django

```python
# Generated by Django 3.1.8 on 2021-04-18 15:36

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0329_remove_realm_allow_community_topic_editing"),
    ]

    operations = [
        migrations.AlterField(
            model_name="realmfilter",
            name="pattern",
            field=models.TextField(),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0331_scheduledmessagenotificationemail.py]---
Location: zulip-main/zerver/migrations/0331_scheduledmessagenotificationemail.py
Signals: Django

```python
# Generated by Django 3.2.5 on 2021-07-09 11:08

import django.db.models.deletion
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0330_linkifier_pattern_validator"),
    ]

    operations = [
        migrations.CreateModel(
            name="ScheduledMessageNotificationEmail",
            fields=[
                (
                    "id",
                    models.AutoField(
                        auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
                    ),
                ),
                (
                    "trigger",
                    models.TextField(
                        choices=[
                            ("direct_message", "Direct message"),
                            ("mentioned", "Mention"),
                            ("topic_wildcard_mentioned", "Topic wildcard mention"),
                            ("stream_wildcard_mentioned", "Stream wildcard mention"),
                            ("stream_email_notify", "Stream notifications enabled"),
                            ("followed_topic_email_notify", "Followed topic notifications enabled"),
                            (
                                "topic_wildcard_mentioned_in_followed_topic",
                                "Topic wildcard mention in followed topic",
                            ),
                            (
                                "stream_wildcard_mentioned_in_followed_topic",
                                "Stream wildcard mention in followed topic",
                            ),
                        ]
                    ),
                ),
                ("scheduled_timestamp", models.DateTimeField(db_index=True)),
                (
                    "mentioned_user_group",
                    models.ForeignKey(
                        null=True,
                        on_delete=django.db.models.deletion.CASCADE,
                        to="zerver.usergroup",
                    ),
                ),
                (
                    "message",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE, to="zerver.message"
                    ),
                ),
                (
                    "user_profile",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL
                    ),
                ),
            ],
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0332_realmuserdefault.py]---
Location: zulip-main/zerver/migrations/0332_realmuserdefault.py
Signals: Django

```python
# Generated by Django 3.2.2 on 2021-05-31 16:49

import django.db.models.deletion
from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0331_scheduledmessagenotificationemail"),
    ]

    operations = [
        migrations.CreateModel(
            name="RealmUserDefault",
            fields=[
                (
                    "id",
                    models.AutoField(
                        auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
                    ),
                ),
                ("enter_sends", models.BooleanField(null=True, default=False)),
                ("left_side_userlist", models.BooleanField(default=False)),
                ("default_language", models.CharField(default="en", max_length=50)),
                ("default_view", models.TextField(default="recent_topics")),
                ("dense_mode", models.BooleanField(default=True)),
                ("fluid_layout_width", models.BooleanField(default=False)),
                ("high_contrast_mode", models.BooleanField(default=False)),
                ("translate_emoticons", models.BooleanField(default=False)),
                ("twenty_four_hour_time", models.BooleanField(default=False)),
                ("starred_message_counts", models.BooleanField(default=True)),
                ("color_scheme", models.PositiveSmallIntegerField(default=1)),
                ("demote_inactive_streams", models.PositiveSmallIntegerField(default=1)),
                (
                    "emojiset",
                    models.CharField(
                        choices=[
                            ("google", "Google modern"),
                            ("google-blob", "Google classic"),
                            ("twitter", "Twitter"),
                            ("text", "Plain text"),
                        ],
                        default="google-blob",
                        max_length=20,
                    ),
                ),
                ("enable_stream_desktop_notifications", models.BooleanField(default=False)),
                ("enable_stream_email_notifications", models.BooleanField(default=False)),
                ("enable_stream_push_notifications", models.BooleanField(default=False)),
                ("enable_stream_audible_notifications", models.BooleanField(default=False)),
                ("notification_sound", models.CharField(default="zulip", max_length=20)),
                ("wildcard_mentions_notify", models.BooleanField(default=True)),
                ("enable_desktop_notifications", models.BooleanField(default=True)),
                ("pm_content_in_desktop_notifications", models.BooleanField(default=True)),
                ("enable_sounds", models.BooleanField(default=True)),
                ("enable_offline_email_notifications", models.BooleanField(default=True)),
                ("message_content_in_email_notifications", models.BooleanField(default=True)),
                ("enable_offline_push_notifications", models.BooleanField(default=True)),
                ("enable_online_push_notifications", models.BooleanField(default=True)),
                ("desktop_icon_count_display", models.PositiveSmallIntegerField(default=1)),
                ("enable_digest_emails", models.BooleanField(default=True)),
                ("enable_login_emails", models.BooleanField(default=True)),
                ("enable_marketing_emails", models.BooleanField(default=True)),
                ("realm_name_in_notifications", models.BooleanField(default=False)),
                ("presence_enabled", models.BooleanField(default=True)),
                (
                    "realm",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE, to="zerver.realm"
                    ),
                ),
            ],
            options={
                "abstract": False,
            },
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0333_alter_realm_org_type.py]---
Location: zulip-main/zerver/migrations/0333_alter_realm_org_type.py
Signals: Django

```python
# Generated by Django 3.2.4 on 2021-07-06 20:34

from django.db import migrations, models
from django.db.backends.base.schema import BaseDatabaseSchemaEditor
from django.db.migrations.state import StateApps


def reset_realm_org_type(apps: StateApps, schema_editor: BaseDatabaseSchemaEditor) -> None:
    UNSPECIFIED = 0
    Realm = apps.get_model("zerver", "Realm")
    Realm.objects.all().update(org_type=UNSPECIFIED)


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0332_realmuserdefault"),
    ]

    operations = [
        migrations.AlterField(
            model_name="realm",
            name="org_type",
            field=models.PositiveSmallIntegerField(
                choices=[
                    (0, "Unspecified"),
                    (10, "Business"),
                    (20, "Open-source project"),
                    (30, "Education (non-profit)"),
                    (35, "Education (for-profit)"),
                    (40, "Research"),
                    (50, "Event or conference"),
                    (60, "Non-profit (registered)"),
                    (70, "Government"),
                    (80, "Political group"),
                    (90, "Community"),
                    (100, "Personal"),
                    (1000, "Other"),
                ],
                default=0,
            ),
        ),
        migrations.RunPython(
            reset_realm_org_type, reverse_code=migrations.RunPython.noop, elidable=True
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0334_email_notifications_batching_period.py]---
Location: zulip-main/zerver/migrations/0334_email_notifications_batching_period.py
Signals: Django

```python
# Generated by Django 3.2.5 on 2021-07-19 11:00

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0333_alter_realm_org_type"),
    ]

    operations = [
        migrations.AddField(
            model_name="realmuserdefault",
            name="email_notifications_batching_period_seconds",
            field=models.IntegerField(default=120),
        ),
        migrations.AddField(
            model_name="userprofile",
            name="email_notifications_batching_period_seconds",
            field=models.IntegerField(default=120),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0335_add_draft_sync_field.py]---
Location: zulip-main/zerver/migrations/0335_add_draft_sync_field.py
Signals: Django

```python
# Generated by Django 3.2.5 on 2021-07-23 04:46

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0334_email_notifications_batching_period"),
    ]

    operations = [
        migrations.AddField(
            model_name="realmuserdefault",
            name="enable_drafts_synchronization",
            field=models.BooleanField(default=True),
        ),
        migrations.AddField(
            model_name="userprofile",
            name="enable_drafts_synchronization",
            field=models.BooleanField(default=True),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0336_userstatus_status_emoji.py]---
Location: zulip-main/zerver/migrations/0336_userstatus_status_emoji.py
Signals: Django

```python
# Generated by Django 3.2.5 on 2021-07-20 13:13

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0335_add_draft_sync_field"),
    ]

    operations = [
        migrations.AddField(
            model_name="userstatus",
            name="emoji_code",
            field=models.TextField(default=""),
        ),
        migrations.AddField(
            model_name="userstatus",
            name="emoji_name",
            field=models.TextField(default=""),
        ),
        migrations.AddField(
            model_name="userstatus",
            name="reaction_type",
            field=models.CharField(
                choices=[
                    ("unicode_emoji", "Unicode emoji"),
                    ("realm_emoji", "Custom emoji"),
                    ("zulip_extra_emoji", "Zulip extra emoji"),
                ],
                default="unicode_emoji",
                max_length=30,
            ),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0337_realm_add_custom_emoji_policy.py]---
Location: zulip-main/zerver/migrations/0337_realm_add_custom_emoji_policy.py
Signals: Django

```python
# Generated by Django 3.2.2 on 2021-05-15 18:00

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0336_userstatus_status_emoji"),
    ]

    operations = [
        migrations.AddField(
            model_name="realm",
            name="add_custom_emoji_policy",
            field=models.PositiveSmallIntegerField(default=1),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0338_migrate_to_add_custom_emoji_policy.py]---
Location: zulip-main/zerver/migrations/0338_migrate_to_add_custom_emoji_policy.py
Signals: Django

```python
# Generated by Django 3.2.2 on 2021-05-15 18:01

from django.db import migrations
from django.db.backends.base.schema import BaseDatabaseSchemaEditor
from django.db.migrations.state import StateApps


def migrate_to_add_custom_emoji_policy(
    apps: StateApps, schema_editor: BaseDatabaseSchemaEditor
) -> None:
    Realm = apps.get_model("zerver", "Realm")
    Realm.ADD_CUSTOM_EMOJI_MEMBERS_ONLY = 1
    Realm.ADD_CUSTOM_EMOJI_ADMINS_ONLY = 2
    Realm.objects.filter(add_emoji_by_admins_only=False).update(
        add_custom_emoji_policy=Realm.ADD_CUSTOM_EMOJI_MEMBERS_ONLY
    )
    Realm.objects.filter(add_emoji_by_admins_only=True).update(
        add_custom_emoji_policy=Realm.ADD_CUSTOM_EMOJI_ADMINS_ONLY
    )


def reverse_migrate_to_add_custom_emoji_policy(
    apps: StateApps, schema_editor: BaseDatabaseSchemaEditor
) -> None:
    Realm = apps.get_model("zerver", "Realm")
    Realm.ADD_CUSTOM_EMOJI_MEMBERS_ONLY = 1
    Realm.ADD_CUSTOM_EMOJI_ADMINS_ONLY = 2
    Realm.objects.filter(add_custom_emoji_policy=Realm.ADD_CUSTOM_EMOJI_MEMBERS_ONLY).update(
        add_emoji_by_admins_only=False
    )
    Realm.objects.filter(add_custom_emoji_policy=Realm.ADD_CUSTOM_EMOJI_ADMINS_ONLY).update(
        add_emoji_by_admins_only=True
    )


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0337_realm_add_custom_emoji_policy"),
    ]

    operations = [
        migrations.RunPython(
            migrate_to_add_custom_emoji_policy,
            reverse_code=reverse_migrate_to_add_custom_emoji_policy,
            elidable=True,
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0339_remove_realm_add_emoji_by_admins_only.py]---
Location: zulip-main/zerver/migrations/0339_remove_realm_add_emoji_by_admins_only.py
Signals: Django

```python
# Generated by Django 3.2.2 on 2021-05-15 18:05

from django.db import migrations


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0338_migrate_to_add_custom_emoji_policy"),
    ]

    operations = [
        migrations.RemoveField(
            model_name="realm",
            name="add_emoji_by_admins_only",
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0340_rename_mutedtopic_to_usertopic.py]---
Location: zulip-main/zerver/migrations/0340_rename_mutedtopic_to_usertopic.py
Signals: Django

```python
# Generated by Django 3.2.5 on 2021-07-23 13:15

from django.db import migrations


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0339_remove_realm_add_emoji_by_admins_only"),
    ]

    operations = [
        migrations.RenameModel(
            old_name="MutedTopic",
            new_name="UserTopic",
        ),
        migrations.AlterModelTable(
            name="usertopic",
            table="zerver_mutedtopic",
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0341_usergroup_is_system_group.py]---
Location: zulip-main/zerver/migrations/0341_usergroup_is_system_group.py
Signals: Django

```python
# Generated by Django 3.2.5 on 2021-08-06 10:04

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0340_rename_mutedtopic_to_usertopic"),
    ]

    operations = [
        migrations.AddField(
            model_name="usergroup",
            name="is_system_group",
            field=models.BooleanField(default=False),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0342_realm_demo_organization_scheduled_deletion_date.py]---
Location: zulip-main/zerver/migrations/0342_realm_demo_organization_scheduled_deletion_date.py
Signals: Django

```python
# Generated by Django 3.2.5 on 2021-08-12 18:41

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0341_usergroup_is_system_group"),
    ]

    operations = [
        migrations.AddField(
            model_name="realm",
            name="demo_organization_scheduled_deletion_date",
            field=models.DateTimeField(default=None, null=True),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0343_alter_useractivityinterval_index_together.py]---
Location: zulip-main/zerver/migrations/0343_alter_useractivityinterval_index_together.py
Signals: Django

```python
# Generated by Django 3.2.6 on 2021-08-31 19:17

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0342_realm_demo_organization_scheduled_deletion_date"),
    ]

    operations = [
        migrations.AddIndex(
            model_name="useractivityinterval",
            index=models.Index(
                fields=["user_profile", "end"],
                name="zerver_useractivityinterval_user_profile_id_end_bb3bfc37_idx",
            ),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0344_alter_emojiset_default_value.py]---
Location: zulip-main/zerver/migrations/0344_alter_emojiset_default_value.py
Signals: Django

```python
# Generated by Django 3.2.6 on 2021-09-08 20:13

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0343_alter_useractivityinterval_index_together"),
    ]

    operations = [
        migrations.AlterField(
            model_name="realmuserdefault",
            name="emojiset",
            field=models.CharField(
                choices=[
                    ("google", "Google"),
                    ("twitter", "Twitter"),
                    ("text", "Plain text"),
                    ("google-blob", "Google blobs"),
                ],
                default="google",
                max_length=20,
            ),
        ),
        migrations.AlterField(
            model_name="userprofile",
            name="emojiset",
            field=models.CharField(
                choices=[
                    ("google", "Google"),
                    ("twitter", "Twitter"),
                    ("text", "Plain text"),
                    ("google-blob", "Google blobs"),
                ],
                default="google",
                max_length=20,
            ),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0345_alter_realm_name.py]---
Location: zulip-main/zerver/migrations/0345_alter_realm_name.py
Signals: Django

```python
# Generated by Django 3.2.6 on 2021-09-08 22:35

from django.conf import settings
from django.db import migrations, models
from django.db.backends.base.schema import BaseDatabaseSchemaEditor
from django.db.migrations.state import StateApps


def rename_system_bot_realm(apps: StateApps, schema_editor: BaseDatabaseSchemaEditor) -> None:
    # Prior to this migration, the system bot realm had name incorrectly set to null.
    Realm = apps.get_model("zerver", "Realm")
    Realm.objects.filter(name=None, string_id=settings.SYSTEM_BOT_REALM).update(
        name="System bot realm"
    )


class Migration(migrations.Migration):
    atomic = False

    dependencies = [
        ("zerver", "0344_alter_emojiset_default_value"),
    ]

    operations = [
        migrations.RunPython(
            rename_system_bot_realm,
            reverse_code=migrations.RunPython.noop,
            elidable=True,
        ),
        migrations.AlterField(
            model_name="realm",
            name="name",
            field=models.CharField(max_length=40),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0346_create_realm_user_default_table.py]---
Location: zulip-main/zerver/migrations/0346_create_realm_user_default_table.py
Signals: Django

```python
# Generated by Django 3.2.2 on 2021-06-01 16:19

from django.db import migrations
from django.db.backends.base.schema import BaseDatabaseSchemaEditor
from django.db.migrations.state import StateApps


def create_realm_user_default_table(
    apps: StateApps, schema_editor: BaseDatabaseSchemaEditor
) -> None:
    Realm = apps.get_model("zerver", "Realm")
    RealmUserDefault = apps.get_model("zerver", "RealmUserDefault")
    realms = Realm.objects.all()
    realm_user_default_objects = []
    for realm in realms:
        realm_user_default = RealmUserDefault(realm=realm)
        realm_user_default_objects.append(realm_user_default)
    RealmUserDefault.objects.bulk_create(realm_user_default_objects)


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0345_alter_realm_name"),
    ]

    operations = [
        migrations.RunPython(
            create_realm_user_default_table, reverse_code=migrations.RunPython.noop, elidable=True
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0347_realm_emoji_animated.py]---
Location: zulip-main/zerver/migrations/0347_realm_emoji_animated.py
Signals: Django

```python
# Generated by Django 3.2.6 on 2021-09-11 16:51

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0346_create_realm_user_default_table"),
    ]

    operations = [
        migrations.AddField(
            model_name="realmemoji",
            name="is_animated",
            field=models.BooleanField(default=False),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0348_rename_date_muted_usertopic_last_updated.py]---
Location: zulip-main/zerver/migrations/0348_rename_date_muted_usertopic_last_updated.py
Signals: Django

```python
# Generated by Django 3.2.5 on 2021-07-29 11:47

from django.db import migrations


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0347_realm_emoji_animated"),
    ]

    operations = [
        migrations.RenameField(
            model_name="usertopic",
            old_name="date_muted",
            new_name="last_updated",
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0349_alter_usertopic_table.py]---
Location: zulip-main/zerver/migrations/0349_alter_usertopic_table.py
Signals: Django

```python
# Generated by Django 3.2.5 on 2021-07-31 05:38

from django.db import migrations


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0348_rename_date_muted_usertopic_last_updated"),
    ]

    operations = [
        migrations.AlterModelTable(
            name="UserTopic",
            table=None,
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0350_usertopic_visibility_policy.py]---
Location: zulip-main/zerver/migrations/0350_usertopic_visibility_policy.py
Signals: Django

```python
# Generated by Django 3.2.5 on 2021-08-02 07:29

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0349_alter_usertopic_table"),
    ]

    operations = [
        migrations.AddField(
            model_name="usertopic",
            name="visibility_policy",
            field=models.SmallIntegerField(
                choices=[
                    (1, "Muted topic"),
                    (2, "Unmuted topic in muted stream"),
                    (3, "Followed topic"),
                ],
                default=1,
            ),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0351_user_topic_visibility_indexes.py]---
Location: zulip-main/zerver/migrations/0351_user_topic_visibility_indexes.py
Signals: Django

```python
# Generated by Django 3.2.6 on 2021-09-17 18:34

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0350_usertopic_visibility_policy"),
    ]

    operations = [
        migrations.AddIndex(
            model_name="usertopic",
            index=models.Index(
                fields=["stream", "topic_name", "visibility_policy", "user_profile"],
                name="zerver_usertopic_stream_topic_user_visibility_idx",
            ),
        ),
        migrations.AddIndex(
            model_name="usertopic",
            index=models.Index(
                fields=["user_profile", "visibility_policy", "stream", "topic_name"],
                name="zerver_usertopic_user_visibility_idx",
            ),
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0352_migrate_twenty_four_hour_time_to_realmuserdefault.py]---
Location: zulip-main/zerver/migrations/0352_migrate_twenty_four_hour_time_to_realmuserdefault.py
Signals: Django

```python
# Generated by Django 3.2.6 on 2021-09-17 17:08

from django.db import migrations
from django.db.backends.base.schema import BaseDatabaseSchemaEditor
from django.db.migrations.state import StateApps
from django.db.models import F


def migrate_twenty_four_hour_time_to_realmuserdefault(
    apps: StateApps, schema_editor: BaseDatabaseSchemaEditor
) -> None:
    RealmUserDefault = apps.get_model("zerver", "RealmUserDefault")
    realm_user_default_objects = RealmUserDefault.objects.exclude(
        twenty_four_hour_time=F("realm__default_twenty_four_hour_time")
    )
    for realm_user_default in realm_user_default_objects:
        realm = realm_user_default.realm
        realm_user_default.twenty_four_hour_time = realm.default_twenty_four_hour_time
        realm_user_default.save(update_fields=["twenty_four_hour_time"])


def reverse_migrate_twenty_four_hour_time_to_realmuserdefault(
    apps: StateApps, schema_editor: BaseDatabaseSchemaEditor
) -> None:
    RealmUserDefault = apps.get_model("zerver", "RealmUserDefault")
    realm_user_default_objects = RealmUserDefault.objects.exclude(
        realm__default_twenty_four_hour_time=F("twenty_four_hour_time")
    )
    for realm_user_default in realm_user_default_objects:
        realm = realm_user_default.realm
        realm.default_twenty_four_hour_time = realm_user_default.twenty_four_hour_time
        realm.save(update_fields=["default_twenty_four_hour_time"])


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0351_user_topic_visibility_indexes"),
    ]

    operations = [
        migrations.RunPython(
            migrate_twenty_four_hour_time_to_realmuserdefault,
            reverse_code=reverse_migrate_twenty_four_hour_time_to_realmuserdefault,
            elidable=True,
        ),
    ]
```

--------------------------------------------------------------------------------

---[FILE: 0353_remove_realm_default_twenty_four_hour_time.py]---
Location: zulip-main/zerver/migrations/0353_remove_realm_default_twenty_four_hour_time.py
Signals: Django

```python
# Generated by Django 3.2.6 on 2021-09-17 18:25

from django.db import migrations


class Migration(migrations.Migration):
    dependencies = [
        ("zerver", "0352_migrate_twenty_four_hour_time_to_realmuserdefault"),
    ]

    operations = [
        migrations.RemoveField(
            model_name="realm",
            name="default_twenty_four_hour_time",
        ),
    ]
```

--------------------------------------------------------------------------------

````
